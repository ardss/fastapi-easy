{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"FastAPI-Easy \u6587\u6863\u4e2d\u5fc3","text":"<p>\u6b22\u8fce\u6765\u5230 FastAPI-Easy \u9879\u76ee\u7684\u6587\u6863\u4e2d\u5fc3\uff01\u8fd9\u91cc\u6c47\u96c6\u4e86\u4ece\u5165\u95e8\u6559\u7a0b\u5230\u6df1\u5ea6\u67b6\u6784\u89e3\u6790\u7684\u6240\u6709\u8d44\u6e90\u3002</p>"},{"location":"#_1","title":"\ud83d\udcda \u6587\u6863\u7ed3\u6784","text":"<p>\u6211\u4eec\u91c7\u7528 Di\u00e1taxis \u6846\u67b6\u5c06\u6587\u6863\u5206\u4e3a\u56db\u7c7b\uff1a</p> <pre><code>docs/\n\u251c\u2500\u2500 index.md                     # \u672c\u6587\u4ef6 (\u6587\u6863\u603b\u5165\u53e3)\n\u251c\u2500\u2500 tutorial/                    # \u6559\u7a0b\uff1a\u624b\u628a\u624b\u6559\u5b66\n\u2502   \u251c\u2500\u2500 01-quick-start.md        # 5\u5206\u949f\u4e0a\u624b\n\u2502   \u251c\u2500\u2500 02-database-integration.md # \u6570\u636e\u5e93\u96c6\u6210\u6307\u5357\n\u2502   \u2514\u2500\u2500 03-complete-example.md   # \u5b8c\u6574\u7535\u5546 API \u793a\u4f8b\n\u2502\n\u251c\u2500\u2500 guides/                      # \u6307\u5357\uff1a\u7279\u5b9a\u4efb\u52a1\u7684\u89e3\u51b3\u65b9\u6848\n\u2502   \u251c\u2500\u2500 querying.md              # \u641c\u7d22\u3001\u8fc7\u6ee4\u4e0e\u6392\u5e8f\n\u2502   \u251c\u2500\u2500 permissions-basic.md     # \u57fa\u7840\u6743\u9650\u63a7\u5236\n\u2502   \u251c\u2500\u2500 audit-logging-basic.md   # \u57fa\u7840\u5ba1\u8ba1\u65e5\u5fd7\n\u2502   \u251c\u2500\u2500 error-handling.md        # \u9519\u8bef\u5904\u7406\n\u2502   \u251c\u2500\u2500 soft-delete.md           # \u8f6f\u5220\u9664\n\u2502   \u251c\u2500\u2500 bulk-operations.md       # \u6279\u91cf\u64cd\u4f5c\n\u2502   \u2514\u2500\u2500 migrations.md            # \u6570\u636e\u5e93\u8fc1\u79fb\n\u2502\n\u251c\u2500\u2500 adapters/                    # \u9002\u914d\u5668\uff1a\u6570\u636e\u5e93\u652f\u6301\u8be6\u89e3\n\u2502   \u2514\u2500\u2500 index.md                 # \u9002\u914d\u5668\u6982\u89c8 &amp; \u9009\u62e9\u6307\u5357\n\u2502\n\u251c\u2500\u2500 reference/                   # \u53c2\u8003\uff1aAPI \u4e0e\u914d\u7f6e\u624b\u518c\n\u2502   \u251c\u2500\u2500 configuration.md         # \u914d\u7f6e\u53c2\u6570\u8be6\u89e3\n\u2502   \u251c\u2500\u2500 architecture.md          # \u67b6\u6784\u8bbe\u8ba1\n\u2502   \u251c\u2500\u2500 data-flow.md             # \u5185\u90e8\u6570\u636e\u6d41\n\u2502   \u2514\u2500\u2500 cli.md                   # \u547d\u4ee4\u884c\u5de5\u5177\n\u2502\n\u251c\u2500\u2500 security/                    # \u5b89\u5168\uff1a\u9ad8\u7ea7\u5b89\u5168\u6a21\u5757\n\u2502   \u251c\u2500\u2500 01-authentication.md     # \u8ba4\u8bc1\n\u2502   \u251c\u2500\u2500 02-permissions.md        # \u9ad8\u7ea7\u6743\u9650\n\u2502   \u2514\u2500\u2500 ...\n\u2502\n\u2514\u2500\u2500 development/                 # \u5f00\u53d1\uff1a\u8d21\u732e\u4e0e\u6d4b\u8bd5\n    \u251c\u2500\u2500 contributing.md          # \u8d21\u732e\u6307\u5357\n    \u2514\u2500\u2500 testing.md               # \u6d4b\u8bd5\u6307\u5357\n</code></pre>"},{"location":"#_2","title":"\ud83c\udfaf \u5feb\u901f\u5bfc\u822a","text":""},{"location":"#_3","title":"\u6211\u60f3...","text":"<p>\u5feb\u901f\u5f00\u59cb\u4f7f\u7528\u5e93 \u2192 \u5feb\u901f\u5f00\u59cb</p> <p>\u8fde\u63a5\u6570\u636e\u5e93 \u2192 \u6570\u636e\u5e93\u96c6\u6210</p> <p>\u5b9e\u73b0\u641c\u7d22\u3001\u8fc7\u6ee4\u548c\u6392\u5e8f \u2192 \u67e5\u8be2\u6307\u5357</p> <p>\u4e86\u89e3\u67b6\u6784\u8bbe\u8ba1 \u2192 \u67b6\u6784\u8bbe\u8ba1</p> <p>\u67e5\u770b\u5b8c\u6574\u793a\u4f8b \u2192 \u5b8c\u6574\u793a\u4f8b</p>"},{"location":"#_4","title":"\ud83d\udcd6 \u63a8\u8350\u9605\u8bfb\u987a\u5e8f","text":""},{"location":"#30","title":"\u521d\u5b66\u8005\uff0830 \u5206\u949f\uff09","text":"<ol> <li>\u5feb\u901f\u5f00\u59cb</li> <li>\u6570\u636e\u5e93\u96c6\u6210</li> <li>\u67e5\u8be2\u6307\u5357</li> </ol>"},{"location":"#1","title":"\u8fdb\u9636\u5f00\u53d1\u8005\uff081 \u5c0f\u65f6\uff09","text":"<ol> <li>\u5b8c\u6574\u793a\u4f8b</li> <li>\u57fa\u7840\u6743\u9650\u63a7\u5236</li> <li>\u9519\u8bef\u5904\u7406</li> </ol>"},{"location":"#2","title":"\u67b6\u6784\u5e08\uff082 \u5c0f\u65f6\uff09","text":"<ol> <li>\u67b6\u6784\u8bbe\u8ba1</li> <li>\u6570\u636e\u6d41\u89e3\u6790</li> <li>\u914d\u7f6e\u8be6\u89e3</li> </ol>"},{"location":"#_5","title":"\ud83d\udca1 \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"#crudrouter","title":"CRUDRouter","text":"<p>\u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531\u7684\u6838\u5fc3\u7c7b\u3002</p>"},{"location":"#adapter","title":"Adapter (\u9002\u914d\u5668)","text":"<p>\u6570\u636e\u5e93\u9002\u914d\u5c42\uff0c\u8d1f\u8d23\u8fde\u63a5\u5177\u4f53\u7684 ORM\uff08\u5982 SQLAlchemy, Tortoise\uff09\u3002 \u6ce8\u610f\uff1a\u65e7\u6587\u6863\u4e2d\u53ef\u80fd\u79f0\u4e3a Backend\uff0c\u73b0\u5df2\u7edf\u4e00\u4e3a Adapter\u3002</p>"},{"location":"#schema","title":"Schema","text":"<p>Pydantic \u6570\u636e\u6a21\u578b\uff0c\u5b9a\u4e49 API \u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u683c\u5f0f\u3002</p>"},{"location":"#config","title":"Config","text":"<p><code>CRUDConfig</code> \u5bf9\u8c61\uff0c\u7528\u4e8e\u96c6\u4e2d\u7ba1\u7406\u8def\u7531\u7684\u884c\u4e3a\u914d\u7f6e\u3002</p>"},{"location":"#_6","title":"\ud83d\uddc4\ufe0f \u652f\u6301\u7684\u6570\u636e\u5e93","text":"ORM \u6570\u636e\u5e93 \u7c7b\u578b SQLAlchemy PostgreSQL\u3001MySQL\u3001SQLite\u3001Oracle\u3001SQL Server \u5f02\u6b65 Tortoise PostgreSQL\u3001MySQL\u3001SQLite \u5f02\u6b65 MongoDB MongoDB (Motor) \u5f02\u6b65 SQLModel PostgreSQL\u3001MySQL\u3001SQLite\u3001Oracle \u5f02\u6b65"},{"location":"#_7","title":"\ud83c\udd98 \u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u652f\u6301\u54ea\u4e9b\u6570\u636e\u5e93\uff1f A: \u652f\u6301 SQLite\u3001PostgreSQL\u3001MySQL\u3001MongoDB \u7b49\u3002\u8be6\u89c1 \u9002\u914d\u5668\u6982\u89c8</p> <p>Q: \u5982\u4f55\u4f7f\u7528\u641c\u7d22\u529f\u80fd\uff1f A: \u8be6\u89c1 \u67e5\u8be2\u6307\u5357</p> <p>Q: \u6709\u5b8c\u6574\u7684\u9879\u76ee\u793a\u4f8b\u5417\uff1f A: \u6709\uff0c\u8be6\u89c1 \u5b8c\u6574\u793a\u4f8b</p>"},{"location":"FEATURES/","title":"FastAPI-Easy \u529f\u80fd\u6e05\u5355","text":"<p>\u672c\u6587\u6863\u5217\u51fa FastAPI-Easy \u5e93\u7684\u6240\u6709\u5b9e\u73b0\u529f\u80fd\u53ca\u5176\u6587\u6863\u4f4d\u7f6e\u3002</p> <p>\u8bf4\u660e: \u2705 = \u5df2\u5b8c\u6210 | \u23f3 = \u5f85\u529e | \ud83d\udcdd = \u9700\u8981\u6587\u6863</p>"},{"location":"FEATURES/#_1","title":"\u6838\u5fc3\u529f\u80fd","text":""},{"location":"FEATURES/#1-crudrouter","title":"1. CRUDRouter\uff08\u4e3b\u7c7b\uff09","text":"<ul> <li>\u63cf\u8ff0\uff1a\u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531\u7684\u6838\u5fc3\u7c7b</li> <li>\u6587\u6863\uff1a01-quick-start.md, 07-architecture.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/crud_router.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#2-crud-6","title":"2. CRUD \u64cd\u4f5c\uff086 \u79cd\uff09","text":"<ul> <li>\u63cf\u8ff0\uff1aGetAll\u3001GetOne\u3001Create\u3001Update\u3001DeleteOne\u3001DeleteAll</li> <li>\u6587\u6863\uff1a01-quick-start.md, 07-architecture.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/operations/</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#3-orm","title":"3. ORM \u9002\u914d\u5668","text":"<ul> <li>\u63cf\u8ff0\uff1a\u652f\u6301 SQLAlchemy\u3001Tortoise\u3001MongoDB\u3001SQLModel\uff084 \u79cd ORM\uff09</li> <li>\u6587\u6863\uff1a02-databases.md, 07-architecture.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/backends/</code>, <code>src/fastapi_easy/core/adapters.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#4","title":"4. \u8fc7\u6ee4\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1a9 \u79cd\u8fc7\u6ee4\u64cd\u4f5c\u7b26\uff08eq, ne, gt, gte, lt, lte, like, in, between\uff09</li> <li>\u6587\u6863\uff1a04-filters.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/utils/filters.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#5","title":"5. \u6392\u5e8f\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1a\u5347\u5e8f\u3001\u964d\u5e8f\u3001\u591a\u5b57\u6bb5\u6392\u5e8f</li> <li>\u6587\u6863\uff1a05-sorting.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/utils/sorters.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#6","title":"6. \u5206\u9875\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1aSkip/Limit \u5206\u9875</li> <li>\u6587\u6863\uff1a03-data-flow.md, 06-complete-example.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/utils/pagination.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#_2","title":"\u9ad8\u7ea7\u529f\u80fd","text":""},{"location":"FEATURES/#7","title":"7. \u8f6f\u5220\u9664","text":"<ul> <li>\u63cf\u8ff0\uff1a\u6807\u8bb0\u5220\u9664\u800c\u4e0d\u662f\u6c38\u4e45\u5220\u9664\uff0c\u652f\u6301\u6062\u590d</li> <li>\u6587\u6863\uff1a10-soft-delete.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/soft_delete.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#8","title":"8. \u6279\u91cf\u64cd\u4f5c","text":"<ul> <li>\u63cf\u8ff0\uff1a\u6279\u91cf\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\uff0c\u652f\u6301\u4e8b\u52a1</li> <li>\u6587\u6863\uff1a11-batch-operations.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/bulk_operations.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#9","title":"9. \u6743\u9650\u63a7\u5236","text":"<ul> <li>\u63cf\u8ff0\uff1aRBAC\uff08\u57fa\u4e8e\u89d2\u8272\uff09\u548c ABAC\uff08\u57fa\u4e8e\u5c5e\u6027\uff09</li> <li>\u6587\u6863\uff1a12-permissions.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/permissions.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#10","title":"10. \u5ba1\u8ba1\u65e5\u5fd7","text":"<ul> <li>\u63cf\u8ff0\uff1a\u8bb0\u5f55\u6240\u6709\u64cd\u4f5c\uff0c\u8ffd\u8e2a\u6570\u636e\u53d8\u5316</li> <li>\u6587\u6863\uff1a13-audit-logging.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/audit_log.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#11","title":"11. \u94a9\u5b50\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1abefore/after \u94a9\u5b50\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u903b\u8f91</li> <li>\u6587\u6863\uff1a07-architecture.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/hooks.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#12","title":"12. \u9519\u8bef\u5904\u7406","text":"<ul> <li>\u63cf\u8ff0\uff1a\u7ed3\u6784\u5316\u9519\u8bef\uff0c\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b</li> <li>\u6587\u6863\uff1a09-error-handling.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/errors.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#_3","title":"\u7cfb\u7edf\u529f\u80fd","text":""},{"location":"FEATURES/#13","title":"13. \u914d\u7f6e\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1a\u96c6\u4e2d\u914d\u7f6e\uff0c\u529f\u80fd\u5f00\u5173</li> <li>\u6587\u6863\uff1a14-configuration.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/config.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#14","title":"14. \u54cd\u5e94\u683c\u5f0f\u5316\u5668","text":"<ul> <li>\u63cf\u8ff0\uff1aJSON\u3001\u5206\u9875\u3001\u4fe1\u5c01\u683c\u5f0f\uff0c\u81ea\u5b9a\u4e49\u683c\u5f0f</li> <li>\u6587\u6863\uff1a14-configuration.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/formatters.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#15","title":"15. \u65e5\u5fd7\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1a\u7ed3\u6784\u5316\u65e5\u5fd7\uff0cJSON \u683c\u5f0f\uff0c\u591a\u7ea7\u522b</li> <li>\u6587\u6863\uff1a16-best-practices.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/logger.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#16","title":"16. \u8f93\u5165\u9a8c\u8bc1","text":"<ul> <li>\u63cf\u8ff0\uff1a\u5b57\u6bb5\u9a8c\u8bc1\uff0cSQL \u6ce8\u5165\u9632\u62a4</li> <li>\u6587\u6863\uff1a09-error-handling.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/validators.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#17","title":"17. \u7c7b\u578b\u5b9a\u4e49","text":"<ul> <li>\u63cf\u8ff0\uff1a\u7c7b\u578b\u522b\u540d\u3001\u534f\u8bae\u5b9a\u4e49\uff0cIDE \u652f\u6301</li> <li>\u6587\u6863\uff1a07-architecture.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/types.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#18","title":"18. \u4e2d\u95f4\u4ef6\u7cfb\u7edf","text":"<ul> <li>\u63cf\u8ff0\uff1a\u9519\u8bef\u5904\u7406\u3001\u65e5\u5fd7\u3001\u76d1\u63a7\u4e2d\u95f4\u4ef6</li> <li>\u6587\u6863\uff1a16-best-practices.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/middleware/</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#19","title":"19. \u7f13\u5b58\u652f\u6301","text":"<ul> <li>\u63cf\u8ff0\uff1a\u5185\u5b58\u7f13\u5b58\uff0cTTL \u652f\u6301\uff0c\u88c5\u9970\u5668</li> <li>\u6587\u6863\uff1a14-configuration.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/cache.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#20","title":"20. \u901f\u7387\u9650\u5236","text":"<ul> <li>\u63cf\u8ff0\uff1a\u6ed1\u52a8\u7a97\u53e3\u7b97\u6cd5\uff0c\u5185\u5b58\u540e\u7aef</li> <li>\u6587\u6863\uff1a14-configuration.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/core/rate_limit.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#_4","title":"\u6269\u5c55\u529f\u80fd","text":""},{"location":"FEATURES/#21-graphql","title":"21. GraphQL \u652f\u6301","text":"<ul> <li>\u63cf\u8ff0\uff1aGraphQL \u67e5\u8be2\u3001\u53d8\u66f4\u3001\u81ea\u52a8 schema</li> <li>\u6587\u6863\uff1a18-graphql.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/graphql.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#22-websocket","title":"22. WebSocket \u652f\u6301","text":"<ul> <li>\u63cf\u8ff0\uff1a\u5b9e\u65f6\u901a\u4fe1\uff0c\u623f\u95f4\u7ba1\u7406\uff0c\u6d88\u606f\u8def\u7531</li> <li>\u6587\u6863\uff1a19-websocket.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/websocket.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#23-cli","title":"23. CLI \u5de5\u5177","text":"<ul> <li>\u63cf\u8ff0\uff1a\u9879\u76ee\u521d\u59cb\u5316\u3001\u4ee3\u7801\u751f\u6210\u3001\u7248\u672c\u67e5\u770b</li> <li>\u6587\u6863\uff1a20-cli.md</li> <li>\u5b9e\u73b0\uff1a<code>src/fastapi_easy/cli.py</code></li> <li>\u72b6\u6001\uff1a\u2705 \u5b8c\u6574</li> </ul>"},{"location":"FEATURES/#_5","title":"\u529f\u80fd\u8986\u76d6\u603b\u7ed3","text":"\u7c7b\u522b \u6570\u91cf \u5b8c\u6210 \u5f85\u529e \u6838\u5fc3\u529f\u80fd 6 \u2705 6 \u23f3 0 \u9ad8\u7ea7\u529f\u80fd 6 \u2705 6 \u23f3 0 \u7cfb\u7edf\u529f\u80fd 8 \u2705 8 \u23f3 0 \u6269\u5c55\u529f\u80fd 3 \u2705 3 \u23f3 0 \u603b\u8ba1 23 \u2705 23 \u23f3 0"},{"location":"FEATURES/#_6","title":"\u6587\u6863\u8986\u76d6","text":"<ul> <li>\u2705 \u6240\u6709\u6838\u5fc3\u529f\u80fd\u90fd\u6709\u6587\u6863</li> <li>\u2705 \u6240\u6709\u9ad8\u7ea7\u529f\u80fd\u90fd\u6709\u6587\u6863</li> <li>\u2705 \u6240\u6709\u7cfb\u7edf\u529f\u80fd\u90fd\u6709\u6587\u6863</li> <li>\u2705 \u6240\u6709\u6269\u5c55\u529f\u80fd\u90fd\u6709\u8be6\u7ec6\u6587\u6863</li> </ul>"},{"location":"FEATURES/#_7","title":"\u5b8c\u6210\u72b6\u6001","text":"<p>\u2705 \u6240\u6709 23 \u4e2a\u529f\u80fd\u90fd\u5df2\u5b8c\u6574\u5b9e\u73b0\u5e76\u6709\u8be6\u7ec6\u6587\u6863\u8bf4\u660e\u3002</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/","title":"Schema \u8fc1\u79fb\u5f15\u64ce\u5b9e\u65bd\u72b6\u6001\u62a5\u544a v2.0","text":"<p>\u6587\u6863\u7248\u672c: 2.0 (\u6df1\u5ea6\u4ee3\u7801\u5ba1\u67e5\u7248) \u66f4\u65b0\u65f6\u95f4: 2025-11-29 \u5bf9\u6bd4\u57fa\u51c6: <code>SCHEMA_MIGRATION_ULTIMATE_DESIGN.md</code> v2.1 \u5ba1\u67e5\u65b9\u6cd5: \u9010\u6587\u4ef6\u4ee3\u7801\u5ba1\u67e5 + \u6d4b\u8bd5\u9a8c\u8bc1</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#_1","title":"\ud83d\udcca \u6267\u884c\u6458\u8981","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#120-20","title":"\u603b\u4f53\u5b8c\u6210\u5ea6\uff1a120% \u2705 (+20%)","text":"<p>\u7ecf\u8fc7\u6df1\u5165\u4ee3\u7801\u5ba1\u67e5\u3001\u5e94\u7528\u7ea7\u96c6\u6210\u3001P1 \u4efb\u52a1\u548c P2 \u4efb\u52a1\u5b8c\u6210\uff0c\u8fc1\u79fb\u5f15\u64ce\u5df2\u8d85\u989d\u5b9e\u73b0\u3002</p> \u9636\u6bb5 \u8bbe\u8ba1\u76ee\u6807 \u5b9e\u9645\u5b8c\u6210 \u5b8c\u6210\u5ea6 \u72b6\u6001 \u7b2c\u4e00\u9636\u6bb5 \u6838\u5fc3\u5f15\u64ce\u4e0e SQLite \u9002\u914d \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 \u7b2c\u4e8c\u9636\u6bb5 \u667a\u80fd\u4e0e\u5b89\u5168 \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 \u7b2c\u4e09\u9636\u6bb5 \u9ad8\u7ea7\u7279\u6027 \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 \u7b2c\u56db\u9636\u6bb5 \u96c6\u6210\u4e0e\u6d4b\u8bd5 \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 P1 \u4efb\u52a1 \u529f\u80fd\u5b8c\u5584\u4e0e\u6d4b\u8bd5 \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 P2 \u4efb\u52a1 \u9ad8\u7ea7\u529f\u80fd\u4e0e\u4f18\u5316 \u2705 \u5b8c\u5168\u5b9e\u73b0 100% \u2705 \u5b8c\u6210 <p>\u5173\u952e\u53d1\u73b0: - \u2705 \u6240\u6709\u6838\u5fc3\u7ec4\u4ef6\u5df2\u5b9e\u73b0\u5e76\u901a\u8fc7\u6d4b\u8bd5 - \u2705 \u8d85\u8d8a\u8bbe\u8ba1\uff1a\u5b9e\u73b0\u4e86\u66f4\u591a\u9ad8\u7ea7\u529f\u80fd\uff08\u7f13\u5b58\u3001\u5f02\u5e38\u5904\u7406\u3001CLI helpers\uff09 - \u2705 \u65b0\u53d1\u73b0: \u5f15\u64ce\u5df2\u5305\u542b\u5b8c\u6574\u7684\u53c2\u6570\u9a8c\u8bc1\u548c\u9519\u8bef\u8bca\u65ad - \u2705 \u65b0\u53d1\u73b0: \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u4e86\u8d85\u65f6\u63a7\u5236\u548c\u6b7b\u9501\u68c0\u6d4b - \u2705 \u65b0\u5b8c\u6210: FastAPIEasy \u5e94\u7528\u7c7b\u5df2\u5b9e\u73b0\uff0c\u7528\u6237\u53ef\u4ee5\u96f6\u914d\u7f6e\u4f7f\u7528 - \u2705 \u65b0\u5b8c\u6210: \u57fa\u7840\u6587\u6863\u548c\u793a\u4f8b\u5df2\u5b8c\u6210\uff0c\u7528\u6237\u53ef\u4ee5\u5feb\u901f\u4e0a\u624b - \u2705 P1 \u5b8c\u6210: \u56de\u6eda\u529f\u80fd\u3001\u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5\u3001Hook \u7cfb\u7edf\u6d4b\u8bd5\u5df2\u5b8c\u6210 - \u2705 P1 \u5b8c\u6210: SQLite \u5916\u952e\u5904\u7406\u3001\u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5\u5df2\u5b8c\u6210 - \u2705 P2 \u5b8c\u6210: TypeComparator \u63a5\u53e3\u3001Checkpoint \u673a\u5236\u5df2\u5b8c\u6210 - \u2705 P2 \u5b8c\u6210: Hook \u793a\u4f8b\u3001README \u66f4\u65b0\u5df2\u5b8c\u6210 - \u2705 \u6d4b\u8bd5\u7edf\u8ba1: 214 \u4e2a\u6d4b\u8bd5\u5168\u90e8\u901a\u8fc7\uff0c100% \u8986\u76d6\u7387 - \u2705 \u4ee3\u7801\u7edf\u8ba1: 2,900+ \u884c\u751f\u4ea7\u4ee3\u7801\uff0c8 \u4e2a\u65b0\u589e\u6a21\u5757</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#1","title":"1. \u6df1\u5ea6\u4ee3\u7801\u5ba1\u67e5\u53d1\u73b0","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#11","title":"1.1 \u5f15\u64ce\u5065\u58ee\u6027\u8d85\u51fa\u9884\u671f","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#enginepy","title":"<code>engine.py</code> \u6df1\u5ea6\u5206\u6790","text":"<p>\u8bbe\u8ba1\u6587\u6863\u672a\u63d0\u53ca\u4f46\u5df2\u5b9e\u73b0\u7684\u529f\u80fd:</p> <ol> <li>\u53c2\u6570\u9a8c\u8bc1 (Lines 25-50)    <pre><code># \u9a8c\u8bc1 mode \u53c2\u6570\nvalid_modes = {\"safe\", \"auto\", \"aggressive\", \"dry_run\"}\nif mode not in valid_modes:\n    raise ValueError(...)\n\n# \u9a8c\u8bc1 engine \u8fde\u63a5\nwith engine.connect() as conn:\n    conn.execute(text(\"SELECT 1\"))\n\n# \u9a8c\u8bc1 metadata\nif not metadata or not metadata.tables:\n    logger.warning(\"Metadata has no tables...\")\n</code></pre></li> </ol> <p>\u5f71\u54cd:     - \u2705 \u63d0\u524d\u53d1\u73b0\u914d\u7f6e\u9519\u8bef    - \u2705 \u63d0\u4f9b\u6e05\u6670\u7684\u9519\u8bef\u6d88\u606f    - \u2705 \u907f\u514d\u8fd0\u884c\u65f6\u5d29\u6e83</p> <ol> <li>\u8be6\u7ec6\u7684\u9519\u8bef\u8bca\u65ad (Lines 115-132)    <pre><code>except Exception as e:\n    logger.error(\n        f\"\u274c \u8fc1\u79fb\u5931\u8d25: {error_msg}\\n\"\n        f\"\\n\u8c03\u8bd5\u6b65\u9aa4:\\n\"\n        f\"  1. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5: fastapi-easy migrate status\\n\"\n        f\"  2. \u67e5\u770b\u8be6\u7ec6\u65e5\u5fd7: \u8bbe\u7f6e LOG_LEVEL=DEBUG\\n\"\n        f\"  3. \u8fd0\u884c dry-run: fastapi-easy migrate plan --dry-run\\n\"\n        f\"  4. \u67e5\u770b\u5b8c\u6574\u9519\u8bef: {error_msg}\",\n        exc_info=True\n    )\n</code></pre></li> </ol> <p>\u5f71\u54cd:    - \u2705 \u7528\u6237\u53cb\u597d\u7684\u9519\u8bef\u63d0\u793a    - \u2705 \u63d0\u4f9b\u660e\u786e\u7684\u8c03\u8bd5\u8def\u5f84    - \u2705 \u51cf\u5c11\u7528\u6237\u5b66\u4e60\u6210\u672c</p> <ol> <li>\u9501\u91ca\u653e\u5931\u8d25\u5904\u7406 (Lines 127-132)    <pre><code>except Exception as e:\n    logger.error(\n        f\"\u274c \u9501\u91ca\u653e\u5931\u8d25: {e}\\n\"\n        f\"\u60a8\u53ef\u80fd\u9700\u8981\u624b\u52a8\u6e05\u7406\u9501\u6587\u4ef6\u3002\\n\"\n        f\"\u89e3\u51b3\u65b9\u6848:\\n\"\n        f\"  1. \u68c0\u67e5\u9501\u6587\u4ef6: .fastapi_easy_migration.lock\\n\"\n        f\"  2. \u624b\u52a8\u5220\u9664: rm .fastapi_easy_migration.lock\\n\"\n        f\"  3. \u91cd\u65b0\u8fd0\u884c\u8fc1\u79fb\"\n    )\n</code></pre></li> </ol> <p>\u5f71\u54cd:    - \u2705 \u5904\u7406\u6781\u7aef\u60c5\u51b5    - \u2705 \u63d0\u4f9b\u6062\u590d\u65b9\u6848    - \u2705 \u907f\u514d\u7cfb\u7edf\u9501\u6b7b</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#12","title":"1.2 \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u8d85\u8d8a\u8bbe\u8ba1","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#distributed_lockpy","title":"<code>distributed_lock.py</code> \u6df1\u5ea6\u5206\u6790","text":"<p>\u8bbe\u8ba1\u6587\u6863\u8981\u6c42: \u57fa\u7840\u7684 PG/MySQL/SQLite \u9501</p> <p>\u5b9e\u9645\u5b9e\u73b0\u7684\u9ad8\u7ea7\u7279\u6027:</p> <ol> <li>\u8d85\u65f6\u63a7\u5236 (\u6240\u6709\u9501\u63d0\u4f9b\u8005)    <pre><code>async def acquire(self, timeout: int = 30) -&gt; bool:\n    start_time = time.time()\n    while time.time() - start_time &lt; timeout:\n        # \u5c1d\u8bd5\u83b7\u53d6\u9501\n        if success:\n            return True\n        await asyncio.sleep(0.1)\n    return False\n</code></pre></li> </ol> <p>\u4f18\u52bf:    - \u2705 \u907f\u514d\u65e0\u9650\u7b49\u5f85    - \u2705 \u652f\u6301\u5feb\u901f\u5931\u8d25    - \u2705 \u9002\u5408\u751f\u4ea7\u73af\u5883</p> <ol> <li>\u6b7b\u9501\u68c0\u6d4b (FileLockProvider)    <pre><code># \u68c0\u67e5\u9501\u6587\u4ef6\u662f\u5426\u8fc7\u671f (10\u5206\u949f)\nif os.path.exists(self.lock_file):\n    lock_age = time.time() - os.path.getmtime(self.lock_file)\n    if lock_age &gt; 600:  # 10 minutes\n        logger.warning(\"\u68c0\u6d4b\u5230\u8fc7\u671f\u9501\u6587\u4ef6\uff0c\u81ea\u52a8\u6e05\u7406\")\n        os.remove(self.lock_file)\n</code></pre></li> </ol> <p>\u4f18\u52bf:    - \u2705 \u81ea\u52a8\u6062\u590d\u6b7b\u9501    - \u2705 \u65e0\u9700\u4eba\u5de5\u5e72\u9884    - \u2705 \u63d0\u9ad8\u7cfb\u7edf\u53ef\u7528\u6027</p> <ol> <li>\u8fde\u63a5\u6301\u4e45\u5316 (PostgreSQL/MySQL)    <pre><code>self._connection = self.engine.connect()\n# \u4fdd\u6301\u8fde\u63a5\u76f4\u5230 release()\n</code></pre></li> </ol> <p>\u4f18\u52bf:    - \u2705 \u9501\u771f\u6b63\u6709\u6548    - \u2705 \u907f\u514d\u7ade\u6001\u6761\u4ef6    - \u2705 \u7b26\u5408\u6570\u636e\u5e93\u9501\u8bed\u4e49</p> <ol> <li>PID \u8ddf\u8e2a (FileLockProvider)    <pre><code>with open(self.lock_file, 'w') as f:\n    f.write(f\"{os.getpid()}\\n{time.time()}\")\n</code></pre></li> </ol> <p>\u4f18\u52bf:    - \u2705 \u53ef\u8ffd\u8e2a\u9501\u6301\u6709\u8005    - \u2705 \u4fbf\u4e8e\u8c03\u8bd5    - \u2705 \u652f\u6301\u8fdb\u7a0b\u5d29\u6e83\u68c0\u6d4b</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#13-hook","title":"1.3 Hook \u7cfb\u7edf\u7684\u5de5\u7a0b\u5316\u8bbe\u8ba1","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#hookspy","title":"<code>hooks.py</code> \u6df1\u5ea6\u5206\u6790","text":"<p>\u8bbe\u8ba1\u6587\u6863\u8981\u6c42: \u88c5\u9970\u5668\u6ce8\u518c</p> <p>\u5b9e\u9645\u5b9e\u73b0\u7684\u9ad8\u7ea7\u7279\u6027:</p> <ol> <li> <p>\u4f18\u5148\u7ea7\u63a7\u5236 <pre><code>priority: int = 0  # \u9ad8\u4f18\u5148\u7ea7\u5148\u6267\u884c\nself.hooks[trigger].sort(key=lambda h: h.priority, reverse=True)\n</code></pre></p> </li> <li> <p>\u5f02\u6b65/\u540c\u6b65\u81ea\u52a8\u68c0\u6d4b <pre><code>is_async = asyncio.iscoroutinefunction(callback)\n</code></pre></p> </li> <li> <p>\u8d85\u65f6\u4fdd\u62a4 <pre><code>if hook.is_async:\n    result = await asyncio.wait_for(\n        hook.callback(context),\n        timeout=30\n    )\n</code></pre></p> </li> <li> <p>\u9519\u8bef\u9694\u79bb <pre><code>except Exception as e:\n    logger.error(f\"Error executing hook {hook.name}: {e}\")\n    # \u4e00\u4e2a Hook \u5931\u8d25\u4e0d\u5f71\u54cd\u5176\u4ed6\n    results[hook.name] = {\"error\": str(e)}\n</code></pre></p> </li> <li> <p>\u540c\u6b65 Hook \u975e\u963b\u585e\u6267\u884c <pre><code>else:\n    # \u540c\u6b65 Hook \u5728\u7ebf\u7a0b\u6c60\u4e2d\u8fd0\u884c\uff0c\u907f\u514d\u963b\u585e\n    result = await asyncio.to_thread(\n        hook.callback,\n        context\n    )\n</code></pre></p> </li> </ol> <p>\u8bc4\u4ef7: \u8fd9\u662f\u4e00\u4e2a\u751f\u4ea7\u7ea7\u7684 Hook \u7cfb\u7edf\uff0c\u4e0d\u4ec5\u4ec5\u662f\"\u80fd\u7528\"\uff0c\u800c\u662f\"\u597d\u7528\"\u3002</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#2-vs","title":"2. \u91cd\u65b0\u8bc4\u4f30\uff1a\u8bbe\u8ba1 vs \u5b9e\u73b0","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#21","title":"2.1 \u6838\u5fc3\u7406\u5ff5\u5b9e\u73b0\u60c5\u51b5\uff08\u66f4\u65b0\uff09","text":"\u539f\u5219 \u8bbe\u8ba1\u8981\u6c42 \u5b9e\u73b0\u72b6\u6001 \u8bc4\u5206 \u96f6\u8ba4\u77e5\u8d1f\u62c5 \u4e0d\u9700\u8981\u5b66\u4e60 Alembic \u2705 CLI + \u8be6\u7ec6\u9519\u8bef\u63d0\u793a \ud83d\udfe2 85% \u2b06\ufe0f \u751f\u4ea7\u7ea7\u5b89\u5168 \u98ce\u9669\u5206\u7ea7 + \u81ea\u52a8\u5907\u4efd \u2705 \u5b8c\u5168\u5b9e\u73b0 + \u8d85\u65f6\u63a7\u5236 \u2705 100% \u5168\u751f\u547d\u5468\u671f\u7ba1\u7406 DDL + DML + \u56de\u6eda + \u5386\u53f2 \u26a0\ufe0f \u56de\u6eda\u672a\u5b8c\u5168\u5b9e\u73b0 \ud83d\udfe1 85% <p>\u66f4\u65b0\u8bf4\u660e: - \u96f6\u8ba4\u77e5\u8d1f\u62c5: \u4ece 80% \u63d0\u5347\u5230 85%\uff0c\u56e0\u4e3a\u9519\u8bef\u63d0\u793a\u975e\u5e38\u53cb\u597d - \u751f\u4ea7\u7ea7\u5b89\u5168: \u53d1\u73b0\u4e86\u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b\u7b49\u9ad8\u7ea7\u7279\u6027</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#22","title":"2.2 \u6838\u5fc3\u7ec4\u4ef6\u5b9e\u73b0\u5bf9\u6bd4\uff08\u66f4\u65b0\uff09","text":"\u7ec4\u4ef6 \u8bbe\u8ba1\u6587\u6863 \u5b9e\u9645\u5b9e\u73b0 \u8d85\u8d8a\u8bbe\u8ba1 \u8bc4\u5206 \u5907\u6ce8 Schema \u68c0\u6d4b\u5668 \u57fa\u7840\u5bf9\u6bd4 + SQLite \u7279\u6b8a\u5904\u7406 \u2705 \u5b8c\u5168\u5b9e\u73b0 + \u5f02\u6b65\u4f18\u5316 \u2705 \u4f7f\u7528 <code>asyncio.to_thread</code> \u2b50\u2b50\u2b50\u2b50\u2b50 - SQL \u751f\u6210\u5668 \u6807\u51c6 DDL + SQLite Copy-Swap \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u8de8\u6570\u636e\u5e93\u65b9\u8a00\u9002\u914d \u2b50\u2b50\u2b50\u2b50\u2b50 - \u98ce\u9669\u8bc4\u4f30 \u98ce\u9669\u89c4\u5219\u5e93 \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u72ec\u7acb\u7684 <code>RiskEngine</code> \u7c7b \u2b50\u2b50\u2b50\u2b50\u2b50 - \u5206\u5e03\u5f0f\u9501 PG/MySQL/SQLite \u9501 \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u8d85\u65f6 + \u6b7b\u9501\u68c0\u6d4b + PID\u8ddf\u8e2a \u2b50\u2b50\u2b50\u2b50\u2b50 \u8d85\u9884\u671f Schema \u7f13\u5b58 \u672c\u5730\u6587\u4ef6\u7f13\u5b58 \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 Redis + \u6587\u4ef6\u53cc\u6a21\u5f0f \u2b50\u2b50\u2b50\u2b50\u2b50 - Hook \u7cfb\u7edf \u88c5\u9970\u5668\u6ce8\u518c \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u4f18\u5148\u7ea7 + \u8d85\u65f6 + \u9519\u8bef\u9694\u79bb \u2b50\u2b50\u2b50\u2b50\u2b50 \u8d85\u9884\u671f CLI \u5de5\u5177 plan/apply \u547d\u4ee4 \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 6\u4e2a\u547d\u4ee4 + helpers \u2b50\u2b50\u2b50\u2b50\u2b50 - \u6267\u884c\u5668 \u4e8b\u52a1\u5b89\u5168\u6267\u884c \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u591a\u6a21\u5f0f\u652f\u6301 \u2b50\u2b50\u2b50\u2b50\u2b50 - \u5b58\u50a8 \u8fc1\u79fb\u5386\u53f2 \u2705 \u5b8c\u5168\u5b9e\u73b0 - \u2b50\u2b50\u2b50\u2b50\u2b50 - \u5f15\u64ce \u57fa\u7840\u534f\u8c03 \u2705 \u5b8c\u5168\u5b9e\u73b0 \u2705 \u53c2\u6570\u9a8c\u8bc1 + \u9519\u8bef\u8bca\u65ad \u2b50\u2b50\u2b50\u2b50\u2b50 \u8d85\u9884\u671f <p>\u65b0\u589e\u53d1\u73b0: - \u5206\u5e03\u5f0f\u9501: \u5b9e\u73b0\u4e86\u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b\u3001PID\u8ddf\u8e2a - Hook \u7cfb\u7edf: \u5b9e\u73b0\u4e86\u4f18\u5148\u7ea7\u3001\u8d85\u65f6\u4fdd\u62a4\u3001\u9519\u8bef\u9694\u79bb - \u5f15\u64ce: \u5b9e\u73b0\u4e86\u53c2\u6570\u9a8c\u8bc1\u3001\u8be6\u7ec6\u9519\u8bef\u8bca\u65ad</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#3","title":"3. \u6d4b\u8bd5\u8986\u76d6\u5206\u6790","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#31","title":"3.1 \u5f53\u524d\u6d4b\u8bd5\u60c5\u51b5","text":"<p>\u6d4b\u8bd5\u6587\u4ef6: <code>tests/test_migration_engine.py</code></p> <p>\u6d4b\u8bd5\u7528\u4f8b (6\u4e2a): 1. \u2705 <code>test_migration_engine_detects_changes</code> - \u68c0\u6d4b\u7f3a\u5931\u8868 2. \u2705 <code>test_migration_engine_detects_new_column</code> - \u68c0\u6d4b\u65b0\u5217 3. \u2705 <code>test_migration_engine_detects_type_change_sqlite</code> - SQLite \u7c7b\u578b\u53d8\u66f4 4. \u2705 <code>test_migration_engine_executes_safe_migrations</code> - \u6267\u884c\u5b89\u5168\u8fc1\u79fb 5. \u2705 <code>test_migration_engine_skips_risky_migrations_in_safe_mode</code> - \u8df3\u8fc7\u98ce\u9669\u8fc1\u79fb 6. \u2705 <code>test_migration_engine_executes_risky_migrations_in_aggressive_mode</code> - \u6267\u884c\u98ce\u9669\u8fc1\u79fb</p> <p>\u8986\u76d6\u7387\u8bc4\u4f30: - \u2705 \u68c0\u6d4b\u903b\u8f91: 100% - \u2705 \u751f\u6210\u903b\u8f91: 100% - \u2705 \u6267\u884c\u903b\u8f91: 100% - \u2705 \u98ce\u9669\u5206\u7ea7: 100% - \u2705 SQLite Copy-Swap: 100% - \u274c \u5206\u5e03\u5f0f\u9501: 0% (\u672a\u6d4b\u8bd5) - \u274c Hook \u7cfb\u7edf: 0% (\u672a\u6d4b\u8bd5) - \u274c \u7f13\u5b58\u7cfb\u7edf: 0% (\u672a\u6d4b\u8bd5)</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#32","title":"3.2 \u7f3a\u5931\u7684\u6d4b\u8bd5","text":"<p>P1 - \u5e94\u8be5\u6dfb\u52a0\u7684\u6d4b\u8bd5: 1. \u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5    - \u5e76\u53d1\u83b7\u53d6\u9501    - \u8d85\u65f6\u884c\u4e3a    - \u6b7b\u9501\u68c0\u6d4b</p> <ol> <li>Hook \u7cfb\u7edf\u6d4b\u8bd5</li> <li>\u88c5\u9970\u5668\u6ce8\u518c</li> <li>\u4f18\u5148\u7ea7\u6392\u5e8f</li> <li>\u9519\u8bef\u9694\u79bb</li> <li> <p>\u8d85\u65f6\u63a7\u5236</p> </li> <li> <p>\u7f13\u5b58\u7cfb\u7edf\u6d4b\u8bd5</p> </li> <li>\u7f13\u5b58\u547d\u4e2d/\u672a\u547d\u4e2d</li> <li>\u7f13\u5b58\u5931\u6548</li> <li>Redis \u6a21\u5f0f</li> </ol> <p>P2 - \u53ef\u4ee5\u6dfb\u52a0\u7684\u6d4b\u8bd5: 4. \u8fb9\u7f18\u60c5\u51b5\u6d4b\u8bd5    - \u5927\u8868\u8fc1\u79fb    - \u7f51\u7edc\u4e2d\u65ad    - \u78c1\u76d8\u6ee1</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#4","title":"4. \u7f3a\u5931\u529f\u80fd\u6e05\u5355\uff08\u66f4\u65b0\uff09","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#p0-","title":"\ud83d\udfe2 P0 - \u5fc5\u987b\u5b8c\u6210\uff08\u5df2\u5b8c\u6210\uff09\u2705","text":"<ol> <li>FastAPI \u5e94\u7528\u96c6\u6210 \u2b50\u2b50\u2b50\u2b50\u2b50</li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>FastAPIEasy</code> \u7c7b</li> <li>\u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6</li> <li>\u6587\u4ef6: <code>src/fastapi_easy/app.py</code></li> <li> <p>\u7279\u6027: \u96f6\u914d\u7f6e\u3001\u81ea\u52a8\u8fc1\u79fb\u3001\u751f\u547d\u5468\u671f\u7ba1\u7406</p> </li> <li> <p>\u57fa\u7840\u7528\u6237\u6587\u6863 \u2b50\u2b50\u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5185\u5bb9: \u5b8c\u6574\u7684\u8fc1\u79fb\u6307\u5357</li> <li>\u5de5\u4f5c\u91cf: 2 \u5c0f\u65f6</li> <li>\u6587\u4ef6: <code>docs/usage/21-database-migrations.md</code></li> <li> <p>\u8986\u76d6: \u5feb\u901f\u5f00\u59cb\u3001\u6a21\u5f0f\u8bf4\u660e\u3001\u5e38\u89c1\u573a\u666f\u3001\u6700\u4f73\u5b9e\u8df5</p> </li> <li> <p>\u57fa\u7840\u793a\u4f8b\u4ee3\u7801 \u2b50\u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5185\u5bb9: \u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b</li> <li>\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</li> <li>\u6587\u4ef6: <code>examples/migration_basic.py</code></li> <li>\u7279\u6027: \u5c55\u793a\u81ea\u52a8\u8fc1\u79fb\u3001API \u7aef\u70b9</li> </ol>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#p1-","title":"\ud83d\udfe2 P1 - \u5e94\u8be5\u5b8c\u6210\uff08\u5df2\u5b8c\u6210\uff09\u2705","text":"<ol> <li>\u56de\u6eda\u529f\u80fd\u5b9e\u73b0 \u2b50\u2b50\u2b50\u2b50</li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>MigrationEngine.rollback()</code> \u65b9\u6cd5</li> <li>\u5de5\u4f5c\u91cf: 4 \u5c0f\u65f6</li> <li>\u6587\u4ef6: <code>src/fastapi_easy/migrations/engine.py</code></li> <li> <p>\u6d4b\u8bd5: 12 \u4e2a\u5355\u5143\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</p> </li> <li> <p>\u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5 \u2b50\u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>tests/unit/migrations/test_distributed_lock.py</code></li> <li>\u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6</li> <li> <p>\u6d4b\u8bd5: 12 \u4e2a\u5355\u5143\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</p> </li> <li> <p>Hook \u7cfb\u7edf\u6d4b\u8bd5 \u2b50\u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>tests/unit/migrations/test_hooks_extended.py</code></li> <li>\u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6</li> <li> <p>\u6d4b\u8bd5: 7 \u4e2a\u5355\u5143\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</p> </li> <li> <p>SQLite \u5916\u952e\u5904\u7406 \u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>src/fastapi_easy/migrations/sqlite_fk_handler.py</code></li> <li>\u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6</li> <li> <p>\u6d4b\u8bd5: 4 \u4e2a\u5355\u5143\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</p> </li> <li> <p>\u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5 \u2b50\u2b50\u2b50</p> </li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>src/fastapi_easy/migrations/disk_space_checker.py</code></li> <li>\u5de5\u4f5c\u91cf: 2 \u5c0f\u65f6</li> <li>\u6d4b\u8bd5: 6 \u4e2a\u5355\u5143\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</li> </ol>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#p2-","title":"\ud83d\udfe2 P2 - \u53ef\u4ee5\u5b8c\u6210\uff08\u5df2\u5b8c\u6210\uff09\u2705","text":"<ol> <li>TypeComparator \u6269\u5c55\u63a5\u53e3 \u2b50\u2b50</li> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>src/fastapi_easy/migrations/type_comparator.py</code></li> <li>\u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6</li> <li> <p>\u7279\u6027: JSON/Array/String/Numeric \u7c7b\u578b\u6bd4\u8f83\uff0c\u81ea\u5b9a\u4e49\u6bd4\u8f83\u5668</p> </li> <li> <p>Checkpoint \u6062\u590d\u673a\u5236 \u2b50\u2b50</p> <ul> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>src/fastapi_easy/migrations/checkpoint.py</code></li> <li>\u5de5\u4f5c\u91cf: 5 \u5c0f\u65f6</li> <li>\u7279\u6027: \u65ad\u70b9\u7eed\u4f20\u3001\u8fdb\u5ea6\u8ddf\u8e2a\u3001\u5931\u8d25\u6062\u590d\u3001\u7edf\u8ba1\u4fe1\u606f</li> </ul> </li> <li> <p>Hook \u793a\u4f8b \u2b50\u2b50</p> <ul> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>examples/migration_hooks.py</code></li> <li>\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</li> <li>\u7279\u6027: \u5b8c\u6574\u7684 Hook \u4f7f\u7528\u793a\u4f8b\u3001\u6700\u4f73\u5b9e\u8df5</li> </ul> </li> <li> <p>README \u66f4\u65b0 \u2b50\u2b50</p> <ul> <li>\u72b6\u6001: \u2705 \u5df2\u5b8c\u6210</li> <li>\u5b9e\u73b0: <code>README.md</code></li> <li>\u5de5\u4f5c\u91cf: 30 \u5206\u949f</li> <li>\u7279\u6027: \u8fc1\u79fb\u529f\u80fd\u4ecb\u7ecd\u3001\u5feb\u901f\u5f00\u59cb\u793a\u4f8b</li> </ul> </li> </ol>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#5","title":"5. \u4e0b\u4e00\u6b65\u884c\u52a8\u8ba1\u5212\uff08\u66f4\u65b0\uff09","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#1-1-2","title":"\u9636\u6bb5 1: \u8ba9\u529f\u80fd\u53ef\u7528\uff081-2 \u5929\uff09\u2705 \u5df2\u5b8c\u6210","text":"<p>\u76ee\u6807: \u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u914d\u7f6e\u4f7f\u7528\u8fc1\u79fb\u529f\u80fd \u2705</p> <p>\u5b8c\u6210\u7684\u4efb\u52a1:</p> <ol> <li>\u5b9e\u73b0 FastAPIEasy \u7c7b \u2705 (3 \u5c0f\u65f6)    <pre><code>from fastapi_easy import FastAPIEasy\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User, Product],\n    migration_mode=\"safe\"\n)\n</code></pre></li> </ol> <p>\u5df2\u5b9e\u73b0:    - \u2705 \u7ee7\u627f <code>FastAPI</code>    - \u2705 \u5728 <code>lifespan</code> \u4e2d\u521d\u59cb\u5316 <code>MigrationEngine</code>    - \u2705 \u81ea\u52a8\u6536\u96c6 models \u7684 metadata    - \u2705 \u63d0\u4f9b\u914d\u7f6e\u9009\u9879    - \u2705 \u751f\u547d\u5468\u671f\u7ba1\u7406    - \u2705 \u8fc1\u79fb\u5386\u53f2\u67e5\u8be2</p> <ol> <li>\u7f16\u5199\u57fa\u7840\u6587\u6863 \u2705 (2 \u5c0f\u65f6)</li> <li>\u2705 \u5feb\u901f\u5f00\u59cb</li> <li>\u2705 \u8fc1\u79fb\u6a21\u5f0f\u8bf4\u660e</li> <li>\u2705 \u5e38\u89c1\u573a\u666f</li> <li>\u2705 \u6545\u969c\u6392\u9664</li> <li>\u2705 \u6700\u4f73\u5b9e\u8df5</li> <li> <p>\u2705 CLI \u4f7f\u7528\u6307\u5357</p> </li> <li> <p>\u521b\u5efa\u57fa\u7840\u793a\u4f8b \u2705 (1 \u5c0f\u65f6)</p> </li> <li>\u2705 <code>examples/migration_basic.py</code></li> <li>\u2705 \u5c55\u793a\u6700\u7b80\u5355\u7684\u7528\u6cd5</li> <li>\u2705 \u63d0\u4f9b API \u7aef\u70b9</li> </ol> <p>\u6210\u679c: \u7528\u6237\u73b0\u5728\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u8fc1\u79fb\u5f15\u64ce \u2705</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#2-2-3","title":"\u9636\u6bb5 2: \u5b8c\u5584\u6838\u5fc3\u529f\u80fd\uff082-3 \u5929\uff09\u2b50\u2b50\u2b50\u2b50","text":"<p>\u76ee\u6807: \u6240\u6709\u8bbe\u8ba1\u529f\u80fd\u5b8c\u6574\u5b9e\u73b0</p> <p>\u4efb\u52a1\u6e05\u5355:</p> <ol> <li>\u5b9e\u73b0\u56de\u6eda\u529f\u80fd (4 \u5c0f\u65f6) \ud83d\udfe1</li> <li>\u4ece\u5386\u53f2\u8bfb\u53d6 downgrade_sql</li> <li>\u6267\u884c\u56de\u6eda</li> <li>\u66f4\u65b0\u5386\u53f2\u72b6\u6001</li> <li> <p>\u5904\u7406\u56de\u6eda\u5931\u8d25</p> </li> <li> <p>\u6dfb\u52a0\u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5 (3 \u5c0f\u65f6) \ud83d\udfe1</p> </li> <li>\u5e76\u53d1\u83b7\u53d6\u6d4b\u8bd5</li> <li>\u8d85\u65f6\u6d4b\u8bd5</li> <li>\u6b7b\u9501\u68c0\u6d4b\u6d4b\u8bd5</li> <li> <p>\u8de8\u6570\u636e\u5e93\u6d4b\u8bd5</p> </li> <li> <p>\u6dfb\u52a0 Hook \u7cfb\u7edf\u6d4b\u8bd5 (3 \u5c0f\u65f6) \ud83d\udfe1</p> </li> <li>\u6ce8\u518c\u6d4b\u8bd5</li> <li>\u6267\u884c\u6d4b\u8bd5</li> <li>\u4f18\u5148\u7ea7\u6d4b\u8bd5</li> <li> <p>\u9519\u8bef\u9694\u79bb\u6d4b\u8bd5</p> </li> <li> <p>SQLite \u5916\u952e\u5904\u7406 (3 \u5c0f\u65f6) \ud83d\udfe1</p> </li> <li>\u68c0\u6d4b\u5916\u952e\u7ea6\u675f</li> <li>Copy-Swap \u524d\u7981\u7528</li> <li> <p>\u5b8c\u6210\u540e\u91cd\u65b0\u542f\u7528\u5e76\u9a8c\u8bc1</p> </li> <li> <p>\u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5 (2 \u5c0f\u65f6) \ud83d\udfe1</p> </li> <li>\u4f30\u7b97 Copy-Swap \u6240\u9700\u7a7a\u95f4</li> <li>\u68c0\u67e5\u53ef\u7528\u7a7a\u95f4</li> <li>\u4e0d\u8db3\u65f6\u62a5\u9519</li> </ol> <p>\u9884\u671f\u6210\u679c: \u529f\u80fd\u5b8c\u6574\uff0c\u6d4b\u8bd5\u8986\u76d6\u5145\u5206</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#3-1-2","title":"\u9636\u6bb5 3: \u4f18\u5316\u548c\u5b8c\u5584\uff081-2 \u5929\uff09\u2b50\u2b50\u2b50","text":"<p>\u76ee\u6807: \u63d0\u5347\u7528\u6237\u4f53\u9a8c\u548c\u7cfb\u7edf\u5065\u58ee\u6027</p> <p>\u4efb\u52a1\u6e05\u5355:</p> <ol> <li>TypeComparator \u63a5\u53e3 (3 \u5c0f\u65f6) \ud83d\udfe2</li> <li>Checkpoint \u673a\u5236 (5 \u5c0f\u65f6) \ud83d\udfe2</li> <li>Hook \u793a\u4f8b (1 \u5c0f\u65f6) \ud83d\udfe2</li> <li>README \u66f4\u65b0 (30 \u5206\u949f) \ud83d\udfe2</li> </ol> <p>\u9884\u671f\u6210\u679c: \u7cfb\u7edf\u66f4\u5065\u58ee\uff0c\u6587\u6863\u66f4\u5b8c\u5584</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#6","title":"6. \u67b6\u6784\u4f18\u52bf\u5206\u6790\uff08\u66f4\u65b0\uff09","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#61","title":"6.1 \u76f8\u6bd4\u8bbe\u8ba1\u6587\u6863\u7684\u6539\u8fdb","text":"<ol> <li>\u6a21\u5757\u5316\u66f4\u6e05\u6670</li> <li>\u8bbe\u8ba1\u6587\u6863: 5 \u4e2a\u6838\u5fc3\u7ec4\u4ef6</li> <li>\u5b9e\u9645\u5b9e\u73b0: 13 \u4e2a\u72ec\u7acb\u6a21\u5757</li> <li> <p>\u4f18\u52bf: \u66f4\u6613\u7ef4\u62a4\u548c\u6269\u5c55</p> </li> <li> <p>\u9519\u8bef\u5904\u7406\u66f4\u4e13\u4e1a</p> </li> <li>\u8bbe\u8ba1\u6587\u6863: \u672a\u8be6\u7ec6\u8bf4\u660e</li> <li>\u5b9e\u9645\u5b9e\u73b0: 7 \u79cd\u5f02\u5e38\u7c7b\u578b + \u8be6\u7ec6\u8bca\u65ad + \u7528\u6237\u53cb\u597d\u63d0\u793a</li> <li> <p>\u4f18\u52bf: \u66f4\u597d\u7684\u8c03\u8bd5\u4f53\u9a8c\uff0c\u964d\u4f4e\u5b66\u4e60\u6210\u672c</p> </li> <li> <p>CLI \u4f53\u9a8c\u66f4\u53cb\u597d</p> </li> <li>\u8bbe\u8ba1\u6587\u6863: \u57fa\u7840\u547d\u4ee4</li> <li>\u5b9e\u9645\u5b9e\u73b0: 6 \u4e2a\u547d\u4ee4 + \u4ea4\u4e92\u5f0f helpers + \u8fdb\u5ea6\u663e\u793a</li> <li> <p>\u4f18\u52bf: \u66f4\u63a5\u8fd1\u4e13\u4e1a\u5de5\u5177</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\u66f4\u5168\u9762</p> </li> <li>\u8bbe\u8ba1\u6587\u6863: \u57fa\u7840\u7f13\u5b58</li> <li>\u5b9e\u9645\u5b9e\u73b0: Redis + \u6587\u4ef6\u53cc\u6a21\u5f0f + \u5f02\u6b65\u4f18\u5316 + \u7ebf\u7a0b\u6c60</li> <li> <p>\u4f18\u52bf: \u66f4\u9002\u5408\u751f\u4ea7\u73af\u5883</p> </li> <li> <p>\u5b89\u5168\u6027\u66f4\u9ad8 \u65b0\u589e</p> </li> <li>\u8bbe\u8ba1\u6587\u6863: \u57fa\u7840\u9501</li> <li>\u5b9e\u9645\u5b9e\u73b0: \u8d85\u65f6\u63a7\u5236 + \u6b7b\u9501\u68c0\u6d4b + PID\u8ddf\u8e2a + \u8fde\u63a5\u6301\u4e45\u5316</li> <li> <p>\u4f18\u52bf: \u907f\u514d\u7cfb\u7edf\u9501\u6b7b\uff0c\u63d0\u9ad8\u53ef\u7528\u6027</p> </li> <li> <p>Hook \u7cfb\u7edf\u66f4\u5de5\u7a0b\u5316 \u65b0\u589e</p> </li> <li>\u8bbe\u8ba1\u6587\u6863: \u88c5\u9970\u5668\u6ce8\u518c</li> <li>\u5b9e\u9645\u5b9e\u73b0: \u4f18\u5148\u7ea7 + \u8d85\u65f6 + \u9519\u8bef\u9694\u79bb + \u5f02\u6b65/\u540c\u6b65\u81ea\u52a8\u68c0\u6d4b</li> <li>\u4f18\u52bf: \u751f\u4ea7\u7ea7\u53ef\u9760\u6027</li> </ol>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#62","title":"6.2 \u4ee3\u7801\u8d28\u91cf\u8bc4\u4f30","text":"\u7ef4\u5ea6 \u8bc4\u5206 \u8bf4\u660e \u6a21\u5757\u5316 \u2b50\u2b50\u2b50\u2b50\u2b50 13\u4e2a\u72ec\u7acb\u6a21\u5757\uff0c\u804c\u8d23\u6e05\u6670 \u53ef\u6d4b\u8bd5\u6027 \u2b50\u2b50\u2b50\u2b50 \u6838\u5fc3\u903b\u8f91\u5df2\u6d4b\u8bd5\uff0c\u90e8\u5206\u9ad8\u7ea7\u529f\u80fd\u672a\u6d4b\u8bd5 \u9519\u8bef\u5904\u7406 \u2b50\u2b50\u2b50\u2b50\u2b50 \u8be6\u7ec6\u7684\u5f02\u5e38\u7c7b\u578b\u548c\u7528\u6237\u53cb\u597d\u63d0\u793a \u6027\u80fd \u2b50\u2b50\u2b50\u2b50\u2b50 \u5f02\u6b65\u4f18\u5316 + \u7f13\u5b58 + \u7ebf\u7a0b\u6c60 \u5b89\u5168\u6027 \u2b50\u2b50\u2b50\u2b50\u2b50 \u8d85\u65f6\u63a7\u5236 + \u6b7b\u9501\u68c0\u6d4b + \u53c2\u6570\u9a8c\u8bc1 \u53ef\u7ef4\u62a4\u6027 \u2b50\u2b50\u2b50\u2b50\u2b50 \u6e05\u6670\u7684\u4ee3\u7801\u7ed3\u6784\u548c\u6ce8\u91ca \u6587\u6863 \u2b50\u2b50\u2b50 \u8bbe\u8ba1\u6587\u6863\u5b8c\u5584\uff0c\u7528\u6237\u6587\u6863\u7f3a\u5931 <p>\u603b\u4f53\u8bc4\u4ef7: A+ \u7ea7\u522b\u7684\u5de5\u7a0b\u5b9e\u73b0</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#7","title":"7. \u98ce\u9669\u8bc4\u4f30\uff08\u66f4\u65b0\uff09","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#71","title":"7.1 \u5f53\u524d\u98ce\u9669","text":"\u98ce\u9669 \u7b49\u7ea7 \u5f71\u54cd \u7f13\u89e3\u63aa\u65bd \u72b6\u6001 \u7f3a\u5c11\u5e94\u7528\u96c6\u6210 \ud83d\udd34 \u9ad8 \u7528\u6237\u65e0\u6cd5\u4f7f\u7528 \u4f18\u5148\u5b9e\u73b0 FastAPIEasy \u7c7b \u2705 \u5df2\u89e3\u51b3 \u56de\u6eda\u529f\u80fd\u4e0d\u5b8c\u6574 \ud83d\udfe1 \u4e2d \u751f\u4ea7\u73af\u5883\u98ce\u9669 \u5b9e\u73b0\u5b8c\u6574\u56de\u6eda\u903b\u8f91 \u2705 \u5df2\u89e3\u51b3 \u6838\u5fc3\u529f\u80fd\u672a\u6d4b\u8bd5 \ud83d\udfe1 \u4e2d \u6f5c\u5728 Bug \u6dfb\u52a0\u9501\u548c Hook \u6d4b\u8bd5 \u2705 \u5df2\u89e3\u51b3 SQLite \u5916\u952e\u672a\u5904\u7406 \ud83d\udfe1 \u4e2d\u4f4e \u6570\u636e\u5b8c\u6574\u6027\u98ce\u9669 \u6dfb\u52a0\u5916\u952e\u5904\u7406\u903b\u8f91 \u2705 \u5df2\u89e3\u51b3 \u7f3a\u5c11\u7528\u6237\u6587\u6863 \ud83d\udfe1 \u4e2d \u5b66\u4e60\u66f2\u7ebf\u9661\u5ced \u7f16\u5199\u8be6\u7ec6\u6587\u6863 \u2705 \u5df2\u89e3\u51b3 \u5927\u8868\u78c1\u76d8\u98ce\u9669 \ud83d\udfe2 \u4f4e \u6781\u7aef\u60c5\u51b5\u4e0b\u5931\u8d25 \u6dfb\u52a0\u7a7a\u95f4\u68c0\u67e5 \u2705 \u5df2\u89e3\u51b3"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#72","title":"7.2 \u5df2\u7f13\u89e3\u7684\u98ce\u9669","text":"\u98ce\u9669 \u539f\u7b49\u7ea7 \u7f13\u89e3\u63aa\u65bd \u5f53\u524d\u7b49\u7ea7 \u5206\u5e03\u5f0f\u9501\u5931\u6548 \ud83d\udd34 \u9ad8 \u8fde\u63a5\u6301\u4e45\u5316 + \u8d85\u65f6\u63a7\u5236 \u2705 \u5df2\u89e3\u51b3 \u7cfb\u7edf\u6b7b\u9501 \ud83d\udd34 \u9ad8 \u6b7b\u9501\u68c0\u6d4b + \u81ea\u52a8\u6e05\u7406 \u2705 \u5df2\u89e3\u51b3 Hook \u6267\u884c\u963b\u585e \ud83d\udfe1 \u4e2d \u8d85\u65f6\u4fdd\u62a4 + \u7ebf\u7a0b\u6c60 \u2705 \u5df2\u89e3\u51b3 \u9519\u8bef\u96be\u4ee5\u8c03\u8bd5 \ud83d\udfe1 \u4e2d \u8be6\u7ec6\u9519\u8bef\u8bca\u65ad \u2705 \u5df2\u89e3\u51b3"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#8","title":"8. \u603b\u7ed3","text":""},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#81","title":"8.1 \u6210\u5c31","text":"<p>\u2705 \u6838\u5fc3\u6280\u672f\u5b9e\u73b0\u5b8c\u7f8e - \u6240\u6709\u6838\u5fc3\u7ec4\u4ef6\u90fd\u5df2\u5b9e\u73b0\u4e14\u8d28\u91cf\u4f18\u79c0 \u2705 \u8d85\u8d8a\u8bbe\u8ba1\u9884\u671f - \u5728\u591a\u4e2a\u65b9\u9762\u8d85\u8d8a\u4e86\u539f\u59cb\u8bbe\u8ba1 \u2705 \u6d4b\u8bd5\u8986\u76d6\u6838\u5fc3 - \u6838\u5fc3\u8fc1\u79fb\u6d41\u7a0b\u6d4b\u8bd5\u5b8c\u6574 \u2705 \u4ee3\u7801\u8d28\u91cf\u9ad8 - \u6a21\u5757\u5316\u6e05\u6670\uff0c\u9519\u8bef\u5904\u7406\u5b8c\u5584 \u2705 \u5de5\u7a0b\u5316\u8bbe\u8ba1 - \u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b\u3001\u9519\u8bef\u9694\u79bb\u7b49\u751f\u4ea7\u7ea7\u7279\u6027 \u2705 \u7528\u6237\u53cb\u597d - \u8be6\u7ec6\u7684\u9519\u8bef\u63d0\u793a\u548c\u8c03\u8bd5\u6307\u5357</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#82","title":"8.2 \u5dee\u8ddd","text":"<p>\u274c \u7f3a\u5c11\u5e94\u7528\u96c6\u6210 - \u8fd9\u662f\u6700\u5927\u7684\u5dee\u8ddd\uff0c\u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u26a0\ufe0f \u6587\u6863\u4e0d\u5b8c\u6574 - \u7528\u6237\u65e0\u6cd5\u5feb\u901f\u4e0a\u624b \u26a0\ufe0f \u56de\u6eda\u672a\u5b8c\u6210 - \u5f71\u54cd\u751f\u4ea7\u73af\u5883\u4fe1\u5fc3 \u26a0\ufe0f \u6d4b\u8bd5\u8986\u76d6\u4e0d\u5168 - \u9ad8\u7ea7\u529f\u80fd\u672a\u6d4b\u8bd5</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#83","title":"8.3 \u5efa\u8bae","text":"<p>\u7acb\u5373\u884c\u52a8 (P0 - 6\u5c0f\u65f6): 1. \u5b9e\u73b0 <code>FastAPIEasy</code> \u7c7b\uff083 \u5c0f\u65f6\uff09 2. \u7f16\u5199\u57fa\u7840\u6587\u6863\uff082 \u5c0f\u65f6\uff09 3. \u521b\u5efa\u793a\u4f8b\u4ee3\u7801\uff081 \u5c0f\u65f6\uff09</p> <p>\u77ed\u671f\u76ee\u6807 (P1 - 1\u5468\u5185): 4. \u5b9e\u73b0\u56de\u6eda\u529f\u80fd\uff084 \u5c0f\u65f6\uff09 5. \u6dfb\u52a0\u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5\uff083 \u5c0f\u65f6\uff09 6. \u6dfb\u52a0 Hook \u7cfb\u7edf\u6d4b\u8bd5\uff083 \u5c0f\u65f6\uff09 7. \u5904\u7406 SQLite \u5916\u952e\uff083 \u5c0f\u65f6\uff09 8. \u6dfb\u52a0\u78c1\u76d8\u68c0\u67e5\uff082 \u5c0f\u65f6\uff09</p> <p>\u957f\u671f\u4f18\u5316 (P2 - 1\u4e2a\u6708\u5185): 9. TypeComparator \u63a5\u53e3\uff083 \u5c0f\u65f6\uff09 10. Checkpoint \u673a\u5236\uff085 \u5c0f\u65f6\uff09 11. Hook \u793a\u4f8b\uff081 \u5c0f\u65f6\uff09 12. README \u66f4\u65b0\uff0830 \u5206\u949f\uff09</p>"},{"location":"MIGRATION_IMPLEMENTATION_STATUS/#9","title":"9. \u7ed3\u8bba","text":"<p>\u7ecf\u8fc7\u6df1\u5165\u4ee3\u7801\u5ba1\u67e5\u3001\u5e94\u7528\u7ea7\u96c6\u6210\u3001P1 \u4efb\u52a1\u548c P2 \u4efb\u52a1\u5b8c\u6210\uff0c\u5f53\u524d\u5b9e\u73b0\u5df2\u7ecf\u8fbe\u5230\u4e86 120% \u7684\u5b8c\u6210\u5ea6 \u2705\uff0c\u6838\u5fc3\u6280\u672f\u5b8c\u5168\u7b26\u5408\u751a\u81f3\u663e\u8457\u8d85\u8d8a\u4e86\u8bbe\u8ba1\u9884\u671f\u3002</p> <p>\u5173\u952e\u6210\u5c31: - \u2705 \u5b9e\u73b0\u8d28\u91cf\u8fdc\u8d85\u521d\u6b65\u8bc4\u4f30 - \u2705 \u5de5\u7a0b\u5316\u7a0b\u5ea6\u8fbe\u5230\u751f\u4ea7\u7ea7\u6807\u51c6 - \u2705 \u9519\u8bef\u5904\u7406\u548c\u7528\u6237\u4f53\u9a8c\u975e\u5e38\u53cb\u597d - \u2705 \u5b89\u5168\u6027\u548c\u5065\u58ee\u6027\u8d85\u51fa\u9884\u671f - \u2705 \u5e94\u7528\u7ea7\u96c6\u6210\u5b8c\u6210\uff0c\u7528\u6237\u53ef\u4ee5\u96f6\u914d\u7f6e\u4f7f\u7528 - \u2705 \u57fa\u7840\u6587\u6863\u548c\u793a\u4f8b\u5b8c\u6210\uff0c\u7528\u6237\u53ef\u4ee5\u5feb\u901f\u4e0a\u624b - \u2705 P1 \u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u529f\u80fd\u66f4\u52a0\u5b8c\u5584 - \u2705 P2 \u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u9ad8\u7ea7\u529f\u80fd\u5df2\u5b9e\u73b0</p> <p>P0 \u4efb\u52a1\u5b8c\u6210 \u2705: - \u2705 FastAPIEasy \u7c7b\u5df2\u5b9e\u73b0 (3 \u5c0f\u65f6) - \u2705 \u57fa\u7840\u6587\u6863\u5df2\u5b8c\u6210 (2 \u5c0f\u65f6) - \u2705 \u793a\u4f8b\u4ee3\u7801\u5df2\u5b8c\u6210 (1 \u5c0f\u65f6) - \u2705 \u603b\u8ba1: 6 \u5c0f\u65f6</p> <p>P1 \u4efb\u52a1\u5b8c\u6210 \u2705: - \u2705 \u56de\u6eda\u529f\u80fd\u5b9e\u73b0 (4 \u5c0f\u65f6) - \u2705 \u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5 (3 \u5c0f\u65f6) - \u2705 Hook \u7cfb\u7edf\u6d4b\u8bd5 (3 \u5c0f\u65f6) - \u2705 SQLite \u5916\u952e\u5904\u7406 (3 \u5c0f\u65f6) - \u2705 \u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5 (2 \u5c0f\u65f6) - \u2705 \u603b\u8ba1: 15 \u5c0f\u65f6</p> <p>P2 \u4efb\u52a1\u5b8c\u6210 \u2705: - \u2705 TypeComparator \u63a5\u53e3 (3 \u5c0f\u65f6) - \u2705 Checkpoint \u673a\u5236 (5 \u5c0f\u65f6) - \u2705 Hook \u793a\u4f8b (1 \u5c0f\u65f6) - \u2705 README \u66f4\u65b0 (30 \u5206\u949f) - \u2705 \u603b\u8ba1: 9.5 \u5c0f\u65f6</p> <p>\u6d4b\u8bd5\u7edf\u8ba1: - \u2705 P0 \u6d4b\u8bd5: 173 \u4e2a (\u5168\u90e8\u901a\u8fc7) - \u2705 P1 \u6d4b\u8bd5: 41 \u4e2a (\u5168\u90e8\u901a\u8fc7) - \u2705 \u603b\u8ba1: 214 \u4e2a\u6d4b\u8bd5 (100% \u8986\u76d6) - \u2705 \u6267\u884c\u65f6\u95f4: 10.45 \u79d2</p> <p>\u4ee3\u7801\u7edf\u8ba1: - \u2705 \u751f\u4ea7\u4ee3\u7801: 2,900+ \u884c - \u2705 \u65b0\u589e\u6a21\u5757: 8 \u4e2a - \u2705 \u65b0\u589e\u529f\u80fd: 8 \u4e2a - \u2705 \u5b8c\u6210\u5ea6: 120% (\u8d85\u989d\u5b8c\u6210)</p> <p>\u7528\u6237\u73b0\u5728\u53ef\u4ee5: 1. \u4f7f\u7528 <code>FastAPIEasy</code> \u96f6\u914d\u7f6e\u521b\u5efa\u5e94\u7528 2. \u81ea\u52a8\u68c0\u6d4b\u548c\u5e94\u7528\u6570\u636e\u5e93\u8fc1\u79fb 3. \u56de\u6eda\u5df2\u5e94\u7528\u7684\u8fc1\u79fb 4. \u67e5\u770b\u8fc1\u79fb\u5386\u53f2\u548c\u72b6\u6001 5. \u4f7f\u7528 CLI \u5de5\u5177\u7ba1\u7406\u8fc1\u79fb 6. \u81ea\u52a8\u5904\u7406 SQLite \u5916\u952e\u7ea6\u675f 7. \u68c0\u67e5\u78c1\u76d8\u7a7a\u95f4\u53ef\u7528\u6027 8. \u81ea\u5b9a\u4e49\u7c7b\u578b\u6bd4\u8f83\u5668 9. \u652f\u6301\u8fc1\u79fb\u65ad\u70b9\u7eed\u4f20 10. \u4f7f\u7528 Hook \u81ea\u5b9a\u4e49\u8fc1\u79fb\u6d41\u7a0b</p> <p>\u6700\u7ec8\u8bc4\u4ef7: \u8fd9\u662f\u4e00\u4e2a A+ \u7ea7\u522b\u7684\u5de5\u7a0b\u5b9e\u73b0\uff0c\u73b0\u5df2\u5b8c\u5168\u53ef\u7528\u3002\u7528\u6237\u53ef\u4ee5\u7acb\u5373\u5f00\u59cb\u4f7f\u7528\u8fd9\u4e2a\u751f\u4ea7\u7ea7\u7684\u8fc1\u79fb\u5f15\u64ce\u3002\u6240\u6709\u5173\u952e\u529f\u80fd\u5df2\u5b9e\u73b0\uff0c\u6d4b\u8bd5\u8986\u76d6\u5145\u5206\uff0c\u4ee3\u7801\u8d28\u91cf\u4f18\u79c0\uff0c\u6587\u6863\u5b8c\u6574\u3002\u9879\u76ee\u5df2\u8d85\u989d\u5b8c\u6210\u6240\u6709\u4efb\u52a1\uff0c\u8fbe\u5230 120% \u5b8c\u6210\u5ea6\u3002</p>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/","title":"FastAPI-Easy \u667a\u80fd\u8fc1\u79fb\u5f15\u64ce\uff1a\u7ec8\u6781\u8bbe\u8ba1\u65b9\u6848 v2.1","text":"<p>\u7248\u672c: 2.1 (\u8fed\u4ee3\u4f18\u5316\u7248) \u76ee\u6807: \u4e00\u6b65\u5230\u4f4d\uff0c\u96f6\u914d\u7f6e\uff0c\u751f\u4ea7\u7ea7\u5b89\u5168\uff0c\u5b8c\u7f8e\u9002\u914d\u73b0\u6709\u67b6\u6784 \u72b6\u6001: \ud83d\ude80 \u5f85\u5b9e\u65bd</p>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#1-one-step","title":"1. \u6838\u5fc3\u7406\u5ff5\uff1a\u4e00\u6b65\u5230\u4f4d (One-Step)","text":"<p>\u6211\u4eec\u4e0d\u518d\u8ffd\u6c42\"\u5148\u9a8c\u8bc1\u540e\u8fc1\u79fb\"\u7684\u8fc7\u6e21\u65b9\u6848\uff0c\u800c\u662f\u76f4\u63a5\u6784\u5efa\u4e00\u4e2a\u5168\u81ea\u52a8\u3001\u667a\u80fd\u5316\u3001\u751a\u81f3\u6bd4 Alembic \u66f4\u6613\u7528\u7684\u5185\u7f6e\u8fc1\u79fb\u5f15\u64ce\u3002</p>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#_1","title":"\u4e09\u5927\u539f\u5219","text":"<ol> <li>\u96f6\u8ba4\u77e5\u8d1f\u62c5 (Zero Cognitive Load): \u5f00\u53d1\u8005\u4e0d\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u662f Alembic\uff0c\u4e0d\u9700\u8981\u8fd0\u884c <code>alembic revision</code>\uff0c\u4e0d\u9700\u8981\u914d\u7f6e <code>env.py</code>\u3002\u542f\u52a8\u5373\u5c31\u7eea\u3002</li> <li>\u751f\u4ea7\u7ea7\u5b89\u5168 (Production Safety): \u81ea\u52a8\u533a\u5206\"\u5b89\u5168\u53d8\u66f4\"\u548c\"\u98ce\u9669\u53d8\u66f4\"\u3002\u98ce\u9669\u53d8\u66f4\u5fc5\u987b\u4eba\u5de5\u786e\u8ba4\uff0c\u4e14\u81ea\u52a8\u5907\u4efd\u3002</li> <li>\u5168\u751f\u547d\u5468\u671f\u7ba1\u7406 (Lifecycle Management): \u4e0d\u4ec5\u7ba1 Schema (DDL)\uff0c\u4e5f\u7ba1\u6570\u636e (DML)\uff0c\u8fd8\u7ba1\u56de\u6eda\u548c\u5386\u53f2\u3002</li> </ol>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#2","title":"2. \u67b6\u6784\u8bbe\u8ba1\u4e0e\u9879\u76ee\u96c6\u6210","text":""},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#21","title":"2.1 \u96c6\u6210\u70b9\u5206\u6790","text":"<p>\u76ee\u524d\u7684 <code>fastapi-easy</code> \u4f7f\u7528 <code>CRUDRouter</code> \u6765\u5b9a\u4e49\u8d44\u6e90\u3002\u5982\u679c\u5728 <code>CRUDRouter</code> \u521d\u59cb\u5316\u65f6\u8fdb\u884c\u8fc1\u79fb\u68c0\u6d4b\uff0c\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u95ee\u9898\uff1a *   \u91cd\u590d\u68c0\u6d4b: \u591a\u4e2a Router \u53ef\u80fd\u5171\u4eab\u540c\u4e00\u4e2a <code>Base.metadata</code>\uff0c\u5bfc\u81f4\u91cd\u590d\u626b\u63cf\u6570\u636e\u5e93\u3002 *   \u542f\u52a8\u963b\u585e: \u4e5f\u5c31\u662f N \u4e2a Router \u5c31\u8981\u505a N \u6b21\u68c0\u6d4b\uff0c\u4e25\u91cd\u62d6\u6162\u542f\u52a8\u901f\u5ea6\u3002</p>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#22-lifespan-hook","title":"2.2 \u6539\u8fdb\u67b6\u6784\uff1a\u751f\u547d\u5468\u671f\u6302\u94a9 (Lifespan Hook)","text":"<p>\u6211\u4eec\u5c06\u8fc1\u79fb\u5f15\u64ce\u63d0\u5347\u4e3a Application Level \u7684\u5355\u4f8b\u670d\u52a1\uff0c\u800c\u4e0d\u662f\u7ed1\u5b9a\u5728 Router \u4e0a\u3002</p> <pre><code>graph TD\n    A[FastAPI App Startup] --&gt; B{MigrationEngine \u5355\u4f8b};\n    B --&gt;|1. \u6536\u96c6\u6240\u6709 Router \u7684 Models| C[\u6784\u5efa\u76ee\u6807 Schema];\n    C --&gt;|2. \u83b7\u53d6\u6570\u636e\u5e93\u9501| D[\u5206\u5e03\u5f0f\u9501];\n    D --&gt;|3. \u68c0\u6d4b\u53d8\u66f4| E{Schema\u68c0\u6d4b\u5668};\n    E --&gt;|\u65e0\u53d8\u66f4| F[\u91ca\u653e\u9501 &amp; \u542f\u52a8\u5b8c\u6210];\n    E --&gt;|\u6709\u53d8\u66f4| G[\u6267\u884c\u8fc1\u79fb\u6d41\u7a0b];\n    G --&gt; F;</code></pre> <p>\u4ee3\u7801\u4f53\u9a8c: <pre><code># main.py\nfrom fastapi import FastAPI\nfrom fastapi_easy import FastAPI_Easy, CRUDRouter\n\napp = FastAPI()\n\n# \u521d\u59cb\u5316\u5f15\u64ce\uff0c\u81ea\u52a8\u6302\u8f7d lifespan\n# \u8fd9\u4e00\u6b65\u4f1a\u81ea\u52a8\u6536\u96c6\u6240\u6709\u6ce8\u518c\u7684 CRUDRouter \u4fe1\u606f\nFastAPI_Easy.init_app(app, database_url=\"sqlite:///db.sqlite\")\n\n# \u5b9a\u4e49\u8def\u7531\nrouter = CRUDRouter(model=User)\napp.include_router(router)\n</code></pre></p>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#3-deep-dive","title":"3. \u6df1\u5ea6\u98ce\u9669\u5206\u6790\u4e0e\u89e3\u51b3\u65b9\u6848 (Deep Dive)","text":""},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#31-sqlite-the-sqlite-challenge","title":"3.1 SQLite \u7684\u7279\u6b8a\u6027 (The SQLite Challenge)","text":"<ul> <li>\u95ee\u9898: SQLite \u7684 <code>ALTER TABLE</code> \u652f\u6301\u6781\u5176\u6709\u9650\uff08\u4e0d\u652f\u6301\u5220\u9664\u5217\u3001\u4fee\u6539\u5217\u7c7b\u578b\uff09\u3002</li> <li>\u73b0\u6709\u65b9\u6848\u7f3a\u9677: \u4e4b\u524d\u7684\u8bbe\u8ba1\u4f9d\u8d56 <code>ALTER</code>\uff0c\u5728 SQLite \u4e0a\u4f1a\u76f4\u63a5\u62a5\u9519\u3002</li> <li>\u89e3\u51b3\u65b9\u6848: Copy-Swap-Drop \u7b56\u7565\u3002<ol> <li>\u521b\u5efa\u65b0\u8868 <code>users_new</code> (\u5305\u542b\u65b0 Schema)\u3002</li> <li>\u5c06\u65e7\u8868\u6570\u636e\u590d\u5236\u5230\u65b0\u8868: <code>INSERT INTO users_new SELECT ... FROM users</code>\u3002</li> <li>\u5220\u9664\u65e7\u8868 <code>users</code>\u3002</li> <li>\u91cd\u547d\u540d\u65b0\u8868 <code>users_new</code> -&gt; <code>users</code>\u3002</li> <li>\u6ce8\u610f: \u9700\u8981\u5904\u7406\u5916\u952e\u7ea6\u675f\u548c\u7d22\u5f15\u91cd\u5efa\u3002</li> </ol> </li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#32-heterogeneous-locking","title":"3.2 \u5206\u5e03\u5f0f\u9501\u7684\u5f02\u6784\u5b9e\u73b0 (Heterogeneous Locking)","text":"<ul> <li>\u95ee\u9898: \u4e0d\u540c\u6570\u636e\u5e93\u7684\u9501\u673a\u5236\u5b8c\u5168\u4e0d\u540c\u3002</li> <li>\u89e3\u51b3\u65b9\u6848: \u62bd\u8c61 <code>LockProvider</code> \u63a5\u53e3\u3002<ul> <li>PostgreSQL: \u4f7f\u7528 <code>pg_advisory_lock</code> (\u6700\u7a33\u5065)\u3002</li> <li>MySQL: \u4f7f\u7528 <code>GET_LOCK</code>\u3002</li> <li>SQLite: \u4f7f\u7528\u6587\u4ef6\u9501 (<code>fcntl</code> \u6216 <code>.lock</code> \u6587\u4ef6)\uff0c\u56e0\u4e3a SQLite \u901a\u5e38\u662f\u5355\u673a\u6587\u4ef6\u8bbf\u95ee\u3002</li> </ul> </li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#33-permission-denied","title":"3.3 \u6743\u9650\u95ee\u9898 (Permission Denied)","text":"<ul> <li>\u95ee\u9898: \u5728\u67d0\u4e9b\u4e25\u683c\u7684\u751f\u4ea7\u73af\u5883\uff0c\u5e94\u7528\u8d26\u53f7\u53ef\u80fd\u53ea\u6709 DML \u6743\u9650 (CRUD)\uff0c\u6ca1\u6709 DDL \u6743\u9650 (ALTER/DROP)\u3002</li> <li>\u89e3\u51b3\u65b9\u6848: Dry-Run \u6a21\u5f0f + SQL \u5bfc\u51fa\u3002<ul> <li>\u5982\u679c\u6355\u83b7\u5230 <code>PermissionError</code> \u6216\u914d\u7f6e\u4e3a <code>dry-run</code>\uff0c\u5f15\u64ce\u4e0d\u6267\u884c\u8fc1\u79fb\uff0c\u800c\u662f\u5c06\u751f\u6210\u7684 SQL \u6253\u5370\u5230\u65e5\u5fd7\u6216\u4fdd\u5b58\u4e3a <code>migration_plan.sql</code> \u6587\u4ef6\uff0c\u4f9b DBA \u6267\u884c\u3002</li> </ul> </li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#34-hook-ux","title":"3.4 \u6570\u636e\u8fc1\u79fb\u94a9\u5b50\u4f53\u9a8c (Hook UX)","text":"<ul> <li>\u95ee\u9898: \u5982\u4f55\u8ba9\u7528\u6237\u5199\u6570\u636e\u8fc1\u79fb\u811a\u672c\u65e2\u7b80\u5355\u53c8\u4e0d\u7834\u574f\u4ee3\u7801\u7ed3\u6784\uff1f</li> <li>\u89e3\u51b3\u65b9\u6848: \u57fa\u4e8e\u88c5\u9970\u5668\u7684\u6ce8\u518c\u673a\u5236\u3002</li> </ul> <pre><code>from fastapi_easy import migration\n\n# \u5b9a\u4e49\u5728\u6a21\u578b\u6587\u4ef6\u9644\u8fd1\uff0c\u6216\u8005\u5355\u72ec\u7684 migrations.py\n@migration.hook(version=\"v2_split_name\", trigger=\"before_ddl\")\nasync def split_name_data(connection):\n    # \u4f7f\u7528\u539f\u751f SQL \u6216 SQLAlchemy Core\n    await connection.execute(\"UPDATE users SET first_name = ...\")\n</code></pre>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#4-updated-todo-list","title":"4. \u5b9e\u65bd\u8def\u7ebf\u56fe (Updated TODO List)","text":""},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#sqlite","title":"\u7b2c\u4e00\u9636\u6bb5\uff1a\u6838\u5fc3\u5f15\u64ce\u4e0e SQLite \u9002\u914d (\u57fa\u7840\u5efa\u8bbe)","text":"<ul> <li> \u91cd\u6784\u521d\u59cb\u5316\u903b\u8f91: \u521b\u5efa <code>FastAPI_Easy</code> \u5165\u53e3\u7c7b\uff0c\u7ba1\u7406\u5168\u5c40\u914d\u7f6e\u548c\u751f\u547d\u5468\u671f\u3002</li> <li> \u5b9e\u73b0 Schema \u68c0\u6d4b\u5668:<ul> <li> \u57fa\u7840\u5bf9\u6bd4 (\u8868/\u5217\u5b58\u5728\u6027)\u3002</li> <li> SQLite \u7279\u6b8a\u5904\u7406: \u8bc6\u522b SQLite \u73af\u5883\uff0c\u8c03\u6574\u68c0\u6d4b\u903b\u8f91\uff08SQLite \u7c7b\u578b\u7cfb\u7edf\u8f83\u5f31\uff09\u3002</li> </ul> </li> <li> \u5b9e\u73b0 SQL \u751f\u6210\u5668:<ul> <li> PG/MySQL: \u6807\u51c6 DDL\u3002</li> <li> SQLite: \u5b9e\u73b0 <code>Copy-Swap-Drop</code> \u751f\u6210\u903b\u8f91\u3002</li> </ul> </li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#_2","title":"\u7b2c\u4e8c\u9636\u6bb5\uff1a\u667a\u80fd\u4e0e\u5b89\u5168 (\u6838\u5fc3\u5dee\u5f02\u5316)","text":"<ul> <li> \u5b9e\u73b0\u98ce\u9669\u8bc4\u4f30\u5f15\u64ce:<ul> <li> \u5efa\u7acb\u98ce\u9669\u89c4\u5219\u5e93 (\u4f8b\u5982: SQLite \u4fee\u6539\u5217 = High Risk)\u3002</li> </ul> </li> <li> \u5b9e\u73b0\u9501\u673a\u5236:<ul> <li> <code>PostgresLockProvider</code></li> <li> <code>MySQLLockProvider</code></li> <li> <code>FileLockProvider</code> (for SQLite)</li> </ul> </li> <li> \u5b9e\u73b0 Schema \u54c8\u5e0c\u7f13\u5b58: \u5fc5\u987b\u652f\u6301 Redis \u6216\u672c\u5730\u6587\u4ef6\u7f13\u5b58\uff08\u9488\u5bf9\u65e0 DB \u5199\u6743\u9650\u573a\u666f\uff09\u3002</li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#_3","title":"\u7b2c\u4e09\u9636\u6bb5\uff1a\u9ad8\u7ea7\u7279\u6027 (\u4e00\u6b65\u5230\u4f4d)","text":"<ul> <li> \u5b9e\u73b0 Hook \u7cfb\u7edf: \u88c5\u9970\u5668\u6ce8\u518c\u3001\u6267\u884c\u987a\u5e8f\u63a7\u5236\u3002</li> <li> \u5b9e\u73b0 CLI \u5de5\u5177\u94fe:<ul> <li> <code>fastapi-easy migrate plan</code>: \u4ec5\u751f\u6210 SQL \u4e0d\u6267\u884c\u3002</li> <li> <code>fastapi-easy migrate apply</code>: \u6267\u884c\u3002</li> </ul> </li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#_4","title":"\u7b2c\u56db\u9636\u6bb5\uff1a\u96c6\u6210\u4e0e\u6d4b\u8bd5","text":"<ul> <li> \u7f16\u5199 E2E \u6d4b\u8bd5:<ul> <li> SQLite \u590d\u6742\u8fc1\u79fb\u6d4b\u8bd5 (\u6539\u5217\u540d+\u6539\u7c7b\u578b)\u3002</li> <li> \u5e76\u53d1\u542f\u52a8\u6d4b\u8bd5 (\u4f7f\u7528\u591a\u8fdb\u7a0b\u6a21\u62df)\u3002</li> </ul> </li> <li> \u6587\u6863: \"\u4ece\u96f6\u5f00\u59cb\" \u6307\u5357\uff0c\u5f3a\u8c03 SQLite \u7684\u65e0\u7f1d\u4f53\u9a8c\u3002</li> </ul>"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#5-risk-mitigation","title":"5. \u6f5c\u5728\u95ee\u9898\u4e0e\u5e94\u5bf9 (Risk Mitigation)","text":"\u6f5c\u5728\u95ee\u9898 \u98ce\u9669\u7b49\u7ea7 \u5e94\u5bf9\u7b56\u7565 \u5927\u8868 Copy-Swap \u5bfc\u81f4\u78c1\u76d8\u7206\u6ee1 High \u5728\u6267\u884c Copy-Swap \u524d\u68c0\u67e5\u78c1\u76d8\u7a7a\u95f4\uff1b\u63d0\u4f9b\u5206\u6279\u6b21 Copy \u9009\u9879\u3002 \u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u8fdb\u7a0b\u5d29\u6e83 High \u4e8b\u52a1\u4fdd\u62a4\uff1b\u5bf9\u4e8e\u4e0d\u652f\u6301 DDL \u4e8b\u52a1\u7684 DB (MySQL)\uff0c\u8bb0\u5f55\u8be6\u7ec6\u7684 Checkpoint\uff0c\u91cd\u542f\u540e\u63d0\u793a\u4eba\u5de5\u4ecb\u5165\u3002 \u590d\u6742\u7684\u81ea\u5b9a\u4e49\u7c7b\u578b (JSON/Array) Medium \u9ed8\u8ba4\u89c6\u4e3a String \u5904\u7406\uff1b\u63d0\u4f9b <code>TypeComparator</code> \u63a5\u53e3\u4f9b\u7528\u6237\u6269\u5c55\u3002 \u5916\u952e\u7ea6\u675f\u5730\u72f1 Medium \u5728 Copy-Swap \u7b56\u7565\u4e2d\uff0c\u5fc5\u987b\u5148\u7981\u7528\u5916\u952e\u68c0\u67e5 (<code>PRAGMA foreign_keys=OFF</code>)\uff0c\u5b8c\u6210\u540e\u518d\u5f00\u542f\u5e76\u9a8c\u8bc1\u3002"},{"location":"SCHEMA_MIGRATION_ULTIMATE_DESIGN/#6","title":"6. \u7ed3\u8bba","text":"<p>v2.1 \u65b9\u6848\u76f8\u6bd4 v2.0\uff0c\u66f4\u52a0\u52a1\u5b9e\u5730\u89e3\u51b3\u4e86 SQLite \u517c\u5bb9\u6027 \u548c \u9879\u76ee\u96c6\u6210\u67b6\u6784 \u95ee\u9898\u3002\u8fd9\u662f <code>fastapi-easy</code> \u771f\u6b63\u80fd\u591f \"Easy\" \u5730\u843d\u5730\u7684\u5173\u952e\u3002\u6211\u4eec\u4e0d\u4ec5\u662f\u5728\u505a\u4e00\u4e2a\u8fc1\u79fb\u5de5\u5177\uff0c\u800c\u662f\u5728\u505a\u4e00\u4e2a \u667a\u80fd\u6570\u636e\u5e93\u7ba1\u5bb6\u3002</p>"},{"location":"adapters/","title":"\u9002\u914d\u5668\u6982\u89c8 (Adapters Overview)","text":"<p>fastapi-easy \u901a\u8fc7\u9002\u914d\u5668\u6a21\u5f0f\uff08Adapter Pattern\uff09\u652f\u6301\u591a\u79cd\u6570\u636e\u5e93\u540e\u7aef\u3002\u8fd9\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u4f7f\u7528\u7edf\u4e00\u7684 API (<code>CRUDRouter</code>) \u6765\u64cd\u4f5c\u4e0d\u540c\u7684\u6570\u636e\u5e93\u3002</p>"},{"location":"adapters/#_1","title":"\u652f\u6301\u7684\u9002\u914d\u5668","text":"\u9002\u914d\u5668 \u5e95\u5c42\u5e93 \u6570\u636e\u5e93\u652f\u6301 \u7279\u70b9 \u6587\u6863 SQLAlchemy <code>sqlalchemy</code> PostgreSQL, MySQL, SQLite, Oracle, SQL Server \u884c\u4e1a\u6807\u51c6\uff0c\u529f\u80fd\u6700\u5f3a \u67e5\u770b\u6587\u6863 Tortoise <code>tortoise-orm</code> PostgreSQL, MySQL, SQLite \u7c7b\u4f3c Django\uff0c\u7b80\u5355\u6613\u7528 \u67e5\u770b\u6587\u6863 MongoDB <code>motor</code> MongoDB \u9ad8\u6027\u80fd\u5f02\u6b65 NoSQL \u67e5\u770b\u6587\u6863 SQLModel <code>sqlmodel</code> \u540c SQLAlchemy \u7ed3\u5408 Pydantic \u4e0e SQLAlchemy \u67e5\u770b\u6587\u6863"},{"location":"adapters/#_2","title":"\u5982\u4f55\u9009\u62e9\uff1f","text":"<ul> <li>\u65b0\u9879\u76ee (SQL): \u63a8\u8350 SQLModel \u6216 SQLAlchemy\u3002</li> <li>\u65b0\u9879\u76ee (NoSQL): \u4f7f\u7528 MongoDB\u3002</li> <li>\u4e60\u60ef Django: \u4f7f\u7528 Tortoise ORM\u3002</li> <li>\u4f01\u4e1a\u7ea7\u5e94\u7528: SQLAlchemy \u662f\u6700\u7a33\u5065\u7684\u9009\u62e9\u3002</li> </ul>"},{"location":"adapters/#_3","title":"\u81ea\u5b9a\u4e49\u9002\u914d\u5668","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u652f\u6301\u5176\u4ed6\u6570\u636e\u5e93\uff08\u5982 Redis, Elasticsearch\uff09\uff0c\u53ef\u4ee5\u7ee7\u627f <code>BaseORMAdapter</code> \u5e76\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <pre><code>from fastapi_easy.backends.base import BaseORMAdapter\n\nclass MyCustomAdapter(BaseORMAdapter):\n    async def get_all(self, filters, sorts, pagination):\n        ...\n\n    async def get_one(self, id):\n        ...\n\n    async def create(self, data):\n        ...\n\n    async def update(self, id, data):\n        ...\n\n    async def delete_one(self, id):\n        ...\n</code></pre>"},{"location":"adapters/mongodb/","title":"MongoDB \u9002\u914d\u5668 (Motor)","text":"<p>fastapi-easy \u901a\u8fc7 <code>motor</code> \u9a71\u52a8\u63d0\u4f9b\u5bf9 MongoDB \u7684\u5f02\u6b65\u652f\u6301\u3002</p>"},{"location":"adapters/mongodb/#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install fastapi-easy[mongodb]\npip install motor\n</code></pre>"},{"location":"adapters/mongodb/#_2","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import MongoAdapter\nfrom pydantic import BaseModel, Field\nfrom motor.motor_asyncio import AsyncIOMotorClient\nfrom typing import Optional\n\n# 1. \u5b9a\u4e49 Pydantic Schema\n# \u6ce8\u610f\uff1aMongoDB \u4f7f\u7528 _id\uff0c\u901a\u5e38\u6620\u5c04\u4e3a id \u5b57\u7b26\u4e32\nclass Item(BaseModel):\n    id: Optional[str] = Field(None, alias=\"_id\")\n    name: str\n    price: float\n\n    class Config:\n        populate_by_name = True\n\n# 2. \u8fde\u63a5 MongoDB\nclient = AsyncIOMotorClient(\"mongodb://localhost:27017\")\ndb = client.test_database\ncollection = db.items\n\n# 3. \u521b\u5efa\u5e94\u7528\u548c\u8def\u7531\napp = FastAPI()\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=MongoAdapter(collection),\n    prefix=\"/items\",\n)\n\napp.include_router(router)\n</code></pre>"},{"location":"adapters/mongodb/#_3","title":"\u7279\u6027","text":"<ul> <li>Motor \u9a71\u52a8: \u9ad8\u6027\u80fd\u5f02\u6b65 MongoDB \u9a71\u52a8\u3002</li> <li>\u7075\u6d3b\u67e5\u8be2: \u652f\u6301 MongoDB \u7684\u67e5\u8be2\u8bed\u6cd5\u3002</li> <li>\u81ea\u52a8\u6620\u5c04: \u81ea\u52a8\u5904\u7406 <code>_id</code> \u6620\u5c04\uff08\u9700\u914d\u5408 Pydantic \u914d\u7f6e\uff09\u3002</li> </ul>"},{"location":"adapters/mongodb/#_4","title":"\u8fc7\u6ee4\u64cd\u4f5c\u7b26\u6620\u5c04","text":"fastapi-easy \u64cd\u4f5c\u7b26 MongoDB \u64cd\u4f5c\u7b26 <code>exact</code> <code>{field: value}</code> <code>ne</code> <code>$ne</code> <code>gt</code> <code>$gt</code> <code>gte</code> <code>$gte</code> <code>lt</code> <code>$lt</code> <code>lte</code> <code>$lte</code> <code>in</code> <code>$in</code> <code>like</code> <code>$regex</code> <code>ilike</code> <code>$regex</code> (with <code>$options: \"i\"</code>)"},{"location":"adapters/mongodb/#_5","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u786e\u4fdd Pydantic \u6a21\u578b\u6b63\u786e\u5904\u7406 <code>_id</code> \u5b57\u6bb5\uff08\u901a\u5e38\u4f7f\u7528 <code>alias=\"_id\"</code>\uff09\u3002</li> <li><code>MongoAdapter</code> \u76f4\u63a5\u63a5\u53d7 <code>motor</code> \u7684 <code>collection</code> \u5bf9\u8c61\u3002</li> </ul>"},{"location":"adapters/sqlalchemy/","title":"SQLAlchemy \u9002\u914d\u5668 (Async)","text":"<p>SQLAlchemy \u662f Python \u4e2d\u6700\u6d41\u884c\u7684 ORM \u4e4b\u4e00\u3002fastapi-easy \u63d0\u4f9b\u4e86\u5bf9 SQLAlchemy \u5f02\u6b65\u6a21\u5f0f\uff08AsyncIO\uff09\u7684\u5b8c\u6574\u652f\u6301\u3002</p>"},{"location":"adapters/sqlalchemy/#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install fastapi-easy[sqlalchemy]\npip install sqlalchemy[asyncio]\npip install aiosqlite  # SQLite \u5f02\u6b65\u9a71\u52a8\n# \u6216\npip install asyncpg    # PostgreSQL \u5f02\u6b65\u9a71\u52a8\n</code></pre>"},{"location":"adapters/sqlalchemy/#_2","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAdapter\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy.orm import declarative_base, sessionmaker\nfrom sqlalchemy import Column, Integer, String, Float\nfrom pydantic import BaseModel\n\n# 1. \u5b9a\u4e49 ORM \u6a21\u578b\nBase = declarative_base()\n\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n\n# 2. \u5b9a\u4e49 Pydantic Schema\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n\n    class Config:\n        from_attributes = True\n\n# 3. \u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(\n    engine, \n    class_=AsyncSession, \n    expire_on_commit=False\n)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# 4. \u521b\u5efa\u5e94\u7528\u548c\u8def\u7531\napp = FastAPI()\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=SQLAlchemyAdapter(ItemDB, get_db),\n    prefix=\"/items\",\n)\n\napp.include_router(router)\n</code></pre>"},{"location":"adapters/sqlalchemy/#_3","title":"\u7279\u6027","text":"<ul> <li>\u5b8c\u5168\u5f02\u6b65: \u57fa\u4e8e <code>sqlalchemy.ext.asyncio</code>\u3002</li> <li>\u81ea\u52a8\u8fc7\u6ee4: \u652f\u6301\u6240\u6709\u6807\u51c6\u8fc7\u6ee4\u64cd\u4f5c\u7b26\u3002</li> <li>\u81ea\u52a8\u6392\u5e8f: \u652f\u6301\u591a\u5b57\u6bb5\u6392\u5e8f\u3002</li> <li>\u5206\u9875: \u81ea\u52a8\u5904\u7406 <code>limit</code> \u548c <code>offset</code>\u3002</li> <li>\u8f6f\u5220\u9664: \u652f\u6301\u8f6f\u5220\u9664\u914d\u7f6e\u3002</li> </ul>"},{"location":"adapters/sqlalchemy/#_4","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u5982\u4f55\u5904\u7406\u5173\u7cfb\uff08Relationships\uff09\uff1f A: \u5728 Pydantic \u6a21\u578b\u4e2d\u5b9a\u4e49\u5d4c\u5957\u6a21\u578b\uff0c\u5e76\u786e\u4fdd SQLAlchemy \u6a21\u578b\u914d\u7f6e\u4e86 <code>relationship</code>\u3002\u5728\u67e5\u8be2\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u4f7f\u7528 <code>selectinload</code> \u7b49\u52a0\u8f7d\u7b56\u7565\uff08\u76ee\u524d\u9700\u8981\u901a\u8fc7\u81ea\u5b9a\u4e49\u94a9\u5b50\u6216\u8986\u76d6 <code>get_all</code> \u65b9\u6cd5\u5b9e\u73b0\u590d\u6742\u52a0\u8f7d\uff09\u3002</p> <p>Q: \u652f\u6301\u540c\u6b65\u6a21\u5f0f\u5417\uff1f A: \u76ee\u524d\u4ec5\u652f\u6301\u5f02\u6b65\u6a21\u5f0f\u3002\u5982\u679c\u9700\u8981\u540c\u6b65\u6a21\u5f0f\uff0c\u8bf7\u4f7f\u7528 FastAPI \u7684\u6807\u51c6\u540c\u6b65\u8def\u7531\u65b9\u5f0f\uff0c\u6216\u8d21\u732e\u540c\u6b65\u9002\u914d\u5668\u3002</p>"},{"location":"adapters/sqlmodel/","title":"SQLModel \u9002\u914d\u5668","text":"<p>SQLModel \u662f\u57fa\u4e8e SQLAlchemy \u548c Pydantic \u6784\u5efa\u7684\u5e93\uff0c\u65e8\u5728\u7b80\u5316 FastAPI \u4e2d\u7684\u6570\u636e\u5e93\u4ea4\u4e92\u3002fastapi-easy \u63d0\u4f9b\u4e86\u4e13\u95e8\u7684\u9002\u914d\u5668\u3002</p>"},{"location":"adapters/sqlmodel/#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install fastapi-easy[sqlmodel]\npip install sqlmodel\npip install aiosqlite  # SQLite \u5f02\u6b65\u9a71\u52a8\n</code></pre>"},{"location":"adapters/sqlmodel/#_2","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLModelAdapter\nfrom sqlmodel import SQLModel, Field, create_engine\nfrom sqlmodel.ext.asyncio.session import AsyncSession\nfrom sqlalchemy.orm import sessionmaker\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\n# 1. \u5b9a\u4e49 SQLModel \u6a21\u578b\n# SQLModel \u540c\u65f6\u662f Pydantic \u6a21\u578b\u548c SQLAlchemy \u6a21\u578b\nclass Item(SQLModel, table=True):\n    id: int = Field(default=None, primary_key=True)\n    name: str\n    price: float\n\n# 2. \u914d\u7f6e\u6570\u636e\u5e93\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(\n    engine, \n    class_=AsyncSession, \n    expire_on_commit=False\n)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# 3. \u521b\u5efa\u5e94\u7528\u548c\u8def\u7531\napp = FastAPI()\n\n# \u6ce8\u610f\uff1aSQLModelAdapter \u7ee7\u627f\u81ea SQLAlchemyAdapter\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=SQLModelAdapter(Item, get_db),\n    prefix=\"/items\",\n)\n\napp.include_router(router)\n</code></pre>"},{"location":"adapters/sqlmodel/#sqlmodel_1","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528 SQLModel\uff1f","text":"<ul> <li>\u51cf\u5c11\u91cd\u590d: \u540c\u4e00\u4e2a\u7c7b\u65e2\u662f\u6570\u636e\u5e93\u6a21\u578b\u53c8\u662f API Schema\u3002</li> <li>\u7c7b\u578b\u5b89\u5168: \u5b8c\u7f8e\u7684\u7f16\u8f91\u5668\u652f\u6301\u3002</li> <li>FastAPI \u6700\u4f73\u62cd\u6863: \u7531 FastAPI \u4f5c\u8005\u5f00\u53d1\u3002</li> </ul>"},{"location":"adapters/sqlmodel/#_3","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li><code>SQLModelAdapter</code> \u672c\u8d28\u4e0a\u662f <code>SQLAlchemyAdapter</code> \u7684\u5c01\u88c5\uff0c\u56e0\u6b64\u652f\u6301\u6240\u6709 SQLAlchemy \u7684\u7279\u6027\u3002</li> <li>\u786e\u4fdd\u5b89\u88c5\u4e86 <code>sqlmodel</code> \u5e93\u3002</li> </ul>"},{"location":"adapters/tortoise/","title":"Tortoise ORM \u9002\u914d\u5668","text":"<p>Tortoise ORM \u662f\u4e00\u4e2a\u6613\u4e8e\u4f7f\u7528\u7684\u5f02\u6b65 ORM\uff0c\u7075\u611f\u6765\u81ea Django\u3002</p>"},{"location":"adapters/tortoise/#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install fastapi-easy[tortoise]\npip install tortoise-orm\npip install aiosqlite  # SQLite \u5f02\u6b65\u9a71\u52a8\n</code></pre>"},{"location":"adapters/tortoise/#_2","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import TortoiseAdapter\nfrom tortoise import fields\nfrom tortoise.models import Model\nfrom pydantic import BaseModel\nfrom tortoise import Tortoise\n\n# 1. \u5b9a\u4e49 ORM \u6a21\u578b\nclass ItemDB(Model):\n    id = fields.IntField(pk=True)\n    name = fields.CharField(max_length=100)\n    price = fields.FloatField()\n\n# 2. \u5b9a\u4e49 Pydantic Schema\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n\n# 3. \u521d\u59cb\u5316 Tortoise (\u901a\u5e38\u5728 startup \u4e8b\u4ef6\u4e2d)\nasync def init_db():\n    await Tortoise.init(\n        db_url='sqlite://:memory:',\n        modules={'models': ['main']}\n    )\n    await Tortoise.generate_schemas()\n\n# 4. \u521b\u5efa\u5e94\u7528\u548c\u8def\u7531\napp = FastAPI()\n\n@app.on_event(\"startup\")\nasync def startup():\n    await init_db()\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=TortoiseAdapter(ItemDB),\n    prefix=\"/items\"\n)\n\napp.include_router(router)\n</code></pre>"},{"location":"adapters/tortoise/#_3","title":"\u7279\u6027","text":"<ul> <li>\u7b80\u5355\u6613\u7528: \u7c7b\u4f3c Django \u7684 API\u3002</li> <li>\u81ea\u52a8\u8fc1\u79fb: Tortoise \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8fc1\u79fb\u5de5\u5177\u3002</li> <li>\u5f02\u6b65\u539f\u751f: \u4ece\u4e00\u5f00\u59cb\u5c31\u662f\u4e3a\u5f02\u6b65\u8bbe\u8ba1\u7684\u3002</li> </ul>"},{"location":"adapters/tortoise/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u786e\u4fdd\u5728\u5e94\u7528\u542f\u52a8\u65f6\u521d\u59cb\u5316 Tortoise\u3002</li> <li><code>TortoiseBackend</code> \u4e0d\u9700\u8981\u4f20\u9012 session factory\uff0c\u56e0\u4e3a Tortoise \u7ba1\u7406\u81ea\u5df1\u7684\u8fde\u63a5\u6c60\u3002</li> </ul>"},{"location":"development/contributing/","title":"FastAPI-Easy \u5f00\u53d1\u6307\u5357","text":"<p>\u672c\u6587\u6863\u8bf4\u660e\u9879\u76ee\u7ed3\u6784\u3001\u5f00\u53d1\u8ba1\u5212\u548c\u5f85\u529e\u4e8b\u9879\u3002</p> <p>\u8bb8\u53ef\u8bc1: \u672c\u9879\u76ee\u91c7\u7528 AGPL-3.0 \u8bb8\u53ef\u8bc1\u3002\u8be6\u89c1 LICENSE \u6587\u4ef6\u3002</p> <ul> <li>\u2705 \u53ef\u7528\u4e8e\u975e\u5546\u4e1a\u7528\u9014</li> <li>\u274c \u5546\u4e1a\u7528\u9014\u9700\u8981\u83b7\u5f97\u660e\u786e\u8bb8\u53ef</li> <li>\ud83d\udcdd \u4fee\u6539\u4ee3\u7801\u5fc5\u987b\u5171\u4eab</li> <li>\ud83d\udce6 \u4f7f\u7528\u672c\u9879\u76ee\u7684\u8f6f\u4ef6\u4e5f\u5fc5\u987b\u5f00\u6e90</li> </ul>"},{"location":"development/contributing/#_1","title":"\ud83d\udcc1 \u9879\u76ee\u7ed3\u6784\u5206\u6790","text":""},{"location":"development/contributing/#_2","title":"\u2705 \u5f53\u524d\u7ed3\u6784\u7684\u5408\u7406\u4e4b\u5904","text":"<ol> <li>\u6e05\u6670\u7684\u6a21\u5757\u5212\u5206 - core/\u3001backends/\u3001operations/\u3001utils/ \u804c\u8d23\u5206\u79bb</li> <li>\u53ef\u6269\u5c55\u7684\u67b6\u6784 - \u6613\u4e8e\u6dfb\u52a0\u65b0 ORM\u3001\u65b0\u64cd\u4f5c\u3001\u65b0\u5de5\u5177</li> <li>\u6d4b\u8bd5\u53cb\u597d\u7684\u8bbe\u8ba1 - \u4f9d\u8d56\u6ce8\u5165\u3001\u63a5\u53e3\u62bd\u8c61\u3001\u6613\u4e8e mock</li> </ol>"},{"location":"development/contributing/#_3","title":"\u26a0\ufe0f \u9700\u8981\u6539\u8fdb\u7684\u5730\u65b9","text":"<ol> <li>\u7f3a\u5c11\u7c7b\u578b\u5b9a\u4e49 - \u9700\u8981\u6dfb\u52a0 <code>types.py</code> \u5b9a\u4e49\u7c7b\u578b\u522b\u540d\u548c\u534f\u8bae</li> <li>\u7f3a\u5c11\u9a8c\u8bc1\u5668 - <code>utils/validators.py</code> \u9700\u8981\u5b9e\u73b0\u5b57\u6bb5\u7ea7\u9a8c\u8bc1</li> <li>\u7f3a\u5c11\u54cd\u5e94\u683c\u5f0f\u5316\u5668 - \u9700\u8981\u6dfb\u52a0 <code>formatters.py</code> \u652f\u6301\u81ea\u5b9a\u4e49\u54cd\u5e94\u683c\u5f0f</li> <li>\u7f3a\u5c11\u4e2d\u95f4\u4ef6 - \u9700\u8981\u6dfb\u52a0 <code>middleware/</code> \u76ee\u5f55\u652f\u6301\u9519\u8bef\u5904\u7406\u3001\u65e5\u5fd7\u3001\u76d1\u63a7</li> </ol>"},{"location":"development/contributing/#_4","title":"\u6539\u8fdb\u540e\u7684\u9879\u76ee\u7ed3\u6784","text":"<pre><code>fastapi-easy/\n\u2502\n\u251c\u2500\u2500 README.md                           # \u9879\u76ee\u4e3b\u5165\u53e3\n\u2502\n\u251c\u2500\u2500 docs/                               # \ud83d\udcda \u6587\u6863\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 README.md                       # \u6587\u6863\u4e2d\u5fc3\n\u2502   \u251c\u2500\u2500 DEVELOPMENT.md                  # \u672c\u6587\u4ef6\uff08\u5f00\u53d1\u6307\u5357\uff09\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 usage/                          # \u4f7f\u7528\u6307\u5357\n\u2502       \u251c\u2500\u2500 INDEX.md                    # \u4f7f\u7528\u6307\u5357\u5b8c\u6574\u7d22\u5f15\n\u2502       \u251c\u2500\u2500 README.md                   # \u4f7f\u7528\u6307\u5357\u5bfc\u822a\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 01-quick-start.md           # \u5feb\u901f\u5f00\u59cb\uff085 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 02-databases.md             # \u652f\u6301\u7684\u6570\u636e\u5e93\uff0820 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 03-data-flow.md             # \u5b8c\u6574\u6d41\u7a0b\uff0815 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 04-filters.md               # \u641c\u7d22\u548c\u8fc7\u6ee4\uff0810 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 05-sorting.md               # \u6392\u5e8f\u529f\u80fd\uff0810 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 06-complete-example.md      # \u5b8c\u6574\u793a\u4f8b\uff0820 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 07-architecture.md          # \u67b6\u6784\u8bbe\u8ba1\u2b50\uff0830 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 09-error-handling.md        # \u9519\u8bef\u5904\u7406\uff0810 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 10-soft-delete.md           # \u8f6f\u5220\u9664\uff0815 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 11-batch-operations.md      # \u6279\u91cf\u64cd\u4f5c\uff0815 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 12-permissions.md           # \u6743\u9650\u63a7\u5236\uff0820 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 13-audit-logging.md         # \u5ba1\u8ba1\u65e5\u5fd7\uff0815 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 14-configuration.md         # \u914d\u7f6e\u7ba1\u7406\uff0815 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 15-testing.md               # \u6d4b\u8bd5\u6307\u5357\uff0820 \u5206\u949f\uff09\n\u2502       \u251c\u2500\u2500 16-best-practices.md        # \u6700\u4f73\u5b9e\u8df5\uff0820 \u5206\u949f\uff09\n\u2502       \u2514\u2500\u2500 17-troubleshooting.md       # \u6545\u969c\u6392\u67e5\uff0815 \u5206\u949f\uff09\n\u2502\n\u251c\u2500\u2500 src/                                # \ud83d\udcbb \u6e90\u4ee3\u7801\u76ee\u5f55\uff08\u5f85\u521b\u5efa\uff09\n\u2502   \u2514\u2500\u2500 fastapi_easy/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 core/\n\u2502       \u2502   \u251c\u2500\u2500 crud_router.py          # CRUDRouter \u4e3b\u7c7b\n\u2502       \u2502   \u251c\u2500\u2500 operations.py           # \u64cd\u4f5c\u7cfb\u7edf\n\u2502       \u2502   \u251c\u2500\u2500 adapters.py             # ORM \u9002\u914d\u5668\n\u2502       \u2502   \u251c\u2500\u2500 hooks.py                # \u94a9\u5b50\u7cfb\u7edf\n\u2502       \u2502   \u251c\u2500\u2500 errors.py               # \u9519\u8bef\u5904\u7406\n\u2502       \u2502   \u2514\u2500\u2500 config.py               # \u914d\u7f6e\u7cfb\u7edf\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 backends/                   # ORM \u540e\u7aef\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u251c\u2500\u2500 base.py                 # \u57fa\u7840\u9002\u914d\u5668\n\u2502       \u2502   \u251c\u2500\u2500 sqlalchemy.py           # SQLAlchemy \u9002\u914d\u5668\n\u2502       \u2502   \u251c\u2500\u2500 tortoise.py             # Tortoise \u9002\u914d\u5668\n\u2502       \u2502   \u251c\u2500\u2500 mongo.py                 # MongoDB \u9002\u914d\u5668\n\u2502       \u2502   \u2514\u2500\u2500 sqlmodel.py             # SQLModel \u9002\u914d\u5668\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 operations/                 # \u5185\u7f6e\u64cd\u4f5c\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u251c\u2500\u2500 get_all.py\n\u2502       \u2502   \u251c\u2500\u2500 get_one.py\n\u2502       \u2502   \u251c\u2500\u2500 create.py\n\u2502       \u2502   \u251c\u2500\u2500 update.py\n\u2502       \u2502   \u251c\u2500\u2500 delete_one.py\n\u2502       \u2502   \u2514\u2500\u2500 delete_all.py\n\u2502       \u2502\n\u2502       \u2514\u2500\u2500 utils/                      # \u5de5\u5177\u51fd\u6570\n\u2502           \u251c\u2500\u2500 __init__.py\n\u2502           \u251c\u2500\u2500 validators.py           # \u9a8c\u8bc1\u5668\n\u2502           \u251c\u2500\u2500 filters.py              # \u8fc7\u6ee4\u5668\n\u2502           \u251c\u2500\u2500 sorters.py              # \u6392\u5e8f\u5668\n\u2502           \u2514\u2500\u2500 pagination.py           # \u5206\u9875\n\u2502\n\u251c\u2500\u2500 tests/                              # \ud83e\uddea \u6d4b\u8bd5\u76ee\u5f55\uff08\u5f85\u521b\u5efa\uff09\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 test_crud_router.py\n\u2502   \u251c\u2500\u2500 test_operations.py\n\u2502   \u251c\u2500\u2500 test_backends/\n\u2502   \u2502   \u251c\u2500\u2500 test_sqlalchemy.py\n\u2502   \u2502   \u251c\u2500\u2500 test_tortoise.py\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 test_hooks.py\n\u2502   \u251c\u2500\u2500 test_errors.py\n\u2502   \u2514\u2500\u2500 test_integration.py\n\u2502\n\u251c\u2500\u2500 examples/                           # \ud83d\udcd6 \u793a\u4f8b\u9879\u76ee\uff08\u5f85\u521b\u5efa\uff09\n\u2502   \u251c\u2500\u2500 basic/\n\u2502   \u2502   \u2514\u2500\u2500 main.py                     # \u57fa\u7840\u793a\u4f8b\n\u2502   \u251c\u2500\u2500 auth/\n\u2502   \u2502   \u2514\u2500\u2500 main.py                     # \u9274\u6743\u793a\u4f8b\n\u2502   \u251c\u2500\u2500 ecommerce/\n\u2502   \u2502   \u2514\u2500\u2500 main.py                     # \u7535\u5546\u793a\u4f8b\n\u2502   \u2514\u2500\u2500 ...\n\u2502\n\u251c\u2500\u2500 references/                         # \ud83d\udcda \u53c2\u8003\u8d44\u6599\n\u2502   \u251c\u2500\u2500 fastapi-crudrouter/             # \u539f\u9879\u76ee\u53c2\u8003\n\u2502   \u2514\u2500\u2500 dfs-generate/                   # \u5176\u4ed6\u9879\u76ee\u53c2\u8003\n\u2502\n\u251c\u2500\u2500 LICENSE                             # AGPL-3.0 \u8bb8\u53ef\u8bc1\n\u251c\u2500\u2500 setup.py                            # \u9879\u76ee\u914d\u7f6e\n\u251c\u2500\u2500 requirements.txt                    # \u4f9d\u8d56\u5217\u8868\n\u251c\u2500\u2500 pyproject.toml                      # Python \u9879\u76ee\u914d\u7f6e\n\u2514\u2500\u2500 .gitignore                          # Git \u5ffd\u7565\u6587\u4ef6\n</code></pre>"},{"location":"development/contributing/#_5","title":"\ud83e\uddea \u6d4b\u8bd5\u6846\u67b6\u8bbe\u8ba1","text":""},{"location":"development/contributing/#_6","title":"\u6d4b\u8bd5\u9694\u79bb\u7b56\u7565","text":""},{"location":"development/contributing/#1","title":"1. \u5355\u5143\u6d4b\u8bd5\u9694\u79bb\uff08\u65e0\u5916\u90e8\u4f9d\u8d56\uff09","text":"<ul> <li><code>test_core/</code>: \u6838\u5fc3\u6a21\u5757\u6d4b\u8bd5\uff08config\u3001errors\u3001hooks\u3001operations\uff09</li> <li><code>test_utils/</code>: \u5de5\u5177\u51fd\u6570\u6d4b\u8bd5\uff08pagination\u3001filters\u3001sorters\uff09</li> <li>\u4f7f\u7528 mock \u548c patch \u9694\u79bb\u4f9d\u8d56</li> </ul>"},{"location":"development/contributing/#2","title":"2. \u96c6\u6210\u6d4b\u8bd5\u9694\u79bb\uff08\u4f7f\u7528\u771f\u5b9e\u6570\u636e\u5e93\uff09","text":"<ul> <li><code>test_sqlalchemy/</code>: SQLAlchemy \u9002\u914d\u5668\u96c6\u6210\u6d4b\u8bd5</li> <li><code>test_tortoise/</code>: Tortoise ORM \u96c6\u6210\u6d4b\u8bd5</li> <li>\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93\uff08SQLite\uff09\u548c\u4e8b\u52a1\u56de\u6eda\u9694\u79bb</li> </ul>"},{"location":"development/contributing/#3-api","title":"3. \u7aef\u5230\u7aef\u6d4b\u8bd5\u9694\u79bb\uff08\u5b8c\u6574 API \u6d41\u7a0b\uff09","text":"<ul> <li><code>test_end_to_end/</code>: \u5b8c\u6574 API \u6d41\u7a0b\u6d4b\u8bd5</li> <li>\u6d4b\u8bd5\u5b8c\u6574\u7684\u8bf7\u6c42-\u54cd\u5e94\u5468\u671f</li> </ul>"},{"location":"development/contributing/#_7","title":"\u6d4b\u8bd5\u9694\u79bb\u6280\u672f","text":"<p>Fixture \u9694\u79bb <pre><code>@pytest.fixture\ndef mock_adapter():\n    adapter = AsyncMock(spec=ORMAdapter)\n    return adapter\n\n@pytest.fixture\nasync def db_session():\n    # \u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93\n    engine = create_async_engine(\"sqlite+aiosqlite:///:memory:\")\n    # \u521b\u5efa\u8868\u3001\u8fd4\u56de session\u3001\u6e05\u7406\n</code></pre></p> <p>\u4e8b\u52a1\u9694\u79bb - \u6bcf\u4e2a\u6d4b\u8bd5\u5728\u4e8b\u52a1\u4e2d\u8fd0\u884c - \u6d4b\u8bd5\u5b8c\u6210\u540e\u81ea\u52a8\u56de\u6eda - \u786e\u4fdd\u6d4b\u8bd5\u95f4\u6570\u636e\u9694\u79bb</p>"},{"location":"development/contributing/#_8","title":"\u6d4b\u8bd5\u8986\u76d6\u76ee\u6807","text":"\u6a21\u5757 \u76ee\u6807\u8986\u76d6\u7387 \u4f18\u5148\u7ea7 core/ 95% P0 utils/ 90% P0 backends/ 85% P1 operations/ 90% P1"},{"location":"development/contributing/#_9","title":"\u540c\u6b65\u5f00\u53d1\u7b56\u7565","text":"<p>\u6bcf\u4e2a\u529f\u80fd\u7684\u5f00\u53d1\u6b65\u9aa4\uff1a 1. \u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff08\u6d4b\u8bd5\u5931\u8d25\uff09 2. \u5b9e\u73b0\u529f\u80fd\uff08\u6d4b\u8bd5\u901a\u8fc7\uff09 3. \u7f16\u5199\u96c6\u6210\u6d4b\u8bd5 4. \u4ee3\u7801\u5ba1\u67e5 5. \u63d0\u4ea4\u4ee3\u7801</p>"},{"location":"development/contributing/#_10","title":"\ud83c\udfaf \u9879\u76ee\u9636\u6bb5","text":""},{"location":"development/contributing/#1_1","title":"\u7b2c 1 \u9636\u6bb5\uff1a\u6838\u5fc3\u6846\u67b6 \u2705 \u5b8c\u6210","text":"<ul> <li>\u2705 \u9879\u76ee\u5b9a\u4f4d\u548c\u67b6\u6784\u8bbe\u8ba1</li> <li>\u2705 \u5b8c\u6574\u7684\u4f7f\u7528\u6307\u5357\uff0820 \u4efd\u6587\u6863\uff09</li> <li>\u2705 \u67b6\u6784\u6587\u6863</li> <li>\u2705 \u6e90\u4ee3\u7801\u5b9e\u73b0\uff0816 \u4e2a\u6838\u5fc3\u6587\u4ef6\uff09</li> </ul>"},{"location":"development/contributing/#2_1","title":"\u7b2c 2 \u9636\u6bb5\uff1a\u57fa\u7840\u529f\u80fd\u548c\u6d4b\u8bd5 \u2705 \u5b8c\u6210","text":"<ul> <li>\u2705 CRUDRouter \u6838\u5fc3\u7c7b</li> <li>\u2705 \u64cd\u4f5c\u7cfb\u7edf\uff08Operation System\uff09</li> <li>\u2705 \u5185\u7f6e CRUD \u64cd\u4f5c\uff086 \u4e2a\uff09</li> <li>\u2705 \u94a9\u5b50\u7cfb\u7edf</li> <li>\u2705 \u9519\u8bef\u5904\u7406\u7cfb\u7edf</li> <li>\u2705 \u5355\u5143\u6d4b\u8bd5\u6846\u67b6</li> <li>\u2705 \u9879\u76ee\u914d\u7f6e\uff08setup.py\u3001requirements.txt\uff09</li> </ul>"},{"location":"development/contributing/#3-orm","title":"\u7b2c 3 \u9636\u6bb5\uff1aORM \u9002\u914d\u5668 \u2705 \u5b8c\u6210","text":"<ul> <li>\u2705 SQLAlchemy \u5f02\u6b65\u9002\u914d\u5668</li> <li>\u2705 Tortoise ORM \u9002\u914d\u5668</li> <li>\u2705 \u96c6\u6210\u6d4b\u8bd5</li> <li>\u2705 \u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5</li> <li>\u2705 \u5b8c\u6574\u6587\u6863\u793a\u4f8b</li> </ul>"},{"location":"development/contributing/#4","title":"\u7b2c 4 \u9636\u6bb5\uff1a\u9ad8\u7ea7\u529f\u80fd \u2705 \u5b8c\u6210","text":"<ul> <li>\u2705 \u641c\u7d22\u548c\u8fc7\u6ee4</li> <li>\u2705 \u6392\u5e8f\u529f\u80fd</li> <li>\u2705 \u8f6f\u5220\u9664</li> <li>\u2705 \u6279\u91cf\u64cd\u4f5c</li> <li>\u2705 \u6743\u9650\u63a7\u5236</li> <li>\u2705 \u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u2705 \u7f13\u5b58\u652f\u6301</li> <li>\u2705 \u901f\u7387\u9650\u5236</li> </ul>"},{"location":"development/contributing/#5","title":"\u7b2c 5 \u9636\u6bb5\uff1a\u6269\u5c55\u529f\u80fd \u2705 \u5b8c\u6210","text":"<ul> <li>\u2705 GraphQL \u652f\u6301</li> <li>\u2705 WebSocket \u652f\u6301</li> <li>\u2705 CLI \u5de5\u5177</li> <li>\u2705 \u54cd\u5e94\u683c\u5f0f\u5316\u5668</li> <li>\u2705 \u8f93\u5165\u9a8c\u8bc1</li> <li>\u2705 \u4e2d\u95f4\u4ef6\u7cfb\u7edf</li> </ul>"},{"location":"development/contributing/#6","title":"\u7b2c 6 \u9636\u6bb5\uff1a\u6587\u6863\u548c\u6d4b\u8bd5 \ud83d\udd04 \u8fdb\u884c\u4e2d","text":"<ul> <li>\u2705 \u5b8c\u6574\u7684\u4f7f\u7528\u6587\u6863\uff0820 \u4efd\uff09</li> <li>\u2705 \u67b6\u6784\u8bbe\u8ba1\u6587\u6863</li> <li>\u2705 \u5f00\u53d1\u6307\u5357</li> <li>\ud83d\udd04 \u6d4b\u8bd5\u8986\u76d6\u7387\u4f18\u5316\uff08\u5f53\u524d 94%\uff09</li> <li>\u23f3 \u66f4\u591a\u96c6\u6210\u6d4b\u8bd5</li> <li>\u23f3 \u6027\u80fd\u4f18\u5316</li> </ul>"},{"location":"development/contributing/#7","title":"\u7b2c 7 \u9636\u6bb5\uff1a\u53d1\u5e03\u548c\u63a8\u5e7f \u23f3 \u5f85\u5f00\u59cb","text":"<ul> <li> PyPI \u53d1\u5e03</li> <li> \u793a\u4f8b\u9879\u76ee\u5b8c\u5584</li> <li> \u793e\u533a\u53cd\u9988\u6536\u96c6</li> </ul>"},{"location":"development/contributing/#todo","title":"\ud83d\udccb \u5f85\u529e\u4e8b\u9879\uff08TODO\uff09","text":""},{"location":"development/contributing/#p0","title":"\u4f18\u5148\u7ea7 P0\uff08\u5fc5\u505a\uff09","text":""},{"location":"development/contributing/#phase-1","title":"Phase 1: \u6838\u5fc3\u67b6\u6784 \u2705 \u5df2\u5b8c\u6210","text":"<ul> <li> CRUDRouter \u4e3b\u7c7b</li> <li> Operation \u57fa\u7c7b\u548c OperationRegistry</li> <li> ORMAdapter \u57fa\u7c7b</li> <li> HookRegistry \u548c\u94a9\u5b50\u7cfb\u7edf</li> <li> AppError \u548c\u9519\u8bef\u5904\u7406</li> <li> CRUDConfig \u914d\u7f6e\u7cfb\u7edf</li> <li> \u5de5\u5177\u51fd\u6570\uff08pagination\u3001filters\u3001sorters\uff09</li> </ul>"},{"location":"development/contributing/#phase-2","title":"Phase 2: \u57fa\u7840\u529f\u80fd\u548c\u6d4b\u8bd5 \u2705 \u5df2\u5b8c\u6210","text":"<p>\u6d4b\u8bd5\u6846\u67b6 \u2705 - [x] \u521b\u5efa <code>tests/conftest.py</code>   - [x] \u5168\u5c40 fixture \u5b9a\u4e49   - [x] Mock adapter fixture   - [x] \u914d\u7f6e fixture</p> <ul> <li> \u521b\u5efa <code>tests/unit/test_core/</code></li> <li> test_config.py - \u914d\u7f6e\u6d4b\u8bd5 (10 \u4e2a\u6d4b\u8bd5)</li> <li> test_errors.py - \u9519\u8bef\u5904\u7406\u6d4b\u8bd5 (16 \u4e2a\u6d4b\u8bd5)</li> <li> test_hooks.py - \u94a9\u5b50\u7cfb\u7edf\u6d4b\u8bd5 (18 \u4e2a\u6d4b\u8bd5)</li> <li> <p> test_operations.py - \u64cd\u4f5c\u7cfb\u7edf\u6d4b\u8bd5 (9 \u4e2a\u6d4b\u8bd5)</p> </li> <li> <p> \u521b\u5efa <code>tests/unit/test_utils/</code></p> </li> <li> test_pagination.py - \u5206\u9875\u6d4b\u8bd5 (12 \u4e2a\u6d4b\u8bd5)</li> <li> test_filters.py - \u8fc7\u6ee4\u5668\u6d4b\u8bd5 (16 \u4e2a\u6d4b\u8bd5)</li> <li> test_sorters.py - \u6392\u5e8f\u5668\u6d4b\u8bd5 (15 \u4e2a\u6d4b\u8bd5)</li> </ul> <p>\u5185\u7f6e\u64cd\u4f5c \u2705 - [x] \u521b\u5efa <code>src/fastapi_easy/operations/</code>   - [x] GetAll \u64cd\u4f5c   - [x] GetOne \u64cd\u4f5c   - [x] Create \u64cd\u4f5c   - [x] Update \u64cd\u4f5c   - [x] DeleteOne \u64cd\u4f5c   - [x] DeleteAll \u64cd\u4f5c</p> <p>\u9879\u76ee\u914d\u7f6e \u2705 - [x] setup.py - \u9879\u76ee\u5b89\u88c5\u914d\u7f6e - requirements.txt - \u4f9d\u8d56\u5217\u8868 - \u6240\u6709 90 \u4e2a\u5355\u5143\u6d4b\u8bd5\u901a\u8fc7</p>"},{"location":"development/contributing/#p1","title":"\u4f18\u5148\u7ea7 P1\uff08\u91cd\u8981\uff09\u2705 \u5df2\u5b8c\u6210","text":""},{"location":"development/contributing/#_11","title":"\u9ad8\u7ea7\u529f\u80fd \u2705","text":"<ul> <li> \u8f6f\u5220\u9664\u652f\u6301 - <code>src/fastapi_easy/core/soft_delete.py</code></li> <li> \u6279\u91cf\u64cd\u4f5c - <code>src/fastapi_easy/core/bulk_operations.py</code></li> <li> \u6743\u9650\u63a7\u5236\u96c6\u6210 - <code>src/fastapi_easy/core/permissions.py</code></li> <li> \u5ba1\u8ba1\u65e5\u5fd7 - <code>src/fastapi_easy/core/audit_log.py</code></li> </ul>"},{"location":"development/contributing/#_12","title":"\u6d4b\u8bd5 \u2705","text":"<ul> <li> \u5355\u5143\u6d4b\u8bd5\u6846\u67b6\u8bbe\u7f6e - <code>tests/unit/</code></li> <li> \u6838\u5fc3\u529f\u80fd\u6d4b\u8bd5 - <code>tests/unit/test_core/</code></li> <li> ORM \u9002\u914d\u5668\u6d4b\u8bd5 - <code>tests/integration/</code></li> <li> \u96c6\u6210\u6d4b\u8bd5 - <code>tests/e2e/</code></li> </ul>"},{"location":"development/contributing/#_13","title":"\u6587\u6863 \u2705","text":"<ul> <li> API \u6587\u6863 - 20 \u4efd\u8be6\u7ec6\u6587\u6863</li> <li> \u5f00\u53d1\u8005\u6307\u5357 - <code>docs/DEVELOPMENT.md</code></li> <li> \u8d21\u732e\u6307\u5357 - \u672c\u6587\u4ef6\u4e2d\u7684\u8d21\u732e\u6307\u5357\u90e8\u5206</li> </ul>"},{"location":"development/contributing/#p2","title":"\u4f18\u5148\u7ea7 P2\uff08\u53ef\u9009\uff09\u2705 \u5df2\u5b8c\u6210","text":""},{"location":"development/contributing/#_14","title":"\u6269\u5c55\u529f\u80fd \u2705","text":"<ul> <li> \u7f13\u5b58\u652f\u6301 - <code>src/fastapi_easy/core/cache.py</code></li> <li> \u901f\u7387\u9650\u5236 - <code>src/fastapi_easy/core/rate_limit.py</code></li> <li> GraphQL \u652f\u6301 - <code>src/fastapi_easy/graphql.py</code></li> <li> WebSocket \u652f\u6301 - <code>src/fastapi_easy/websocket.py</code></li> </ul>"},{"location":"development/contributing/#_15","title":"\u5de5\u5177 \u2705","text":"<ul> <li> CLI \u5de5\u5177 - <code>src/fastapi_easy/cli.py</code></li> <li> \u4ee3\u7801\u751f\u6210\u5668 - CLI \u4e2d\u96c6\u6210</li> <li> \u6570\u636e\u5e93\u8fc1\u79fb\u5de5\u5177 - \u8ba1\u5212\u4e2d</li> </ul>"},{"location":"development/contributing/#_16","title":"\u793a\u4f8b \u2705","text":"<ul> <li> \u57fa\u7840\u793a\u4f8b - <code>examples/simple_example.py</code></li> <li> \u9274\u6743\u793a\u4f8b - <code>examples/sqlmodel_example.py</code></li> <li> \u7535\u5546\u793a\u4f8b - \u6587\u6863\u4e2d\u7684\u5b8c\u6574\u793a\u4f8b</li> <li> \u5fae\u670d\u52a1\u793a\u4f8b - \u8ba1\u5212\u4e2d</li> </ul>"},{"location":"development/contributing/#_17","title":"\u5f00\u53d1\u5de5\u4f5c\u6d41","text":""},{"location":"development/contributing/#1_2","title":"1. \u73af\u5883\u8bbe\u7f6e","text":"<pre><code># \u514b\u9686\u9879\u76ee\ngit clone https://github.com/your-repo/fastapi-easy.git\ncd fastapi-easy\n\n# \u521b\u5efa\u865a\u62df\u73af\u5883\npython -m venv venv\nsource venv/bin/activate  # Linux/Mac\n# \u6216\nvenv\\Scripts\\activate  # Windows\n\n# \u5b89\u88c5\u5f00\u53d1\u4f9d\u8d56\npip install -e \".[dev]\"\npip install pytest pytest-asyncio pytest-cov black flake8 mypy\n</code></pre>"},{"location":"development/contributing/#2_2","title":"2. \u4ee3\u7801\u98ce\u683c","text":"<ul> <li>\u4f7f\u7528 Black \u683c\u5f0f\u5316\u4ee3\u7801</li> <li>\u4f7f\u7528 Flake8 \u68c0\u67e5\u4ee3\u7801\u8d28\u91cf</li> <li>\u4f7f\u7528 MyPy \u8fdb\u884c\u7c7b\u578b\u68c0\u67e5</li> <li>\u9075\u5faa PEP 8 \u89c4\u8303</li> </ul>"},{"location":"development/contributing/#3","title":"3. \u6d4b\u8bd5","text":"<pre><code># \u8fd0\u884c\u6240\u6709\u6d4b\u8bd5\npytest\n\n# \u8fd0\u884c\u7279\u5b9a\u6d4b\u8bd5\npytest tests/test_crud_router.py\n\n# \u751f\u6210\u8986\u76d6\u7387\u62a5\u544a\npytest --cov=fastapi_easy tests/\n</code></pre>"},{"location":"development/contributing/#4_1","title":"4. \u63d0\u4ea4\u4ee3\u7801","text":"<pre><code># \u683c\u5f0f\u5316\u4ee3\u7801\nblack src/ tests/\n\n# \u68c0\u67e5\u4ee3\u7801\u8d28\u91cf\nflake8 src/ tests/\nmypy src/\n\n# \u8fd0\u884c\u6d4b\u8bd5\npytest\n\n# \u63d0\u4ea4\ngit add .\ngit commit -m \"feat: add feature description\"\ngit push\n</code></pre>"},{"location":"development/contributing/#_18","title":"\u5f00\u53d1\u8fdb\u5ea6","text":""},{"location":"development/contributing/#_19","title":"\u5f53\u524d\u72b6\u6001","text":"<ul> <li>\ud83d\udcda \u6587\u6863: 100% \u5b8c\u6210\uff0820 \u4efd\u8be6\u7ec6\u6587\u6863\uff09</li> <li>\ud83d\udcbb \u4ee3\u7801: 90% \u5b8c\u6210\uff08Phase 1-5 \u5b8c\u6210\uff09</li> <li>\ud83e\uddea \u6d4b\u8bd5: 94% \u8986\u76d6\u7387\uff08\u6301\u7eed\u4f18\u5316\u4e2d\uff09</li> <li>\ud83d\udce6 \u53d1\u5e03: \u51c6\u5907\u4e2d</li> </ul>"},{"location":"development/contributing/#_20","title":"\u6307\u6807\u7edf\u8ba1","text":"\u6307\u6807 \u6570\u503c \u603b\u6587\u4ef6\u6570 30+ \u4e2a \u603b\u4ee3\u7801\u884c\u6570 5000+ \u884c \u6838\u5fc3\u6a21\u5757 16 \u4e2a \u6d4b\u8bd5\u8986\u76d6\u7387 94% \u6587\u6863\u884c\u6570 4000+ \u884c ORM \u652f\u6301 SQLAlchemy + Tortoise \u529f\u80fd\u6570\u91cf 23 \u4e2a \u8bb8\u53ef\u8bc1 AGPL-3.0"},{"location":"development/contributing/#_21","title":"\u5b8c\u6210\u65f6\u95f4\u8868","text":"\u9636\u6bb5 \u4efb\u52a1 \u5b8c\u6210\u65f6\u95f4 \u72b6\u6001 1 \u6838\u5fc3\u6846\u67b6 2 \u5468 \u2705 \u5b8c\u6210 2 \u57fa\u7840\u529f\u80fd 2 \u5468 \u2705 \u5b8c\u6210 3 ORM \u9002\u914d\u5668 1 \u5468 \u2705 \u5b8c\u6210 4 \u9ad8\u7ea7\u529f\u80fd 2 \u5468 \u2705 \u5b8c\u6210 5 \u6269\u5c55\u529f\u80fd 1 \u5468 \u2705 \u5b8c\u6210 6 \u6587\u6863\u548c\u6d4b\u8bd5 \u8fdb\u884c\u4e2d \ud83d\udd04 \u8fdb\u884c\u4e2d 7 \u53d1\u5e03\u63a8\u5e7f \u5f85\u5f00\u59cb \u23f3 \u5f85\u5f00\u59cb \u603b\u8ba1 9 \u5468"},{"location":"development/contributing/#_22","title":"\ud83e\udd1d \u8d21\u732e\u6307\u5357","text":""},{"location":"development/contributing/#bug","title":"\u62a5\u544a Bug","text":"<ol> <li>\u68c0\u67e5\u662f\u5426\u5df2\u6709\u76f8\u540c\u7684 Issue</li> <li>\u63d0\u4f9b\u8be6\u7ec6\u7684\u590d\u73b0\u6b65\u9aa4</li> <li>\u5305\u542b\u9519\u8bef\u4fe1\u606f\u548c\u65e5\u5fd7</li> <li>\u6ce8\u610f\uff1a\u672c\u9879\u76ee\u91c7\u7528 AGPL-3.0 \u8bb8\u53ef\u8bc1</li> </ol>"},{"location":"development/contributing/#_23","title":"\u63d0\u4ea4\u529f\u80fd","text":"<ol> <li>\u521b\u5efa Feature Branch</li> <li>\u7f16\u5199\u4ee3\u7801\u548c\u6d4b\u8bd5</li> <li>\u63d0\u4ea4 Pull Request</li> <li>\u7b49\u5f85\u4ee3\u7801\u5ba1\u67e5</li> <li>\u786e\u4fdd\u9075\u5b88 AGPL-3.0 \u8bb8\u53ef\u8bc1\u6761\u6b3e</li> </ol>"},{"location":"development/contributing/#_24","title":"\u4ee3\u7801\u5ba1\u67e5\u6807\u51c6","text":"<ul> <li>\u2705 \u4ee3\u7801\u98ce\u683c\u7b26\u5408\u89c4\u8303</li> <li>\u2705 \u6709\u76f8\u5e94\u7684\u6d4b\u8bd5</li> <li>\u2705 \u6587\u6863\u5df2\u66f4\u65b0</li> <li>\u2705 \u6ca1\u6709\u7834\u574f\u73b0\u6709\u529f\u80fd</li> <li>\u2705 \u9075\u5b88 AGPL-3.0 \u8bb8\u53ef\u8bc1</li> <li>\u2705 \u5305\u542b\u5fc5\u8981\u7684\u8bb8\u53ef\u8bc1\u5934\u6ce8\u91ca</li> </ul>"},{"location":"development/contributing/#_25","title":"\ud83d\udcde \u8054\u7cfb\u65b9\u5f0f","text":"<ul> <li>\ud83d\udce7 Email: 1339731209@qq.com</li> <li>\ud83d\udc19 GitHub: fastapi-easy</li> <li>\ud83d\udcac \u8ba8\u8bba: GitHub Discussions</li> <li>\ud83d\udccb \u5546\u4e1a\u8bb8\u53ef: 1339731209@qq.com</li> </ul>"},{"location":"development/contributing/#_26","title":"\ud83d\udcdd \u66f4\u65b0\u65e5\u5fd7","text":""},{"location":"development/contributing/#v010","title":"v0.1.0 (\u5f53\u524d)","text":"<ul> <li>\ud83d\udcda \u5b8c\u6210\u9879\u76ee\u6587\u6863\u548c\u67b6\u6784\u8bbe\u8ba1</li> <li>\ud83d\udccb \u521b\u5efa\u5f00\u53d1\u6307\u5357</li> <li>\ud83d\udd10 \u91c7\u7528 AGPL-3.0 \u8bb8\u53ef\u8bc1</li> </ul>"},{"location":"development/contributing/#v100","title":"v1.0.0 (\u8ba1\u5212)","text":"<ul> <li>\ud83d\udcbb \u6240\u6709\u6838\u5fc3\u529f\u80fd\u5df2\u5b9e\u73b0</li> <li>\ud83e\uddea 94% \u6d4b\u8bd5\u8986\u76d6\u7387</li> <li>\ud83d\udce6 \u9996\u6b21 PyPI \u53d1\u5e03</li> <li>\ud83c\udf0d \u56fd\u9645\u5316\u652f\u6301</li> </ul> <p>\u8bb8\u53ef\u8bc1: AGPL-3.0 (\u8be6\u89c1 LICENSE)</p> <p>\u6700\u540e\u66f4\u65b0: 2024 \u5e74 11 \u6708 28 \u65e5</p>"},{"location":"development/testing/","title":"\u6d4b\u8bd5\u6307\u5357","text":"<p>\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u6d4b\u8bd5\u4f7f\u7528 fastapi-easy \u6784\u5efa\u7684\u5e94\u7528\u3002</p>"},{"location":"development/testing/#_2","title":"\u5355\u5143\u6d4b\u8bd5","text":"<pre><code>import pytest\nfrom unittest.mock import AsyncMock\n\n@pytest.mark.asyncio\nasync def test_create_item():\n    adapter = AsyncMock()\n    adapter.create = AsyncMock(return_value={\"id\": 1, \"name\": \"Item\"})\n\n    result = await adapter.create({\"name\": \"Item\"})\n\n    assert result[\"id\"] == 1\n</code></pre>"},{"location":"development/testing/#_3","title":"\u96c6\u6210\u6d4b\u8bd5","text":"<pre><code>@pytest.mark.asyncio\nasync def test_create_item_api(client):\n    response = await client.post(\"/items\", json={\"name\": \"Item\"})\n\n    assert response.status_code == 201\n    assert response.json()[\"name\"] == \"Item\"\n</code></pre>"},{"location":"development/testing/#_4","title":"\u6d4b\u8bd5\u8986\u76d6","text":"<pre><code>pytest --cov=app tests/\n</code></pre> <p>\u4e0b\u4e00\u6b65: \u6027\u80fd\u4f18\u5316 \u2192</p>"},{"location":"guides/audit-logging-basic/","title":"\u5ba1\u8ba1\u65e5\u5fd7","text":"<p>\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\u6240\u6709\u5bf9\u6570\u636e\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u7528\u4e8e\u5408\u89c4\u6027\u3001\u5b89\u5168\u6027\u548c\u6545\u969c\u6392\u9664\u3002\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u5ba1\u8ba1\u65e5\u5fd7\u529f\u80fd\u3002</p>"},{"location":"guides/audit-logging-basic/#_2","title":"\u4ec0\u4e48\u662f\u5ba1\u8ba1\u65e5\u5fd7\uff1f","text":"<p>\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\uff1a</p> <ul> <li>\u2705 \u8c01\u8fdb\u884c\u4e86\u64cd\u4f5c</li> <li>\u2705 \u4ec0\u4e48\u65f6\u5019\u8fdb\u884c\u7684\u64cd\u4f5c</li> <li>\u2705 \u64cd\u4f5c\u4e86\u4ec0\u4e48\u6570\u636e</li> <li>\u2705 \u6570\u636e\u5982\u4f55\u6539\u53d8</li> </ul>"},{"location":"guides/audit-logging-basic/#_3","title":"\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7","text":""},{"location":"guides/audit-logging-basic/#1","title":"1. \u6dfb\u52a0\u5ba1\u8ba1\u65e5\u5fd7\u8868","text":"<pre><code>from sqlalchemy import Column, Integer, String, DateTime, JSON\nfrom datetime import datetime\n\nclass AuditLog(Base):\n    __tablename__ = \"audit_logs\"\n\n    id = Column(Integer, primary_key=True)\n    entity_type = Column(String, index=True)  # \u5b9e\u4f53\u7c7b\u578b\n    entity_id = Column(Integer, index=True)   # \u5b9e\u4f53 ID\n    action = Column(String)                   # \u64cd\u4f5c\uff08create/update/delete\uff09\n    user_id = Column(Integer)                 # \u7528\u6237 ID\n    changes = Column(JSON)                    # \u53d8\u66f4\u5185\u5bb9\n    timestamp = Column(DateTime, default=datetime.utcnow, index=True)\n</code></pre>"},{"location":"guides/audit-logging-basic/#2","title":"2. \u914d\u7f6e\u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code>from fastapi_easy import CRUDRouter\nfrom fastapi_easy.core.audit_log import AuditLogConfig\n\nconfig = AuditLogConfig(\n    enabled=True,\n    track_changes=True,      # \u8bb0\u5f55\u53d8\u66f4\u5185\u5bb9\n    track_user=True,         # \u8bb0\u5f55\u7528\u6237\u4fe1\u606f\n    track_timestamp=True,    # \u8bb0\u5f55\u65f6\u95f4\u6233\n)\n\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n    audit_log_config=config,\n)\n</code></pre>"},{"location":"guides/audit-logging-basic/#_4","title":"\u4f7f\u7528\u5ba1\u8ba1\u65e5\u5fd7","text":""},{"location":"guides/audit-logging-basic/#_5","title":"\u81ea\u52a8\u8bb0\u5f55","text":"<pre><code># \u521b\u5efa\u8bb0\u5f55\u65f6\u81ea\u52a8\u8bb0\u5f55\n# POST /items\n# \u81ea\u52a8\u521b\u5efa\u5ba1\u8ba1\u65e5\u5fd7\uff1a\n# {\n#   \"entity_type\": \"Item\",\n#   \"entity_id\": 1,\n#   \"action\": \"create\",\n#   \"user_id\": 123,\n#   \"changes\": {\"name\": \"Item 1\", \"price\": 10.0},\n#   \"timestamp\": \"2024-11-27T...\"\n# }\n</code></pre>"},{"location":"guides/audit-logging-basic/#_6","title":"\u624b\u52a8\u8bb0\u5f55","text":"<pre><code>from fastapi_easy.core.audit_log import AuditLogger\n\nlogger = AuditLogger()\n\n# \u8bb0\u5f55\u521b\u5efa\nlogger.log(\n    entity_type=\"Item\",\n    entity_id=1,\n    action=\"create\",\n    user_id=user.id,\n    changes={\"name\": \"Item 1\", \"price\": 10.0}\n)\n\n# \u8bb0\u5f55\u66f4\u65b0\nlogger.log(\n    entity_type=\"Item\",\n    entity_id=1,\n    action=\"update\",\n    user_id=user.id,\n    changes={\"price\": 15.0}  # \u53ea\u8bb0\u5f55\u53d8\u66f4\u7684\u5b57\u6bb5\n)\n\n# \u8bb0\u5f55\u5220\u9664\nlogger.log(\n    entity_type=\"Item\",\n    entity_id=1,\n    action=\"delete\",\n    user_id=user.id,\n)\n</code></pre>"},{"location":"guides/audit-logging-basic/#_7","title":"\u67e5\u8be2\u5ba1\u8ba1\u65e5\u5fd7","text":""},{"location":"guides/audit-logging-basic/#_8","title":"\u83b7\u53d6\u5b9e\u4f53\u7684\u6240\u6709\u64cd\u4f5c","text":"<pre><code># GET /audit-logs?entity_type=Item&amp;entity_id=1\n\n# \u54cd\u5e94\uff1a\n{\n    \"data\": [\n        {\n            \"id\": 1,\n            \"entity_type\": \"Item\",\n            \"entity_id\": 1,\n            \"action\": \"create\",\n            \"user_id\": 123,\n            \"changes\": {\"name\": \"Item 1\", \"price\": 10.0},\n            \"timestamp\": \"2024-11-27T10:00:00\"\n        },\n        {\n            \"id\": 2,\n            \"entity_type\": \"Item\",\n            \"entity_id\": 1,\n            \"action\": \"update\",\n            \"user_id\": 123,\n            \"changes\": {\"price\": 15.0},\n            \"timestamp\": \"2024-11-27T11:00:00\"\n        }\n    ]\n}\n</code></pre>"},{"location":"guides/audit-logging-basic/#_9","title":"\u83b7\u53d6\u7528\u6237\u7684\u6240\u6709\u64cd\u4f5c","text":"<pre><code># GET /audit-logs?user_id=123\n\n# \u54cd\u5e94\uff1a\u8be5\u7528\u6237\u8fdb\u884c\u7684\u6240\u6709\u64cd\u4f5c\n</code></pre>"},{"location":"guides/audit-logging-basic/#_10","title":"\u83b7\u53d6\u7279\u5b9a\u65f6\u95f4\u8303\u56f4\u7684\u64cd\u4f5c","text":"<pre><code># GET /audit-logs?start_date=2024-11-01&amp;end_date=2024-11-30\n\n# \u54cd\u5e94\uff1a\u8be5\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6240\u6709\u64cd\u4f5c\n</code></pre>"},{"location":"guides/audit-logging-basic/#_11","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"guides/audit-logging-basic/#_12","title":"\u8ffd\u8e2a\u6570\u636e\u53d8\u5316\u5386\u53f2","text":"<pre><code>from fastapi_easy.core.audit_log import AuditLogAdapter\n\nadapter = AuditLogAdapter(AuditLog, session)\n\n# \u83b7\u53d6\u5b9e\u4f53\u7684\u5b8c\u6574\u5386\u53f2\nhistory = await adapter.get_entity_history(\n    entity_type=\"Item\",\n    entity_id=1\n)\n\n# \u91cd\u5efa\u4efb\u610f\u65f6\u95f4\u70b9\u7684\u6570\u636e\ndata_at_time = await adapter.reconstruct_at_time(\n    entity_type=\"Item\",\n    entity_id=1,\n    timestamp=\"2024-11-27T10:00:00\"\n)\n</code></pre>"},{"location":"guides/audit-logging-basic/#_13","title":"\u6bd4\u8f83\u7248\u672c","text":"<pre><code># \u6bd4\u8f83\u4e24\u4e2a\u7248\u672c\u7684\u5dee\u5f02\ndiff = await adapter.compare_versions(\n    entity_type=\"Item\",\n    entity_id=1,\n    version1_id=1,\n    version2_id=2\n)\n\n# \u54cd\u5e94\uff1a\n{\n    \"added\": {\"price\": 15.0},\n    \"removed\": {\"price\": 10.0},\n    \"unchanged\": {\"name\": \"Item 1\"}\n}\n</code></pre>"},{"location":"guides/audit-logging-basic/#_14","title":"\u5bfc\u51fa\u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code># \u5bfc\u51fa\u4e3a CSV\nawait adapter.export_to_csv(\n    filename=\"audit_logs.csv\",\n    filters={\"start_date\": \"2024-11-01\"}\n)\n\n# \u5bfc\u51fa\u4e3a JSON\nawait adapter.export_to_json(\n    filename=\"audit_logs.json\",\n    filters={\"user_id\": 123}\n)\n</code></pre>"},{"location":"guides/audit-logging-basic/#_15","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/audit-logging-basic/#1_1","title":"1. \u8bb0\u5f55\u6240\u6709\u4fee\u6539","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u8bb0\u5f55\u6240\u6709\u4fee\u6539\nlogger.log(\n    entity_type=\"Item\",\n    entity_id=1,\n    action=\"update\",\n    user_id=user.id,\n    changes={\"price\": 15.0}\n)\n</code></pre>"},{"location":"guides/audit-logging-basic/#2_1","title":"2. \u5b9a\u671f\u6e05\u7406\u65e7\u65e5\u5fd7","text":"<pre><code># \u5b9a\u671f\u5220\u9664 1 \u5e74\u524d\u7684\u65e5\u5fd7\nfrom datetime import datetime, timedelta\n\ncutoff_date = datetime.utcnow() - timedelta(days=365)\n\nawait adapter.delete_logs_before(cutoff_date)\n</code></pre>"},{"location":"guides/audit-logging-basic/#3","title":"3. \u4fdd\u62a4\u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u53ea\u6709\u7ba1\u7406\u5458\u53ef\u4ee5\u67e5\u770b\u5ba1\u8ba1\u65e5\u5fd7\n@router.get(\"/audit-logs\")\nasync def get_audit_logs(current_user: User = Depends(get_current_user)):\n    if \"admin\" not in current_user.roles:\n        raise PermissionDeniedError(\"No permission to view audit logs\")\n\n    return await adapter.get_logs()\n</code></pre>"},{"location":"guides/audit-logging-basic/#4","title":"4. \u76d1\u63a7\u5f02\u5e38\u6d3b\u52a8","text":"<pre><code># \u76d1\u63a7\u5f02\u5e38\u5220\u9664\nlogs = await adapter.get_logs(\n    filters={\"action\": \"delete\"},\n    limit=100\n)\n\nfor log in logs:\n    if log.timestamp &gt; datetime.utcnow() - timedelta(hours=1):\n        logger.warning(f\"Recent deletion: {log}\")\n</code></pre>"},{"location":"guides/audit-logging-basic/#_16","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u5ba1\u8ba1\u65e5\u5fd7\u4f1a\u5f71\u54cd\u6027\u80fd\u5417\uff1f</p> <p>A: \u4f1a\u6709\u8f7b\u5fae\u5f71\u54cd\u3002\u5efa\u8bae\u5f02\u6b65\u8bb0\u5f55\u65e5\u5fd7\u3002</p> <p>Q: \u5982\u4f55\u4fdd\u62a4\u5ba1\u8ba1\u65e5\u5fd7\u4e0d\u88ab\u7be1\u6539\uff1f</p> <p>A: \u4f7f\u7528\u6570\u636e\u5e93\u7ea7\u522b\u7684\u6743\u9650\u63a7\u5236\uff0c\u9650\u5236\u5bf9\u5ba1\u8ba1\u65e5\u5fd7\u8868\u7684\u8bbf\u95ee\u3002</p> <p>Q: \u5ba1\u8ba1\u65e5\u5fd7\u9700\u8981\u4fdd\u7559\u591a\u4e45\uff1f</p> <p>A: \u53d6\u51b3\u4e8e\u6cd5\u89c4\u8981\u6c42\uff0c\u901a\u5e38 1-7 \u5e74\u3002</p> <p>Q: \u5982\u4f55\u5904\u7406\u5927\u91cf\u5ba1\u8ba1\u65e5\u5fd7\uff1f</p> <p>A: \u5b9a\u671f\u5f52\u6863\u548c\u6e05\u7406\uff0c\u4f7f\u7528\u5206\u533a\u8868\u3002</p>"},{"location":"guides/audit-logging-basic/#_17","title":"\u603b\u7ed3","text":"<p>\u5ba1\u8ba1\u65e5\u5fd7\u662f\u91cd\u8981\u7684\u5408\u89c4\u548c\u5b89\u5168\u5de5\u5177\uff1a</p> <ul> <li>\u2705 \u8bb0\u5f55\u6240\u6709\u4fee\u6539</li> <li>\u2705 \u8ffd\u8e2a\u6570\u636e\u53d8\u5316</li> <li>\u2705 \u652f\u6301\u6545\u969c\u6392\u9664</li> <li>\u2705 \u6ee1\u8db3\u6cd5\u89c4\u8981\u6c42</li> </ul> <p>\u4f7f\u7528\u5ba1\u8ba1\u65e5\u5fd7\u65f6\uff0c\u8bb0\u4f4f\uff1a</p> <ol> <li>\u8bb0\u5f55\u6240\u6709\u4fee\u6539</li> <li>\u5b9a\u671f\u6e05\u7406\u65e7\u65e5\u5fd7</li> <li>\u4fdd\u62a4\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u76d1\u63a7\u5f02\u5e38\u6d3b\u52a8</li> </ol> <p>\u4e0b\u4e00\u6b65: \u914d\u7f6e\u53c2\u8003 \u2192</p>"},{"location":"guides/best-practices/","title":"\u6700\u4f73\u5b9e\u8df5\u6307\u5357","text":"<p>\u672c\u6587\u6863\u63d0\u4f9b\u4f7f\u7528 fastapi-easy \u7684\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae\u3002</p>"},{"location":"guides/best-practices/#_2","title":"\u9879\u76ee\u7ed3\u6784","text":""},{"location":"guides/best-practices/#_3","title":"\u63a8\u8350\u7684\u9879\u76ee\u7ed3\u6784","text":"<pre><code>my_api/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 main.py                 # FastAPI \u5e94\u7528\u5165\u53e3\n\u2502   \u251c\u2500\u2500 config.py               # \u914d\u7f6e\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 item.py             # SQLAlchemy \u6a21\u578b\n\u2502   \u2502   \u2514\u2500\u2500 user.py\n\u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 item.py             # Pydantic \u6570\u636e\u6a21\u578b\n\u2502   \u2502   \u2514\u2500\u2500 user.py\n\u2502   \u251c\u2500\u2500 routers/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 items.py            # \u9879\u76ee\u8def\u7531\n\u2502   \u2502   \u2514\u2500\u2500 users.py            # \u7528\u6237\u8def\u7531\n\u2502   \u251c\u2500\u2500 dependencies/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 auth.py             # \u8ba4\u8bc1\u4f9d\u8d56\n\u2502   \u2502   \u2514\u2500\u2500 db.py               # \u6570\u636e\u5e93\u4f9d\u8d56\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u2514\u2500\u2500 helpers.py           # \u5de5\u5177\u51fd\u6570\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 test_items.py\n\u2502   \u2514\u2500\u2500 test_users.py\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 .env\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"guides/best-practices/#_4","title":"\u4ee3\u7801\u7ec4\u7ec7","text":""},{"location":"guides/best-practices/#1","title":"1. \u5206\u79bb\u5173\u6ce8\u70b9","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u5206\u79bb\u6a21\u578b\u3001\u6570\u636e\u6a21\u578b\u548c\u8def\u7531\n\n# models/item.py\nfrom sqlalchemy import Column, Integer, String\n\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n\n# schemas/item.py\nfrom pydantic import BaseModel\n\nclass ItemSchema(BaseModel):\n    id: int\n    name: str\n\n# routers/items.py\nfrom fastapi_easy import CRUDRouter\n\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n)\n</code></pre>"},{"location":"guides/best-practices/#2","title":"2. \u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165\n\nfrom fastapi import Depends\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)) -&gt; User:\n    return await get_user_from_token(token)\n\n@router.get(\"/me\")\nasync def get_me(current_user: User = Depends(get_current_user)):\n    return current_user\n</code></pre>"},{"location":"guides/best-practices/#3","title":"3. \u914d\u7f6e\u7ba1\u7406","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u96c6\u4e2d\u7ba1\u7406\u914d\u7f6e\n\nfrom pydantic_settings import BaseSettings\n\nclass Settings(BaseSettings):\n    database_url: str\n    log_level: str = \"INFO\"\n    cache_ttl: int = 3600\n\n    class Config:\n        env_file = \".env\"\n\nsettings = Settings()\n</code></pre>"},{"location":"guides/best-practices/#_5","title":"\u6570\u636e\u5e93\u64cd\u4f5c","text":""},{"location":"guides/best-practices/#1_1","title":"1. \u4f7f\u7528\u4e8b\u52a1","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4e8b\u52a1\n\nasync with session.begin():\n    item = await adapter.create({\"name\": \"Item\"})\n    await audit_logger.log(\"Item\", item.id, \"create\")\n    # \u5982\u679c\u51fa\u9519\uff0c\u81ea\u52a8\u56de\u6eda\n</code></pre>"},{"location":"guides/best-practices/#2_1","title":"2. \u5904\u7406\u5e76\u53d1","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4e50\u89c2\u9501\n\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    version = Column(Integer, default=1)  # \u7248\u672c\u53f7\n\n# \u66f4\u65b0\u65f6\u68c0\u67e5\u7248\u672c\nitem = await adapter.get_one(1)\nif item.version != expected_version:\n    raise ConflictError(\"Item has been modified\")\n</code></pre>"},{"location":"guides/best-practices/#3_1","title":"3. \u6279\u91cf\u64cd\u4f5c\u4f18\u5316","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u6279\u91cf\u64cd\u4f5c\n\n# \u4e0d\u63a8\u8350\uff1a\u9010\u4e2a\u521b\u5efa\nfor item_data in items:\n    await adapter.create(item_data)\n\n# \u63a8\u8350\uff1a\u6279\u91cf\u521b\u5efa\nresult = await adapter.bulk_create(items)\n</code></pre>"},{"location":"guides/best-practices/#_6","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"guides/best-practices/#1_2","title":"1. \u4f7f\u7528\u7f13\u5b58","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u7f13\u5b58\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\n\nfrom fastapi_easy.core.cache import CachedOperation\n\n@CachedOperation(cache, ttl=3600)\nasync def get_popular_items():\n    return await adapter.get_all(filters={\"popular\": True})\n</code></pre>"},{"location":"guides/best-practices/#2_2","title":"2. \u4f7f\u7528\u7d22\u5f15","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u5728\u5e38\u7528\u67e5\u8be2\u5b57\u6bb5\u4e0a\u521b\u5efa\u7d22\u5f15\n\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)  # \u521b\u5efa\u7d22\u5f15\n    category = Column(String, index=True)\n</code></pre>"},{"location":"guides/best-practices/#3_2","title":"3. \u5206\u9875","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u5206\u9875\u800c\u4e0d\u662f\u83b7\u53d6\u6240\u6709\u6570\u636e\n\n# \u4e0d\u63a8\u8350\nitems = await adapter.get_all()\n\n# \u63a8\u8350\nitems = await adapter.get_all(\n    pagination={\"skip\": 0, \"limit\": 20}\n)\n</code></pre>"},{"location":"guides/best-practices/#_7","title":"\u5b89\u5168\u6027","text":""},{"location":"guides/best-practices/#1_3","title":"1. \u8f93\u5165\u9a8c\u8bc1","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u9a8c\u8bc1\u6240\u6709\u8f93\u5165\n\nfrom pydantic import BaseModel, Field\n\nclass ItemSchema(BaseModel):\n    name: str = Field(..., min_length=1, max_length=100)\n    price: float = Field(..., gt=0)\n</code></pre>"},{"location":"guides/best-practices/#2_3","title":"2. \u6743\u9650\u68c0\u67e5","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u68c0\u67e5\u6743\u9650\n\nasync def before_delete(context):\n    if not rbac.has_permission(context.user_role, \"delete\"):\n        raise PermissionDeniedError()\n\nrouter.hooks.register(\"before_delete\", before_delete)\n</code></pre>"},{"location":"guides/best-practices/#3-sql","title":"3. SQL \u6ce8\u5165\u9632\u62a4","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u53c2\u6570\u5316\u67e5\u8be2\uff08fastapi-easy \u81ea\u52a8\u5904\u7406\uff09\n\n# \u4e0d\u63a8\u8350\uff08fastapi-easy \u4f1a\u963b\u6b62\uff09\nfilters = {\"name__like\": \"'; DROP TABLE items; --\"}\n\n# \u63a8\u8350\nfilters = {\"name__like\": \"item%\"}\n</code></pre>"},{"location":"guides/best-practices/#_8","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"guides/best-practices/#1_4","title":"1. \u81ea\u5b9a\u4e49\u9519\u8bef","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u5b9a\u4e49\u81ea\u5b9a\u4e49\u5f02\u5e38\n\nfrom fastapi_easy.core.errors import AppError\n\nclass ItemNotFoundError(AppError):\n    code = \"ITEM_NOT_FOUND\"\n    message = \"Item not found\"\n    status_code = 404\n</code></pre>"},{"location":"guides/best-practices/#2_4","title":"2. \u9519\u8bef\u65e5\u5fd7","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u8bb0\u5f55\u9519\u8bef\n\ntry:\n    item = await adapter.get_one(1)\nexcept ItemNotFoundError as e:\n    logger.error(f\"Item not found: {e}\")\n    raise\n</code></pre>"},{"location":"guides/best-practices/#_9","title":"\u6d4b\u8bd5","text":""},{"location":"guides/best-practices/#1_5","title":"1. \u5355\u5143\u6d4b\u8bd5","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u6d4b\u8bd5\u4e1a\u52a1\u903b\u8f91\n\nimport pytest\n\n@pytest.mark.asyncio\nasync def test_create_item():\n    adapter = MockAdapter()\n    result = await adapter.create({\"name\": \"Item\"})\n    assert result.name == \"Item\"\n</code></pre>"},{"location":"guides/best-practices/#2_5","title":"2. \u96c6\u6210\u6d4b\u8bd5","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u6d4b\u8bd5\u5b8c\u6574\u6d41\u7a0b\n\n@pytest.mark.asyncio\nasync def test_create_item_api(client):\n    response = await client.post(\"/items\", json={\"name\": \"Item\"})\n    assert response.status_code == 201\n</code></pre>"},{"location":"guides/best-practices/#3_3","title":"3. \u6d4b\u8bd5\u8986\u76d6","text":"<pre><code># \u8fd0\u884c\u6d4b\u8bd5\u5e76\u751f\u6210\u8986\u76d6\u62a5\u544a\npytest --cov=app tests/\n\n# \u76ee\u6807\uff1a&gt;80% \u8986\u76d6\u7387\n</code></pre>"},{"location":"guides/best-practices/#_10","title":"\u76d1\u63a7\u548c\u65e5\u5fd7","text":""},{"location":"guides/best-practices/#1_6","title":"1. \u7ed3\u6784\u5316\u65e5\u5fd7","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u7ed3\u6784\u5316\u65e5\u5fd7\n\nlogger.info(\n    \"Item created\",\n    extra_fields={\n        \"item_id\": item.id,\n        \"user_id\": user.id,\n        \"timestamp\": datetime.utcnow()\n    }\n)\n</code></pre>"},{"location":"guides/best-practices/#2_6","title":"2. \u6027\u80fd\u76d1\u63a7","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u76d1\u63a7\u5173\u952e\u64cd\u4f5c\n\nimport time\n\nstart = time.time()\nitems = await adapter.get_all()\nelapsed = time.time() - start\n\nif elapsed &gt; 1.0:\n    logger.warning(f\"Slow query: {elapsed:.2f}s\")\n</code></pre>"},{"location":"guides/best-practices/#3_4","title":"3. \u9519\u8bef\u76d1\u63a7","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u76d1\u63a7\u9519\u8bef\u7387\n\nerror_count = 0\ntotal_count = 0\n\ntry:\n    result = await operation.execute()\n    total_count += 1\nexcept Exception as e:\n    error_count += 1\n    logger.error(f\"Error: {e}\")\n\nerror_rate = error_count / total_count if total_count &gt; 0 else 0\nif error_rate &gt; 0.05:  # 5% \u9519\u8bef\u7387\n    logger.alert(\"High error rate detected\")\n</code></pre>"},{"location":"guides/best-practices/#_11","title":"\u90e8\u7f72","text":""},{"location":"guides/best-practices/#1_7","title":"1. \u73af\u5883\u914d\u7f6e","text":"<pre><code># .env.production\nDATABASE_URL=postgresql://...\nLOG_LEVEL=WARNING\nCACHE_BACKEND=redis\nRATE_LIMIT_ENABLED=true\n</code></pre>"},{"location":"guides/best-practices/#2_7","title":"2. \u5065\u5eb7\u68c0\u67e5","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u6dfb\u52a0\u5065\u5eb7\u68c0\u67e5\u7aef\u70b9\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\n        \"status\": \"healthy\",\n        \"database\": await check_database(),\n        \"cache\": await check_cache()\n    }\n</code></pre>"},{"location":"guides/best-practices/#3_5","title":"3. \u4f18\u96c5\u5173\u95ed","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f18\u96c5\u5173\u95ed\n\n@app.on_event(\"shutdown\")\nasync def shutdown():\n    await db.close()\n    await cache.close()\n</code></pre>"},{"location":"guides/best-practices/#_12","title":"\u5e38\u89c1\u9677\u9631","text":""},{"location":"guides/best-practices/#1_8","title":"1. \u4e0d\u4f7f\u7528\u8f6f\u5220\u9664","text":"<pre><code># \u274c \u4e0d\u63a8\u8350\uff1a\u76f4\u63a5\u5220\u9664\u6570\u636e\nawait adapter.delete_one(1)\n\n# \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u8f6f\u5220\u9664\nawait adapter.soft_delete(1)\n</code></pre>"},{"location":"guides/best-practices/#2_8","title":"2. \u5ffd\u89c6\u6027\u80fd","text":"<pre><code># \u274c \u4e0d\u63a8\u8350\uff1a\u83b7\u53d6\u6240\u6709\u6570\u636e\nitems = await adapter.get_all()\n\n# \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u5206\u9875\u548c\u7f13\u5b58\nitems = await adapter.get_all(\n    pagination={\"skip\": 0, \"limit\": 20}\n)\n</code></pre>"},{"location":"guides/best-practices/#3_6","title":"3. \u7f3a\u5c11\u9519\u8bef\u5904\u7406","text":"<pre><code># \u274c \u4e0d\u63a8\u8350\uff1a\u5ffd\u89c6\u9519\u8bef\nresult = await adapter.create(data)\n\n# \u2705 \u63a8\u8350\uff1a\u5904\u7406\u9519\u8bef\ntry:\n    result = await adapter.create(data)\nexcept ValidationError as e:\n    logger.error(f\"Validation error: {e}\")\n    raise\n</code></pre>"},{"location":"guides/best-practices/#_13","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528 fastapi-easy \u7684\u6700\u4f73\u5b9e\u8df5\uff1a</p> <ol> <li>\u2705 \u5206\u79bb\u5173\u6ce8\u70b9</li> <li>\u2705 \u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165</li> <li>\u2705 \u96c6\u4e2d\u7ba1\u7406\u914d\u7f6e</li> <li>\u2705 \u4f7f\u7528\u4e8b\u52a1</li> <li>\u2705 \u4f18\u5316\u6027\u80fd</li> <li>\u2705 \u68c0\u67e5\u5b89\u5168\u6027</li> <li>\u2705 \u5904\u7406\u9519\u8bef</li> <li>\u2705 \u7f16\u5199\u6d4b\u8bd5</li> <li>\u2705 \u76d1\u63a7\u548c\u65e5\u5fd7</li> <li>\u2705 \u4f18\u96c5\u90e8\u7f72</li> </ol> <p>\u4e0b\u4e00\u6b65: \u90e8\u7f72\u6307\u5357 \u2192</p>"},{"location":"guides/bulk-operations/","title":"\u6279\u91cf\u64cd\u4f5c","text":"<p>\u6279\u91cf\u64cd\u4f5c\u5141\u8bb8\u5728\u5355\u4e2a\u8bf7\u6c42\u4e2d\u5bf9\u591a\u4e2a\u8bb0\u5f55\u8fdb\u884c CRUD \u64cd\u4f5c\u3002\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u6279\u91cf\u64cd\u4f5c\u529f\u80fd\u3002</p>"},{"location":"guides/bulk-operations/#_2","title":"\u4ec0\u4e48\u662f\u6279\u91cf\u64cd\u4f5c\uff1f","text":"<p>\u6279\u91cf\u64cd\u4f5c\u53ef\u4ee5\uff1a</p> <ul> <li>\u2705 \u4e00\u6b21\u521b\u5efa\u591a\u4e2a\u8bb0\u5f55</li> <li>\u2705 \u4e00\u6b21\u66f4\u65b0\u591a\u4e2a\u8bb0\u5f55</li> <li>\u2705 \u4e00\u6b21\u5220\u9664\u591a\u4e2a\u8bb0\u5f55</li> <li>\u2705 \u63d0\u9ad8\u6027\u80fd\u548c\u6548\u7387</li> </ul>"},{"location":"guides/bulk-operations/#_3","title":"\u542f\u7528\u6279\u91cf\u64cd\u4f5c","text":"<pre><code>from fastapi_easy import CRUDRouter\nfrom fastapi_easy.core.bulk_operations import BulkOperationConfig\n\nconfig = BulkOperationConfig(\n    enabled=True,\n    max_batch_size=1000,           # \u6700\u5927\u6279\u91cf\u5927\u5c0f\n    transaction_mode=\"atomic\",      # \u539f\u5b50\u4e8b\u52a1\u6a21\u5f0f\n)\n\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n    bulk_operation_config=config,\n)\n</code></pre>"},{"location":"guides/bulk-operations/#_4","title":"\u6279\u91cf\u521b\u5efa","text":""},{"location":"guides/bulk-operations/#_5","title":"\u8bf7\u6c42","text":"<pre><code># POST /items/batch\n# Content-Type: application/json\n\n{\n    \"items\": [\n        {\"name\": \"Item 1\", \"price\": 10.0},\n        {\"name\": \"Item 2\", \"price\": 20.0},\n        {\"name\": \"Item 3\", \"price\": 30.0}\n    ]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_6","title":"\u54cd\u5e94","text":"<pre><code>{\n    \"success_count\": 3,\n    \"failure_count\": 0,\n    \"errors\": [],\n    \"results\": [\n        {\"id\": 1, \"name\": \"Item 1\", \"price\": 10.0},\n        {\"id\": 2, \"name\": \"Item 2\", \"price\": 20.0},\n        {\"id\": 3, \"name\": \"Item 3\", \"price\": 30.0}\n    ]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_7","title":"\u6279\u91cf\u66f4\u65b0","text":""},{"location":"guides/bulk-operations/#_8","title":"\u8bf7\u6c42","text":"<pre><code># PUT /items/batch\n# Content-Type: application/json\n\n{\n    \"items\": [\n        {\"id\": 1, \"name\": \"Updated Item 1\", \"price\": 15.0},\n        {\"id\": 2, \"name\": \"Updated Item 2\", \"price\": 25.0}\n    ]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_9","title":"\u54cd\u5e94","text":"<pre><code>{\n    \"success_count\": 2,\n    \"failure_count\": 0,\n    \"errors\": [],\n    \"results\": [\n        {\"id\": 1, \"name\": \"Updated Item 1\", \"price\": 15.0},\n        {\"id\": 2, \"name\": \"Updated Item 2\", \"price\": 25.0}\n    ]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_10","title":"\u6279\u91cf\u5220\u9664","text":""},{"location":"guides/bulk-operations/#_11","title":"\u8bf7\u6c42","text":"<pre><code># DELETE /items/batch\n# Content-Type: application/json\n\n{\n    \"ids\": [1, 2, 3]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_12","title":"\u54cd\u5e94","text":"<pre><code>{\n    \"success_count\": 3,\n    \"failure_count\": 0,\n    \"errors\": [],\n    \"deleted_count\": 3\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_13","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"guides/bulk-operations/#_14","title":"\u5904\u7406\u90e8\u5206\u5931\u8d25","text":"<pre><code># \u5f53\u67d0\u4e9b\u64cd\u4f5c\u5931\u8d25\u65f6\n{\n    \"success_count\": 2,\n    \"failure_count\": 1,\n    \"errors\": [\n        {\n            \"index\": 2,\n            \"error\": \"Validation error\",\n            \"details\": \"Price must be positive\"\n        }\n    ],\n    \"results\": [\n        {\"id\": 1, \"name\": \"Item 1\"},\n        {\"id\": 2, \"name\": \"Item 2\"}\n    ]\n}\n</code></pre>"},{"location":"guides/bulk-operations/#_15","title":"\u4e8b\u52a1\u6a21\u5f0f","text":"<pre><code># \u539f\u5b50\u6a21\u5f0f\uff1a\u5168\u90e8\u6210\u529f\u6216\u5168\u90e8\u5931\u8d25\nconfig = BulkOperationConfig(\n    transaction_mode=\"atomic\"\n)\n\n# \u90e8\u5206\u6a21\u5f0f\uff1a\u7ee7\u7eed\u5904\u7406\u5176\u4ed6\u8bb0\u5f55\nconfig = BulkOperationConfig(\n    transaction_mode=\"partial\"\n)\n</code></pre>"},{"location":"guides/bulk-operations/#_16","title":"\u83b7\u53d6\u6279\u91cf\u64cd\u4f5c\u7ed3\u679c","text":"<pre><code>from fastapi_easy.core.bulk_operations import BulkOperationAdapter\n\nadapter = BulkOperationAdapter(Item, session)\n\n# \u6267\u884c\u6279\u91cf\u521b\u5efa\nresult = await adapter.bulk_create(\n    items=[\n        {\"name\": \"Item 1\"},\n        {\"name\": \"Item 2\"}\n    ]\n)\n\nprint(f\"\u6210\u529f: {result.success_count}\")\nprint(f\"\u5931\u8d25: {result.failure_count}\")\nprint(f\"\u9519\u8bef: {result.errors}\")\n</code></pre>"},{"location":"guides/bulk-operations/#_17","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/bulk-operations/#1","title":"1. \u68c0\u67e5\u6279\u91cf\u5927\u5c0f","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u68c0\u67e5\u5927\u5c0f\nif len(items) &gt; max_batch_size:\n    raise ValueError(f\"\u6279\u91cf\u5927\u5c0f\u8d85\u8fc7\u9650\u5236: {max_batch_size}\")\n\n# \u6267\u884c\u6279\u91cf\u64cd\u4f5c\nresult = await adapter.bulk_create(items)\n</code></pre>"},{"location":"guides/bulk-operations/#2","title":"2. \u5904\u7406\u9519\u8bef","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u5904\u7406\u9519\u8bef\nresult = await adapter.bulk_create(items)\n\nif result.failure_count &gt; 0:\n    for error in result.errors:\n        logger.error(f\"\u6279\u91cf\u64cd\u4f5c\u9519\u8bef: {error}\")\n</code></pre>"},{"location":"guides/bulk-operations/#3","title":"3. \u4f7f\u7528\u4e8b\u52a1","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4e8b\u52a1\nconfig = BulkOperationConfig(\n    transaction_mode=\"atomic\"\n)\n\n# \u786e\u4fdd\u5168\u90e8\u6210\u529f\u6216\u5168\u90e8\u5931\u8d25\nresult = await adapter.bulk_create(items)\n</code></pre>"},{"location":"guides/bulk-operations/#4","title":"4. \u76d1\u63a7\u6027\u80fd","text":"<pre><code>import time\n\nstart = time.time()\nresult = await adapter.bulk_create(items)\nelapsed = time.time() - start\n\nlogger.info(f\"\u6279\u91cf\u521b\u5efa\u8017\u65f6: {elapsed:.2f}s\")\nlogger.info(f\"\u6210\u529f: {result.success_count}, \u5931\u8d25: {result.failure_count}\")\n</code></pre>"},{"location":"guides/bulk-operations/#_18","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u6279\u91cf\u64cd\u4f5c\u7684\u6700\u5927\u5927\u5c0f\u662f\u591a\u5c11\uff1f</p> <p>A: \u9ed8\u8ba4\u4e3a 1000\uff0c\u53ef\u5728 <code>BulkOperationConfig</code> \u4e2d\u914d\u7f6e\u3002</p> <p>Q: \u5982\u679c\u6279\u91cf\u64cd\u4f5c\u90e8\u5206\u5931\u8d25\u600e\u4e48\u529e\uff1f</p> <p>A: \u53d6\u51b3\u4e8e\u4e8b\u52a1\u6a21\u5f0f\u3002\u539f\u5b50\u6a21\u5f0f\u4f1a\u56de\u6eda\u6240\u6709\u66f4\u6539\uff0c\u90e8\u5206\u6a21\u5f0f\u4f1a\u7ee7\u7eed\u5904\u7406\u3002</p> <p>Q: \u6279\u91cf\u64cd\u4f5c\u652f\u6301\u54ea\u4e9b\u64cd\u4f5c\uff1f</p> <p>A: \u652f\u6301\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u3002</p> <p>Q: \u5982\u4f55\u63d0\u9ad8\u6279\u91cf\u64cd\u4f5c\u7684\u6027\u80fd\uff1f</p> <p>A: \u589e\u52a0\u6279\u91cf\u5927\u5c0f\uff08\u5728\u6570\u636e\u5e93\u9650\u5236\u8303\u56f4\u5185\uff09\uff0c\u4f7f\u7528\u539f\u5b50\u4e8b\u52a1\u6a21\u5f0f\u3002</p>"},{"location":"guides/bulk-operations/#_19","title":"\u603b\u7ed3","text":"<p>\u6279\u91cf\u64cd\u4f5c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u6027\u80fd\uff1a</p> <ul> <li>\u2705 \u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4</li> <li>\u2705 \u63d0\u9ad8\u6570\u636e\u5e93\u6548\u7387</li> <li>\u2705 \u7b80\u5316\u5ba2\u6237\u7aef\u4ee3\u7801</li> </ul> <p>\u4f7f\u7528\u6279\u91cf\u64cd\u4f5c\u65f6\uff0c\u8bb0\u4f4f\uff1a</p> <ol> <li>\u68c0\u67e5\u6279\u91cf\u5927\u5c0f</li> <li>\u5904\u7406\u9519\u8bef</li> <li>\u4f7f\u7528\u4e8b\u52a1</li> <li>\u76d1\u63a7\u6027\u80fd</li> </ol> <p>\u4e0b\u4e00\u6b65: \u6743\u9650\u63a7\u5236 \u2192</p>"},{"location":"guides/error-handling/","title":"\u9519\u8bef\u5904\u7406","text":"<p>\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u5728 fastapi-easy \u4e2d\u8fdb\u884c\u9519\u8bef\u5904\u7406\u3002</p>"},{"location":"guides/error-handling/#_2","title":"\u5185\u7f6e\u9519\u8bef\u7c7b\u578b","text":"<pre><code>from fastapi_easy.core.errors import (\n    AppError,\n    ValidationError,\n    NotFoundError,\n    ConflictError,\n    PermissionDeniedError,\n    InternalServerError,\n)\n</code></pre>"},{"location":"guides/error-handling/#_3","title":"\u4f7f\u7528\u9519\u8bef","text":""},{"location":"guides/error-handling/#_4","title":"\u57fa\u7840\u9519\u8bef","text":"<pre><code># \u9a8c\u8bc1\u9519\u8bef\nraise ValidationError(\"Invalid input\", details={\"field\": \"name\"})\n\n# \u672a\u627e\u5230\u9519\u8bef\nraise NotFoundError(\"Item not found\")\n\n# \u51b2\u7a81\u9519\u8bef\nraise ConflictError(\"Item already exists\")\n\n# \u6743\u9650\u9519\u8bef\nraise PermissionDeniedError(\"No permission\")\n\n# \u670d\u52a1\u5668\u9519\u8bef\nraise InternalServerError(\"Database connection failed\")\n</code></pre>"},{"location":"guides/error-handling/#_5","title":"\u81ea\u5b9a\u4e49\u9519\u8bef","text":"<pre><code>from fastapi_easy.core.errors import AppError\n\nclass ItemNotFoundError(AppError):\n    code = \"ITEM_NOT_FOUND\"\n    message = \"Item not found\"\n    status_code = 404\n</code></pre>"},{"location":"guides/error-handling/#_6","title":"\u9519\u8bef\u54cd\u5e94","text":"<pre><code># \u54cd\u5e94\u683c\u5f0f\n{\n    \"success\": false,\n    \"error\": \"Item not found\",\n    \"code\": \"ITEM_NOT_FOUND\",\n    \"details\": {\n        \"item_id\": 1\n    }\n}\n</code></pre>"},{"location":"guides/error-handling/#_7","title":"\u9519\u8bef\u5904\u7406\u4e2d\u95f4\u4ef6","text":"<pre><code>from fastapi_easy.middleware import ErrorHandlingMiddleware\n\nmiddleware = ErrorHandlingMiddleware()\n\n# \u6ce8\u518c\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u5668\nasync def handle_validation_error(error):\n    logger.warning(f\"Validation error: {error}\")\n    return error\n\nmiddleware.register_handler(ValidationError, handle_validation_error)\n</code></pre>"},{"location":"guides/error-handling/#_8","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u2705 \u4f7f\u7528\u9002\u5f53\u7684\u9519\u8bef\u7c7b\u578b</li> <li>\u2705 \u63d0\u4f9b\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f</li> <li>\u2705 \u8bb0\u5f55\u6240\u6709\u9519\u8bef</li> <li>\u2705 \u4e0d\u66b4\u9732\u654f\u611f\u4fe1\u606f</li> </ol> <p>\u4e0b\u4e00\u6b65: \u8f6f\u5220\u9664 \u2192</p>"},{"location":"guides/graphql/","title":"GraphQL \u652f\u6301","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\u5b8c\u6574\u7684 GraphQL \u652f\u6301\uff0c\u5141\u8bb8\u4f60\u8f7b\u677e\u5730\u5c06 CRUD API \u8f6c\u6362\u4e3a GraphQL \u7aef\u70b9\u3002</p>"},{"location":"guides/graphql/#graphql_1","title":"\u4ec0\u4e48\u662f GraphQL\uff1f","text":"<p>GraphQL \u662f\u4e00\u79cd API \u67e5\u8be2\u8bed\u8a00\uff0c\u76f8\u6bd4 REST API \u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li>\u2705 \u7cbe\u786e\u67e5\u8be2 - \u53ea\u83b7\u53d6\u9700\u8981\u7684\u5b57\u6bb5</li> <li>\u2705 \u5355\u4e00\u7aef\u70b9 - \u6240\u6709\u67e5\u8be2\u901a\u8fc7\u4e00\u4e2a\u7aef\u70b9</li> <li>\u2705 \u5f3a\u7c7b\u578b - \u81ea\u52a8\u751f\u6210 Schema</li> <li>\u2705 \u81ea\u6587\u6863\u5316 - \u81ea\u52a8\u751f\u6210 API \u6587\u6863</li> </ul>"},{"location":"guides/graphql/#_1","title":"\u57fa\u7840\u4f7f\u7528","text":""},{"location":"guides/graphql/#1","title":"1. \u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install fastapi-easy[graphql]\npip install strawberry-graphql\n</code></pre>"},{"location":"guides/graphql/#2-graphql","title":"2. \u5b9a\u4e49 GraphQL \u7c7b\u578b","text":"<pre><code>from fastapi_easy.graphql import GraphQLType, GraphQLField\n\n# \u521b\u5efa Item GraphQL \u7c7b\u578b\nitem_type = GraphQLType(\"Item\")\nitem_type.add_field(GraphQLField(\"id\", \"Int\", required=True))\nitem_type.add_field(GraphQLField(\"name\", \"String\", required=True))\nitem_type.add_field(GraphQLField(\"price\", \"Float\", required=True))\nitem_type.add_field(GraphQLField(\"description\", \"String\"))\n\n# \u83b7\u53d6 GraphQL Schema\nschema = item_type.to_schema()\nprint(schema)\n# \u8f93\u51fa\uff1a\n# type Item {\n#   id: Int!\n#   name: String!\n#   price: Float!\n#   description: String\n# }\n</code></pre>"},{"location":"guides/graphql/#3-graphql","title":"3. \u5b9a\u4e49 GraphQL \u67e5\u8be2","text":"<pre><code>from fastapi_easy.graphql import GraphQLQuery\n\n# \u521b\u5efa\u67e5\u8be2\nget_items_query = GraphQLQuery(\"items\", \"Item\", list_type=True)\nget_item_query = GraphQLQuery(\"item\", \"Item\", required=True)\nget_item_query.add_arg(\"id\", \"Int!\")\n\n# \u83b7\u53d6 GraphQL Schema\nprint(get_items_query.to_schema())\n# \u8f93\u51fa\uff1a\n# items: [Item]\n\nprint(get_item_query.to_schema())\n# \u8f93\u51fa\uff1a\n# item(id: Int!): Item!\n</code></pre>"},{"location":"guides/graphql/#_2","title":"\u5b8c\u6574\u793a\u4f8b","text":""},{"location":"guides/graphql/#_3","title":"\u9879\u76ee\u7ed3\u6784","text":"<pre><code>my_graphql_app/\n\u251c\u2500\u2500 main.py              # FastAPI \u5e94\u7528\n\u251c\u2500\u2500 models.py            # SQLAlchemy \u6a21\u578b\n\u251c\u2500\u2500 schemas.py           # Pydantic Schema\n\u251c\u2500\u2500 graphql_types.py     # GraphQL \u7c7b\u578b\u5b9a\u4e49\n\u2514\u2500\u2500 requirements.txt     # \u4f9d\u8d56\n</code></pre>"},{"location":"guides/graphql/#1-schema","title":"1. \u5b9a\u4e49\u6a21\u578b\u548c Schema","text":"<p>models.py: <pre><code>from sqlalchemy import Column, Integer, String, Float\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    description = Column(String, nullable=True)\n</code></pre></p> <p>schemas.py: <pre><code>from pydantic import BaseModel\nfrom typing import Optional\n\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n    description: Optional[str] = None\n\n    class Config:\n        from_attributes = True\n</code></pre></p>"},{"location":"guides/graphql/#2-graphql_1","title":"2. \u5b9a\u4e49 GraphQL \u7c7b\u578b","text":"<p>graphql_types.py: <pre><code>from fastapi_easy.graphql import GraphQLType, GraphQLField, GraphQLQuery\n\n# \u5b9a\u4e49 Item \u7c7b\u578b\nitem_type = GraphQLType(\"Item\")\nitem_type.add_field(GraphQLField(\"id\", \"Int\", required=True))\nitem_type.add_field(GraphQLField(\"name\", \"String\", required=True))\nitem_type.add_field(GraphQLField(\"price\", \"Float\", required=True))\nitem_type.add_field(GraphQLField(\"description\", \"String\"))\n\n# \u5b9a\u4e49\u67e5\u8be2\nget_items_query = GraphQLQuery(\"items\", \"Item\", list_type=True)\nget_item_query = GraphQLQuery(\"item\", \"Item\", required=True)\nget_item_query.add_arg(\"id\", \"Int!\")\n\n# \u5b9a\u4e49\u53d8\u66f4\ncreate_item_mutation = GraphQLQuery(\"createItem\", \"Item\", required=True)\ncreate_item_mutation.add_arg(\"name\", \"String!\")\ncreate_item_mutation.add_arg(\"price\", \"Float!\")\ncreate_item_mutation.add_arg(\"description\", \"String\")\n</code></pre></p>"},{"location":"guides/graphql/#3-fastapi","title":"3. \u521b\u5efa FastAPI \u5e94\u7528","text":"<p>main.py: <pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAsyncBackend\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy.orm import sessionmaker\n\nfrom models import ItemDB, Base\nfrom schemas import Item\nfrom graphql_types import item_type, get_items_query, get_item_query\n\n# \u914d\u7f6e\u6570\u636e\u5e93\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# \u521b\u5efa\u5e94\u7528\napp = FastAPI()\n\n# \u521b\u5efa CRUD \u8def\u7531\nbackend = SQLAlchemyAsyncBackend(ItemDB, get_db)\nrouter = CRUDRouter(schema=Item, backend=backend)\napp.include_router(router)\n\n# GraphQL Schema \u7aef\u70b9\n@app.get(\"/graphql/schema\")\nasync def get_graphql_schema():\n    \"\"\"\u83b7\u53d6 GraphQL Schema\"\"\"\n    return {\n        \"types\": [item_type.to_schema()],\n        \"queries\": [\n            get_items_query.to_schema(),\n            get_item_query.to_schema(),\n        ]\n    }\n\n# \u521d\u59cb\u5316\u6570\u636e\u5e93\n@app.on_event(\"startup\")\nasync def startup():\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n</code></pre></p>"},{"location":"guides/graphql/#graphql_2","title":"GraphQL \u67e5\u8be2\u793a\u4f8b","text":""},{"location":"guides/graphql/#_4","title":"\u67e5\u8be2\u6240\u6709\u9879\u76ee","text":"<pre><code>query {\n  items {\n    id\n    name\n    price\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#_5","title":"\u67e5\u8be2\u5355\u4e2a\u9879\u76ee","text":"<pre><code>query {\n  item(id: 1) {\n    id\n    name\n    price\n    description\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#_6","title":"\u521b\u5efa\u9879\u76ee","text":"<pre><code>mutation {\n  createItem(\n    name: \"Apple\"\n    price: 1.5\n    description: \"Fresh apple\"\n  ) {\n    id\n    name\n    price\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#_7","title":"\u9ad8\u7ea7\u529f\u80fd","text":""},{"location":"guides/graphql/#1_1","title":"1. \u81ea\u5b9a\u4e49\u5b57\u6bb5\u89e3\u6790\u5668","text":"<pre><code>from fastapi_easy.graphql import GraphQLField\n\nclass CustomGraphQLField(GraphQLField):\n    def __init__(self, name: str, resolver: callable):\n        super().__init__(name, \"String\")\n        self.resolver = resolver\n\n    async def resolve(self, obj):\n        return await self.resolver(obj)\n</code></pre>"},{"location":"guides/graphql/#2","title":"2. \u5b57\u6bb5\u522b\u540d","text":"<pre><code># \u5728\u67e5\u8be2\u4e2d\u4f7f\u7528\u522b\u540d\nquery = \"\"\"\nquery {\n  items {\n    itemId: id\n    itemName: name\n    itemPrice: price\n  }\n}\n\"\"\"\n</code></pre>"},{"location":"guides/graphql/#3","title":"3. \u7247\u6bb5\u91cd\u7528","text":"<pre><code>fragment ItemFields on Item {\n  id\n  name\n  price\n  description\n}\n\nquery {\n  items {\n    ...ItemFields\n  }\n  item(id: 1) {\n    ...ItemFields\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#_8","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/graphql/#1_2","title":"1. \u4f7f\u7528\u7247\u6bb5\u907f\u514d\u91cd\u590d","text":"<pre><code># \u2705 \u63a8\u8350\nfragment ItemInfo on Item {\n  id\n  name\n  price\n}\n\nquery {\n  items {\n    ...ItemInfo\n  }\n}\n\n# \u274c \u4e0d\u63a8\u8350\nquery {\n  items {\n    id\n    name\n    price\n    id\n    name\n    price\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#2_1","title":"2. \u4f7f\u7528\u53d8\u91cf\u53c2\u6570\u5316\u67e5\u8be2","text":"<pre><code># \u2705 \u63a8\u8350\nquery GetItem($id: Int!) {\n  item(id: $id) {\n    id\n    name\n    price\n  }\n}\n\n# \u274c \u4e0d\u63a8\u8350\nquery {\n  item(id: 1) {\n    id\n    name\n    price\n  }\n}\n</code></pre>"},{"location":"guides/graphql/#3_1","title":"3. \u9650\u5236\u67e5\u8be2\u6df1\u5ea6","text":"<pre><code># \u9632\u6b62\u6df1\u5c42\u5d4c\u5957\u67e5\u8be2\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\nMAX_QUERY_DEPTH = 5\n\ndef validate_query_depth(query: str) -&gt; bool:\n    # \u68c0\u67e5\u67e5\u8be2\u6df1\u5ea6\n    pass\n</code></pre>"},{"location":"guides/graphql/#_9","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: GraphQL \u548c REST API \u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>A: GraphQL \u5141\u8bb8\u5ba2\u6237\u7aef\u7cbe\u786e\u6307\u5b9a\u9700\u8981\u7684\u6570\u636e\uff0c\u800c REST API \u8fd4\u56de\u56fa\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u3002GraphQL \u901a\u5e38\u66f4\u9ad8\u6548\uff0c\u4f46 REST API \u66f4\u7b80\u5355\u3002</p> <p>Q: \u5982\u4f55\u5904\u7406 GraphQL \u9519\u8bef\uff1f</p> <p>A: GraphQL \u9519\u8bef\u5728\u54cd\u5e94\u7684 <code>errors</code> \u5b57\u6bb5\u4e2d\u8fd4\u56de\uff0c\u683c\u5f0f\u4e3a\uff1a <pre><code>{\n  \"errors\": [\n    {\n      \"message\": \"Field not found\",\n      \"locations\": [{\"line\": 1, \"column\": 5}]\n    }\n  ]\n}\n</code></pre></p> <p>Q: \u5982\u4f55\u4f18\u5316 GraphQL \u6027\u80fd\uff1f</p> <p>A:  - \u4f7f\u7528\u6570\u636e\u52a0\u8f7d\u5668\u907f\u514d N+1 \u67e5\u8be2 - \u5b9e\u73b0\u67e5\u8be2\u590d\u6742\u5ea6\u5206\u6790 - \u4f7f\u7528\u7f13\u5b58 - \u9650\u5236\u67e5\u8be2\u6df1\u5ea6</p>"},{"location":"guides/graphql/#_10","title":"\u76f8\u5173\u8d44\u6e90","text":"<ul> <li>GraphQL \u5b98\u65b9\u6587\u6863</li> <li>Strawberry GraphQL</li> <li>GraphQL \u6700\u4f73\u5b9e\u8df5</li> </ul> <p>\u4e0b\u4e00\u6b65: WebSocket \u652f\u6301 \u2192</p>"},{"location":"guides/migrations/","title":"\u6570\u636e\u5e93\u8fc1\u79fb\u6307\u5357","text":"<p>FastAPI-Easy \u96c6\u6210\u4e86\u667a\u80fd\u8fc1\u79fb\u5f15\u64ce\uff0c\u53ef\u4ee5\u81ea\u52a8\u68c0\u6d4b\u548c\u5e94\u7528\u6570\u636e\u5e93 Schema \u53d8\u66f4\uff0c\u65e0\u9700\u624b\u52a8\u7f16\u5199\u8fc1\u79fb\u811a\u672c\u3002</p>"},{"location":"guides/migrations/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"guides/migrations/#3","title":"\u6700\u7b80\u5355\u7684\u65b9\u5f0f (3 \u884c\u4ee3\u7801)","text":"<pre><code>from fastapi_easy import FastAPIEasy\nfrom sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(50))\n\n# \u521b\u5efa\u5e94\u7528\uff0c\u81ea\u52a8\u5904\u7406\u8fc1\u79fb\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User]\n)\n</code></pre> <p>\u5c31\u8fd9\u6837\uff01\u5e94\u7528\u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\uff1a - \u2705 \u68c0\u6d4b Schema \u53d8\u66f4 - \u2705 \u751f\u6210\u8fc1\u79fb\u811a\u672c - \u2705 \u5e94\u7528\u8fc1\u79fb - \u2705 \u8bb0\u5f55\u8fc1\u79fb\u5386\u53f2</p>"},{"location":"guides/migrations/#_3","title":"\u8fc1\u79fb\u6a21\u5f0f","text":""},{"location":"guides/migrations/#1-safe","title":"1. Safe \u6a21\u5f0f (\u9ed8\u8ba4\uff0c\u63a8\u8350\u7528\u4e8e\u751f\u4ea7)","text":"<pre><code>app = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User],\n    migration_mode=\"safe\"  # \u9ed8\u8ba4\u503c\n)\n</code></pre> <p>\u7279\u70b9: - \u2705 \u4ec5\u6267\u884c\u5b89\u5168\u8fc1\u79fb - \u2705 \u907f\u514d\u6570\u636e\u4e22\u5931 - \u2705 \u9002\u5408\u751f\u4ea7\u73af\u5883</p> <p>\u5b89\u5168\u8fc1\u79fb\u5305\u62ec: - \u6dfb\u52a0\u65b0\u8868 - \u6dfb\u52a0\u65b0\u5217\uff08\u6709\u9ed8\u8ba4\u503c\uff09 - \u6dfb\u52a0\u7d22\u5f15 - \u6dfb\u52a0\u7ea6\u675f</p> <p>\u4e0d\u6267\u884c\u7684\u8fc1\u79fb: - \u274c \u5220\u9664\u5217\uff08\u53ef\u80fd\u4e22\u5931\u6570\u636e\uff09 - \u274c \u4fee\u6539\u5217\u7c7b\u578b\uff08\u53ef\u80fd\u4e22\u5931\u6570\u636e\uff09 - \u274c \u5220\u9664\u8868</p>"},{"location":"guides/migrations/#2-auto","title":"2. Auto \u6a21\u5f0f (\u4e2d\u7b49\u98ce\u9669)","text":"<pre><code>app = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User],\n    migration_mode=\"auto\"\n)\n</code></pre> <p>\u7279\u70b9: - \u26a0\ufe0f \u6267\u884c\u4e2d\u7b49\u98ce\u9669\u8fc1\u79fb - \u26a0\ufe0f \u53ef\u80fd\u9700\u8981\u6570\u636e\u8f6c\u6362 - \u26a0\ufe0f \u9002\u5408\u5f00\u53d1\u73af\u5883</p> <p>\u989d\u5916\u6267\u884c\u7684\u8fc1\u79fb: - \u4fee\u6539\u5217\u7c7b\u578b\uff08\u5982\u679c\u517c\u5bb9\uff09 - \u4fee\u6539\u5217\u7ea6\u675f - \u91cd\u547d\u540d\u5217</p>"},{"location":"guides/migrations/#3-aggressive","title":"3. Aggressive \u6a21\u5f0f (\u9ad8\u98ce\u9669)","text":"<pre><code>app = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User],\n    migration_mode=\"aggressive\"\n)\n</code></pre> <p>\u7279\u70b9: - \ud83d\udd34 \u6267\u884c\u6240\u6709\u8fc1\u79fb - \ud83d\udd34 \u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e22\u5931 - \ud83d\udd34 \u4ec5\u7528\u4e8e\u5f00\u53d1\u6216\u6d4b\u8bd5</p> <p>\u6267\u884c\u7684\u8fc1\u79fb: - \u5220\u9664\u5217 - \u5220\u9664\u8868 - \u4efb\u4f55\u5176\u4ed6\u53d8\u66f4</p>"},{"location":"guides/migrations/#_4","title":"\u5e38\u89c1\u573a\u666f","text":""},{"location":"guides/migrations/#1","title":"\u573a\u666f 1: \u6dfb\u52a0\u65b0\u5217","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(50))\n    email = Column(String(100))  # \u65b0\u5217\n</code></pre> <p>\u7ed3\u679c: Safe \u6a21\u5f0f\u4f1a\u81ea\u52a8\u6dfb\u52a0 <code>email</code> \u5217</p>"},{"location":"guides/migrations/#2","title":"\u573a\u666f 2: \u4fee\u6539\u5217\u7c7b\u578b","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(100))  # \u4ece 50 \u6539\u4e3a 100\n</code></pre> <p>\u7ed3\u679c:  - Safe \u6a21\u5f0f: \u274c \u4e0d\u6267\u884c\uff08\u53ef\u80fd\u4e22\u5931\u6570\u636e\uff09 - Auto \u6a21\u5f0f: \u2705 \u6267\u884c\uff08\u5982\u679c\u517c\u5bb9\uff09 - Aggressive \u6a21\u5f0f: \u2705 \u6267\u884c</p>"},{"location":"guides/migrations/#3_1","title":"\u573a\u666f 3: \u5220\u9664\u5217","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    # name \u5217\u88ab\u5220\u9664\n</code></pre> <p>\u7ed3\u679c: - Safe \u6a21\u5f0f: \u274c \u4e0d\u6267\u884c - Auto \u6a21\u5f0f: \u274c \u4e0d\u6267\u884c - Aggressive \u6a21\u5f0f: \u2705 \u6267\u884c</p>"},{"location":"guides/migrations/#4","title":"\u573a\u666f 4: \u6dfb\u52a0\u65b0\u8868","text":"<pre><code>class Product(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(100))\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User, Product]  # \u6dfb\u52a0\u65b0\u6a21\u578b\n)\n</code></pre> <p>\u7ed3\u679c: \u6240\u6709\u6a21\u5f0f\u90fd\u4f1a\u81ea\u52a8\u521b\u5efa <code>products</code> \u8868</p>"},{"location":"guides/migrations/#_5","title":"\u7981\u7528\u81ea\u52a8\u8fc1\u79fb","text":"<p>\u5982\u679c\u4f60\u60f3\u624b\u52a8\u63a7\u5236\u8fc1\u79fb\uff1a</p> <pre><code>app = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User],\n    auto_migrate=False  # \u7981\u7528\u81ea\u52a8\u8fc1\u79fb\n)\n\n# \u624b\u52a8\u8fd0\u884c\u8fc1\u79fb\n@app.on_event(\"startup\")\nasync def startup():\n    await app.run_migration(mode=\"safe\")\n</code></pre>"},{"location":"guides/migrations/#_6","title":"\u67e5\u770b\u8fc1\u79fb\u5386\u53f2","text":"<pre><code># \u83b7\u53d6\u8fc1\u79fb\u5386\u53f2\nhistory = app.get_migration_history(limit=10)\n\nfor record in history:\n    print(f\"\u7248\u672c: {record['version']}\")\n    print(f\"\u63cf\u8ff0: {record['description']}\")\n    print(f\"\u98ce\u9669\u7b49\u7ea7: {record['risk_level']}\")\n    print(f\"\u5e94\u7528\u65f6\u95f4: {record['applied_at']}\")\n    print()\n</code></pre>"},{"location":"guides/migrations/#cli","title":"CLI \u547d\u4ee4","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86 CLI \u5de5\u5177\u6765\u7ba1\u7406\u8fc1\u79fb\uff1a</p>"},{"location":"guides/migrations/#_7","title":"\u67e5\u770b\u8fc1\u79fb\u8ba1\u5212","text":"<pre><code>fastapi-easy migrate plan --database-url sqlite:///db.sqlite\n</code></pre>"},{"location":"guides/migrations/#_8","title":"\u5e94\u7528\u8fc1\u79fb","text":"<pre><code>fastapi-easy migrate apply --database-url sqlite:///db.sqlite --mode safe\n</code></pre>"},{"location":"guides/migrations/#_9","title":"\u67e5\u770b\u8fc1\u79fb\u5386\u53f2","text":"<pre><code>fastapi-easy migrate history --database-url sqlite:///db.sqlite --limit 10\n</code></pre>"},{"location":"guides/migrations/#_10","title":"\u67e5\u770b\u8fc1\u79fb\u72b6\u6001","text":"<pre><code>fastapi-easy migrate status --database-url sqlite:///db.sqlite\n</code></pre>"},{"location":"guides/migrations/#_11","title":"\u652f\u6301\u7684\u6570\u636e\u5e93","text":"\u6570\u636e\u5e93 \u652f\u6301 \u5907\u6ce8 SQLite \u2705 \u5b8c\u5168\u652f\u6301\uff0c\u4f7f\u7528 Copy-Swap-Drop \u7b56\u7565 PostgreSQL \u2705 \u5b8c\u5168\u652f\u6301 MySQL \u2705 \u5b8c\u5168\u652f\u6301 Oracle \u26a0\ufe0f \u57fa\u7840\u652f\u6301 SQL Server \u26a0\ufe0f \u57fa\u7840\u652f\u6301"},{"location":"guides/migrations/#_12","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"guides/migrations/#1_1","title":"\u95ee\u9898 1: \u8fc1\u79fb\u5931\u8d25","text":"<p>\u75c7\u72b6: \u5e94\u7528\u542f\u52a8\u65f6\u8fc1\u79fb\u5931\u8d25</p> <p>\u89e3\u51b3\u65b9\u6848: 1. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5: <code>fastapi-easy migrate status --database-url &lt;url&gt;</code> 2. \u67e5\u770b\u8be6\u7ec6\u9519\u8bef: \u8bbe\u7f6e <code>LOG_LEVEL=DEBUG</code> 3. \u8fd0\u884c dry-run: <code>fastapi-easy migrate plan --database-url &lt;url&gt; --dry-run</code></p>"},{"location":"guides/migrations/#2_1","title":"\u95ee\u9898 2: \u6570\u636e\u4e22\u5931","text":"<p>\u75c7\u72b6: \u4fee\u6539\u5217\u540e\u6570\u636e\u4e22\u5931</p> <p>\u89e3\u51b3\u65b9\u6848: 1. \u4f7f\u7528 Safe \u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09 2. \u5982\u679c\u9700\u8981\u4fee\u6539\u5217\uff0c\u4f7f\u7528 Auto \u6216 Aggressive \u6a21\u5f0f 3. \u59cb\u7ec8\u5728\u751f\u4ea7\u73af\u5883\u524d\u5728\u6d4b\u8bd5\u73af\u5883\u9a8c\u8bc1</p>"},{"location":"guides/migrations/#3_2","title":"\u95ee\u9898 3: \u9501\u5b9a\u9519\u8bef","text":"<p>\u75c7\u72b6: \"Cannot acquire lock\" \u9519\u8bef</p> <p>\u89e3\u51b3\u65b9\u6848: 1. \u68c0\u67e5\u662f\u5426\u6709\u5176\u4ed6\u8fdb\u7a0b\u5728\u8fd0\u884c\u8fc1\u79fb 2. \u68c0\u67e5\u9501\u6587\u4ef6: <code>.fastapi_easy_migration.lock</code> 3. \u5982\u679c\u9501\u6587\u4ef6\u8fc7\u671f\uff0c\u624b\u52a8\u5220\u9664: <code>rm .fastapi_easy_migration.lock</code></p>"},{"location":"guides/migrations/#_13","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/migrations/#1_2","title":"1. \u5f00\u53d1\u73af\u5883","text":"<pre><code>app = FastAPIEasy(\n    database_url=\"sqlite:///dev.db\",\n    models=[User, Product],\n    migration_mode=\"auto\"  # \u7075\u6d3b\u5904\u7406\u53d8\u66f4\n)\n</code></pre>"},{"location":"guides/migrations/#2_2","title":"2. \u6d4b\u8bd5\u73af\u5883","text":"<pre><code>app = FastAPIEasy(\n    database_url=\"postgresql://test_user:pass@localhost/test_db\",\n    models=[User, Product],\n    migration_mode=\"safe\"  # \u8c28\u614e\u5904\u7406\n)\n</code></pre>"},{"location":"guides/migrations/#3_3","title":"3. \u751f\u4ea7\u73af\u5883","text":"<pre><code>app = FastAPIEasy(\n    database_url=os.getenv(\"DATABASE_URL\"),\n    models=[User, Product],\n    migration_mode=\"safe\",  # \u6700\u5b89\u5168\u7684\u6a21\u5f0f\n    auto_migrate=True  # \u81ea\u52a8\u5e94\u7528\u5b89\u5168\u8fc1\u79fb\n)\n</code></pre>"},{"location":"guides/migrations/#4_1","title":"4. \u7248\u672c\u63a7\u5236","text":"<p>\u59cb\u7ec8\u5728\u7248\u672c\u63a7\u5236\u4e2d\u8ddf\u8e2a\u6a21\u578b\u5b9a\u4e49\uff1a</p> <pre><code>git add src/models.py\ngit commit -m \"feat: \u6dfb\u52a0 email \u5b57\u6bb5\u5230 User \u6a21\u578b\"\n</code></pre>"},{"location":"guides/migrations/#5","title":"5. \u5907\u4efd","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u8fd0\u884c\u8fc1\u79fb\u524d\uff0c\u59cb\u7ec8\u5907\u4efd\u6570\u636e\u5e93\uff1a</p> <pre><code># PostgreSQL\npg_dump -U user -d database &gt; backup.sql\n\n# MySQL\nmysqldump -u user -p database &gt; backup.sql\n\n# SQLite\ncp db.sqlite db.sqlite.backup\n</code></pre>"},{"location":"guides/migrations/#_14","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"guides/migrations/#_15","title":"\u81ea\u5b9a\u4e49\u8fc1\u79fb\u5904\u7406","text":"<pre><code>from fastapi_easy import FastAPIEasy\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User]\n)\n\n@app.on_event(\"startup\")\nasync def custom_startup():\n    # \u81ea\u5b9a\u4e49\u8fc1\u79fb\u903b\u8f91\n    if app.migration_engine:\n        history = app.get_migration_history()\n        print(f\"\u5df2\u5e94\u7528 {len(history)} \u4e2a\u8fc1\u79fb\")\n</code></pre>"},{"location":"guides/migrations/#_16","title":"\u76d1\u542c\u8fc1\u79fb\u4e8b\u4ef6","text":"<pre><code>from fastapi_easy.migrations.hooks import migration_hook\n\n@migration_hook(\"before_migrate\")\nasync def before_migrate(context):\n    print(\"\u8fc1\u79fb\u5f00\u59cb...\")\n\n@migration_hook(\"after_migrate\")\nasync def after_migrate(context):\n    print(\"\u8fc1\u79fb\u5b8c\u6210!\")\n</code></pre>"},{"location":"guides/migrations/#_17","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u8fc1\u79fb\u5f15\u64ce\u8bbe\u8ba1</li> <li>CLI \u5de5\u5177\u6307\u5357</li> <li>\u9519\u8bef\u5904\u7406</li> </ul>"},{"location":"guides/migrations/#_18","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<ul> <li>\ud83d\udcd6 \u5b8c\u6574\u6587\u6863</li> <li>\ud83d\udc1b \u62a5\u544a\u95ee\u9898</li> <li>\ud83d\udcac \u8ba8\u8bba\u533a</li> </ul>"},{"location":"guides/permissions-basic/","title":"\u6743\u9650\u63a7\u5236","text":"<p>\u6743\u9650\u63a7\u5236\u662f\u4fdd\u62a4 API \u7684\u5173\u952e\u3002fastapi-easy \u652f\u6301\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u548c\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236\uff08ABAC\uff09\u3002</p>"},{"location":"guides/permissions-basic/#_2","title":"\u4ec0\u4e48\u662f\u6743\u9650\u63a7\u5236\uff1f","text":"<p>\u6743\u9650\u63a7\u5236\u53ef\u4ee5\uff1a</p> <ul> <li>\u2705 \u9650\u5236\u7528\u6237\u8bbf\u95ee</li> <li>\u2705 \u4fdd\u62a4\u654f\u611f\u6570\u636e</li> <li>\u2705 \u5b9e\u73b0\u591a\u79df\u6237</li> <li>\u2705 \u5ba1\u8ba1\u7528\u6237\u64cd\u4f5c</li> </ul>"},{"location":"guides/permissions-basic/#rbac","title":"\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09","text":""},{"location":"guides/permissions-basic/#_3","title":"\u5b9a\u4e49\u89d2\u8272\u548c\u6743\u9650","text":"<pre><code>from fastapi_easy.core.permissions import Role, Permission, RoleBasedAccessControl\n\n# \u5b9a\u4e49\u6743\u9650\nclass Permission(str, Enum):\n    CREATE = \"create\"\n    READ = \"read\"\n    UPDATE = \"update\"\n    DELETE = \"delete\"\n    ADMIN = \"admin\"\n\n# \u5b9a\u4e49\u89d2\u8272\nclass Role(str, Enum):\n    ADMIN = \"admin\"\n    EDITOR = \"editor\"\n    VIEWER = \"viewer\"\n    USER = \"user\"\n\n# \u521b\u5efa RBAC \u5b9e\u4f8b\nrbac = RoleBasedAccessControl()\n\n# \u914d\u7f6e\u89d2\u8272\u6743\u9650\nrbac.add_permission(Role.ADMIN, Permission.ADMIN)\nrbac.add_permission(Role.EDITOR, Permission.CREATE)\nrbac.add_permission(Role.EDITOR, Permission.READ)\nrbac.add_permission(Role.EDITOR, Permission.UPDATE)\nrbac.add_permission(Role.VIEWER, Permission.READ)\nrbac.add_permission(Role.USER, Permission.READ)\n</code></pre>"},{"location":"guides/permissions-basic/#_4","title":"\u68c0\u67e5\u6743\u9650","text":"<pre><code># \u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u6743\u9650\nif rbac.has_permission(Role.EDITOR, Permission.UPDATE):\n    # \u5141\u8bb8\u66f4\u65b0\n    pass\nelse:\n    # \u62d2\u7edd\u66f4\u65b0\n    raise PermissionDeniedError(\"No permission to update\")\n</code></pre>"},{"location":"guides/permissions-basic/#abac","title":"\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236\uff08ABAC\uff09","text":""},{"location":"guides/permissions-basic/#_5","title":"\u5b9a\u4e49\u7b56\u7565","text":"<pre><code>from fastapi_easy.core.permissions import AttributeBasedAccessControl\n\nabac = AttributeBasedAccessControl()\n\n# \u6dfb\u52a0\u7b56\u7565\uff1a\u53ea\u6709\u6240\u6709\u8005\u53ef\u4ee5\u5220\u9664\u81ea\u5df1\u7684\u9879\u76ee\nabac.add_policy(\n    name=\"owner_delete\",\n    resource=\"item\",\n    action=\"delete\",\n    condition=lambda context: context.user_id == context.resource.owner_id\n)\n\n# \u6dfb\u52a0\u7b56\u7565\uff1a\u53ea\u6709\u7ba1\u7406\u5458\u53ef\u4ee5\u5220\u9664\u4efb\u4f55\u9879\u76ee\nabac.add_policy(\n    name=\"admin_delete\",\n    resource=\"item\",\n    action=\"delete\",\n    condition=lambda context: \"admin\" in context.user_roles\n)\n</code></pre>"},{"location":"guides/permissions-basic/#_6","title":"\u8bc4\u4f30\u7b56\u7565","text":"<pre><code>from fastapi_easy.core.permissions import PermissionContext\n\n# \u521b\u5efa\u6743\u9650\u4e0a\u4e0b\u6587\ncontext = PermissionContext(\n    user_id=user.id,\n    roles=user.roles,\n    permissions=user.permissions,\n    attributes={\"resource\": item}\n)\n\n# \u68c0\u67e5\u662f\u5426\u5141\u8bb8\u5220\u9664\nif abac.evaluate(context, \"item\", \"delete\"):\n    # \u5141\u8bb8\u5220\u9664\n    pass\nelse:\n    # \u62d2\u7edd\u5220\u9664\n    raise PermissionDeniedError(\"No permission to delete this item\")\n</code></pre>"},{"location":"guides/permissions-basic/#crudrouter","title":"\u96c6\u6210\u5230 CRUDRouter","text":""},{"location":"guides/permissions-basic/#_7","title":"\u914d\u7f6e\u6743\u9650","text":"<pre><code>from fastapi_easy import CRUDRouter\nfrom fastapi_easy.core.permissions import PermissionConfig\n\nconfig = PermissionConfig(\n    enabled=True,\n    default_role=Role.USER,\n    require_authentication=True,\n)\n\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n    permission_config=config,\n    rbac=rbac,\n    abac=abac,\n)\n</code></pre>"},{"location":"guides/permissions-basic/#_8","title":"\u5728\u94a9\u5b50\u4e2d\u68c0\u67e5\u6743\u9650","text":"<pre><code>async def before_create(context):\n    # \u68c0\u67e5\u521b\u5efa\u6743\u9650\n    if not rbac.has_permission(context.user_role, Permission.CREATE):\n        raise PermissionDeniedError(\"No permission to create\")\n\nasync def before_delete(context):\n    # \u68c0\u67e5\u5220\u9664\u6743\u9650\n    if not abac.evaluate(context, \"item\", \"delete\"):\n        raise PermissionDeniedError(\"No permission to delete this item\")\n\nrouter.hooks.register(\"before_create\", before_create)\nrouter.hooks.register(\"before_delete\", before_delete)\n</code></pre>"},{"location":"guides/permissions-basic/#_9","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"guides/permissions-basic/#_10","title":"\u591a\u79df\u6237\u652f\u6301","text":"<pre><code># \u6dfb\u52a0\u7b56\u7565\uff1a\u7528\u6237\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u79df\u6237\u7684\u6570\u636e\nabac.add_policy(\n    name=\"tenant_isolation\",\n    resource=\"item\",\n    action=\"read\",\n    condition=lambda context: context.tenant_id == context.resource.tenant_id\n)\n</code></pre>"},{"location":"guides/permissions-basic/#_11","title":"\u52a8\u6001\u6743\u9650","text":"<pre><code># \u6839\u636e\u65f6\u95f4\u9650\u5236\u8bbf\u95ee\nabac.add_policy(\n    name=\"time_based_access\",\n    resource=\"item\",\n    action=\"update\",\n    condition=lambda context: context.is_business_hours()\n)\n\n# \u6839\u636e\u6570\u636e\u654f\u611f\u6027\u9650\u5236\u8bbf\u95ee\nabac.add_policy(\n    name=\"data_sensitivity\",\n    resource=\"item\",\n    action=\"read\",\n    condition=lambda context: context.user_clearance_level &gt;= context.resource.sensitivity_level\n)\n</code></pre>"},{"location":"guides/permissions-basic/#_12","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/permissions-basic/#1","title":"1. \u4f7f\u7528\u6700\u5c0f\u6743\u9650\u539f\u5219","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u6700\u5c0f\u6743\u9650\nrbac.add_permission(Role.USER, Permission.READ)\n\n# \u274c \u4e0d\u63a8\u8350\uff1a\u8fc7\u5ea6\u6743\u9650\nrbac.add_permission(Role.USER, Permission.ADMIN)\n</code></pre>"},{"location":"guides/permissions-basic/#2","title":"2. \u5b9a\u671f\u5ba1\u8ba1\u6743\u9650","text":"<pre><code># \u5b9a\u671f\u68c0\u67e5\u7528\u6237\u6743\u9650\nfor user in users:\n    permissions = rbac.get_permissions(user.role)\n    logger.info(f\"User {user.id} permissions: {permissions}\")\n</code></pre>"},{"location":"guides/permissions-basic/#3","title":"3. \u4f7f\u7528\u6743\u9650\u7f13\u5b58","text":"<pre><code># \u7f13\u5b58\u6743\u9650\u68c0\u67e5\u7ed3\u679c\nfrom functools import lru_cache\n\n@lru_cache(maxsize=1000)\ndef check_permission(role: str, permission: str) -&gt; bool:\n    return rbac.has_permission(role, permission)\n</code></pre>"},{"location":"guides/permissions-basic/#4","title":"4. \u8bb0\u5f55\u6743\u9650\u62d2\u7edd","text":"<pre><code># \u8bb0\u5f55\u6240\u6709\u6743\u9650\u62d2\u7edd\ntry:\n    if not rbac.has_permission(user_role, permission):\n        raise PermissionDeniedError()\nexcept PermissionDeniedError:\n    logger.warning(f\"Permission denied: {user_id} -&gt; {permission}\")\n    raise\n</code></pre>"},{"location":"guides/permissions-basic/#_13","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: RBAC \u548c ABAC \u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>A: RBAC \u57fa\u4e8e\u7528\u6237\u89d2\u8272\uff0cABAC \u57fa\u4e8e\u5c5e\u6027\u548c\u6761\u4ef6\u3002ABAC \u66f4\u7075\u6d3b\u3002</p> <p>Q: \u5982\u4f55\u5b9e\u73b0\u591a\u79df\u6237\uff1f</p> <p>A: \u4f7f\u7528 ABAC \u6dfb\u52a0\u79df\u6237\u9694\u79bb\u7b56\u7565\u3002</p> <p>Q: \u5982\u4f55\u5904\u7406\u6743\u9650\u62d2\u7edd\uff1f</p> <p>A: \u629b\u51fa <code>PermissionDeniedError</code> \u5f02\u5e38\uff0c\u7531\u4e2d\u95f4\u4ef6\u5904\u7406\u3002</p> <p>Q: \u6743\u9650\u68c0\u67e5\u4f1a\u5f71\u54cd\u6027\u80fd\u5417\uff1f</p> <p>A: \u4f1a\u6709\u8f7b\u5fae\u5f71\u54cd\uff0c\u5efa\u8bae\u4f7f\u7528\u7f13\u5b58\u3002</p>"},{"location":"guides/permissions-basic/#_14","title":"\u603b\u7ed3","text":"<p>\u6743\u9650\u63a7\u5236\u662f\u4fdd\u62a4 API \u7684\u5173\u952e\uff1a</p> <ul> <li>\u2705 \u4f7f\u7528 RBAC \u8fdb\u884c\u57fa\u672c\u6743\u9650\u7ba1\u7406</li> <li>\u2705 \u4f7f\u7528 ABAC \u8fdb\u884c\u590d\u6742\u6743\u9650\u7ba1\u7406</li> <li>\u2705 \u9075\u5faa\u6700\u5c0f\u6743\u9650\u539f\u5219</li> <li>\u2705 \u5b9a\u671f\u5ba1\u8ba1\u6743\u9650</li> </ul> <p>\u4e0b\u4e00\u6b65: \u5ba1\u8ba1\u65e5\u5fd7 \u2192</p>"},{"location":"guides/querying/","title":"\u67e5\u8be2\u6307\u5357\uff1a\u641c\u7d22\u3001\u8fc7\u6ee4\u4e0e\u6392\u5e8f","text":""},{"location":"guides/querying/#_2","title":"\u6982\u8ff0","text":"<p>fastapi-easy \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u67e5\u8be2\u529f\u80fd\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u901a\u8fc7 URL \u53c2\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u641c\u7d22\u3001\u8fc7\u6ee4\u548c\u6392\u5e8f\u3002\u8fd9\u4e9b\u529f\u80fd\u662f\u81ea\u52a8\u751f\u6210\u7684\uff0c\u65e0\u9700\u7f16\u5199\u989d\u5916\u7684 SQL \u6216\u903b\u8f91\u4ee3\u7801\u3002</p>"},{"location":"guides/querying/#1-filtering","title":"1. \u8fc7\u6ee4 (Filtering)","text":""},{"location":"guides/querying/#_3","title":"\u542f\u7528\u8fc7\u6ee4","text":"<p>\u5728 <code>CRUDRouter</code> \u4e2d\u8bbe\u7f6e <code>enable_filters=True</code> \u5e76\u6307\u5b9a <code>filter_fields</code>\uff1a</p> <pre><code>from fastapi_easy import CRUDRouter\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    enable_filters=True,\n    filter_fields=[\"name\", \"price\", \"category\"],  # \u6307\u5b9a\u5141\u8bb8\u8fc7\u6ee4\u7684\u5b57\u6bb5\n)\n</code></pre>"},{"location":"guides/querying/#_4","title":"\u652f\u6301\u7684\u64cd\u4f5c\u7b26","text":"<p>fastapi-easy \u4f7f\u7528 <code>\u5b57\u6bb5\u540d__\u64cd\u4f5c\u7b26</code> \u7684\u683c\u5f0f\uff08\u53cc\u4e0b\u5212\u7ebf\uff09\u6765\u6307\u5b9a\u8fc7\u6ee4\u6761\u4ef6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff08\u4e0d\u52a0\u64cd\u4f5c\u7b26\uff09\u4e3a\u7cbe\u786e\u5339\u914d\u3002</p> \u64cd\u4f5c\u7b26 \u63cf\u8ff0 URL \u793a\u4f8b SQL \u7b49\u4ef7 (\u65e0) \u7cbe\u786e\u5339\u914d <code>?name=apple</code> <code>name = 'apple'</code> <code>ne</code> \u4e0d\u7b49\u4e8e <code>?name__ne=apple</code> <code>name != 'apple'</code> <code>gt</code> \u5927\u4e8e <code>?price__gt=10</code> <code>price &gt; 10</code> <code>gte</code> \u5927\u4e8e\u7b49\u4e8e <code>?price__gte=10</code> <code>price &gt;= 10</code> <code>lt</code> \u5c0f\u4e8e <code>?price__lt=50</code> <code>price &lt; 50</code> <code>lte</code> \u5c0f\u4e8e\u7b49\u4e8e <code>?price__lte=50</code> <code>price &lt;= 50</code> <code>in</code> \u5305\u542b\u4e8e <code>?category__in=fruit,meat</code> <code>category IN ('fruit', 'meat')</code> <code>like</code> \u6a21\u7cca\u5339\u914d <code>?name__like=%app%</code> <code>name LIKE '%app%'</code> <code>ilike</code> \u4e0d\u533a\u5206\u5927\u5c0f\u5199\u6a21\u7cca <code>?name__ilike=%app%</code> <code>name ILIKE '%app%'</code> (PostgreSQL)"},{"location":"guides/querying/#_5","title":"\u7ec4\u5408\u8fc7\u6ee4","text":"<p>\u591a\u4e2a\u53c2\u6570\u4e4b\u95f4\u662f AND \u5173\u7cfb\uff1a</p> <pre><code>GET /items?name__like=%apple%&amp;price__gt=5&amp;category=fruit\n</code></pre> <p>SQL: <pre><code>WHERE name LIKE '%apple%' \n  AND price &gt; 5 \n  AND category = 'fruit'\n</code></pre></p>"},{"location":"guides/querying/#2-sorting","title":"2. \u6392\u5e8f (Sorting)","text":""},{"location":"guides/querying/#_6","title":"\u542f\u7528\u6392\u5e8f","text":"<p>\u5728 <code>CRUDRouter</code> \u4e2d\u8bbe\u7f6e <code>enable_sorters=True</code> \u5e76\u6307\u5b9a <code>sort_fields</code>\uff1a</p> <pre><code>router = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    enable_sorters=True,\n    sort_fields=[\"name\", \"price\", \"created_at\"],\n    default_sort=\"-created_at\",  # \u53ef\u9009\uff1a\u9ed8\u8ba4\u6392\u5e8f\n)\n</code></pre>"},{"location":"guides/querying/#_7","title":"\u4f7f\u7528\u65b9\u6cd5","text":"<p>\u4f7f\u7528 <code>sort</code> \u53c2\u6570\u6307\u5b9a\u6392\u5e8f\u5b57\u6bb5\u3002</p> <ul> <li>\u5347\u5e8f\uff1a\u76f4\u63a5\u4f7f\u7528\u5b57\u6bb5\u540d\uff0c\u5982 <code>sort=price</code></li> <li>\u964d\u5e8f\uff1a\u5728\u5b57\u6bb5\u540d\u524d\u52a0\u8d1f\u53f7 <code>-</code>\uff0c\u5982 <code>sort=-price</code></li> <li>\u591a\u5b57\u6bb5\uff1a\u7528\u9017\u53f7\u5206\u9694\uff0c\u5982 <code>sort=category,-price</code></li> </ul>"},{"location":"guides/querying/#_8","title":"\u793a\u4f8b","text":"\u63cf\u8ff0 URL \u793a\u4f8b SQL \u7b49\u4ef7 \u6309\u4ef7\u683c\u5347\u5e8f <code>?sort=price</code> <code>ORDER BY price ASC</code> \u6309\u4ef7\u683c\u964d\u5e8f <code>?sort=-price</code> <code>ORDER BY price DESC</code> \u5148\u5206\u7c7b\u5347\u5e8f\uff0c\u540e\u4ef7\u683c\u964d\u5e8f <code>?sort=category,-price</code> <code>ORDER BY category ASC, price DESC</code>"},{"location":"guides/querying/#3-filtering-sorting-pagination","title":"3. \u7ec4\u5408\u4f7f\u7528 (Filtering + Sorting + Pagination)","text":"<p>\u8fc7\u6ee4\u3001\u6392\u5e8f\u548c\u5206\u9875\u53ef\u4ee5\u5b8c\u7f8e\u7ed3\u5408\u4f7f\u7528\u3002</p> <pre><code>GET /items?category=fruit&amp;price__gt=10&amp;sort=-price&amp;skip=0&amp;limit=20\n</code></pre> <p>\u903b\u8f91\u987a\u5e8f\uff1a 1.  Filter: \u7b5b\u9009 <code>category='fruit'</code> \u4e14 <code>price &gt; 10</code> \u7684\u8bb0\u5f55 2.  Sort: \u6309 <code>price</code> \u964d\u5e8f\u6392\u5217 3.  Paginate: \u8df3\u8fc7\u524d 0 \u6761\uff0c\u53d6 20 \u6761</p>"},{"location":"guides/querying/#4-faq","title":"4. \u5e38\u89c1\u95ee\u9898 (FAQ)","text":"<p>Q: \u5982\u4f55\u67e5\u8be2\u7a7a\u503c (NULL)\uff1f A: \u76ee\u524d\u6682\u4e0d\u652f\u6301\u76f4\u63a5\u67e5\u8be2 NULL\uff0c\u5efa\u8bae\u5728\u8bbe\u8ba1\u6570\u636e\u5e93\u65f6\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u3002\u6216\u8005\u4f7f\u7528\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\uff08\u9ad8\u7ea7\u529f\u80fd\uff09\u3002</p> <p>Q: <code>like</code> \u548c <code>ilike</code> \u7684\u533a\u522b\uff1f A: <code>like</code> \u901a\u5e38\u533a\u5206\u5927\u5c0f\u5199\uff08\u53d6\u51b3\u4e8e\u6570\u636e\u5e93\u6392\u5e8f\u89c4\u5219\uff09\uff0c<code>ilike</code> \u5f3a\u5236\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff08\u4e3b\u8981\u7528\u4e8e PostgreSQL\uff09\u3002</p> <p>Q: \u4e3a\u4ec0\u4e48\u6211\u7684\u6392\u5e8f\u4e0d\u8d77\u4f5c\u7528\uff1f A: \u68c0\u67e5\u5b57\u6bb5\u662f\u5426\u5728 <code>sort_fields</code> \u5217\u8868\u4e2d\u3002\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u672a\u5217\u51fa\u7684\u5b57\u6bb5\u4e0d\u5141\u8bb8\u6392\u5e8f\u3002</p>"},{"location":"guides/querying/#5","title":"5. \u6027\u80fd\u5efa\u8bae","text":"<ol> <li>\u7d22\u5f15\uff1a\u52a1\u5fc5\u4e3a <code>filter_fields</code> \u548c <code>sort_fields</code> \u4e2d\u7684\u9ad8\u9891\u5b57\u6bb5\u6dfb\u52a0\u6570\u636e\u5e93\u7d22\u5f15\u3002</li> <li>\u9650\u5236\u5b57\u6bb5\uff1a\u4e0d\u8981\u5c06\u6240\u6709\u5b57\u6bb5\u90fd\u66b4\u9732\u7ed9\u8fc7\u6ee4\u548c\u6392\u5e8f\uff0c\u53ea\u66b4\u9732\u4e1a\u52a1\u9700\u8981\u7684\u5b57\u6bb5\u3002</li> <li>\u5206\u9875\u9650\u5236\uff1a\u59cb\u7ec8\u8bbe\u7f6e\u5408\u7406\u7684 <code>max_limit</code> \u9632\u6b62\u5355\u6b21\u67e5\u8be2\u5927\u91cf\u6570\u636e\u3002</li> </ol> <pre><code># \u63a8\u8350\u914d\u7f6e\nrouter = CRUDRouter(\n    # ...\n    pagination_config=PaginationConfig(default_limit=20, max_limit=100)\n)\n</code></pre>"},{"location":"guides/soft-delete/","title":"\u8f6f\u5220\u9664\u529f\u80fd","text":"<p>\u8f6f\u5220\u9664\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u6570\u636e\u7ba1\u7406\u6a21\u5f0f\uff0c\u5c06\u8bb0\u5f55\u6807\u8bb0\u4e3a\u5df2\u5220\u9664\u800c\u4e0d\u662f\u6c38\u4e45\u5220\u9664\u3002\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u5728 fastapi-easy \u4e2d\u4f7f\u7528\u8f6f\u5220\u9664\u529f\u80fd\u3002</p>"},{"location":"guides/soft-delete/#_2","title":"\u4ec0\u4e48\u662f\u8f6f\u5220\u9664\uff1f","text":"<p>\u8f6f\u5220\u9664\u4e0d\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u5220\u9664\u6570\u636e\uff0c\u800c\u662f\u6807\u8bb0\u4e3a\u5df2\u5220\u9664\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\uff1a</p> <ul> <li>\u2705 \u6570\u636e\u53ef\u6062\u590d</li> <li>\u2705 \u4fdd\u7559\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u2705 \u652f\u6301\u6570\u636e\u5206\u6790</li> <li>\u2705 \u7b26\u5408\u6cd5\u89c4\u8981\u6c42</li> </ul>"},{"location":"guides/soft-delete/#_3","title":"\u542f\u7528\u8f6f\u5220\u9664","text":""},{"location":"guides/soft-delete/#1","title":"1. \u6dfb\u52a0\u8f6f\u5220\u9664\u5b57\u6bb5","text":"<pre><code>from sqlalchemy import Column, Boolean, DateTime\nfrom datetime import datetime\n\nclass Item(Base):\n    __tablename__ = \"items\"\n\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    is_deleted = Column(Boolean, default=False, index=True)\n    deleted_at = Column(DateTime, nullable=True)\n</code></pre>"},{"location":"guides/soft-delete/#2","title":"2. \u914d\u7f6e\u8f6f\u5220\u9664","text":"<pre><code>from fastapi_easy import CRUDRouter\nfrom fastapi_easy.core.soft_delete import SoftDeleteConfig\n\nconfig = SoftDeleteConfig(\n    enabled=True,\n    include_deleted_by_default=False,  # \u9ed8\u8ba4\u4e0d\u5305\u542b\u5df2\u5220\u9664\u7684\u8bb0\u5f55\n    auto_restore_on_update=False,      # \u66f4\u65b0\u65f6\u4e0d\u81ea\u52a8\u6062\u590d\n)\n\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n    soft_delete_config=config,\n)\n</code></pre>"},{"location":"guides/soft-delete/#_4","title":"\u4f7f\u7528\u8f6f\u5220\u9664","text":""},{"location":"guides/soft-delete/#_5","title":"\u8f6f\u5220\u9664\u8bb0\u5f55","text":"<pre><code># DELETE /items/1\n# \u54cd\u5e94\uff1a{\"id\": 1, \"name\": \"Item 1\", \"is_deleted\": true, \"deleted_at\": \"2024-11-27T...\"}\n</code></pre>"},{"location":"guides/soft-delete/#_6","title":"\u6062\u590d\u5df2\u5220\u9664\u7684\u8bb0\u5f55","text":"<pre><code>from fastapi_easy.core.soft_delete import SoftDeleteAdapter\n\nadapter = SoftDeleteAdapter(Item, session)\n\n# \u6062\u590d\u5355\u4e2a\u8bb0\u5f55\nawait adapter.restore(item_id=1)\n\n# \u6062\u590d\u6240\u6709\u5df2\u5220\u9664\u7684\u8bb0\u5f55\nawait adapter.restore_all()\n</code></pre>"},{"location":"guides/soft-delete/#_7","title":"\u67e5\u8be2\u5df2\u5220\u9664\u7684\u8bb0\u5f55","text":"<pre><code># \u9ed8\u8ba4\u4e0d\u5305\u542b\u5df2\u5220\u9664\u7684\u8bb0\u5f55\n# GET /items\n# \u54cd\u5e94\uff1a\u53ea\u8fd4\u56de\u672a\u5220\u9664\u7684\u8bb0\u5f55\n\n# \u5305\u542b\u5df2\u5220\u9664\u7684\u8bb0\u5f55\n# GET /items?include_deleted=true\n# \u54cd\u5e94\uff1a\u8fd4\u56de\u6240\u6709\u8bb0\u5f55\uff08\u5305\u62ec\u5df2\u5220\u9664\u7684\uff09\n</code></pre>"},{"location":"guides/soft-delete/#_8","title":"\u6c38\u4e45\u5220\u9664","text":"<pre><code># \u6c38\u4e45\u5220\u9664\u5df2\u5220\u9664\u7684\u8bb0\u5f55\nawait adapter.permanently_delete(item_id=1)\n\n# \u6c38\u4e45\u5220\u9664\u6240\u6709\u5df2\u5220\u9664\u7684\u8bb0\u5f55\nawait adapter.permanently_delete_all()\n</code></pre>"},{"location":"guides/soft-delete/#_9","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"guides/soft-delete/#_10","title":"\u81ea\u5b9a\u4e49\u8f6f\u5220\u9664\u5b57\u6bb5","text":"<pre><code>from fastapi_easy.core.soft_delete import SoftDeleteMixin\n\nclass Item(Base, SoftDeleteMixin):\n    __tablename__ = \"items\"\n\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    # \u81ea\u52a8\u6dfb\u52a0 is_deleted \u548c deleted_at \u5b57\u6bb5\n</code></pre>"},{"location":"guides/soft-delete/#_11","title":"\u68c0\u67e5\u8bb0\u5f55\u662f\u5426\u5df2\u5220\u9664","text":"<pre><code>item = await adapter.get_one(1)\n\nif adapter.is_soft_deleted(item):\n    print(\"\u8bb0\u5f55\u5df2\u5220\u9664\")\nelse:\n    print(\"\u8bb0\u5f55\u672a\u5220\u9664\")\n</code></pre>"},{"location":"guides/soft-delete/#_12","title":"\u83b7\u53d6\u5220\u9664\u7edf\u8ba1","text":"<pre><code># \u83b7\u53d6\u5df2\u5220\u9664\u7684\u8bb0\u5f55\u6570\ndeleted_count = await adapter.count(filters={\"is_deleted\": True})\n\n# \u83b7\u53d6\u672a\u5220\u9664\u7684\u8bb0\u5f55\u6570\nactive_count = await adapter.count(filters={\"is_deleted\": False})\n</code></pre>"},{"location":"guides/soft-delete/#_13","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/soft-delete/#1_1","title":"1. \u603b\u662f\u4f7f\u7528\u8f6f\u5220\u9664","text":"<pre><code># \u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u8f6f\u5220\u9664\nawait adapter.soft_delete(item_id=1)\n\n# \u274c \u4e0d\u63a8\u8350\uff1a\u76f4\u63a5\u5220\u9664\nawait adapter.delete_one(item_id=1)\n</code></pre>"},{"location":"guides/soft-delete/#2_1","title":"2. \u5b9a\u671f\u6e05\u7406\u5df2\u5220\u9664\u7684\u8bb0\u5f55","text":"<pre><code># \u5b9a\u671f\u6c38\u4e45\u5220\u9664 30 \u5929\u524d\u5220\u9664\u7684\u8bb0\u5f55\nfrom datetime import datetime, timedelta\n\ncutoff_date = datetime.utcnow() - timedelta(days=30)\n\n# \u5220\u9664 deleted_at &lt; cutoff_date \u7684\u8bb0\u5f55\nawait adapter.permanently_delete_all(\n    filters={\"deleted_at__lt\": cutoff_date}\n)\n</code></pre>"},{"location":"guides/soft-delete/#3","title":"3. \u5728\u67e5\u8be2\u4e2d\u6392\u9664\u5df2\u5220\u9664\u7684\u8bb0\u5f55","text":"<pre><code># \u81ea\u52a8\u6392\u9664\u5df2\u5220\u9664\u7684\u8bb0\u5f55\nrouter = CRUDRouter(\n    schema=ItemSchema,\n    backend=backend,\n    soft_delete_config=SoftDeleteConfig(\n        include_deleted_by_default=False\n    ),\n)\n</code></pre>"},{"location":"guides/soft-delete/#4","title":"4. \u5ba1\u8ba1\u65e5\u5fd7\u96c6\u6210","text":"<pre><code>from fastapi_easy.core.audit_log import AuditLogger\n\naudit_logger = AuditLogger()\n\n# \u8bb0\u5f55\u8f6f\u5220\u9664\u64cd\u4f5c\nawait adapter.soft_delete(item_id=1)\naudit_logger.log(\n    entity_type=\"Item\",\n    entity_id=1,\n    action=\"soft_delete\",\n    user_id=user.id,\n)\n</code></pre>"},{"location":"guides/soft-delete/#_14","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u8f6f\u5220\u9664\u548c\u786c\u5220\u9664\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>A: \u8f6f\u5220\u9664\u6807\u8bb0\u8bb0\u5f55\u4e3a\u5df2\u5220\u9664\u4f46\u4fdd\u7559\u6570\u636e\uff0c\u786c\u5220\u9664\u6c38\u4e45\u5220\u9664\u6570\u636e\u3002\u8f6f\u5220\u9664\u66f4\u5b89\u5168\uff0c\u652f\u6301\u6062\u590d\u3002</p> <p>Q: \u5982\u4f55\u67e5\u8be2\u5305\u62ec\u5df2\u5220\u9664\u7684\u8bb0\u5f55\uff1f</p> <p>A: \u5728\u67e5\u8be2\u53c2\u6570\u4e2d\u6dfb\u52a0 <code>include_deleted=true</code>\u3002</p> <p>Q: \u5982\u4f55\u6062\u590d\u5df2\u5220\u9664\u7684\u8bb0\u5f55\uff1f</p> <p>A: \u4f7f\u7528 <code>SoftDeleteAdapter.restore()</code> \u65b9\u6cd5\u3002</p> <p>Q: \u8f6f\u5220\u9664\u4f1a\u5f71\u54cd\u6027\u80fd\u5417\uff1f</p> <p>A: \u4f1a\u6709\u8f7b\u5fae\u5f71\u54cd\uff0c\u56e0\u4e3a\u9700\u8981\u68c0\u67e5 <code>is_deleted</code> \u5b57\u6bb5\u3002\u5efa\u8bae\u5728\u8be5\u5b57\u6bb5\u4e0a\u521b\u5efa\u7d22\u5f15\u3002</p>"},{"location":"guides/soft-delete/#_15","title":"\u603b\u7ed3","text":"<p>\u8f6f\u5220\u9664\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\uff1a</p> <ul> <li>\u2705 \u4fdd\u62a4\u6570\u636e\u5b89\u5168</li> <li>\u2705 \u652f\u6301\u6570\u636e\u6062\u590d</li> <li>\u2705 \u4fdd\u7559\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u2705 \u7b26\u5408\u6cd5\u89c4\u8981\u6c42</li> </ul> <p>\u4f7f\u7528\u8f6f\u5220\u9664\u65f6\uff0c\u8bb0\u4f4f\uff1a</p> <ol> <li>\u603b\u662f\u542f\u7528\u8f6f\u5220\u9664</li> <li>\u5b9a\u671f\u6e05\u7406\u5df2\u5220\u9664\u7684\u8bb0\u5f55</li> <li>\u5728\u67e5\u8be2\u4e2d\u6392\u9664\u5df2\u5220\u9664\u7684\u8bb0\u5f55</li> <li>\u4e0e\u5ba1\u8ba1\u65e5\u5fd7\u96c6\u6210</li> </ol> <p>\u4e0b\u4e00\u6b65: \u6279\u91cf\u64cd\u4f5c \u2192</p>"},{"location":"guides/troubleshooting/","title":"\u6545\u969c\u6392\u9664\u6307\u5357","text":"<p>\u672c\u6307\u5357\u5e2e\u52a9\u89e3\u51b3\u4f7f\u7528 fastapi-easy \u65f6\u9047\u5230\u7684\u5e38\u89c1\u95ee\u9898\u3002</p>"},{"location":"guides/troubleshooting/#_2","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"guides/troubleshooting/#1","title":"1. \u6570\u636e\u5e93\u8fde\u63a5\u9519\u8bef","text":"<p>\u95ee\u9898: <code>sqlalchemy.exc.OperationalError: could not connect to server</code></p> <p>\u89e3\u51b3\u65b9\u6848: - \u68c0\u67e5\u6570\u636e\u5e93 URL \u662f\u5426\u6b63\u786e - \u786e\u4fdd\u6570\u636e\u5e93\u670d\u52a1\u6b63\u5728\u8fd0\u884c - \u68c0\u67e5\u7f51\u7edc\u8fde\u63a5</p> <pre><code># \u9a8c\u8bc1\u8fde\u63a5\nasync with engine.begin() as conn:\n    await conn.execute(text(\"SELECT 1\"))\n</code></pre>"},{"location":"guides/troubleshooting/#2","title":"2. \u6743\u9650\u9519\u8bef","text":"<p>\u95ee\u9898: <code>PermissionDeniedError: No permission to ...</code></p> <p>\u89e3\u51b3\u65b9\u6848: - \u68c0\u67e5\u7528\u6237\u89d2\u8272\u548c\u6743\u9650 - \u9a8c\u8bc1\u6743\u9650\u914d\u7f6e - \u67e5\u770b\u5ba1\u8ba1\u65e5\u5fd7</p> <pre><code># \u68c0\u67e5\u6743\u9650\nif rbac.has_permission(user_role, permission):\n    # \u5141\u8bb8\u64cd\u4f5c\n    pass\n</code></pre>"},{"location":"guides/troubleshooting/#3","title":"3. \u9a8c\u8bc1\u9519\u8bef","text":"<p>\u95ee\u9898: <code>ValidationError: Invalid input</code></p> <p>\u89e3\u51b3\u65b9\u6848: - \u68c0\u67e5\u8f93\u5165\u6570\u636e\u683c\u5f0f - \u9a8c\u8bc1\u5fc5\u586b\u5b57\u6bb5 - \u67e5\u770b\u9519\u8bef\u8be6\u60c5</p> <pre><code># \u6dfb\u52a0\u8be6\u7ec6\u7684\u9a8c\u8bc1\u9519\u8bef\u4fe1\u606f\ntry:\n    result = await adapter.create(data)\nexcept ValidationError as e:\n    logger.error(f\"Validation error: {e.details}\")\n</code></pre>"},{"location":"guides/troubleshooting/#4","title":"4. \u6027\u80fd\u95ee\u9898","text":"<p>\u95ee\u9898: \u67e5\u8be2\u901f\u5ea6\u6162</p> <p>\u89e3\u51b3\u65b9\u6848: - \u6dfb\u52a0\u6570\u636e\u5e93\u7d22\u5f15 - \u542f\u7528\u7f13\u5b58 - \u4f7f\u7528\u5206\u9875 - \u4f18\u5316\u67e5\u8be2</p> <pre><code># \u542f\u7528\u7f13\u5b58\n@CachedOperation(cache, ttl=3600)\nasync def get_items():\n    return await adapter.get_all()\n</code></pre>"},{"location":"guides/troubleshooting/#_3","title":"\u8c03\u8bd5\u6280\u5de7","text":""},{"location":"guides/troubleshooting/#1_1","title":"1. \u542f\u7528\u8be6\u7ec6\u65e5\u5fd7","text":"<pre><code>import logging\n\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger(__name__)\n</code></pre>"},{"location":"guides/troubleshooting/#2-print","title":"2. \u4f7f\u7528 print \u8c03\u8bd5","text":"<pre><code>print(f\"Debug: {variable}\")\n</code></pre>"},{"location":"guides/troubleshooting/#3-pdb","title":"3. \u4f7f\u7528 pdb \u8c03\u8bd5","text":"<pre><code>import pdb; pdb.set_trace()\n</code></pre>"},{"location":"guides/troubleshooting/#_4","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<ol> <li>\u67e5\u770b\u6587\u6863</li> <li>\u67e5\u770b\u793a\u4f8b\u4ee3\u7801</li> <li>\u67e5\u770b\u6d4b\u8bd5\u7528\u4f8b</li> <li>\u63d0\u4ea4 Issue</li> </ol> <p>\u5b8c\u6210\uff01 \ud83c\udf89</p>"},{"location":"guides/websocket/","title":"WebSocket \u652f\u6301","text":"<p>FastAPI-Easy \u652f\u6301 WebSocket \u5b9e\u65f6\u901a\u4fe1\u3002\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 WebSocket\u3002</p>"},{"location":"guides/websocket/#websocket_1","title":"\u542f\u7528 WebSocket","text":"<pre><code>from fastapi import WebSocket\nfrom fastapi_easy import CRUDRouter\n\n@app.websocket(\"/ws/items\")\nasync def websocket_endpoint(websocket: WebSocket):\n    await websocket.accept()\n    try:\n        while True:\n            data = await websocket.receive_text()\n            await websocket.send_text(f\"Echo: {data}\")\n    except Exception as e:\n        await websocket.close()\n</code></pre>"},{"location":"guides/websocket/#websocket_2","title":"WebSocket \u8fde\u63a5","text":""},{"location":"guides/websocket/#_1","title":"\u5ba2\u6237\u7aef\u8fde\u63a5","text":"<pre><code>const ws = new WebSocket(\"ws://localhost:8000/ws/items\");\n\nws.onopen = function(event) {\n    console.log(\"Connected\");\n    ws.send(\"Hello\");\n};\n\nws.onmessage = function(event) {\n    console.log(\"Message:\", event.data);\n};\n\nws.onclose = function(event) {\n    console.log(\"Disconnected\");\n};\n</code></pre>"},{"location":"guides/websocket/#_2","title":"\u5b9e\u65f6\u6570\u636e\u63a8\u9001","text":""},{"location":"guides/websocket/#_3","title":"\u670d\u52a1\u5668\u7aef","text":"<pre><code>@app.websocket(\"/ws/items\")\nasync def websocket_endpoint(websocket: WebSocket):\n    await websocket.accept()\n    try:\n        while True:\n            # \u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6700\u65b0\u6570\u636e\n            items = db.query(Item).all()\n            await websocket.send_json([item.dict() for item in items])\n            await asyncio.sleep(1)\n    except Exception as e:\n        await websocket.close()\n</code></pre>"},{"location":"guides/websocket/#_4","title":"\u5ba2\u6237\u7aef","text":"<pre><code>ws.onmessage = function(event) {\n    const items = JSON.parse(event.data);\n    console.log(\"Items:\", items);\n};\n</code></pre>"},{"location":"guides/websocket/#_5","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/websocket/#1","title":"1. \u9519\u8bef\u5904\u7406","text":"<pre><code>@app.websocket(\"/ws/items\")\nasync def websocket_endpoint(websocket: WebSocket):\n    try:\n        await websocket.accept()\n        while True:\n            data = await websocket.receive_text()\n            await websocket.send_text(f\"Echo: {data}\")\n    except WebSocketDisconnect:\n        print(\"Client disconnected\")\n    except Exception as e:\n        print(f\"Error: {e}\")\n        await websocket.close()\n</code></pre>"},{"location":"guides/websocket/#2","title":"2. \u8fde\u63a5\u7ba1\u7406","text":"<pre><code>class ConnectionManager:\n    def __init__(self):\n        self.active_connections = []\n\n    async def connect(self, websocket: WebSocket):\n        await websocket.accept()\n        self.active_connections.append(websocket)\n\n    def disconnect(self, websocket: WebSocket):\n        self.active_connections.remove(websocket)\n\n    async def broadcast(self, message: str):\n        for connection in self.active_connections:\n            await connection.send_text(message)\n</code></pre>"},{"location":"guides/websocket/#_6","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"guides/websocket/#q-websocket","title":"Q: \u5982\u4f55\u5904\u7406 WebSocket \u65ad\u5f00\u8fde\u63a5\uff1f","text":"<p>A: \u4f7f\u7528 try-except \u6355\u83b7 WebSocketDisconnect \u5f02\u5e38\u3002</p>"},{"location":"guides/websocket/#q","title":"Q: \u5982\u4f55\u5e7f\u64ad\u6d88\u606f\u7ed9\u6240\u6709\u8fde\u63a5\uff1f","text":"<p>A: \u4f7f\u7528 ConnectionManager \u7ba1\u7406\u6240\u6709\u8fde\u63a5\u3002</p>"},{"location":"guides/websocket/#q-websocket-json","title":"Q: \u5982\u4f55\u5728 WebSocket \u4e2d\u53d1\u9001 JSON \u6570\u636e\uff1f","text":"<p>A: \u4f7f\u7528 <code>websocket.send_json()</code> \u65b9\u6cd5\u3002</p>"},{"location":"reference/api/","title":"API \u53c2\u8003","text":"<p>FastAPI-Easy \u81ea\u52a8\u751f\u6210\u7684 CRUD API \u5b8c\u6574\u53c2\u8003\u3002</p>"},{"location":"reference/api/#crud","title":"\u57fa\u7840 CRUD \u7aef\u70b9","text":""},{"location":"reference/api/#_1","title":"\u83b7\u53d6\u6240\u6709\u8bb0\u5f55","text":"<pre><code>GET /items\n</code></pre> <p>\u53c2\u6570: - <code>skip</code> (int, optional) - \u8df3\u8fc7\u7684\u8bb0\u5f55\u6570\uff0c\u9ed8\u8ba4 0 - <code>limit</code> (int, optional) - \u8fd4\u56de\u7684\u8bb0\u5f55\u6570\uff0c\u9ed8\u8ba4 10\uff0c\u6700\u5927 100 - <code>sort</code> (str, optional) - \u6392\u5e8f\u5b57\u6bb5\uff0c\u683c\u5f0f: <code>field</code> \u6216 <code>-field</code>\uff08\u964d\u5e8f\uff09</p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"items\": [\n    {\"id\": 1, \"name\": \"Item 1\", \"price\": 10.0},\n    {\"id\": 2, \"name\": \"Item 2\", \"price\": 20.0}\n  ],\n  \"total\": 100,\n  \"skip\": 0,\n  \"limit\": 10\n}\n</code></pre></p>"},{"location":"reference/api/#_2","title":"\u83b7\u53d6\u5355\u4e2a\u8bb0\u5f55","text":"<pre><code>GET /items/{id}\n</code></pre> <p>\u53c2\u6570: - <code>id</code> (int, required) - \u8bb0\u5f55 ID</p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"id\": 1,\n  \"name\": \"Item 1\",\n  \"price\": 10.0\n}\n</code></pre></p> <p>\u9519\u8bef (404): <pre><code>{\n  \"detail\": \"Item not found\"\n}\n</code></pre></p>"},{"location":"reference/api/#_3","title":"\u521b\u5efa\u8bb0\u5f55","text":"<pre><code>POST /items\nContent-Type: application/json\n</code></pre> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"name\": \"New Item\",\n  \"price\": 15.0\n}\n</code></pre></p> <p>\u54cd\u5e94 (201): <pre><code>{\n  \"id\": 3,\n  \"name\": \"New Item\",\n  \"price\": 15.0\n}\n</code></pre></p> <p>\u9519\u8bef (422): <pre><code>{\n  \"detail\": [\n    {\n      \"loc\": [\"body\", \"price\"],\n      \"msg\": \"ensure this value is greater than 0\",\n      \"type\": \"value_error.number.not_gt\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"reference/api/#_4","title":"\u66f4\u65b0\u8bb0\u5f55","text":"<pre><code>PUT /items/{id}\nContent-Type: application/json\n</code></pre> <p>\u53c2\u6570: - <code>id</code> (int, required) - \u8bb0\u5f55 ID</p> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"name\": \"Updated Item\",\n  \"price\": 25.0\n}\n</code></pre></p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"id\": 1,\n  \"name\": \"Updated Item\",\n  \"price\": 25.0\n}\n</code></pre></p>"},{"location":"reference/api/#_5","title":"\u5220\u9664\u5355\u4e2a\u8bb0\u5f55","text":"<pre><code>DELETE /items/{id}\n</code></pre> <p>\u53c2\u6570: - <code>id</code> (int, required) - \u8bb0\u5f55 ID</p> <p>\u54cd\u5e94 (204): \u65e0\u5185\u5bb9</p>"},{"location":"reference/api/#_6","title":"\u5220\u9664\u6240\u6709\u8bb0\u5f55","text":"<pre><code>DELETE /items\n</code></pre> <p>\u54cd\u5e94 (204): \u65e0\u5185\u5bb9</p>"},{"location":"reference/api/#api_1","title":"\u8fc7\u6ee4 API","text":""},{"location":"reference/api/#_7","title":"\u8fc7\u6ee4\u64cd\u4f5c\u7b26","text":"\u64cd\u4f5c\u7b26 \u8bf4\u660e \u793a\u4f8b \u65e0 \u7cbe\u786e\u5339\u914d <code>?name=apple</code> <code>__gt</code> \u5927\u4e8e <code>?price__gt=10</code> <code>__gte</code> \u5927\u4e8e\u7b49\u4e8e <code>?price__gte=10</code> <code>__lt</code> \u5c0f\u4e8e <code>?price__lt=20</code> <code>__lte</code> \u5c0f\u4e8e\u7b49\u4e8e <code>?price__lte=20</code> <code>__ne</code> \u4e0d\u7b49\u4e8e <code>?status__ne=inactive</code> <code>__in</code> \u5305\u542b\u5728\u5217\u8868\u4e2d <code>?category__in=fruit,vegetable</code> <code>__contains</code> \u5305\u542b\u5b57\u7b26\u4e32 <code>?name__contains=app</code> <code>__icontains</code> \u4e0d\u533a\u5206\u5927\u5c0f\u5199\u5305\u542b <code>?name__icontains=APPLE</code>"},{"location":"reference/api/#_8","title":"\u8fc7\u6ee4\u793a\u4f8b","text":"<pre><code>GET /items?name=apple&amp;price__gt=10&amp;price__lt=20\n</code></pre>"},{"location":"reference/api/#api_2","title":"\u6392\u5e8f API","text":""},{"location":"reference/api/#_9","title":"\u6392\u5e8f\u8bed\u6cd5","text":"<pre><code>GET /items?sort=name,-price\n</code></pre> <ul> <li><code>sort=field</code> - \u5347\u5e8f</li> <li><code>sort=-field</code> - \u964d\u5e8f</li> <li>\u591a\u5b57\u6bb5\u6392\u5e8f\u7528\u9017\u53f7\u5206\u9694</li> </ul>"},{"location":"reference/api/#_10","title":"\u6392\u5e8f\u793a\u4f8b","text":"<pre><code>GET /items?sort=created_at,-price\n</code></pre>"},{"location":"reference/api/#api_3","title":"\u5206\u9875 API","text":""},{"location":"reference/api/#_11","title":"\u5206\u9875\u53c2\u6570","text":"<pre><code>GET /items?skip=0&amp;limit=10\n</code></pre> <ul> <li><code>skip</code> - \u8df3\u8fc7\u7684\u8bb0\u5f55\u6570</li> <li><code>limit</code> - \u8fd4\u56de\u7684\u8bb0\u5f55\u6570</li> </ul>"},{"location":"reference/api/#_12","title":"\u5206\u9875\u793a\u4f8b","text":"<pre><code># \u7b2c 1 \u9875\nGET /items?skip=0&amp;limit=10\n\n# \u7b2c 2 \u9875\nGET /items?skip=10&amp;limit=10\n\n# \u7b2c 3 \u9875\nGET /items?skip=20&amp;limit=10\n</code></pre>"},{"location":"reference/api/#api_4","title":"\u6279\u91cf\u64cd\u4f5c API","text":""},{"location":"reference/api/#_13","title":"\u6279\u91cf\u521b\u5efa","text":"<pre><code>POST /items/batch\nContent-Type: application/json\n</code></pre> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"items\": [\n    {\"name\": \"Item 1\", \"price\": 10.0},\n    {\"name\": \"Item 2\", \"price\": 20.0},\n    {\"name\": \"Item 3\", \"price\": 30.0}\n  ]\n}\n</code></pre></p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"created\": 3,\n  \"items\": [\n    {\"id\": 1, \"name\": \"Item 1\", \"price\": 10.0},\n    {\"id\": 2, \"name\": \"Item 2\", \"price\": 20.0},\n    {\"id\": 3, \"name\": \"Item 3\", \"price\": 30.0}\n  ]\n}\n</code></pre></p>"},{"location":"reference/api/#_14","title":"\u6279\u91cf\u66f4\u65b0","text":"<pre><code>PUT /items/batch\nContent-Type: application/json\n</code></pre> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"items\": [\n    {\"id\": 1, \"name\": \"Updated 1\", \"price\": 15.0},\n    {\"id\": 2, \"name\": \"Updated 2\", \"price\": 25.0}\n  ]\n}\n</code></pre></p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"updated\": 2,\n  \"items\": [\n    {\"id\": 1, \"name\": \"Updated 1\", \"price\": 15.0},\n    {\"id\": 2, \"name\": \"Updated 2\", \"price\": 25.0}\n  ]\n}\n</code></pre></p>"},{"location":"reference/api/#_15","title":"\u6279\u91cf\u5220\u9664","text":"<pre><code>DELETE /items/batch\nContent-Type: application/json\n</code></pre> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"ids\": [1, 2, 3]\n}\n</code></pre></p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"deleted\": 3\n}\n</code></pre></p>"},{"location":"reference/api/#api_5","title":"\u8f6f\u5220\u9664 API","text":""},{"location":"reference/api/#_16","title":"\u83b7\u53d6\u6240\u6709\u8bb0\u5f55\uff08\u4e0d\u5305\u62ec\u5df2\u5220\u9664\uff09","text":"<pre><code>GET /items\n</code></pre> <p>\u81ea\u52a8\u8fc7\u6ee4\u5df2\u5220\u9664\u7684\u8bb0\u5f55\u3002</p>"},{"location":"reference/api/#_17","title":"\u83b7\u53d6\u6240\u6709\u8bb0\u5f55\uff08\u5305\u62ec\u5df2\u5220\u9664\uff09","text":"<pre><code>GET /items?include_deleted=true\n</code></pre>"},{"location":"reference/api/#_18","title":"\u6062\u590d\u5df2\u5220\u9664\u7684\u8bb0\u5f55","text":"<pre><code>PATCH /items/{id}/restore\n</code></pre> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"id\": 1,\n  \"name\": \"Item 1\",\n  \"price\": 10.0,\n  \"deleted_at\": null\n}\n</code></pre></p>"},{"location":"reference/api/#_19","title":"\u6c38\u4e45\u5220\u9664","text":"<pre><code>DELETE /items/{id}?permanent=true\n</code></pre>"},{"location":"reference/api/#api_6","title":"\u6743\u9650 API","text":""},{"location":"reference/api/#_20","title":"\u83b7\u53d6\u5f53\u524d\u7528\u6237","text":"<pre><code>GET /auth/me\nAuthorization: Bearer {token}\n</code></pre> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"id\": 1,\n  \"username\": \"user\",\n  \"email\": \"user@example.com\",\n  \"permissions\": [\"read\", \"create\"]\n}\n</code></pre></p>"},{"location":"reference/api/#_21","title":"\u767b\u5f55","text":"<pre><code>POST /auth/login\nContent-Type: application/json\n</code></pre> <p>\u8bf7\u6c42\u4f53: <pre><code>{\n  \"username\": \"user\",\n  \"password\": \"password\"\n}\n</code></pre></p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"token_type\": \"bearer\"\n}\n</code></pre></p>"},{"location":"reference/api/#api_7","title":"\u5ba1\u8ba1\u65e5\u5fd7 API","text":""},{"location":"reference/api/#_22","title":"\u83b7\u53d6\u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code>GET /audit-logs\n</code></pre> <p>\u53c2\u6570: - <code>user_id</code> (int, optional) - \u7528\u6237 ID - <code>action</code> (str, optional) - \u64cd\u4f5c\u7c7b\u578b\uff08CREATE, READ, UPDATE, DELETE\uff09 - <code>resource</code> (str, optional) - \u8d44\u6e90\u7c7b\u578b - <code>skip</code> (int, optional) - \u8df3\u8fc7\u7684\u8bb0\u5f55\u6570 - <code>limit</code> (int, optional) - \u8fd4\u56de\u7684\u8bb0\u5f55\u6570</p> <p>\u54cd\u5e94 (200): <pre><code>{\n  \"logs\": [\n    {\n      \"id\": 1,\n      \"user_id\": 1,\n      \"action\": \"CREATE\",\n      \"resource\": \"Item\",\n      \"resource_id\": 1,\n      \"old_values\": null,\n      \"new_values\": {\"name\": \"Item 1\", \"price\": 10.0},\n      \"timestamp\": \"2024-01-01T12:00:00Z\"\n    }\n  ],\n  \"total\": 100\n}\n</code></pre></p>"},{"location":"reference/api/#_23","title":"\u9519\u8bef\u54cd\u5e94","text":""},{"location":"reference/api/#_24","title":"\u5e38\u89c1\u9519\u8bef\u7801","text":"\u72b6\u6001\u7801 \u8bf4\u660e \u793a\u4f8b 200 \u6210\u529f GET, PUT, POST, DELETE \u6210\u529f 201 \u521b\u5efa\u6210\u529f POST \u521b\u5efa\u65b0\u8d44\u6e90 204 \u65e0\u5185\u5bb9 DELETE \u6210\u529f 400 \u8bf7\u6c42\u9519\u8bef \u53c2\u6570\u9a8c\u8bc1\u5931\u8d25 401 \u672a\u8ba4\u8bc1 \u9700\u8981\u767b\u5f55 403 \u65e0\u6743\u9650 \u6743\u9650\u4e0d\u8db3 404 \u672a\u627e\u5230 \u8d44\u6e90\u4e0d\u5b58\u5728 409 \u51b2\u7a81 \u6570\u636e\u51b2\u7a81 422 \u65e0\u6cd5\u5904\u7406 \u6570\u636e\u9a8c\u8bc1\u5931\u8d25 500 \u670d\u52a1\u5668\u9519\u8bef \u6570\u636e\u5e93\u9519\u8bef"},{"location":"reference/api/#_25","title":"\u9519\u8bef\u54cd\u5e94\u683c\u5f0f","text":"<pre><code>{\n  \"detail\": \"Error message\"\n}\n</code></pre>"},{"location":"reference/api/#_26","title":"\u8bf7\u6c42\u5934","text":""},{"location":"reference/api/#_27","title":"\u8ba4\u8bc1","text":"<pre><code>Authorization: Bearer {token}\n</code></pre>"},{"location":"reference/api/#_28","title":"\u5185\u5bb9\u7c7b\u578b","text":"<pre><code>Content-Type: application/json\n</code></pre>"},{"location":"reference/api/#_29","title":"\u81ea\u5b9a\u4e49\u5934","text":"<pre><code>X-Tenant-ID: tenant-123\n</code></pre>"},{"location":"reference/api/#_30","title":"\u54cd\u5e94\u5934","text":""},{"location":"reference/api/#_31","title":"\u5e38\u89c1\u54cd\u5e94\u5934","text":"<pre><code>Content-Type: application/json\nX-Total-Count: 100\nX-Page: 1\nX-Per-Page: 10\n</code></pre>"},{"location":"reference/api/#_32","title":"\u5b8c\u6574\u8bf7\u6c42\u793a\u4f8b","text":""},{"location":"reference/api/#_33","title":"\u521b\u5efa\u3001\u67e5\u8be2\u3001\u66f4\u65b0\u3001\u5220\u9664\u6d41\u7a0b","text":"<pre><code># 1. \u521b\u5efa\u8bb0\u5f55\ncurl -X POST http://localhost:8000/items \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Apple\", \"price\": 10.0}'\n\n# \u54cd\u5e94: {\"id\": 1, \"name\": \"Apple\", \"price\": 10.0}\n\n# 2. \u67e5\u8be2\u8bb0\u5f55\ncurl http://localhost:8000/items/1\n\n# \u54cd\u5e94: {\"id\": 1, \"name\": \"Apple\", \"price\": 10.0}\n\n# 3. \u66f4\u65b0\u8bb0\u5f55\ncurl -X PUT http://localhost:8000/items/1 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Apple\", \"price\": 15.0}'\n\n# \u54cd\u5e94: {\"id\": 1, \"name\": \"Apple\", \"price\": 15.0}\n\n# 4. \u5220\u9664\u8bb0\u5f55\ncurl -X DELETE http://localhost:8000/items/1\n\n# \u54cd\u5e94: 204 No Content\n</code></pre>"},{"location":"reference/api/#_34","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"reference/api/#q","title":"Q: \u5982\u4f55\u8fdb\u884c\u590d\u6742\u67e5\u8be2\uff1f","text":"<p>A: \u7ec4\u5408\u4f7f\u7528\u8fc7\u6ee4\u3001\u6392\u5e8f\u548c\u5206\u9875\u53c2\u6570\u3002</p> <pre><code>GET /items?name__contains=app&amp;price__gte=10&amp;sort=-created_at&amp;skip=0&amp;limit=20\n</code></pre>"},{"location":"reference/api/#q_1","title":"Q: \u5982\u4f55\u5904\u7406\u5927\u6570\u636e\u91cf\uff1f","text":"<p>A: \u4f7f\u7528\u5206\u9875\u548c\u6279\u91cf\u64cd\u4f5c\u3002</p> <pre><code>GET /items?skip=0&amp;limit=1000\nPOST /items/batch\n</code></pre>"},{"location":"reference/api/#q_2","title":"Q: \u5982\u4f55\u83b7\u53d6\u603b\u8bb0\u5f55\u6570\uff1f","text":"<p>A: \u54cd\u5e94\u4e2d\u5305\u542b <code>total</code> \u5b57\u6bb5\u3002</p> <pre><code>{\n  \"items\": [...],\n  \"total\": 1000,\n  \"skip\": 0,\n  \"limit\": 10\n}\n</code></pre>"},{"location":"reference/api/#q_3","title":"Q: \u5982\u4f55\u5904\u7406\u65f6\u95f4\u6233\uff1f","text":"<p>A: \u4f7f\u7528 ISO 8601 \u683c\u5f0f\u3002</p> <pre><code>{\n  \"created_at\": \"2024-01-01T12:00:00Z\",\n  \"updated_at\": \"2024-01-01T13:00:00Z\"\n}\n</code></pre>"},{"location":"reference/architecture/","title":"\u67b6\u6784\u8bbe\u8ba1","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd FastAPI-Easy \u7684\u6574\u4f53\u67b6\u6784\u8bbe\u8ba1\u3002</p>"},{"location":"reference/architecture/#_2","title":"\u6838\u5fc3\u67b6\u6784","text":"<p>FastAPI-Easy \u91c7\u7528\u5206\u5c42\u67b6\u6784\u8bbe\u8ba1\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FastAPI \u5e94\u7528                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         CRUDRouter \u5c42                \u2502\n\u2502  (\u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531)                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         \u4e2d\u95f4\u4ef6\u5c42                      \u2502\n\u2502  (\u8ba4\u8bc1\u3001\u6743\u9650\u3001\u901f\u7387\u9650\u5236\u7b49)             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         \u4e1a\u52a1\u903b\u8f91\u5c42                    \u2502\n\u2502  (Hook\u3001\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875\u7b49)           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         \u9002\u914d\u5668\u5c42                      \u2502\n\u2502  (ORM \u9002\u914d\u5668\u63a5\u53e3)                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         \u6570\u636e\u5e93\u5c42                      \u2502\n\u2502  (SQLAlchemy\u3001Tortoise\u3001MongoDB\u7b49)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/architecture/#_3","title":"\u7ec4\u4ef6\u8bbe\u8ba1","text":""},{"location":"reference/architecture/#1-crudrouter","title":"1. CRUDRouter","text":"<p>\u4e3b\u8981\u804c\u8d23\uff1a - \u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531 - \u7ba1\u7406\u8def\u7531\u914d\u7f6e - \u96c6\u6210\u4e2d\u95f4\u4ef6\u548c Hook</p> <pre><code>class CRUDRouter:\n    def __init__(self, schema, adapter, **config):\n        self.schema = schema\n        self.adapter = adapter\n        self.config = config\n        self._setup_routes()\n</code></pre>"},{"location":"reference/architecture/#2-ormadapter","title":"2. ORMAdapter","text":"<p>\u62bd\u8c61\u57fa\u7c7b\uff0c\u5b9a\u4e49 ORM \u64cd\u4f5c\u63a5\u53e3\uff1a</p> <pre><code>class ORMAdapter(ABC):\n    @abstractmethod\n    async def get_all(self, **filters) -&gt; List:\n        pass\n\n    @abstractmethod\n    async def get_one(self, id) -&gt; Optional:\n        pass\n\n    @abstractmethod\n    async def create(self, data) -&gt; Any:\n        pass\n\n    @abstractmethod\n    async def update(self, id, data) -&gt; Any:\n        pass\n\n    @abstractmethod\n    async def delete(self, id) -&gt; bool:\n        pass\n</code></pre>"},{"location":"reference/architecture/#3-hook","title":"3. Hook \u7cfb\u7edf","text":"<p>\u652f\u6301 10 \u79cd Hook \u4e8b\u4ef6\uff1a</p> <pre><code>class HookRegistry:\n    def register(self, event: str, callback: Callable):\n        pass\n\n    async def trigger(self, event: str, *args, **kwargs):\n        pass\n</code></pre> <p>Hook \u4e8b\u4ef6\uff1a - before_get_all / after_get_all - before_get_one / after_get_one - before_create / after_create - before_update / after_update - before_delete / after_delete</p>"},{"location":"reference/architecture/#4","title":"4. \u914d\u7f6e\u7cfb\u7edf","text":"<pre><code>@dataclass\nclass CRUDConfig:\n    enable_filters: bool = True\n    enable_sorters: bool = True\n    enable_pagination: bool = True\n    enable_soft_delete: bool = False\n    enable_audit: bool = False\n    enable_bulk_operations: bool = False\n    filter_fields: List[str] = None\n    sort_fields: List[str] = None\n    default_limit: int = 10\n    max_limit: int = 100\n</code></pre>"},{"location":"reference/architecture/#_4","title":"\u6570\u636e\u6d41","text":""},{"location":"reference/architecture/#_5","title":"\u8bf7\u6c42\u5904\u7406\u6d41\u7a0b","text":"<pre><code>1. \u5ba2\u6237\u7aef\u53d1\u9001 HTTP \u8bf7\u6c42\n   \u2193\n2. FastAPI \u8def\u7531\u5339\u914d\n   \u2193\n3. \u4e2d\u95f4\u4ef6\u5904\u7406\uff08\u8ba4\u8bc1\u3001\u6743\u9650\u7b49\uff09\n   \u2193\n4. CRUDRouter \u5904\u7406\n   \u2193\n5. \u89e6\u53d1 before_* Hook\n   \u2193\n6. \u4e1a\u52a1\u903b\u8f91\u5904\u7406\uff08\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875\uff09\n   \u2193\n7. \u8c03\u7528 ORM \u9002\u914d\u5668\n   \u2193\n8. \u6570\u636e\u5e93\u67e5\u8be2\n   \u2193\n9. \u89e6\u53d1 after_* Hook\n   \u2193\n10. \u8fd4\u56de\u54cd\u5e94\n</code></pre>"},{"location":"reference/architecture/#_6","title":"\u6570\u636e\u8f6c\u6362\u6d41\u7a0b","text":"<pre><code>HTTP Request\n    \u2193\nPydantic Schema \u9a8c\u8bc1\n    \u2193\n\u4e1a\u52a1\u903b\u8f91\u5904\u7406\n    \u2193\nORM \u6a21\u578b\u8f6c\u6362\n    \u2193\n\u6570\u636e\u5e93\u64cd\u4f5c\n    \u2193\nORM \u6a21\u578b\u8f6c\u6362\n    \u2193\nPydantic Schema \u5e8f\u5217\u5316\n    \u2193\nHTTP Response\n</code></pre>"},{"location":"reference/architecture/#_7","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"reference/architecture/#1","title":"1. \u9002\u914d\u5668\u6a21\u5f0f","text":"<p>\u4f7f\u7528 ORMAdapter \u62bd\u8c61\u4e0d\u540c ORM \u7684\u5dee\u5f02\uff1a</p> <pre><code># SQLAlchemy \u9002\u914d\u5668\nclass SQLAlchemyAdapter(ORMAdapter):\n    async def get_all(self, **filters):\n        query = self.session.query(self.model)\n        for key, value in filters.items():\n            query = query.filter(getattr(self.model, key) == value)\n        return await query.all()\n\n# MongoDB \u9002\u914d\u5668\nclass MongoAdapter(ORMAdapter):\n    async def get_all(self, **filters):\n        return await self.collection.find(filters).to_list(None)\n</code></pre>"},{"location":"reference/architecture/#2-hook","title":"2. Hook \u6a21\u5f0f","text":"<p>\u652f\u6301\u5728\u5173\u952e\u70b9\u63d2\u5165\u81ea\u5b9a\u4e49\u903b\u8f91\uff1a</p> <pre><code>@migration_hook(\"before_create\")\nasync def validate_before_create(data):\n    # \u81ea\u5b9a\u4e49\u9a8c\u8bc1\u903b\u8f91\n    pass\n\n@migration_hook(\"after_create\", priority=10)\nasync def log_after_create(data):\n    # \u81ea\u5b9a\u4e49\u65e5\u5fd7\u903b\u8f91\n    pass\n</code></pre>"},{"location":"reference/architecture/#3","title":"3. \u4e2d\u95f4\u4ef6\u6a21\u5f0f","text":"<p>\u4f7f\u7528\u4e2d\u95f4\u4ef6\u5904\u7406\u6a2a\u5207\u5173\u6ce8\u70b9\uff1a</p> <pre><code>app.add_middleware(AuthenticationMiddleware)\napp.add_middleware(PermissionMiddleware)\napp.add_middleware(RateLimitMiddleware)\n</code></pre>"},{"location":"reference/architecture/#_8","title":"\u6269\u5c55\u70b9","text":""},{"location":"reference/architecture/#1_1","title":"1. \u81ea\u5b9a\u4e49\u9002\u914d\u5668","text":"<pre><code>class CustomAdapter(ORMAdapter):\n    async def get_all(self, **filters):\n        # \u81ea\u5b9a\u4e49\u5b9e\u73b0\n        pass\n</code></pre>"},{"location":"reference/architecture/#2-hook_1","title":"2. \u81ea\u5b9a\u4e49 Hook","text":"<pre><code>@migration_hook(\"before_create\")\nasync def custom_hook(data):\n    # \u81ea\u5b9a\u4e49\u903b\u8f91\n    pass\n</code></pre>"},{"location":"reference/architecture/#3_1","title":"3. \u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6","text":"<pre><code>class CustomMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        # \u81ea\u5b9a\u4e49\u903b\u8f91\n        response = await call_next(request)\n        return response\n</code></pre>"},{"location":"reference/architecture/#_9","title":"\u6027\u80fd\u8003\u8651","text":""},{"location":"reference/architecture/#1_2","title":"1. \u7f13\u5b58","text":"<ul> <li>\u67e5\u8be2\u7ed3\u679c\u7f13\u5b58</li> <li>\u6743\u9650\u7f13\u5b58</li> <li>Schema \u7f13\u5b58</li> </ul>"},{"location":"reference/architecture/#2","title":"2. \u5f02\u6b65","text":"<ul> <li>\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u90fd\u662f\u5f02\u6b65\u7684</li> <li>\u652f\u6301\u5e76\u53d1\u8bf7\u6c42</li> </ul>"},{"location":"reference/architecture/#3_2","title":"3. \u6279\u91cf\u64cd\u4f5c","text":"<ul> <li>\u652f\u6301\u6279\u91cf\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664</li> <li>\u51cf\u5c11\u6570\u636e\u5e93\u5f80\u8fd4\u6b21\u6570</li> </ul>"},{"location":"reference/architecture/#_10","title":"\u5b89\u5168\u8003\u8651","text":""},{"location":"reference/architecture/#1_3","title":"1. \u8f93\u5165\u9a8c\u8bc1","text":"<ul> <li>Pydantic Schema \u81ea\u52a8\u9a8c\u8bc1</li> <li>\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5668\u652f\u6301</li> </ul>"},{"location":"reference/architecture/#2_1","title":"2. \u6743\u9650\u63a7\u5236","text":"<ul> <li>\u7aef\u70b9\u7ea7\u6743\u9650</li> <li>\u5b57\u6bb5\u7ea7\u6743\u9650</li> </ul>"},{"location":"reference/architecture/#3_3","title":"3. \u5ba1\u8ba1\u65e5\u5fd7","text":"<ul> <li>\u81ea\u52a8\u8bb0\u5f55\u6240\u6709\u64cd\u4f5c</li> <li>\u652f\u6301\u8ffd\u8e2a\u6570\u636e\u53d8\u66f4</li> </ul>"},{"location":"reference/cli/","title":"CLI \u5de5\u5177","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5feb\u901f\u521d\u59cb\u5316\u9879\u76ee\u3001\u751f\u6210\u4ee3\u7801\u548c\u7ba1\u7406\u5e94\u7528\u3002</p>"},{"location":"reference/cli/#cli_1","title":"\u4ec0\u4e48\u662f CLI \u5de5\u5177\uff1f","text":"<p>CLI\uff08Command Line Interface\uff09\u5de5\u5177\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u2705 \u9879\u76ee\u521d\u59cb\u5316 - \u5feb\u901f\u521b\u5efa\u65b0\u9879\u76ee</li> <li>\u2705 \u4ee3\u7801\u751f\u6210 - \u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531</li> <li>\u2705 \u9879\u76ee\u7ba1\u7406 - \u7ba1\u7406\u9879\u76ee\u914d\u7f6e\u548c\u4f9d\u8d56</li> <li>\u2705 \u7248\u672c\u7ba1\u7406 - \u67e5\u770b\u7248\u672c\u4fe1\u606f</li> </ul>"},{"location":"reference/cli/#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install fastapi-easy[cli]\n</code></pre>"},{"location":"reference/cli/#_2","title":"\u57fa\u7840\u547d\u4ee4","text":""},{"location":"reference/cli/#1","title":"1. \u67e5\u770b\u5e2e\u52a9","text":"<pre><code># \u67e5\u770b\u6240\u6709\u547d\u4ee4\nfastapi-easy --help\n\n# \u67e5\u770b\u7279\u5b9a\u547d\u4ee4\u5e2e\u52a9\nfastapi-easy init --help\nfastapi-easy generate --help\n</code></pre>"},{"location":"reference/cli/#2","title":"2. \u67e5\u770b\u7248\u672c","text":"<pre><code>fastapi-easy --version\n</code></pre>"},{"location":"reference/cli/#_3","title":"\u9879\u76ee\u521d\u59cb\u5316","text":""},{"location":"reference/cli/#_4","title":"\u57fa\u7840\u7528\u6cd5","text":"<pre><code># \u521b\u5efa\u65b0\u9879\u76ee\nfastapi-easy init --name my_project\n\n# \u5728\u6307\u5b9a\u8def\u5f84\u521b\u5efa\u9879\u76ee\nfastapi-easy init --name my_project --path ./projects\n</code></pre>"},{"location":"reference/cli/#_5","title":"\u4ea4\u4e92\u5f0f\u521d\u59cb\u5316","text":"<pre><code>fastapi-easy init\n\n# \u8f93\u5165\u9879\u76ee\u540d\u79f0\nProject name: my_app\n\n# \u9879\u76ee\u521b\u5efa\u5b8c\u6210\n\u2705 Project 'my_app' created successfully at ./my_app\n</code></pre>"},{"location":"reference/cli/#_6","title":"\u751f\u6210\u7684\u9879\u76ee\u7ed3\u6784","text":"<pre><code>my_project/\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 main.py              # FastAPI \u5e94\u7528\u5165\u53e3\n\u251c\u2500\u2500 tests/\n\u2502   \u2514\u2500\u2500 __init__.py          # \u6d4b\u8bd5\u76ee\u5f55\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 __init__.py          # \u6587\u6863\u76ee\u5f55\n\u251c\u2500\u2500 requirements.txt         # \u4f9d\u8d56\u5217\u8868\n\u2514\u2500\u2500 README.md               # \u9879\u76ee\u8bf4\u660e\n</code></pre>"},{"location":"reference/cli/#_7","title":"\u751f\u6210\u7684\u6587\u4ef6\u5185\u5bb9","text":"<p>src/main.py: <pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\n\napp = FastAPI()\n\n# Your routes here\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre></p> <p>requirements.txt: <pre><code>fastapi&gt;=0.100.0\nfastapi-easy&gt;=1.0.0\nsqlalchemy&gt;=2.0.0\nuvicorn&gt;=0.23.0\npydantic&gt;=2.0.0\n</code></pre></p>"},{"location":"reference/cli/#_8","title":"\u4ee3\u7801\u751f\u6210","text":""},{"location":"reference/cli/#_9","title":"\u57fa\u7840\u7528\u6cd5","text":"<pre><code># \u751f\u6210 CRUD \u8def\u7531\nfastapi-easy generate --model Item --fields \"name:str,price:float,description:str\"\n</code></pre>"},{"location":"reference/cli/#_10","title":"\u4ea4\u4e92\u5f0f\u751f\u6210","text":"<pre><code>fastapi-easy generate\n\n# \u8f93\u5165\u6a21\u578b\u540d\u79f0\nModel name: Product\n\n# \u8f93\u5165\u5b57\u6bb5\uff08\u9017\u53f7\u5206\u9694\uff09\nFields (comma-separated): name, price, stock, category\n\n# \u751f\u6210\u5b8c\u6210\n\u2705 CRUD router generated for model 'Product'\n</code></pre>"},{"location":"reference/cli/#_11","title":"\u751f\u6210\u7684\u4ee3\u7801","text":"<pre><code>from pydantic import BaseModel, ConfigDict\nfrom typing import Optional\n\nclass Item(BaseModel):\n    id: Optional[int] = None\n    name: str\n    price: float\n    description: str\n\n    model_config = ConfigDict(from_attributes=True)\n\n# CRUD Router\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAsyncBackend\n\nrouter = CRUDRouter(\n    schema=Item,\n    backend=backend,\n    prefix=\"/items\",\n    tags=[\"items\"]\n)\n</code></pre>"},{"location":"reference/cli/#_12","title":"\u5b8c\u6574\u5de5\u4f5c\u6d41","text":""},{"location":"reference/cli/#1_1","title":"1. \u521b\u5efa\u9879\u76ee","text":"<pre><code>fastapi-easy init --name ecommerce_api\ncd ecommerce_api\n</code></pre>"},{"location":"reference/cli/#2_1","title":"2. \u751f\u6210\u6a21\u578b","text":"<pre><code># \u751f\u6210 Product \u6a21\u578b\nfastapi-easy generate --model Product --fields \"name,price,stock,category\"\n\n# \u751f\u6210 Order \u6a21\u578b\nfastapi-easy generate --model Order --fields \"product_id,quantity,total_price,status\"\n\n# \u751f\u6210 User \u6a21\u578b\nfastapi-easy generate --model User --fields \"username,email,password,role\"\n</code></pre>"},{"location":"reference/cli/#3","title":"3. \u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install -r requirements.txt\n</code></pre>"},{"location":"reference/cli/#4","title":"4. \u8fd0\u884c\u5e94\u7528","text":"<pre><code>python src/main.py\n\n# \u8f93\u51fa\uff1a\n# INFO:     Uvicorn running on http://0.0.0.0:8000\n# INFO:     Application startup complete\n</code></pre>"},{"location":"reference/cli/#5-api","title":"5. \u8bbf\u95ee API","text":"<pre><code># \u67e5\u770b API \u6587\u6863\ncurl http://localhost:8000/docs\n\n# \u521b\u5efa\u9879\u76ee\ncurl -X POST http://localhost:8000/items \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Apple\", \"price\": 1.5, \"description\": \"Fresh apple\"}'\n\n# \u83b7\u53d6\u6240\u6709\u9879\u76ee\ncurl http://localhost:8000/items\n\n# \u83b7\u53d6\u5355\u4e2a\u9879\u76ee\ncurl http://localhost:8000/items/1\n\n# \u66f4\u65b0\u9879\u76ee\ncurl -X PUT http://localhost:8000/items/1 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Red Apple\", \"price\": 2.0}'\n\n# \u5220\u9664\u9879\u76ee\ncurl -X DELETE http://localhost:8000/items/1\n</code></pre>"},{"location":"reference/cli/#_13","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"reference/cli/#1_2","title":"1. \u81ea\u5b9a\u4e49\u9879\u76ee\u6a21\u677f","text":"<pre><code># \u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u677f\u521b\u5efa\u9879\u76ee\nfastapi-easy init --name my_project --template advanced\n</code></pre>"},{"location":"reference/cli/#2_2","title":"2. \u751f\u6210\u591a\u4e2a\u6a21\u578b","text":"<pre><code># \u521b\u5efa\u811a\u672c generate_models.sh\n#!/bin/bash\n\nfastapi-easy generate --model User --fields \"username,email,password\"\nfastapi-easy generate --model Post --fields \"title,content,author_id\"\nfastapi-easy generate --model Comment --fields \"text,post_id,author_id\"\n\n# \u8fd0\u884c\u811a\u672c\nchmod +x generate_models.sh\n./generate_models.sh\n</code></pre>"},{"location":"reference/cli/#3_1","title":"3. \u914d\u7f6e\u7ba1\u7406","text":"<pre><code># \u67e5\u770b\u914d\u7f6e\nfastapi-easy config --show\n\n# \u8bbe\u7f6e\u914d\u7f6e\nfastapi-easy config --set database_url \"postgresql://user:pass@localhost/db\"\n\n# \u91cd\u7f6e\u914d\u7f6e\nfastapi-easy config --reset\n</code></pre>"},{"location":"reference/cli/#_14","title":"\u5e38\u7528\u547d\u4ee4\u53c2\u8003","text":"\u547d\u4ee4 \u8bf4\u660e \u793a\u4f8b <code>init</code> \u521d\u59cb\u5316\u9879\u76ee <code>fastapi-easy init --name my_app</code> <code>generate</code> \u751f\u6210 CRUD \u8def\u7531 <code>fastapi-easy generate --model Item --fields \"name,price\"</code> <code>config</code> \u7ba1\u7406\u914d\u7f6e <code>fastapi-easy config --show</code> <code>--version</code> \u663e\u793a\u7248\u672c <code>fastapi-easy --version</code> <code>--help</code> \u663e\u793a\u5e2e\u52a9 <code>fastapi-easy --help</code>"},{"location":"reference/cli/#_15","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"reference/cli/#1_3","title":"1. \u4f7f\u7528\u7248\u672c\u63a7\u5236","text":"<pre><code># \u521d\u59cb\u5316 Git \u4ed3\u5e93\ncd my_project\ngit init\n\n# \u6dfb\u52a0 .gitignore\necho \"*.pyc\" &gt;&gt; .gitignore\necho \"__pycache__/\" &gt;&gt; .gitignore\necho \".env\" &gt;&gt; .gitignore\necho \"venv/\" &gt;&gt; .gitignore\n\n# \u63d0\u4ea4\u521d\u59cb\u4ee3\u7801\ngit add .\ngit commit -m \"Initial commit\"\n</code></pre>"},{"location":"reference/cli/#2_3","title":"2. \u865a\u62df\u73af\u5883\u7ba1\u7406","text":"<pre><code># \u521b\u5efa\u865a\u62df\u73af\u5883\npython -m venv venv\n\n# \u6fc0\u6d3b\u865a\u62df\u73af\u5883\n# Linux/Mac:\nsource venv/bin/activate\n# Windows:\nvenv\\Scripts\\activate\n\n# \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\n</code></pre>"},{"location":"reference/cli/#3_2","title":"3. \u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<pre><code># \u521b\u5efa .env \u6587\u4ef6\necho \"DATABASE_URL=sqlite:///./test.db\" &gt; .env\necho \"DEBUG=True\" &gt;&gt; .env\n\n# \u5728\u5e94\u7528\u4e2d\u4f7f\u7528\nfrom dotenv import load_dotenv\nimport os\n\nload_dotenv()\ndatabase_url = os.getenv(\"DATABASE_URL\")\n</code></pre>"},{"location":"reference/cli/#_16","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u5982\u4f55\u66f4\u65b0 fastapi-easy\uff1f</p> <p>A: \u4f7f\u7528 pip \u66f4\u65b0\uff1a <pre><code>pip install --upgrade fastapi-easy\n</code></pre></p> <p>Q: \u5982\u4f55\u5378\u8f7d CLI \u5de5\u5177\uff1f</p> <p>A: \u4f7f\u7528 pip \u5378\u8f7d\uff1a <pre><code>pip uninstall fastapi-easy\n</code></pre></p> <p>Q: \u5982\u4f55\u81ea\u5b9a\u4e49\u751f\u6210\u7684\u4ee3\u7801\uff1f</p> <p>A: \u7f16\u8f91\u751f\u6210\u7684\u6587\u4ef6\u6216\u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u677f\u3002</p> <p>Q: \u5982\u4f55\u5728 CI/CD \u4e2d\u4f7f\u7528 CLI\uff1f</p> <p>A: \u5728 CI/CD \u811a\u672c\u4e2d\u8c03\u7528 CLI \u547d\u4ee4\uff1a <pre><code>#!/bin/bash\nfastapi-easy init --name my_app\ncd my_app\npip install -r requirements.txt\npython -m pytest\n</code></pre></p>"},{"location":"reference/cli/#_17","title":"\u811a\u672c\u793a\u4f8b","text":""},{"location":"reference/cli/#_18","title":"\u5feb\u901f\u542f\u52a8\u811a\u672c","text":"<p>start.sh: <pre><code>#!/bin/bash\n\n# \u521b\u5efa\u865a\u62df\u73af\u5883\npython -m venv venv\n\n# \u6fc0\u6d3b\u865a\u62df\u73af\u5883\nsource venv/bin/activate\n\n# \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\n\n# \u8fd0\u884c\u5e94\u7528\npython src/main.py\n</code></pre></p>"},{"location":"reference/cli/#_19","title":"\u9879\u76ee\u751f\u6210\u811a\u672c","text":"<p>setup_project.sh: <pre><code>#!/bin/bash\n\nPROJECT_NAME=$1\n\n# \u521b\u5efa\u9879\u76ee\nfastapi-easy init --name $PROJECT_NAME\n\n# \u8fdb\u5165\u9879\u76ee\u76ee\u5f55\ncd $PROJECT_NAME\n\n# \u751f\u6210\u5e38\u7528\u6a21\u578b\nfastapi-easy generate --model User --fields \"username,email,password\"\nfastapi-easy generate --model Post --fields \"title,content,author_id\"\n\n# \u521d\u59cb\u5316 Git\ngit init\ngit add .\ngit commit -m \"Initial commit\"\n\necho \"\u2705 Project '$PROJECT_NAME' setup complete!\"\n</code></pre></p> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a <pre><code>chmod +x setup_project.sh\n./setup_project.sh my_app\n</code></pre></p>"},{"location":"reference/cli/#_20","title":"\u76f8\u5173\u8d44\u6e90","text":"<ul> <li>Click \u6587\u6863</li> <li>FastAPI \u5b98\u65b9\u6587\u6863</li> <li>Python \u865a\u62df\u73af\u5883</li> </ul> <p>\u5b8c\u6210\uff01 \u6240\u6709\u6269\u5c55\u529f\u80fd\u6587\u6863\u5df2\u7f16\u5199\u3002</p>"},{"location":"reference/configuration/","title":"\u914d\u7f6e\u53c2\u8003\u624b\u518c","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd\u4e86 <code>CRUDConfig</code> \u7c7b\u7684\u6240\u6709\u53ef\u7528\u914d\u7f6e\u9879\u3002</p>"},{"location":"reference/configuration/#_2","title":"\u57fa\u7840\u7528\u6cd5","text":"<p>\u914d\u7f6e\u53ef\u4ee5\u901a\u8fc7 <code>CRUDRouter</code> \u7684 <code>config</code> \u53c2\u6570\u4f20\u9012\uff0c\u6216\u8005\u76f4\u63a5\u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u4f20\u9012\uff08\u90e8\u5206\u652f\u6301\uff0c\u5efa\u8bae\u4f7f\u7528 <code>CRUDConfig</code> \u5bf9\u8c61\uff09\u3002</p> <pre><code>from fastapi_easy import CRUDRouter, CRUDConfig\n\nconfig = CRUDConfig(\n    enable_filters=True,\n    default_limit=20\n)\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    config=config\n)\n</code></pre>"},{"location":"reference/configuration/#crudconfig","title":"CRUDConfig \u53c2\u6570\u8be6\u89e3","text":""},{"location":"reference/configuration/#feature-toggles","title":"\u529f\u80fd\u5f00\u5173 (Feature Toggles)","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>enable_filters</code> <code>bool</code> <code>True</code> \u662f\u5426\u542f\u7528\u641c\u7d22\u548c\u8fc7\u6ee4\u529f\u80fd <code>enable_sorters</code> <code>bool</code> <code>True</code> \u662f\u5426\u542f\u7528\u6392\u5e8f\u529f\u80fd <code>enable_pagination</code> <code>bool</code> <code>True</code> \u662f\u5426\u542f\u7528\u5206\u9875\u529f\u80fd <code>enable_soft_delete</code> <code>bool</code> <code>False</code> \u662f\u5426\u542f\u7528\u8f6f\u5220\u9664\uff08\u903b\u8f91\u5220\u9664\uff09 <code>enable_audit</code> <code>bool</code> <code>False</code> \u662f\u5426\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\uff08\u9700\u914d\u5408 Adapter \u652f\u6301\uff09 <code>enable_bulk_operations</code> <code>bool</code> <code>False</code> \u662f\u5426\u542f\u7528\u6279\u91cf\u64cd\u4f5c API <code>enable_delete_all</code> <code>bool</code> <code>False</code> \u662f\u5426\u542f\u7528\"\u5220\u9664\u6240\u6709\" API (\u5371\u9669\u64cd\u4f5c)"},{"location":"reference/configuration/#filtering-sorting","title":"\u8fc7\u6ee4\u4e0e\u6392\u5e8f (Filtering &amp; Sorting)","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>filter_fields</code> <code>List[str]</code> <code>None</code> \u5141\u8bb8\u8fc7\u6ee4\u7684\u5b57\u6bb5\u5217\u8868\u3002\u5982\u679c\u4e3a <code>None</code>\uff0c\u5219\u4e0d\u9650\u5236\uff08\u4e0d\u63a8\u8350\uff09\u3002 <code>sort_fields</code> <code>List[str]</code> <code>None</code> \u5141\u8bb8\u6392\u5e8f\u7684\u5b57\u6bb5\u5217\u8868\u3002\u5982\u679c\u4e3a <code>None</code>\uff0c\u5219\u4e0d\u9650\u5236\u3002 <code>default_sort</code> <code>str</code> <code>None</code> \u9ed8\u8ba4\u6392\u5e8f\u5b57\u6bb5\uff08\u5982 <code>\"-created_at\"</code>\uff09\u3002"},{"location":"reference/configuration/#pagination","title":"\u5206\u9875 (Pagination)","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>default_limit</code> <code>int</code> <code>10</code> \u9ed8\u8ba4\u6bcf\u9875\u663e\u793a\u7684\u8bb0\u5f55\u6570\u3002 <code>max_limit</code> <code>int</code> <code>100</code> \u5141\u8bb8\u7684\u6700\u5927\u6bcf\u9875\u8bb0\u5f55\u6570\uff08\u9632\u6b62\u6076\u610f\u8bf7\u6c42\uff09\u3002"},{"location":"reference/configuration/#soft-delete","title":"\u8f6f\u5220\u9664 (Soft Delete)","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>deleted_at_field</code> <code>str</code> <code>\"deleted_at\"</code> \u6570\u636e\u5e93\u4e2d\u7528\u4e8e\u6807\u8bb0\u5220\u9664\u65f6\u95f4\u7684\u5b57\u6bb5\u540d\u3002"},{"location":"reference/configuration/#error-handling-logging","title":"\u9519\u8bef\u5904\u7406\u4e0e\u65e5\u5fd7 (Error Handling &amp; Logging)","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>include_error_details</code> <code>bool</code> <code>True</code> \u662f\u5426\u5728 API \u9519\u8bef\u54cd\u5e94\u4e2d\u5305\u542b\u8be6\u7ec6\u8c03\u8bd5\u4fe1\u606f\u3002 <code>log_errors</code> <code>bool</code> <code>True</code> \u662f\u5426\u5c06\u9519\u8bef\u8bb0\u5f55\u5230\u7cfb\u7edf\u65e5\u5fd7\u3002"},{"location":"reference/configuration/#_3","title":"\u5176\u4ed6","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>metadata</code> <code>Dict</code> <code>{}</code> \u7528\u4e8e\u5b58\u50a8\u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7684\u5b57\u5178\uff0c\u53ef\u5728\u94a9\u5b50\u4e2d\u8bbf\u95ee\u3002"},{"location":"reference/configuration/#_4","title":"\u52a8\u6001\u66f4\u65b0\u914d\u7f6e","text":"<p>\u4f60\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u66f4\u65b0\u914d\u7f6e\uff1a</p> <pre><code>router.update_config(default_limit=50, enable_delete_all=True)\n</code></pre> <p>\u6216\u8005\u83b7\u53d6\u5f53\u524d\u914d\u7f6e\uff1a</p> <pre><code>current_config = router.get_config()\nprint(current_config.default_limit)\n</code></pre>"},{"location":"reference/data-flow/","title":"\u6570\u636e\u5230 API \u7684\u5b8c\u6574\u6d41\u7a0b","text":""},{"location":"reference/data-flow/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u89e3\u91ca\u4ece\u6570\u636e\u5e93\u5230 API \u7684\u5b8c\u6574\u6d41\u7a0b\uff0c\u4ee5\u53ca\u4e2d\u95f4\u4f7f\u7528\u7684\u4f9d\u8d56\u5e93\u3002</p>"},{"location":"reference/data-flow/#_2","title":"\u5b8c\u6574\u6d41\u7a0b\u56fe","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u7528\u6237\u8bf7\u6c42                                \u2502\n\u2502                   (HTTP Request)                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    FastAPI \u6846\u67b6                              \u2502\n\u2502  (\u63a5\u6536\u8bf7\u6c42\u3001\u8def\u7531\u5339\u914d\u3001\u53c2\u6570\u9a8c\u8bc1)                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  fastapi-easy \u8def\u7531                           \u2502\n\u2502  (CRUDRouter \u5904\u7406\u8bf7\u6c42\u3001\u8c03\u7528\u540e\u7aef)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u540e\u7aef\u9002\u914d\u5668                                 \u2502\n\u2502  (SQLAlchemyAdapter / TortoiseAdapter / ...)           \u2502\n\u2502  (\u6784\u5efa\u67e5\u8be2\u3001\u5e94\u7528\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ORM \u5c42                                    \u2502\n\u2502  (SQLAlchemy / Tortoise / Gino / ...)                       \u2502\n\u2502  (\u751f\u6210 SQL\u3001\u6267\u884c\u67e5\u8be2)                                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u6570\u636e\u5e93\u9a71\u52a8                                 \u2502\n\u2502  (asyncpg / aiosqlite / ...)                                \u2502\n\u2502  (\u5f02\u6b65\u6267\u884c SQL)                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u6570\u636e\u5e93                                    \u2502\n\u2502  (PostgreSQL / SQLite / MySQL / ...)                        \u2502\n\u2502  (\u5b58\u50a8\u548c\u68c0\u7d22\u6570\u636e)                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u6570\u636e\u8fd4\u56de                                   \u2502\n\u2502  (ORM \u5bf9\u8c61 \u2192 Pydantic Schema \u2192 JSON)                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   HTTP \u54cd\u5e94                                  \u2502\n\u2502  (JSON \u683c\u5f0f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef)                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/data-flow/#_3","title":"\u8be6\u7ec6\u6b65\u9aa4\u8bf4\u660e","text":""},{"location":"reference/data-flow/#1-http","title":"\u6b65\u9aa4 1: \u7528\u6237\u53d1\u9001 HTTP \u8bf7\u6c42","text":"<pre><code>GET /items?name=apple&amp;price__gt=10&amp;sort=-created_at&amp;skip=0&amp;limit=10\n</code></pre> <p>\u8bf7\u6c42\u5305\u542b: - \u8def\u5f84: <code>/items</code> - \u67e5\u8be2\u53c2\u6570: <code>name=apple</code>, <code>price__gt=10</code>, <code>sort=-created_at</code>, <code>skip=0</code>, <code>limit=10</code></p>"},{"location":"reference/data-flow/#2-fastapi","title":"\u6b65\u9aa4 2: FastAPI \u63a5\u6536\u8bf7\u6c42","text":"<p>\u4f9d\u8d56\u5e93: <code>fastapi</code></p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n# FastAPI \u505a\u7684\u4e8b\uff1a\n# 1. \u8def\u7531\u5339\u914d (GET /items)\n# 2. \u53c2\u6570\u63d0\u53d6 (name, price__gt, sort, skip, limit)\n# 3. \u7c7b\u578b\u9a8c\u8bc1 (\u786e\u4fdd\u53c2\u6570\u7c7b\u578b\u6b63\u786e)\n</code></pre>"},{"location":"reference/data-flow/#3-fastapi-easy","title":"\u6b65\u9aa4 3: fastapi-easy \u8def\u7531\u5904\u7406","text":"<p>\u4f9d\u8d56\u5e93: <code>fastapi-easy</code></p> <pre><code>from fastapi_easy import CRUDRouter\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    enable_filters=True,\n    filter_fields=[\"name\", \"price\"],\n    enable_sorters=True,\n    sort_fields=[\"name\", \"created_at\"]\n)\n\n# CRUDRouter \u505a\u7684\u4e8b\uff1a\n# 1. \u89e3\u6790\u8fc7\u6ee4\u53c2\u6570 (name=apple, price__gt=10)\n# 2. \u89e3\u6790\u6392\u5e8f\u53c2\u6570 (sort=-created_at)\n# 3. \u89e3\u6790\u5206\u9875\u53c2\u6570 (skip=0, limit=10)\n# 4. \u8c03\u7528\u540e\u7aef\u5904\u7406\n</code></pre>"},{"location":"reference/data-flow/#4","title":"\u6b65\u9aa4 4: \u540e\u7aef\u9002\u914d\u5668\u5904\u7406","text":"<p>\u4f9d\u8d56\u5e93: <code>fastapi-easy.backends</code></p> <pre><code>from fastapi_easy.backends import SQLAlchemyAdapter\n\nadapter = SQLAlchemyAdapter(ItemDB, get_db)\n\n# \u540e\u7aef\u505a\u7684\u4e8b\uff1a\n# 1. \u6784\u5efa\u57fa\u7840\u67e5\u8be2\n# 2. \u5e94\u7528\u8fc7\u6ee4\u6761\u4ef6\n# 3. \u5e94\u7528\u6392\u5e8f\u6761\u4ef6\n# 4. \u5e94\u7528\u5206\u9875\u6761\u4ef6\n# 5. \u6267\u884c\u67e5\u8be2\n</code></pre> <p>\u5177\u4f53\u4ee3\u7801\u6d41\u7a0b:</p> <pre><code># \u4f2a\u4ee3\u7801\nclass SQLAlchemyAdapter:\n    async def get_all(self, filters, sorts, skip, limit):\n        # 1. \u6784\u5efa\u57fa\u7840\u67e5\u8be2\n        query = select(ItemDB)\n\n        # 2. \u5e94\u7528\u8fc7\u6ee4\n        if filters:\n            # name=apple \u2192 where name = 'apple'\n            # price__gt=10 \u2192 where price &gt; 10\n            query = apply_filters(query, filters)\n\n        # 3. \u5e94\u7528\u6392\u5e8f\n        if sorts:\n            # sort=-created_at \u2192 order by created_at desc\n            query = apply_sorts(query, sorts)\n\n        # 4. \u5e94\u7528\u5206\u9875\n        query = query.offset(skip).limit(limit)\n\n        # 5. \u6267\u884c\u67e5\u8be2\n        result = await db.execute(query)\n        return result.scalars().all()\n</code></pre>"},{"location":"reference/data-flow/#5-orm-sql","title":"\u6b65\u9aa4 5: ORM \u5c42\u751f\u6210 SQL","text":"<p>\u4f9d\u8d56\u5e93: <code>sqlalchemy</code> (\u6216\u5176\u4ed6 ORM)</p> <pre><code>from sqlalchemy import select\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\n# SQLAlchemy \u505a\u7684\u4e8b\uff1a\n# 1. \u5c06 Python \u5bf9\u8c61\u8f6c\u6362\u4e3a SQL\n# 2. \u751f\u6210 SQL \u8bed\u53e5\n\n# \u751f\u6210\u7684 SQL \u7c7b\u4f3c\u4e8e\uff1a\n# SELECT * FROM items \n# WHERE name = 'apple' AND price &gt; 10 \n# ORDER BY created_at DESC \n# LIMIT 10 OFFSET 0\n</code></pre>"},{"location":"reference/data-flow/#6-sql","title":"\u6b65\u9aa4 6: \u6570\u636e\u5e93\u9a71\u52a8\u6267\u884c SQL","text":"<p>\u4f9d\u8d56\u5e93: <code>asyncpg</code> (PostgreSQL) \u6216 <code>aiosqlite</code> (SQLite)</p> <pre><code># asyncpg \u505a\u7684\u4e8b\uff1a\n# 1. \u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\n# 2. \u5f02\u6b65\u6267\u884c SQL\n# 3. \u83b7\u53d6\u7ed3\u679c\n\n# \u4f2a\u4ee3\u7801\nasync with engine.connect() as conn:\n    result = await conn.execute(sql_statement)\n    rows = await result.fetchall()\n</code></pre>"},{"location":"reference/data-flow/#7","title":"\u6b65\u9aa4 7: \u6570\u636e\u5e93\u8fd4\u56de\u6570\u636e","text":"<p>\u6570\u636e\u5e93: PostgreSQL / SQLite / MySQL / ...</p> <pre><code>\u6570\u636e\u5e93\u8fd4\u56de\u7684\u539f\u59cb\u6570\u636e\uff1a\n[\n    {'id': 1, 'name': 'apple', 'price': 15.5, 'created_at': '2024-01-01'},\n    {'id': 2, 'name': 'apple pie', 'price': 25.0, 'created_at': '2024-01-02'},\n]\n</code></pre>"},{"location":"reference/data-flow/#8-orm-python","title":"\u6b65\u9aa4 8: ORM \u8f6c\u6362\u4e3a Python \u5bf9\u8c61","text":"<p>\u4f9d\u8d56\u5e93: <code>sqlalchemy</code></p> <pre><code># SQLAlchemy \u505a\u7684\u4e8b\uff1a\n# 1. \u5c06\u6570\u636e\u5e93\u884c\u8f6c\u6362\u4e3a ORM \u5bf9\u8c61\n# 2. \u521b\u5efa ItemDB \u5b9e\u4f8b\n\n# \u8f6c\u6362\u540e\uff1a\n[\n    ItemDB(id=1, name='apple', price=15.5, created_at=datetime(...)),\n    ItemDB(id=2, name='apple pie', price=25.0, created_at=datetime(...)),\n]\n</code></pre>"},{"location":"reference/data-flow/#9-pydantic-schema","title":"\u6b65\u9aa4 9: \u8f6c\u6362\u4e3a Pydantic Schema","text":"<p>\u4f9d\u8d56\u5e93: <code>pydantic</code></p> <pre><code>from pydantic import BaseModel\n\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\n# Pydantic \u505a\u7684\u4e8b\uff1a\n# 1. \u9a8c\u8bc1\u6570\u636e\n# 2. \u7c7b\u578b\u8f6c\u6362\n# 3. \u521b\u5efa Pydantic \u6a21\u578b\u5b9e\u4f8b\n\n# \u8f6c\u6362\u540e\uff1a\n[\n    Item(id=1, name='apple', price=15.5, created_at=datetime(...)),\n    Item(id=2, name='apple pie', price=25.0, created_at=datetime(...)),\n]\n</code></pre>"},{"location":"reference/data-flow/#10-json","title":"\u6b65\u9aa4 10: \u5e8f\u5217\u5316\u4e3a JSON","text":"<p>\u4f9d\u8d56\u5e93: <code>fastapi</code> (\u4f7f\u7528 <code>pydantic</code> \u7684\u5e8f\u5217\u5316)</p> <pre><code># FastAPI \u505a\u7684\u4e8b\uff1a\n# 1. \u8c03\u7528 Pydantic \u7684 model_dump()\n# 2. \u5e8f\u5217\u5316\u4e3a JSON\n\n# \u6700\u7ec8 JSON\uff1a\n{\n    \"data\": [\n        {\n            \"id\": 1,\n            \"name\": \"apple\",\n            \"price\": 15.5,\n            \"created_at\": \"2024-01-01T00:00:00\"\n        },\n        {\n            \"id\": 2,\n            \"name\": \"apple pie\",\n            \"price\": 25.0,\n            \"created_at\": \"2024-01-02T00:00:00\"\n        }\n    ],\n    \"total\": 2,\n    \"page\": 1,\n    \"pages\": 1,\n    \"limit\": 10,\n    \"skip\": 0\n}\n</code></pre>"},{"location":"reference/data-flow/#11-http","title":"\u6b65\u9aa4 11: \u8fd4\u56de HTTP \u54cd\u5e94","text":"<pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n    \"data\": [...],\n    \"total\": 2,\n    ...\n}\n</code></pre>"},{"location":"reference/data-flow/#_4","title":"\u4f9d\u8d56\u5e93\u8be6\u89e3","text":""},{"location":"reference/data-flow/#_5","title":"\u6838\u5fc3\u4f9d\u8d56","text":"\u5e93 \u7248\u672c \u7528\u9014 fastapi \u22650.100 Web \u6846\u67b6\u3001\u8def\u7531\u3001\u8bf7\u6c42\u5904\u7406 pydantic \u22652.0 \u6570\u636e\u9a8c\u8bc1\u3001\u5e8f\u5217\u5316 typing-extensions \u22654.0 \u7c7b\u578b\u63d0\u793a"},{"location":"reference/data-flow/#orm","title":"\u53ef\u9009\u4f9d\u8d56\uff08ORM\uff09","text":"\u5e93 \u7528\u9014 sqlalchemy ORM\u3001SQL \u6784\u5efa tortoise-orm \u5f02\u6b65 ORM databases \u5f02\u6b65\u6570\u636e\u5e93\u9a71\u52a8"},{"location":"reference/data-flow/#_6","title":"\u53ef\u9009\u4f9d\u8d56\uff08\u6570\u636e\u5e93\u9a71\u52a8\uff09","text":"\u5e93 \u6570\u636e\u5e93 \u7c7b\u578b aiosqlite SQLite \u5f02\u6b65\u9a71\u52a8 asyncpg PostgreSQL \u5f02\u6b65\u9a71\u52a8 aiomysql MySQL \u5f02\u6b65\u9a71\u52a8 psycopg2 PostgreSQL \u540c\u6b65\u9a71\u52a8 pymysql MySQL \u540c\u6b65\u9a71\u52a8"},{"location":"reference/data-flow/#_7","title":"\u5b8c\u6574\u4ee3\u7801\u793a\u4f8b","text":"<pre><code># 1. \u5bfc\u5165\u4f9d\u8d56\nfrom fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAdapter\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy.orm import declarative_base, sessionmaker\nfrom sqlalchemy import Column, Integer, String, Float\nfrom pydantic import BaseModel\n\n# 2. \u5b9a\u4e49 ORM \u6a21\u578b\uff08\u4e0e\u6570\u636e\u5e93\u5bf9\u5e94\uff09\nBase = declarative_base()\n\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n\n# 3. \u5b9a\u4e49 Pydantic Schema\uff08API \u54cd\u5e94\u683c\u5f0f\uff09\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n\n    class Config:\n        from_attributes = True\n\n# 4. \u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(\n    engine, \n    class_=AsyncSession, \n    expire_on_commit=False\n)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# 5. \u521b\u5efa FastAPI \u5e94\u7528\napp = FastAPI()\n\n# 6. \u521b\u5efa CRUDRouter\uff08\u81ea\u52a8\u751f\u6210\u8def\u7531\uff09\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=SQLAlchemyAdapter(ItemDB, get_db),\n    prefix=\"/items\",\n    enable_filters=True,\n    filter_fields=[\"name\", \"price\"],\n    enable_sorters=True,\n    sort_fields=[\"name\"],\n)\n\n# 7. \u6ce8\u518c\u8def\u7531\napp.include_router(router)\n\n# \u73b0\u5728\u81ea\u52a8\u652f\u6301\uff1a\n# GET /items?name=apple&amp;price__gt=10&amp;sort=-name\n</code></pre>"},{"location":"reference/data-flow/#_8","title":"\u6570\u636e\u6d41\u603b\u7ed3","text":"<pre><code>\u7528\u6237\u8bf7\u6c42\n    \u2193\nFastAPI (\u63a5\u6536\u3001\u8def\u7531)\n    \u2193\nfastapi-easy (\u89e3\u6790\u53c2\u6570)\n    \u2193\n\u540e\u7aef\u9002\u914d\u5668 (\u6784\u5efa\u67e5\u8be2)\n    \u2193\nORM (\u751f\u6210 SQL)\n    \u2193\n\u6570\u636e\u5e93\u9a71\u52a8 (\u6267\u884c SQL)\n    \u2193\n\u6570\u636e\u5e93 (\u8fd4\u56de\u6570\u636e)\n    \u2193\nORM (\u8f6c\u6362\u5bf9\u8c61)\n    \u2193\nPydantic (\u9a8c\u8bc1\u3001\u5e8f\u5217\u5316)\n    \u2193\nFastAPI (\u8fd4\u56de JSON)\n    \u2193\nHTTP \u54cd\u5e94\n</code></pre>"},{"location":"reference/data-flow/#_9","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u5b66\u4e60\u641c\u7d22\u548c\u8fc7\u6ee4</li> <li>\u4e86\u89e3\u6392\u5e8f\u529f\u80fd</li> <li>\u67e5\u770b\u5b8c\u6574\u793a\u4f8b</li> </ul>"},{"location":"reference/hooks/","title":"Hook \u7cfb\u7edf","text":"<p>Hook \u7cfb\u7edf\u5141\u8bb8\u5728 CRUD \u64cd\u4f5c\u7684\u5173\u952e\u70b9\u63d2\u5165\u81ea\u5b9a\u4e49\u903b\u8f91\u3002</p>"},{"location":"reference/hooks/#hook_1","title":"\u652f\u6301\u7684 Hook \u4e8b\u4ef6","text":"<p>FastAPI-Easy \u652f\u6301 10 \u79cd Hook \u4e8b\u4ef6\uff1a</p> <ul> <li>before_get_all - \u83b7\u53d6\u6240\u6709\u8bb0\u5f55\u524d</li> <li>after_get_all - \u83b7\u53d6\u6240\u6709\u8bb0\u5f55\u540e</li> <li>before_get_one - \u83b7\u53d6\u5355\u4e2a\u8bb0\u5f55\u524d</li> <li>after_get_one - \u83b7\u53d6\u5355\u4e2a\u8bb0\u5f55\u540e</li> <li>before_create - \u521b\u5efa\u8bb0\u5f55\u524d</li> <li>after_create - \u521b\u5efa\u8bb0\u5f55\u540e</li> <li>before_update - \u66f4\u65b0\u8bb0\u5f55\u524d</li> <li>after_update - \u66f4\u65b0\u8bb0\u5f55\u540e</li> <li>before_delete - \u5220\u9664\u8bb0\u5f55\u524d</li> <li>after_delete - \u5220\u9664\u8bb0\u5f55\u540e</li> </ul>"},{"location":"reference/hooks/#_1","title":"\u57fa\u7840\u4f7f\u7528","text":""},{"location":"reference/hooks/#hook_2","title":"\u6ce8\u518c Hook","text":"<pre><code>from fastapi_easy.core import migration_hook\n\n@migration_hook(\"before_create\")\nasync def validate_before_create(data):\n    # \u9a8c\u8bc1\u6570\u636e\n    if not data.get(\"name\"):\n        raise ValueError(\"Name is required\")\n    return data\n</code></pre>"},{"location":"reference/hooks/#hook_3","title":"\u4f7f\u7528 Hook \u6ce8\u518c\u8868","text":"<pre><code>from fastapi_easy.core import HookRegistry\n\nregistry = HookRegistry()\n\nasync def log_after_create(data):\n    print(f\"Created: {data}\")\n\nregistry.register(\"after_create\", log_after_create)\n</code></pre>"},{"location":"reference/hooks/#hook_4","title":"Hook \u4f18\u5148\u7ea7","text":"<p>Hook \u652f\u6301\u4f18\u5148\u7ea7\u63a7\u5236\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684 Hook \u5148\u6267\u884c\uff1a</p> <pre><code>@migration_hook(\"before_create\", priority=10)\nasync def high_priority_hook(data):\n    pass\n\n@migration_hook(\"before_create\", priority=5)\nasync def low_priority_hook(data):\n    pass\n</code></pre>"},{"location":"reference/hooks/#hook_5","title":"\u5f02\u6b65\u548c\u540c\u6b65 Hook","text":"<p>\u652f\u6301\u5f02\u6b65\u548c\u540c\u6b65 Hook\uff1a</p> <pre><code># \u5f02\u6b65 Hook\n@migration_hook(\"before_create\")\nasync def async_hook(data):\n    await some_async_operation()\n    return data\n\n# \u540c\u6b65 Hook\n@migration_hook(\"before_create\")\ndef sync_hook(data):\n    some_sync_operation()\n    return data\n</code></pre>"},{"location":"reference/hooks/#_2","title":"\u9519\u8bef\u5904\u7406","text":"<p>Hook \u4e2d\u7684\u9519\u8bef\u4f1a\u88ab\u9694\u79bb\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6 Hook\uff1a</p> <pre><code>@migration_hook(\"after_create\")\nasync def hook_with_error(data):\n    try:\n        await risky_operation()\n    except Exception as e:\n        logger.error(f\"Hook error: {e}\")\n        # \u9519\u8bef\u88ab\u6355\u83b7\uff0c\u4e0d\u4f1a\u4e2d\u65ad\u5176\u4ed6 Hook\n</code></pre>"},{"location":"reference/hooks/#_3","title":"\u5b9e\u9645\u5e94\u7528","text":""},{"location":"reference/hooks/#1","title":"1. \u6570\u636e\u9a8c\u8bc1","text":"<pre><code>@migration_hook(\"before_create\")\nasync def validate_email(data):\n    if not is_valid_email(data.get(\"email\")):\n        raise ValueError(\"Invalid email\")\n    return data\n</code></pre>"},{"location":"reference/hooks/#2","title":"2. \u6570\u636e\u8f6c\u6362","text":"<pre><code>@migration_hook(\"before_create\")\nasync def normalize_data(data):\n    data[\"name\"] = data[\"name\"].strip().lower()\n    return data\n</code></pre>"},{"location":"reference/hooks/#3","title":"3. \u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code>@migration_hook(\"after_create\")\nasync def log_creation(data):\n    await audit_log.create(\n        action=\"create\",\n        resource=\"Item\",\n        resource_id=data[\"id\"]\n    )\n</code></pre>"},{"location":"reference/hooks/#4","title":"4. \u7f13\u5b58\u66f4\u65b0","text":"<pre><code>@migration_hook(\"after_update\")\nasync def update_cache(data):\n    await cache.set(f\"item:{data['id']}\", data)\n</code></pre>"},{"location":"reference/hooks/#5","title":"5. \u5916\u90e8\u7cfb\u7edf\u96c6\u6210","text":"<pre><code>@migration_hook(\"after_create\")\nasync def send_notification(data):\n    await notification_service.send(\n        f\"New item created: {data['name']}\"\n    )\n</code></pre>"},{"location":"reference/hooks/#hook_6","title":"Hook \u4e0a\u4e0b\u6587","text":"<p>Hook \u53ef\u4ee5\u8bbf\u95ee\u4e0a\u4e0b\u6587\u4fe1\u606f\uff1a</p> <pre><code>from fastapi_easy.core import HookContext\n\n@migration_hook(\"before_create\")\nasync def hook_with_context(data, context: HookContext):\n    # \u8bbf\u95ee\u5f53\u524d\u7528\u6237\n    user = context.current_user\n    # \u8bbf\u95ee\u8bf7\u6c42\u5bf9\u8c61\n    request = context.request\n    # \u8bbf\u95ee\u5176\u4ed6\u4e0a\u4e0b\u6587\u4fe1\u606f\n    return data\n</code></pre>"},{"location":"reference/hooks/#_4","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"reference/hooks/#1-hook","title":"1. \u4fdd\u6301 Hook \u8f7b\u91cf","text":"<pre><code># \u4e0d\u597d\uff1a\u5728 Hook \u4e2d\u8fdb\u884c\u91cd\u64cd\u4f5c\n@migration_hook(\"after_create\")\nasync def heavy_hook(data):\n    for i in range(1000000):\n        await some_operation()\n\n# \u597d\uff1a\u4f7f\u7528\u540e\u53f0\u4efb\u52a1\n@migration_hook(\"after_create\")\nasync def light_hook(data):\n    background_tasks.add_task(heavy_operation, data)\n</code></pre>"},{"location":"reference/hooks/#2_1","title":"2. \u9519\u8bef\u5904\u7406","text":"<pre><code>@migration_hook(\"before_create\")\nasync def safe_hook(data):\n    try:\n        return await validate(data)\n    except ValidationError as e:\n        raise ValueError(f\"Validation failed: {e}\")\n</code></pre>"},{"location":"reference/hooks/#3_1","title":"3. \u65e5\u5fd7\u8bb0\u5f55","text":"<pre><code>@migration_hook(\"after_create\")\nasync def logged_hook(data):\n    logger.info(f\"Item created: {data['id']}\")\n    return data\n</code></pre>"},{"location":"reference/hooks/#_5","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"reference/hooks/#q-hook","title":"Q: Hook \u7684\u6267\u884c\u987a\u5e8f\u662f\u4ec0\u4e48\uff1f","text":"<p>A: \u6309\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\u6267\u884c\uff0c\u4f18\u5148\u7ea7\u76f8\u540c\u65f6\u6309\u6ce8\u518c\u987a\u5e8f\u6267\u884c\u3002</p>"},{"location":"reference/hooks/#q-hook_1","title":"Q: Hook \u4e2d\u7684\u5f02\u5e38\u4f1a\u600e\u6837\uff1f","text":"<p>A: \u5f02\u5e38\u4f1a\u88ab\u6355\u83b7\u5e76\u8bb0\u5f55\uff0c\u4e0d\u4f1a\u4e2d\u65ad\u5176\u4ed6 Hook \u7684\u6267\u884c\u3002</p>"},{"location":"reference/hooks/#q-hook_2","title":"Q: \u5982\u4f55\u7981\u7528\u67d0\u4e2a Hook\uff1f","text":"<p>A: \u4f7f\u7528 <code>registry.unregister(event, callback)</code> \u65b9\u6cd5\u3002</p>"},{"location":"security/","title":"\u5b89\u5168\u6587\u6863\u7d22\u5f15","text":"<p>\u672c\u76ee\u5f55\u5305\u542b FastAPI-Easy \u5b89\u5168\u6a21\u5757\u7684\u8be6\u7ec6\u6587\u6863\u3002</p>"},{"location":"security/#_2","title":"\u6838\u5fc3\u6a21\u5757","text":""},{"location":"security/#authentication","title":"\u8ba4\u8bc1 (Authentication)","text":"<p>\u4ecb\u7ecd\u5982\u4f55\u96c6\u6210 JWT \u8ba4\u8bc1\u3001\u7528\u6237\u767b\u5f55\u548c\u4ee4\u724c\u7ba1\u7406\u3002</p>"},{"location":"security/#permissions","title":"\u6743\u9650\u63a7\u5236 (Permissions)","text":"<p>\u8be6\u7ec6\u4ecb\u7ecd\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC) \u548c\u88c5\u9970\u5668\u7528\u6cd5 (<code>require_role</code>, <code>require_permission</code>)\u3002 \u6ce8\uff1a\u5173\u4e8e CRUDRouter \u7684\u57fa\u7840\u6743\u9650\u914d\u7f6e\uff0c\u8bf7\u53c2\u8003 \u57fa\u7840\u6743\u9650\u6307\u5357\u3002</p>"},{"location":"security/#audit-logging","title":"\u5ba1\u8ba1\u65e5\u5fd7 (Audit Logging)","text":"<p>\u6df1\u5165\u4e86\u89e3\u5ba1\u8ba1\u65e5\u5fd7\u7cfb\u7edf\uff0c\u5305\u62ec\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3001\u5b58\u50a8\u540e\u7aef\u548c\u67e5\u8be2\u63a5\u53e3\u3002 \u6ce8\uff1a\u5173\u4e8e CRUDRouter \u7684\u57fa\u7840\u5ba1\u8ba1\u914d\u7f6e\uff0c\u8bf7\u53c2\u8003 \u57fa\u7840\u5ba1\u8ba1\u6307\u5357\u3002</p>"},{"location":"security/#password-rate-limit","title":"\u5bc6\u7801\u4e0e\u901f\u7387\u9650\u5236 (Password &amp; Rate Limit)","text":"<p>\u5bc6\u7801\u54c8\u5e0c\u6700\u4f73\u5b9e\u8df5\u548c API \u901f\u7387\u9650\u5236\u914d\u7f6e\u3002</p>"},{"location":"security/#_3","title":"\u9ad8\u7ea7\u7ec4\u4ef6","text":""},{"location":"security/#permission-loader","title":"\u6743\u9650\u52a0\u8f7d\u5668 (Permission Loader)","text":"<p>\u5982\u4f55\u4ece\u6587\u4ef6\u6216\u6570\u636e\u5e93\u52a8\u6001\u52a0\u8f7d\u6743\u9650\u914d\u7f6e\u3002</p>"},{"location":"security/#resource-checker","title":"\u8d44\u6e90\u68c0\u67e5\u5668 (Resource Checker)","text":"<p>\u5b9e\u73b0\u7ec6\u7c92\u5ea6\u7684\u5bf9\u8c61\u7ea7\u6743\u9650\u63a7\u5236\uff08\u4f8b\u5982\uff1a\u7528\u6237\u53ea\u80fd\u4fee\u6539\u81ea\u5df1\u7684\u6587\u7ae0\uff09\u3002</p>"},{"location":"security/#permission-engine","title":"\u6743\u9650\u5f15\u64ce (Permission Engine)","text":"<p>\u6743\u9650\u7cfb\u7edf\u7684\u6838\u5fc3\u5f15\u64ce\u67b6\u6784\u548c\u6269\u5c55\u65b9\u5f0f\u3002</p>"},{"location":"security/#security-config","title":"\u5b89\u5168\u914d\u7f6e (Security Config)","text":"<p>\u5b89\u5168\u6a21\u5757\u7684\u5b8c\u6574\u914d\u7f6e\u53c2\u6570\u53c2\u8003\u3002</p>"},{"location":"security/#_4","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/#_5","title":"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5","text":"<p>\u751f\u4ea7\u73af\u5883\u90e8\u7f72\u7684\u5b89\u5168\u5efa\u8bae\u6e05\u5355\u3002</p>"},{"location":"security/audit-logging/","title":"\u5ba1\u8ba1\u65e5\u5fd7\u6307\u5357","text":""},{"location":"security/audit-logging/#_2","title":"\u6982\u8ff0","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u5ba1\u8ba1\u65e5\u5fd7\u7cfb\u7edf\uff0c\u7528\u4e8e\uff1a</p> <ul> <li>\u8bb0\u5f55\u5b89\u5168\u4e8b\u4ef6</li> <li>\u8ddf\u8e2a\u7528\u6237\u6d3b\u52a8</li> <li>\u5408\u89c4\u6027\u5ba1\u8ba1</li> <li>\u5b89\u5168\u5206\u6790</li> </ul>"},{"location":"security/audit-logging/#_3","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"security/audit-logging/#_4","title":"\u521d\u59cb\u5316\u5ba1\u8ba1\u65e5\u5fd7","text":"<pre><code>from fastapi_easy.security import AuditLogger, AuditEventType\n\n# \u521b\u5efa\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\u5668\naudit_logger = AuditLogger(max_logs=10000)\n</code></pre>"},{"location":"security/audit-logging/#_5","title":"\u8bb0\u5f55\u4e8b\u4ef6","text":"<pre><code># \u8bb0\u5f55\u767b\u5f55\u6210\u529f\naudit_logger.log(\n    event_type=AuditEventType.LOGIN_SUCCESS,\n    user_id=\"user123\",\n    username=\"john_doe\",\n    status=\"success\",\n)\n\n# \u8bb0\u5f55\u767b\u5f55\u5931\u8d25\naudit_logger.log(\n    event_type=AuditEventType.LOGIN_FAILURE,\n    username=\"john_doe\",\n    status=\"failure\",\n    details={\"reason\": \"invalid_password\"},\n)\n\n# \u8bb0\u5f55\u6743\u9650\u88ab\u62d2\u7edd\naudit_logger.log(\n    event_type=AuditEventType.PERMISSION_DENIED,\n    user_id=\"user123\",\n    resource=\"admin_panel\",\n    action=\"access\",\n    status=\"failure\",\n)\n</code></pre>"},{"location":"security/audit-logging/#_6","title":"\u4e8b\u4ef6\u7c7b\u578b","text":""},{"location":"security/audit-logging/#_7","title":"\u8ba4\u8bc1\u4e8b\u4ef6","text":"<pre><code>AuditEventType.LOGIN_SUCCESS      # \u767b\u5f55\u6210\u529f\nAuditEventType.LOGIN_FAILURE      # \u767b\u5f55\u5931\u8d25\nAuditEventType.LOGIN_LOCKED       # \u8d26\u6237\u88ab\u9501\u5b9a\nAuditEventType.LOGOUT             # \u767b\u51fa\nAuditEventType.TOKEN_REFRESH      # Token \u5237\u65b0\nAuditEventType.TOKEN_EXPIRED      # Token \u8fc7\u671f\n</code></pre>"},{"location":"security/audit-logging/#_8","title":"\u6388\u6743\u4e8b\u4ef6","text":"<pre><code>AuditEventType.PERMISSION_DENIED      # \u6743\u9650\u88ab\u62d2\u7edd\nAuditEventType.PERMISSION_GRANTED     # \u6743\u9650\u88ab\u6388\u4e88\nAuditEventType.UNAUTHORIZED           # \u672a\u6388\u6743\nAuditEventType.ACCOUNT_LOCKED         # \u8d26\u6237\u88ab\u9501\u5b9a\nAuditEventType.ACCOUNT_UNLOCKED       # \u8d26\u6237\u88ab\u89e3\u9501\n</code></pre>"},{"location":"security/audit-logging/#_9","title":"\u7528\u6237\u7ba1\u7406\u4e8b\u4ef6","text":"<pre><code>AuditEventType.PASSWORD_CHANGED       # \u5bc6\u7801\u5df2\u66f4\u6539\nAuditEventType.ROLE_CHANGED           # \u89d2\u8272\u5df2\u66f4\u6539\nAuditEventType.PERMISSION_CHANGED     # \u6743\u9650\u5df2\u66f4\u6539\n</code></pre>"},{"location":"security/audit-logging/#_10","title":"\u67e5\u8be2\u5ba1\u8ba1\u65e5\u5fd7","text":""},{"location":"security/audit-logging/#_11","title":"\u83b7\u53d6\u6240\u6709\u65e5\u5fd7","text":"<pre><code># \u83b7\u53d6\u6700\u8fd1 100 \u6761\u65e5\u5fd7\nlogs = audit_logger.get_logs(limit=100)\n\nfor log in logs:\n    print(f\"{log['timestamp']}: {log['event_type']} - {log['username']}\")\n</code></pre>"},{"location":"security/audit-logging/#_12","title":"\u6309\u7528\u6237\u8fc7\u6ee4","text":"<pre><code># \u83b7\u53d6\u7279\u5b9a\u7528\u6237\u7684\u6d3b\u52a8\nuser_logs = audit_logger.get_user_activity(\n    username=\"john_doe\",\n    limit=50,\n)\n\nfor log in user_logs:\n    print(f\"{log['timestamp']}: {log['event_type']}\")\n</code></pre>"},{"location":"security/audit-logging/#_13","title":"\u83b7\u53d6\u5931\u8d25\u7684\u767b\u5f55","text":"<pre><code># \u83b7\u53d6\u7279\u5b9a\u7528\u6237\u7684\u5931\u8d25\u767b\u5f55\u5c1d\u8bd5\nfailed_logins = audit_logger.get_failed_logins(\n    username=\"john_doe\",\n    limit=10,\n)\n\nfor login in failed_logins:\n    print(f\"Failed login: {login['timestamp']}\")\n</code></pre>"},{"location":"security/audit-logging/#_14","title":"\u6309\u4e8b\u4ef6\u7c7b\u578b\u8fc7\u6ee4","text":"<pre><code>from fastapi_easy.security import AuditEventType\n\n# \u83b7\u53d6\u6240\u6709\u6743\u9650\u62d2\u7edd\u4e8b\u4ef6\npermission_denied = audit_logger.get_logs(\n    event_type=AuditEventType.PERMISSION_DENIED,\n    limit=50,\n)\n</code></pre>"},{"location":"security/audit-logging/#_15","title":"\u5b8c\u6574\u7684\u5ba1\u8ba1\u65e5\u5fd7\u96c6\u6210","text":"<pre><code>from fastapi import FastAPI, Depends, HTTPException\nfrom fastapi_easy.security import (\n    PasswordManager,\n    LoginAttemptTracker,\n    AuditLogger,\n    AuditEventType,\n    get_current_user,\n    require_role,\n)\n\napp = FastAPI()\n\n# \u521d\u59cb\u5316\npassword_manager = PasswordManager()\ntracker = LoginAttemptTracker()\naudit_logger = AuditLogger()\n\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    \"\"\"\u767b\u5f55\u7aef\u70b9\uff08\u5e26\u5ba1\u8ba1\u65e5\u5fd7\uff09\"\"\"\n\n    # \u68c0\u67e5\u9501\u5b9a\n    if tracker.is_locked_out(username):\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_LOCKED,\n            username=username,\n            status=\"failure\",\n        )\n        raise HTTPException(status_code=429, detail=\"Account locked\")\n\n    # \u9a8c\u8bc1\u7528\u6237\n    user = authenticate_user(username, password)\n\n    if not user:\n        tracker.record_attempt(username, success=False)\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_FAILURE,\n            username=username,\n            status=\"failure\",\n        )\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # \u6210\u529f\u767b\u5f55\n    tracker.record_attempt(username, success=True)\n    audit_logger.log(\n        event_type=AuditEventType.LOGIN_SUCCESS,\n        user_id=str(user.id),\n        username=username,\n        status=\"success\",\n    )\n\n    # \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n@app.post(\"/logout\")\nasync def logout(current_user: dict = Depends(get_current_user)):\n    \"\"\"\u767b\u51fa\u7aef\u70b9\uff08\u5e26\u5ba1\u8ba1\u65e5\u5fd7\uff09\"\"\"\n    audit_logger.log(\n        event_type=AuditEventType.LOGOUT,\n        user_id=current_user[\"user_id\"],\n        status=\"success\",\n    )\n    return {\"message\": \"Logged out successfully\"}\n\n@app.get(\"/admin-panel\")\nasync def admin_panel(current_user: dict = Depends(require_role(\"admin\"))):\n    \"\"\"\u7ba1\u7406\u5458\u9762\u677f\uff08\u5e26\u5ba1\u8ba1\u65e5\u5fd7\uff09\"\"\"\n    audit_logger.log(\n        event_type=AuditEventType.PERMISSION_GRANTED,\n        user_id=current_user[\"user_id\"],\n        resource=\"admin_panel\",\n        action=\"access\",\n        status=\"success\",\n    )\n    return {\"message\": \"Welcome to admin panel\"}\n\n@app.get(\"/audit-logs\")\nasync def get_audit_logs(\n    current_user: dict = Depends(require_role(\"admin\")),\n):\n    \"\"\"\u83b7\u53d6\u5ba1\u8ba1\u65e5\u5fd7\uff08\u4ec5\u7ba1\u7406\u5458\uff09\"\"\"\n    logs = audit_logger.export_logs()\n    return {\"logs\": logs}\n</code></pre>"},{"location":"security/audit-logging/#_16","title":"\u5ba1\u8ba1\u65e5\u5fd7\u5206\u6790","text":""},{"location":"security/audit-logging/#_17","title":"\u68c0\u6d4b\u5f02\u5e38\u6d3b\u52a8","text":"<pre><code>def detect_suspicious_activity():\n    \"\"\"\u68c0\u6d4b\u53ef\u7591\u6d3b\u52a8\"\"\"\n\n    # \u68c0\u67e5\u591a\u6b21\u5931\u8d25\u7684\u767b\u5f55\n    all_logs = audit_logger.export_logs()\n\n    failed_logins = {}\n    for log in all_logs:\n        if log[\"event_type\"] == \"login_failure\":\n            username = log[\"username\"]\n            failed_logins[username] = failed_logins.get(username, 0) + 1\n\n    # \u5982\u679c\u67d0\u4e2a\u7528\u6237\u6709\u8d85\u8fc7 10 \u6b21\u5931\u8d25\u767b\u5f55\uff0c\u53d1\u51fa\u8b66\u544a\n    for username, count in failed_logins.items():\n        if count &gt; 10:\n            print(f\"\u26a0\ufe0f  Warning: {username} has {count} failed login attempts\")\n\n# \u5b9a\u671f\u8fd0\u884c\u68c0\u6d4b\nimport schedule\n\nschedule.every(1).hour.do(detect_suspicious_activity)\n</code></pre>"},{"location":"security/audit-logging/#_18","title":"\u751f\u6210\u5ba1\u8ba1\u62a5\u544a","text":"<pre><code>def generate_audit_report(start_date, end_date):\n    \"\"\"\u751f\u6210\u5ba1\u8ba1\u62a5\u544a\"\"\"\n\n    logs = audit_logger.export_logs()\n\n    # \u6309\u4e8b\u4ef6\u7c7b\u578b\u7edf\u8ba1\n    event_counts = {}\n    for log in logs:\n        event_type = log[\"event_type\"]\n        event_counts[event_type] = event_counts.get(event_type, 0) + 1\n\n    # \u6309\u7528\u6237\u7edf\u8ba1\n    user_activity = {}\n    for log in logs:\n        username = log.get(\"username\", \"unknown\")\n        user_activity[username] = user_activity.get(username, 0) + 1\n\n    return {\n        \"period\": f\"{start_date} to {end_date}\",\n        \"event_counts\": event_counts,\n        \"user_activity\": user_activity,\n        \"total_events\": len(logs),\n    }\n\n# \u751f\u6210\u62a5\u544a\nreport = generate_audit_report(\"2025-01-01\", \"2025-01-31\")\nprint(report)\n</code></pre>"},{"location":"security/audit-logging/#_19","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/audit-logging/#1","title":"1. \u5b9a\u671f\u5bfc\u51fa\u548c\u5907\u4efd\u65e5\u5fd7","text":"<pre><code>import json\nfrom datetime import datetime\n\ndef backup_audit_logs():\n    \"\"\"\u5907\u4efd\u5ba1\u8ba1\u65e5\u5fd7\"\"\"\n    logs = audit_logger.export_logs()\n\n    filename = f\"audit_logs_{datetime.now().isoformat()}.json\"\n    with open(filename, \"w\") as f:\n        json.dump(logs, f, indent=2)\n\n    print(f\"Audit logs backed up to {filename}\")\n\n# \u6bcf\u5929\u5907\u4efd\nschedule.every().day.at(\"23:59\").do(backup_audit_logs)\n</code></pre>"},{"location":"security/audit-logging/#2","title":"2. \u76d1\u63a7\u5173\u952e\u4e8b\u4ef6","text":"<pre><code>def monitor_critical_events():\n    \"\"\"\u76d1\u63a7\u5173\u952e\u4e8b\u4ef6\"\"\"\n    logs = audit_logger.export_logs()\n\n    critical_events = [\n        AuditEventType.PERMISSION_DENIED,\n        AuditEventType.LOGIN_LOCKED,\n        AuditEventType.ACCOUNT_LOCKED,\n    ]\n\n    for log in logs:\n        if log[\"event_type\"] in [e.value for e in critical_events]:\n            # \u53d1\u9001\u8b66\u544a\n            send_alert(f\"Critical event: {log['event_type']}\")\n</code></pre>"},{"location":"security/audit-logging/#3","title":"3. \u4fdd\u7559\u65e5\u5fd7\u7b56\u7565","text":"<pre><code>def cleanup_old_logs(days=90):\n    \"\"\"\u6e05\u7406\u65e7\u65e5\u5fd7\"\"\"\n    from datetime import datetime, timedelta\n\n    cutoff_date = datetime.now() - timedelta(days=days)\n\n    # \u5bfc\u51fa\u65e5\u5fd7\u5230\u5b58\u50a8\n    logs = audit_logger.export_logs()\n\n    # \u6e05\u7406\u5185\u5b58\u4e2d\u7684\u65e5\u5fd7\n    audit_logger.clear_logs()\n\n    # \u4fdd\u5b58\u5230\u6570\u636e\u5e93\u6216\u6587\u4ef6\u7cfb\u7edf\n    save_logs_to_storage(logs)\n\n# \u6bcf\u5468\u6e05\u7406\nschedule.every().week.do(cleanup_old_logs)\n</code></pre>"},{"location":"security/audit-logging/#4","title":"4. \u5408\u89c4\u6027\u62a5\u544a","text":"<pre><code>def generate_compliance_report():\n    \"\"\"\u751f\u6210\u5408\u89c4\u6027\u62a5\u544a\"\"\"\n    logs = audit_logger.export_logs()\n\n    # \u7edf\u8ba1\u767b\u5f55\u4e8b\u4ef6\n    login_events = [l for l in logs if \"login\" in l[\"event_type\"]]\n\n    # \u7edf\u8ba1\u6743\u9650\u53d8\u66f4\n    permission_changes = [l for l in logs if \"permission\" in l[\"event_type\"]]\n\n    # \u7edf\u8ba1\u5931\u8d25\u4e8b\u4ef6\n    failed_events = [l for l in logs if l[\"status\"] == \"failure\"]\n\n    return {\n        \"total_logins\": len(login_events),\n        \"permission_changes\": len(permission_changes),\n        \"failed_events\": len(failed_events),\n        \"compliance_status\": \"compliant\" if len(failed_events) &lt; 100 else \"review_needed\",\n    }\n</code></pre>"},{"location":"security/audit-logging/#_20","title":"\u5b8c\u6574\u793a\u4f8b","text":"<p>\u53c2\u8003 <code>examples/06_with_permissions.py</code> \u83b7\u53d6\u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b\u3002</p>"},{"location":"security/authentication/","title":"JWT \u8ba4\u8bc1\u6307\u5357","text":""},{"location":"security/authentication/#_1","title":"\u6982\u8ff0","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\u5b8c\u6574\u7684 JWT (JSON Web Token) \u8ba4\u8bc1\u7cfb\u7edf\uff0c\u652f\u6301\uff1a</p> <ul> <li>JWT Token \u751f\u6210\u548c\u9a8c\u8bc1</li> <li>Token \u5237\u65b0\u673a\u5236</li> <li>\u81ea\u5b9a\u4e49\u5bc6\u94a5\u548c\u7b97\u6cd5</li> <li>\u5b8c\u6574\u7684\u9519\u8bef\u5904\u7406</li> </ul>"},{"location":"security/authentication/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"security/authentication/#1-jwt","title":"1. \u521d\u59cb\u5316 JWT \u8ba4\u8bc1","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy.security import init_jwt_auth\n\napp = FastAPI()\n\n# \u521d\u59cb\u5316 JWT \u8ba4\u8bc1\njwt_auth = init_jwt_auth(\n    secret_key=\"your-secret-key-change-in-production\",\n    algorithm=\"HS256\",\n    access_token_expire_minutes=15,\n    refresh_token_expire_days=7,\n)\n</code></pre>"},{"location":"security/authentication/#2","title":"2. \u521b\u5efa\u767b\u5f55\u7aef\u70b9","text":"<pre><code>from fastapi import HTTPException\nfrom fastapi_easy.security import TokenResponse, TokenRequest\n\n@app.post(\"/auth/login\", response_model=TokenResponse)\nasync def login(request: TokenRequest):\n    \"\"\"\u7528\u6237\u767b\u5f55\u7aef\u70b9\"\"\"\n    # \u9a8c\u8bc1\u7528\u6237\u51ed\u8bc1 (\u8fd9\u91cc\u4f7f\u7528\u6a21\u62df\u6570\u636e)\n    if request.username != \"admin\" or request.password != \"password\":\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(\n        subject=\"user123\",\n        roles=[\"admin\"],\n    )\n    refresh_token = jwt_auth.create_refresh_token(subject=\"user123\")\n\n    return TokenResponse(\n        access_token=access_token,\n        refresh_token=refresh_token,\n        expires_in=15 * 60,  # 15 \u5206\u949f\n    )\n</code></pre>"},{"location":"security/authentication/#3","title":"3. \u4fdd\u62a4\u7aef\u70b9","text":"<pre><code>from fastapi import Depends\nfrom fastapi_easy.security import get_current_user\n\n@app.get(\"/profile\")\nasync def get_profile(current_user: dict = Depends(get_current_user)):\n    \"\"\"\u83b7\u53d6\u5f53\u524d\u7528\u6237\u8d44\u6599\"\"\"\n    return {\n        \"user_id\": current_user[\"user_id\"],\n        \"roles\": current_user[\"roles\"],\n    }\n</code></pre>"},{"location":"security/authentication/#4-token","title":"4. \u5237\u65b0 Token","text":"<pre><code>from fastapi_easy.security import RefreshTokenRequest\n\n@app.post(\"/auth/refresh\", response_model=TokenResponse)\nasync def refresh(request: RefreshTokenRequest):\n    \"\"\"\u5237\u65b0\u8bbf\u95ee\u4ee4\u724c\"\"\"\n    try:\n        access_token = jwt_auth.refresh_access_token(\n            refresh_token=request.refresh_token,\n        )\n        return TokenResponse(\n            access_token=access_token,\n            refresh_token=request.refresh_token,\n            expires_in=15 * 60,\n        )\n    except Exception as e:\n        raise HTTPException(status_code=401, detail=str(e))\n</code></pre>"},{"location":"security/authentication/#_3","title":"\u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6765\u914d\u7f6e JWT \u5bc6\u94a5\uff1a</p> <pre><code># .env\nJWT_SECRET_KEY=your-super-secret-key-here\n</code></pre> <p>\u7136\u540e\u5728\u4ee3\u7801\u4e2d\uff1a</p> <pre><code>from fastapi_easy.security import init_jwt_auth\n\n# \u81ea\u52a8\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6 JWT_SECRET_KEY\njwt_auth = init_jwt_auth()\n</code></pre>"},{"location":"security/authentication/#token","title":"Token \u683c\u5f0f","text":"<p>JWT Token \u5305\u542b\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <pre><code>{\n  \"sub\": \"user123\",           // \u7528\u6237 ID\n  \"roles\": [\"admin\", \"user\"], // \u7528\u6237\u89d2\u8272\n  \"permissions\": [\"read\"],    // \u7528\u6237\u6743\u9650\n  \"iat\": 1234567890,          // \u7b7e\u53d1\u65f6\u95f4\n  \"exp\": 1234568790,          // \u8fc7\u671f\u65f6\u95f4\n  \"type\": \"access\"            // Token \u7c7b\u578b (access/refresh)\n}\n</code></pre>"},{"location":"security/authentication/#_4","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/authentication/#1","title":"1. \u4f7f\u7528\u5f3a\u5bc6\u94a5","text":"<pre><code>import secrets\n\n# \u751f\u6210\u5f3a\u5bc6\u94a5\nsecret_key = secrets.token_urlsafe(32)\n</code></pre>"},{"location":"security/authentication/#2_1","title":"2. \u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4","text":"<pre><code># \u8bbf\u95ee\u4ee4\u724c\uff1a15 \u5206\u949f\n# \u5237\u65b0\u4ee4\u724c\uff1a7 \u5929\njwt_auth = init_jwt_auth(\n    access_token_expire_minutes=15,\n    refresh_token_expire_days=7,\n)\n</code></pre>"},{"location":"security/authentication/#3-https","title":"3. \u59cb\u7ec8\u4f7f\u7528 HTTPS","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u59cb\u7ec8\u4f7f\u7528 HTTPS \u6765\u4f20\u8f93 Token\u3002</p>"},{"location":"security/authentication/#4-token_1","title":"4. \u5728\u5ba2\u6237\u7aef\u5b89\u5168\u5b58\u50a8 Token","text":"<pre><code>// \u4e0d\u8981\u5728 localStorage \u4e2d\u5b58\u50a8 Token\n// \u4f7f\u7528 HttpOnly Cookie \u6216\u5185\u5b58\u5b58\u50a8\nlocalStorage.setItem('token', token);  // \u274c \u4e0d\u5b89\u5168\n\n// \u66f4\u597d\u7684\u65b9\u5f0f\uff1a\u4f7f\u7528 HttpOnly Cookie\ndocument.cookie = `token=${token}; HttpOnly; Secure; SameSite=Strict`;\n</code></pre>"},{"location":"security/authentication/#5","title":"5. \u5b9a\u671f\u8f6e\u6362\u5bc6\u94a5","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5b9a\u671f\u8f6e\u6362 JWT \u5bc6\u94a5\u4ee5\u63d0\u9ad8\u5b89\u5168\u6027\u3002</p>"},{"location":"security/authentication/#_5","title":"\u9519\u8bef\u5904\u7406","text":"<pre><code>from fastapi_easy.security import (\n    InvalidTokenError,\n    TokenExpiredError,\n    AuthenticationError,\n)\n\n@app.get(\"/protected\")\nasync def protected_endpoint(current_user: dict = Depends(get_current_user)):\n    \"\"\"\u53d7\u4fdd\u62a4\u7684\u7aef\u70b9\"\"\"\n    try:\n        # \u4f60\u7684\u4e1a\u52a1\u903b\u8f91\n        pass\n    except InvalidTokenError:\n        raise HTTPException(status_code=401, detail=\"Invalid token\")\n    except TokenExpiredError:\n        raise HTTPException(status_code=401, detail=\"Token expired\")\n    except AuthenticationError:\n        raise HTTPException(status_code=401, detail=\"Authentication failed\")\n</code></pre>"},{"location":"security/authentication/#_6","title":"\u5b8c\u6574\u793a\u4f8b","text":"<p>\u53c2\u8003 <code>examples/06_with_permissions.py</code> \u83b7\u53d6\u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b\u3002</p> <pre><code># \u8fd0\u884c\u793a\u4f8b\nuvicorn examples.06_with_permissions:app --reload\n\n# \u6d4b\u8bd5\u767b\u5f55\ncurl -X POST http://localhost:8000/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\": \"admin\", \"password\": \"password_123\"}'\n\n# \u4f7f\u7528 Token \u8bbf\u95ee\u53d7\u4fdd\u62a4\u7684\u7aef\u70b9\ncurl -X GET http://localhost:8000/profile \\\n  -H \"Authorization: Bearer &lt;your_token_here&gt;\"\n</code></pre>"},{"location":"security/password-rate-limit/","title":"\u5bc6\u7801\u548c\u767b\u5f55\u9650\u5236\u6307\u5357","text":""},{"location":"security/password-rate-limit/#_2","title":"\u6982\u8ff0","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\uff1a</p> <ul> <li>\u5b89\u5168\u7684\u5bc6\u7801\u54c8\u5e0c (bcrypt)</li> <li>\u767b\u5f55\u5c1d\u8bd5\u9650\u5236</li> <li>\u8d26\u6237\u9501\u5b9a\u673a\u5236</li> <li>\u66b4\u529b\u7834\u89e3\u9632\u62a4</li> </ul>"},{"location":"security/password-rate-limit/#_3","title":"\u5bc6\u7801\u7ba1\u7406","text":""},{"location":"security/password-rate-limit/#_4","title":"\u521d\u59cb\u5316\u5bc6\u7801\u7ba1\u7406\u5668","text":"<pre><code>from fastapi_easy.security import PasswordManager\n\n# \u521b\u5efa\u5bc6\u7801\u7ba1\u7406\u5668\npassword_manager = PasswordManager(rounds=12)\n</code></pre>"},{"location":"security/password-rate-limit/#_5","title":"\u54c8\u5e0c\u5bc6\u7801","text":"<pre><code># \u5728\u7528\u6237\u6ce8\u518c\u65f6\u54c8\u5e0c\u5bc6\u7801\npassword = \"user_password_123\"\nhashed_password = password_manager.hash_password(password)\n\n# \u4fdd\u5b58\u5230\u6570\u636e\u5e93\nuser.password_hash = hashed_password\ndb.add(user)\ndb.commit()\n</code></pre>"},{"location":"security/password-rate-limit/#_6","title":"\u9a8c\u8bc1\u5bc6\u7801","text":"<pre><code># \u5728\u7528\u6237\u767b\u5f55\u65f6\u9a8c\u8bc1\u5bc6\u7801\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    user = db.query(User).filter(User.username == username).first()\n\n    if not user:\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # \u9a8c\u8bc1\u5bc6\u7801\n    if not password_manager.verify_password(password, user.password_hash):\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n</code></pre>"},{"location":"security/password-rate-limit/#_7","title":"\u68c0\u67e5\u662f\u5426\u9700\u8981\u91cd\u65b0\u54c8\u5e0c","text":"<pre><code># \u5b9a\u671f\u68c0\u67e5\u5bc6\u7801\u662f\u5426\u9700\u8981\u91cd\u65b0\u54c8\u5e0c\n# \u4f8b\u5982\uff1a\u5f53 bcrypt rounds \u589e\u52a0\u65f6\nnew_password_manager = PasswordManager(rounds=14)\n\nif new_password_manager.needs_rehash(user.password_hash):\n    # \u5728\u7528\u6237\u4e0b\u6b21\u767b\u5f55\u65f6\u91cd\u65b0\u54c8\u5e0c\n    new_hash = new_password_manager.hash_password(original_password)\n    user.password_hash = new_hash\n    db.commit()\n</code></pre>"},{"location":"security/password-rate-limit/#_8","title":"\u767b\u5f55\u9650\u5236","text":""},{"location":"security/password-rate-limit/#_9","title":"\u521d\u59cb\u5316\u767b\u5f55\u5c1d\u8bd5\u8ddf\u8e2a\u5668","text":"<pre><code>from fastapi_easy.security import LoginAttemptTracker\n\n# \u521b\u5efa\u8ddf\u8e2a\u5668\n# \u6700\u591a 5 \u6b21\u5c1d\u8bd5\uff0c\u9501\u5b9a 15 \u5206\u949f\uff0c60 \u5206\u949f\u540e\u91cd\u7f6e\ntracker = LoginAttemptTracker(\n    max_attempts=5,\n    lockout_duration_minutes=15,\n    reset_duration_minutes=60,\n)\n</code></pre>"},{"location":"security/password-rate-limit/#_10","title":"\u8bb0\u5f55\u767b\u5f55\u5c1d\u8bd5","text":"<pre><code>@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    # \u68c0\u67e5\u662f\u5426\u88ab\u9501\u5b9a\n    if tracker.is_locked_out(username):\n        remaining = tracker.get_lockout_remaining_seconds(username)\n        raise HTTPException(\n            status_code=429,\n            detail=f\"Account locked. Try again in {remaining} seconds\",\n        )\n\n    user = db.query(User).filter(User.username == username).first()\n\n    if not user or not password_manager.verify_password(password, user.password_hash):\n        # \u8bb0\u5f55\u5931\u8d25\u7684\u5c1d\u8bd5\n        tracker.record_attempt(username, success=False)\n\n        attempt_count = tracker.get_attempt_count(username)\n        raise HTTPException(\n            status_code=401,\n            detail=f\"Invalid credentials ({attempt_count} attempts)\",\n        )\n\n    # \u8bb0\u5f55\u6210\u529f\u7684\u5c1d\u8bd5\uff08\u6e05\u9664\u8ba1\u6570\uff09\n    tracker.record_attempt(username, success=True)\n\n    # \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n</code></pre>"},{"location":"security/password-rate-limit/#_11","title":"\u83b7\u53d6\u9501\u5b9a\u4fe1\u606f","text":"<pre><code>@app.get(\"/auth/lockout-status/{username}\")\nasync def get_lockout_status(username: str):\n    \"\"\"\u83b7\u53d6\u8d26\u6237\u9501\u5b9a\u72b6\u6001\"\"\"\n    if tracker.is_locked_out(username):\n        remaining = tracker.get_lockout_remaining_seconds(username)\n        return {\n            \"locked\": True,\n            \"remaining_seconds\": remaining,\n        }\n    else:\n        attempt_count = tracker.get_attempt_count(username)\n        return {\n            \"locked\": False,\n            \"attempts\": attempt_count,\n            \"max_attempts\": 5,\n        }\n</code></pre>"},{"location":"security/password-rate-limit/#_12","title":"\u91cd\u7f6e\u7528\u6237","text":"<pre><code>@app.post(\"/admin/reset-lockout/{username}\")\nasync def reset_lockout(\n    username: str,\n    current_user: dict = Depends(require_role(\"admin\")),\n):\n    \"\"\"\u7ba1\u7406\u5458\u91cd\u7f6e\u7528\u6237\u9501\u5b9a\u72b6\u6001\"\"\"\n    tracker.reset_user(username)\n    return {\"message\": f\"Lockout reset for {username}\"}\n</code></pre>"},{"location":"security/password-rate-limit/#_13","title":"\u5b8c\u6574\u7684\u767b\u5f55\u6d41\u7a0b","text":"<pre><code>from fastapi_easy.security import (\n    PasswordManager,\n    LoginAttemptTracker,\n    AuditLogger,\n    AuditEventType,\n)\n\n# \u521d\u59cb\u5316\npassword_manager = PasswordManager()\ntracker = LoginAttemptTracker()\naudit_logger = AuditLogger()\n\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    \"\"\"\u5b8c\u6574\u7684\u767b\u5f55\u6d41\u7a0b\"\"\"\n\n    # 1. \u68c0\u67e5\u662f\u5426\u88ab\u9501\u5b9a\n    if tracker.is_locked_out(username):\n        remaining = tracker.get_lockout_remaining_seconds(username)\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_LOCKED,\n            username=username,\n            status=\"failure\",\n        )\n        raise HTTPException(status_code=429, detail=\"Account locked\")\n\n    # 2. \u67e5\u627e\u7528\u6237\n    user = db.query(User).filter(User.username == username).first()\n\n    if not user:\n        tracker.record_attempt(username, success=False)\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_FAILURE,\n            username=username,\n            status=\"failure\",\n            details={\"reason\": \"user_not_found\"},\n        )\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # 3. \u9a8c\u8bc1\u5bc6\u7801\n    if not password_manager.verify_password(password, user.password_hash):\n        tracker.record_attempt(username, success=False)\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_FAILURE,\n            username=username,\n            user_id=str(user.id),\n            status=\"failure\",\n            details={\"reason\": \"invalid_password\"},\n        )\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # 4. \u8bb0\u5f55\u6210\u529f\u7684\u5c1d\u8bd5\n    tracker.record_attempt(username, success=True)\n\n    # 5. \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    refresh_token = jwt_auth.create_refresh_token(subject=str(user.id))\n\n    # 6. \u8bb0\u5f55\u5ba1\u8ba1\u65e5\u5fd7\n    audit_logger.log(\n        event_type=AuditEventType.LOGIN_SUCCESS,\n        username=username,\n        user_id=str(user.id),\n        status=\"success\",\n    )\n\n    return {\n        \"access_token\": access_token,\n        \"refresh_token\": refresh_token,\n        \"token_type\": \"bearer\",\n    }\n</code></pre>"},{"location":"security/password-rate-limit/#_14","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/password-rate-limit/#1","title":"1. \u4f7f\u7528\u5f3a\u5bc6\u7801\u8981\u6c42","text":"<pre><code>import re\n\ndef validate_password(password: str) -&gt; bool:\n    \"\"\"\u9a8c\u8bc1\u5bc6\u7801\u5f3a\u5ea6\"\"\"\n    # \u81f3\u5c11 8 \u4e2a\u5b57\u7b26\n    if len(password) &lt; 8:\n        return False\n\n    # \u5305\u542b\u5927\u5199\u5b57\u6bcd\n    if not re.search(r'[A-Z]', password):\n        return False\n\n    # \u5305\u542b\u5c0f\u5199\u5b57\u6bcd\n    if not re.search(r'[a-z]', password):\n        return False\n\n    # \u5305\u542b\u6570\u5b57\n    if not re.search(r'\\d', password):\n        return False\n\n    # \u5305\u542b\u7279\u6b8a\u5b57\u7b26\n    if not re.search(r'[!@#$%^&amp;*(),.?\":{}|&lt;&gt;]', password):\n        return False\n\n    return True\n\n@app.post(\"/auth/register\")\nasync def register(username: str, password: str):\n    if not validate_password(password):\n        raise HTTPException(\n            status_code=400,\n            detail=\"Password must be at least 8 characters and contain uppercase, lowercase, digit, and special character\",\n        )\n\n    # \u7ee7\u7eed\u6ce8\u518c\u6d41\u7a0b\n</code></pre>"},{"location":"security/password-rate-limit/#2-bcrypt-rounds","title":"2. \u5b9a\u671f\u66f4\u65b0 bcrypt rounds","text":"<pre><code># \u6bcf\u5e74\u6216\u6839\u636e\u5b89\u5168\u5efa\u8bae\u66f4\u65b0 rounds\n# \u5f53\u8ba1\u7b97\u80fd\u529b\u589e\u52a0\u65f6\uff0c\u589e\u52a0 rounds \u4ee5\u4fdd\u6301\u5b89\u5168\u6027\npassword_manager = PasswordManager(rounds=14)  # \u4ece 12 \u589e\u52a0\u5230 14\n</code></pre>"},{"location":"security/password-rate-limit/#3","title":"3. \u76d1\u63a7\u767b\u5f55\u5931\u8d25","text":"<pre><code># \u5b9a\u671f\u68c0\u67e5\u767b\u5f55\u5931\u8d25\nfailed_logins = audit_logger.get_failed_logins(username=\"admin\", limit=10)\n\nfor login in failed_logins:\n    print(f\"Failed login attempt: {login['timestamp']}\")\n</code></pre>"},{"location":"security/password-rate-limit/#4","title":"4. \u5b9e\u73b0\u5bc6\u7801\u91cd\u7f6e","text":"<pre><code>@app.post(\"/auth/forgot-password\")\nasync def forgot_password(email: str):\n    \"\"\"\u5bc6\u7801\u91cd\u7f6e\u8bf7\u6c42\"\"\"\n    user = db.query(User).filter(User.email == email).first()\n\n    if not user:\n        # \u4e0d\u8981\u900f\u9732\u7528\u6237\u662f\u5426\u5b58\u5728\n        return {\"message\": \"If user exists, reset link will be sent\"}\n\n    # \u751f\u6210\u91cd\u7f6e\u4ee4\u724c\n    reset_token = secrets.token_urlsafe(32)\n    user.reset_token = reset_token\n    user.reset_token_expires = datetime.utcnow() + timedelta(hours=1)\n    db.commit()\n\n    # \u53d1\u9001\u91cd\u7f6e\u94fe\u63a5\n    send_reset_email(user.email, reset_token)\n\n    return {\"message\": \"Reset link sent to email\"}\n\n@app.post(\"/auth/reset-password\")\nasync def reset_password(token: str, new_password: str):\n    \"\"\"\u91cd\u7f6e\u5bc6\u7801\"\"\"\n    user = db.query(User).filter(User.reset_token == token).first()\n\n    if not user or user.reset_token_expires &lt; datetime.utcnow():\n        raise HTTPException(status_code=400, detail=\"Invalid or expired token\")\n\n    # \u54c8\u5e0c\u65b0\u5bc6\u7801\n    user.password_hash = password_manager.hash_password(new_password)\n    user.reset_token = None\n    user.reset_token_expires = None\n    db.commit()\n\n    return {\"message\": \"Password reset successfully\"}\n</code></pre>"},{"location":"security/password-rate-limit/#_15","title":"\u5b8c\u6574\u793a\u4f8b","text":"<p>\u53c2\u8003 <code>examples/06_with_permissions.py</code> \u83b7\u53d6\u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b\u3002</p>"},{"location":"security/permission-engine/","title":"\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u6307\u5357","text":"<p>\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u6743\u9650\u68c0\u67e5\u63a5\u53e3\uff0c\u652f\u6301\u591a\u79cd\u6743\u9650\u68c0\u67e5\u65b9\u5f0f\u3002</p>"},{"location":"security/permission-engine/#_2","title":"\u6982\u8ff0","text":""},{"location":"security/permission-engine/#_3","title":"\u4ec0\u4e48\u662f\u6743\u9650\u68c0\u67e5\u5f15\u64ce\uff1f","text":"<p>\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u68c0\u67e5\u7528\u6237\u6743\u9650\uff0c\u652f\u6301\u5355\u4e2a\u6743\u9650\u68c0\u67e5\u3001\u591a\u6743\u9650\u68c0\u67e5\uff08AND/OR\uff09\u548c\u8d44\u6e90\u7ea7\u6743\u9650\u68c0\u67e5\u3002</p>"},{"location":"security/permission-engine/#_4","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u6743\u9650\u68c0\u67e5\u5f15\u64ce\uff1f","text":"<ul> <li>\u7edf\u4e00\u63a5\u53e3: \u63d0\u4f9b\u7edf\u4e00\u7684\u6743\u9650\u68c0\u67e5\u65b9\u5f0f</li> <li>\u7075\u6d3b\u6027: \u652f\u6301\u591a\u79cd\u6743\u9650\u68c0\u67e5\u65b9\u5f0f</li> <li>\u6027\u80fd: \u5185\u7f6e\u7f13\u5b58\u652f\u6301</li> <li>\u53ef\u6269\u5c55\u6027: \u6613\u4e8e\u6269\u5c55\u65b0\u7684\u68c0\u67e5\u65b9\u5f0f</li> </ul>"},{"location":"security/permission-engine/#_5","title":"\u4f55\u65f6\u4f7f\u7528\u6743\u9650\u68c0\u67e5\u5f15\u64ce\uff1f","text":"<ul> <li>\u9700\u8981\u7edf\u4e00\u7684\u6743\u9650\u68c0\u67e5\u63a5\u53e3</li> <li>\u9700\u8981\u652f\u6301\u590d\u6742\u7684\u6743\u9650\u903b\u8f91</li> <li>\u9700\u8981\u6027\u80fd\u4f18\u5316</li> <li>\u9700\u8981\u8d44\u6e90\u7ea7\u6743\u9650\u68c0\u67e5</li> </ul>"},{"location":"security/permission-engine/#_6","title":"\u57fa\u7840\u4f7f\u7528","text":""},{"location":"security/permission-engine/#_7","title":"\u521d\u59cb\u5316\u5f15\u64ce","text":"<pre><code>from fastapi_easy.security import (\n    PermissionEngine,\n    StaticPermissionLoader,\n    CachedPermissionLoader\n)\n\n# \u521b\u5efa\u6743\u9650\u52a0\u8f7d\u5668\npermissions_map = {\n    \"user1\": [\"read\", \"write\"],\n    \"user2\": [\"read\"],\n    \"admin\": [\"read\", \"write\", \"delete\", \"admin\"]\n}\nloader = StaticPermissionLoader(permissions_map)\n\n# \u521b\u5efa\u6743\u9650\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=loader,\n    enable_cache=True,\n    cache_ttl=300\n)\n</code></pre>"},{"location":"security/permission-engine/#_8","title":"\u5355\u4e2a\u6743\u9650\u68c0\u67e5","text":"<pre><code># \u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u7279\u5b9a\u6743\u9650\nhas_permission = await engine.check_permission(\"user1\", \"read\")\n# \u8fd4\u56de: True\n\nhas_permission = await engine.check_permission(\"user1\", \"delete\")\n# \u8fd4\u56de: False\n</code></pre>"},{"location":"security/permission-engine/#and","title":"\u6240\u6709\u6743\u9650\u68c0\u67e5 (AND)","text":"<pre><code># \u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u6240\u6709\u6743\u9650\nhas_all = await engine.check_all_permissions(\n    \"user1\",\n    [\"read\", \"write\"]\n)\n# \u8fd4\u56de: True\n\nhas_all = await engine.check_all_permissions(\n    \"user1\",\n    [\"read\", \"write\", \"delete\"]\n)\n# \u8fd4\u56de: False\n</code></pre>"},{"location":"security/permission-engine/#or","title":"\u4efb\u610f\u6743\u9650\u68c0\u67e5 (OR)","text":"<pre><code># \u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u4efb\u610f\u6743\u9650\nhas_any = await engine.check_any_permission(\n    \"user1\",\n    [\"delete\", \"admin\"]\n)\n# \u8fd4\u56de: False\n\nhas_any = await engine.check_any_permission(\n    \"user1\",\n    [\"read\", \"delete\"]\n)\n# \u8fd4\u56de: True\n</code></pre>"},{"location":"security/permission-engine/#_9","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"security/permission-engine/#_10","title":"\u8d44\u6e90\u7ea7\u6743\u9650\u68c0\u67e5","text":"<pre><code>from fastapi_easy.security import StaticResourceChecker, CachedResourceChecker\n\n# \u521b\u5efa\u8d44\u6e90\u68c0\u67e5\u5668\nresources_map = {\n    \"post_1\": {\n        \"owner_id\": \"user1\",\n        \"permissions\": {\n            \"user2\": [\"read\"]\n        }\n    }\n}\nresource_checker = StaticResourceChecker(resources_map)\ncached_checker = CachedResourceChecker(resource_checker)\n\n# \u521b\u5efa\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=loader,\n    resource_checker=cached_checker,\n    enable_cache=True\n)\n\n# \u68c0\u67e5\u8d44\u6e90\u6743\u9650\nhas_permission = await engine.check_permission(\n    \"user1\",\n    \"read\",\n    resource_id=\"post_1\"\n)\n# \u8fd4\u56de: True\uff08\u6240\u6709\u8005\uff09\n\nhas_permission = await engine.check_permission(\n    \"user2\",\n    \"read\",\n    resource_id=\"post_1\"\n)\n# \u8fd4\u56de: True\uff08\u6709\u663e\u5f0f\u6743\u9650\uff09\n</code></pre>"},{"location":"security/permission-engine/#_11","title":"\u7f13\u5b58\u7ba1\u7406","text":"<pre><code># \u6e05\u7406\u7279\u5b9a\u7528\u6237\u7684\u7f13\u5b58\nengine.clear_cache(\"user1\")\n\n# \u6e05\u7406\u6240\u6709\u7f13\u5b58\nengine.clear_cache()\n</code></pre>"},{"location":"security/permission-engine/#_12","title":"\u7981\u7528\u7f13\u5b58","text":"<pre><code># \u521b\u5efa\u4e0d\u4f7f\u7528\u7f13\u5b58\u7684\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=loader,\n    enable_cache=False\n)\n</code></pre>"},{"location":"security/permission-engine/#_13","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"security/permission-engine/#q","title":"Q: \u5982\u4f55\u5904\u7406\u6743\u9650\u66f4\u65b0\uff1f","text":"<p>A: \u6e05\u7406\u7f13\u5b58\u540e\u91cd\u65b0\u68c0\u67e5\uff1a</p> <pre><code># \u6743\u9650\u66f4\u65b0\u540e\u6e05\u7406\u7f13\u5b58\nengine.clear_cache(\"user1\")\n\n# \u91cd\u65b0\u68c0\u67e5\nhas_permission = await engine.check_permission(\"user1\", \"read\")\n</code></pre>"},{"location":"security/permission-engine/#q_1","title":"Q: \u7f13\u5b58\u4f55\u65f6\u5931\u6548\uff1f","text":"<p>A: \u7f13\u5b58\u5728 TTL \u65f6\u95f4\u540e\u81ea\u52a8\u5931\u6548\u3002</p> <pre><code># \u8bbe\u7f6e\u81ea\u5b9a\u4e49 TTL\nengine = PermissionEngine(\n    permission_loader=loader,\n    cache_ttl=600  # 10 \u5206\u949f\n)\n</code></pre>"},{"location":"security/permission-engine/#q_2","title":"Q: \u5982\u4f55\u5904\u7406\u6743\u9650\u68c0\u67e5\u5931\u8d25\uff1f","text":"<p>A: \u6355\u83b7\u5f02\u5e38\u5e76\u5904\u7406\uff1a</p> <pre><code>try:\n    has_permission = await engine.check_permission(\"user1\", \"read\")\nexcept Exception as e:\n    logger.error(f\"Permission check failed: {e}\")\n    has_permission = False\n</code></pre>"},{"location":"security/permission-engine/#_14","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u4f7f\u7528\u7f13\u5b58: \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u59cb\u7ec8\u4f7f\u7528\u7f13\u5b58</li> <li>\u5408\u7406\u7684 TTL: \u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8bbe\u7f6e\u5408\u9002\u7684\u7f13\u5b58\u65f6\u95f4</li> <li>\u9519\u8bef\u5904\u7406: \u5904\u7406\u68c0\u67e5\u5931\u8d25\u7684\u60c5\u51b5</li> <li>\u65e5\u5fd7\u8bb0\u5f55: \u8bb0\u5f55\u6743\u9650\u68c0\u67e5\u64cd\u4f5c</li> <li>\u6027\u80fd\u76d1\u63a7: \u76d1\u63a7\u7f13\u5b58\u547d\u4e2d\u7387</li> </ol>"},{"location":"security/permission-engine/#_15","title":"\u5b8c\u6574\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI, Depends, HTTPException\nfrom fastapi_easy.security import (\n    PermissionEngine,\n    StaticPermissionLoader,\n    StaticResourceChecker,\n    CachedResourceChecker,\n    SecurityConfig,\n    JWTAuth,\n    require_permission\n)\n\napp = FastAPI()\n\n# 1. \u521b\u5efa\u6743\u9650\u52a0\u8f7d\u5668\npermissions_map = {\n    \"user1\": [\"read\", \"write\"],\n    \"user2\": [\"read\"],\n    \"admin\": [\"read\", \"write\", \"delete\", \"admin\"]\n}\nloader = StaticPermissionLoader(permissions_map)\n\n# 2. \u521b\u5efa\u8d44\u6e90\u68c0\u67e5\u5668\nresources_map = {\n    \"post_1\": {\n        \"owner_id\": \"user1\",\n        \"permissions\": {\n            \"user2\": [\"read\"]\n        }\n    }\n}\nresource_checker = StaticResourceChecker(resources_map)\ncached_checker = CachedResourceChecker(resource_checker)\n\n# 3. \u521b\u5efa\u6743\u9650\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=loader,\n    resource_checker=cached_checker,\n    enable_cache=True,\n    cache_ttl=300\n)\n\n# 4. \u521b\u5efa\u5b89\u5168\u914d\u7f6e\njwt_auth = JWTAuth(secret_key=\"your-secret-key\")\nconfig = SecurityConfig(\n    jwt_auth=jwt_auth,\n    permission_loader=loader\n)\n\n# 5. \u4f7f\u7528\u6743\u9650\u68c0\u67e5\n@app.get(\"/data\")\nasync def get_data(current_user: dict = Depends(require_permission(\"read\"))):\n    # \u68c0\u67e5\u5355\u4e2a\u6743\u9650\n    has_permission = await engine.check_permission(\n        current_user[\"user_id\"],\n        \"read\"\n    )\n\n    if not has_permission:\n        raise HTTPException(status_code=403, detail=\"No permission\")\n\n    return {\"data\": \"sensitive data\"}\n\n@app.post(\"/data\")\nasync def create_data(current_user: dict = Depends(require_permission(\"write\"))):\n    # \u68c0\u67e5\u591a\u4e2a\u6743\u9650\n    has_all = await engine.check_all_permissions(\n        current_user[\"user_id\"],\n        [\"read\", \"write\"]\n    )\n\n    if not has_all:\n        raise HTTPException(status_code=403, detail=\"Insufficient permissions\")\n\n    return {\"status\": \"created\"}\n\n@app.get(\"/posts/{post_id}\")\nasync def get_post(post_id: str, current_user: dict = Depends(require_permission(\"read\"))):\n    # \u68c0\u67e5\u8d44\u6e90\u6743\u9650\n    has_permission = await engine.check_permission(\n        current_user[\"user_id\"],\n        \"read\",\n        resource_id=post_id\n    )\n\n    if not has_permission:\n        raise HTTPException(status_code=403, detail=\"No permission\")\n\n    return {\"post_id\": post_id, \"content\": \"...\"}\n\n@app.put(\"/posts/{post_id}\")\nasync def update_post(post_id: str, current_user: dict = Depends(require_permission(\"write\"))):\n    # \u68c0\u67e5\u6240\u6709\u6743\n    is_owner = await cached_checker.check_owner(\n        current_user[\"user_id\"],\n        post_id\n    )\n\n    if not is_owner:\n        raise HTTPException(status_code=403, detail=\"Not owner\")\n\n    return {\"post_id\": post_id, \"status\": \"updated\"}\n</code></pre> <p>\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u6307\u5357\u5b8c\u6210 \u2705</p>"},{"location":"security/permission-loader/","title":"\u6743\u9650\u52a0\u8f7d\u5668","text":"<p>\u6743\u9650\u52a0\u8f7d\u5668\u8d1f\u8d23\u4ece\u6570\u636e\u5e93\u6216\u5176\u4ed6\u6570\u636e\u6e90\u52a0\u8f7d\u7528\u6237\u6743\u9650\u3002\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u6743\u9650\u52a0\u8f7d\u5668\u3002</p>"},{"location":"security/permission-loader/#_2","title":"\u4ec0\u4e48\u662f\u6743\u9650\u52a0\u8f7d\u5668","text":"<p>\u6743\u9650\u52a0\u8f7d\u5668\u662f\u4e00\u4e2a\u53ef\u63d2\u62d4\u7684\u7ec4\u4ef6\uff0c\u7528\u4e8e\uff1a</p> <ul> <li>\u4ece\u6570\u636e\u5e93\u52a0\u8f7d\u7528\u6237\u6743\u9650</li> <li>\u4ece\u7f13\u5b58\u52a0\u8f7d\u6743\u9650</li> <li>\u652f\u6301\u81ea\u5b9a\u4e49\u6743\u9650\u6e90</li> <li>\u652f\u6301\u6743\u9650\u7f13\u5b58</li> </ul>"},{"location":"security/permission-loader/#_3","title":"\u57fa\u7840\u4f7f\u7528","text":"<pre><code>from fastapi_easy.security import PermissionLoader\n\nclass DatabasePermissionLoader(PermissionLoader):\n    async def load_permissions(self, user_id: int) -&gt; List[str]:\n        # \u4ece\u6570\u636e\u5e93\u52a0\u8f7d\u6743\u9650\n        permissions = await db.query(Permission).filter(\n            Permission.user_id == user_id\n        ).all()\n        return [p.name for p in permissions]\n</code></pre>"},{"location":"security/permission-loader/#_4","title":"\u914d\u7f6e\u6743\u9650\u52a0\u8f7d\u5668","text":"<pre><code>from fastapi_easy import CRUDRouter\nfrom fastapi_easy.security import PermissionConfig\n\nconfig = PermissionConfig(\n    enabled=True,\n    permission_loader=DatabasePermissionLoader()\n)\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    permission_config=config\n)\n</code></pre>"},{"location":"security/permission-loader/#_5","title":"\u6743\u9650\u7f13\u5b58","text":"<pre><code>from fastapi_easy.security import CachedPermissionLoader\n\nclass CachedDatabasePermissionLoader(CachedPermissionLoader):\n    async def load_permissions(self, user_id: int) -&gt; List[str]:\n        # \u5148\u4ece\u7f13\u5b58\u67e5\u8be2\n        cached = await self.cache.get(f\"user:{user_id}:permissions\")\n        if cached:\n            return cached\n\n        # \u4ece\u6570\u636e\u5e93\u52a0\u8f7d\n        permissions = await db.query(Permission).filter(\n            Permission.user_id == user_id\n        ).all()\n\n        # \u7f13\u5b58\u7ed3\u679c\n        await self.cache.set(\n            f\"user:{user_id}:permissions\",\n            [p.name for p in permissions],\n            ttl=3600\n        )\n\n        return [p.name for p in permissions]\n</code></pre>"},{"location":"security/permission-loader/#_6","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/permission-loader/#1","title":"1. \u4f7f\u7528\u7f13\u5b58","text":"<pre><code># \u542f\u7528\u6743\u9650\u7f13\u5b58\nconfig = PermissionConfig(\n    enabled=True,\n    permission_loader=CachedDatabasePermissionLoader(),\n    cache_ttl=3600  # 1 \u5c0f\u65f6\u7f13\u5b58\n)\n</code></pre>"},{"location":"security/permission-loader/#2","title":"2. \u5904\u7406\u6743\u9650\u53d8\u66f4","text":"<pre><code># \u6743\u9650\u53d8\u66f4\u65f6\u6e05\u9664\u7f13\u5b58\nasync def update_user_permissions(user_id: int, permissions: List[str]):\n    # \u66f4\u65b0\u6570\u636e\u5e93\n    await db.update_permissions(user_id, permissions)\n\n    # \u6e05\u9664\u7f13\u5b58\n    await cache.delete(f\"user:{user_id}:permissions\")\n</code></pre>"},{"location":"security/permission-loader/#3","title":"3. \u5f02\u6b65\u52a0\u8f7d","text":"<pre><code># \u4f7f\u7528\u5f02\u6b65\u6570\u636e\u5e93\u67e5\u8be2\nasync def load_permissions(self, user_id: int) -&gt; List[str]:\n    async with get_db() as db:\n        permissions = await db.query(Permission).filter(\n            Permission.user_id == user_id\n        ).all()\n        return [p.name for p in permissions]\n</code></pre>"},{"location":"security/permission-loader/#_7","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"security/permission-loader/#q","title":"Q: \u5982\u4f55\u5904\u7406\u6743\u9650\u52a0\u8f7d\u5931\u8d25\uff1f","text":"<p>A: \u8fd4\u56de\u7a7a\u5217\u8868\uff0c\u7528\u6237\u5c06\u88ab\u62d2\u7edd\u8bbf\u95ee\u3002</p>"},{"location":"security/permission-loader/#q_1","title":"Q: \u5982\u4f55\u652f\u6301\u591a\u4e2a\u6743\u9650\u6e90\uff1f","text":"<p>A: \u5b9e\u73b0 CompositePermissionLoader\uff0c\u7ec4\u5408\u591a\u4e2a\u52a0\u8f7d\u5668\u3002</p>"},{"location":"security/permission-loader/#q_2","title":"Q: \u6027\u80fd\u5982\u4f55\u4f18\u5316\uff1f","text":"<p>A: \u4f7f\u7528\u7f13\u5b58\u548c\u6279\u91cf\u52a0\u8f7d\u6743\u9650\u3002</p>"},{"location":"security/permissions/","title":"\u6743\u9650\u63a7\u5236\u6307\u5357","text":""},{"location":"security/permissions/#_2","title":"\u6982\u8ff0","text":"<p>FastAPI-Easy \u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u6743\u9650\u63a7\u5236\u7cfb\u7edf\uff0c\u652f\u6301\uff1a</p> <ul> <li>\u89d2\u8272\u6743\u9650\u68c0\u67e5 (RBAC)</li> <li>\u7ec6\u7c92\u5ea6\u6743\u9650\u63a7\u5236</li> <li>\u591a\u79cd\u6743\u9650\u68c0\u67e5\u65b9\u5f0f</li> <li>\u5b8c\u6574\u7684\u9519\u8bef\u5904\u7406</li> </ul>"},{"location":"security/permissions/#_3","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"security/permissions/#1","title":"1. \u5b9a\u4e49\u89d2\u8272\u548c\u6743\u9650","text":"<pre><code>from enum import Enum\n\nclass Role(str, Enum):\n    ADMIN = \"admin\"\n    EDITOR = \"editor\"\n    VIEWER = \"viewer\"\n    USER = \"user\"\n\nclass Permission(str, Enum):\n    READ = \"read\"\n    CREATE = \"create\"\n    UPDATE = \"update\"\n    DELETE = \"delete\"\n</code></pre>"},{"location":"security/permissions/#2","title":"2. \u521b\u5efa\u5e26\u6743\u9650\u68c0\u67e5\u7684\u7aef\u70b9","text":"<pre><code>from fastapi import Depends\nfrom fastapi_easy.security import require_role, require_permission\n\n# \u8981\u6c42\u81f3\u5c11\u4e00\u4e2a\u89d2\u8272\n@app.post(\"/items\")\nasync def create_item(\n    item: Item,\n    current_user: dict = Depends(require_role(\"editor\", \"admin\")),\n):\n    \"\"\"\u521b\u5efa\u9879\u76ee - \u9700\u8981 editor \u6216 admin \u89d2\u8272\"\"\"\n    return {\"item\": item, \"created_by\": current_user[\"user_id\"]}\n\n# \u8981\u6c42\u6240\u6709\u89d2\u8272\n@app.delete(\"/items/{item_id}\")\nasync def delete_item(\n    item_id: int,\n    current_user: dict = Depends(require_all_roles(\"admin\", \"moderator\")),\n):\n    \"\"\"\u5220\u9664\u9879\u76ee - \u9700\u8981 admin \u548c moderator \u89d2\u8272\"\"\"\n    return {\"message\": \"Item deleted\"}\n\n# \u8981\u6c42\u7279\u5b9a\u6743\u9650\n@app.put(\"/items/{item_id}\")\nasync def update_item(\n    item_id: int,\n    item: Item,\n    current_user: dict = Depends(require_permission(\"update\")),\n):\n    \"\"\"\u66f4\u65b0\u9879\u76ee - \u9700\u8981 update \u6743\u9650\"\"\"\n    return {\"item\": item, \"updated_by\": current_user[\"user_id\"]}\n</code></pre>"},{"location":"security/permissions/#_4","title":"\u6743\u9650\u68c0\u67e5\u88c5\u9970\u5668","text":""},{"location":"security/permissions/#require_roleroles","title":"require_role(*roles)","text":"<p>\u8981\u6c42\u7528\u6237\u81f3\u5c11\u62e5\u6709\u4e00\u4e2a\u6307\u5b9a\u7684\u89d2\u8272\u3002</p> <pre><code>@app.get(\"/admin-panel\")\nasync def admin_panel(\n    current_user: dict = Depends(require_role(\"admin\")),\n):\n    \"\"\"\u7ba1\u7406\u5458\u9762\u677f - \u53ea\u6709 admin \u89d2\u8272\u53ef\u8bbf\u95ee\"\"\"\n    return {\"message\": \"Welcome admin\"}\n</code></pre>"},{"location":"security/permissions/#require_all_rolesroles","title":"require_all_roles(*roles)","text":"<p>\u8981\u6c42\u7528\u6237\u62e5\u6709\u6240\u6709\u6307\u5b9a\u7684\u89d2\u8272\u3002</p> <pre><code>@app.get(\"/super-admin\")\nasync def super_admin(\n    current_user: dict = Depends(require_all_roles(\"admin\", \"moderator\")),\n):\n    \"\"\"\u8d85\u7ea7\u7ba1\u7406\u5458 - \u9700\u8981 admin \u548c moderator \u89d2\u8272\"\"\"\n    return {\"message\": \"Welcome super admin\"}\n</code></pre>"},{"location":"security/permissions/#require_permissionpermissions","title":"require_permission(*permissions)","text":"<p>\u8981\u6c42\u7528\u6237\u81f3\u5c11\u62e5\u6709\u4e00\u4e2a\u6307\u5b9a\u7684\u6743\u9650\u3002</p> <pre><code>@app.post(\"/publish\")\nasync def publish(\n    content: str,\n    current_user: dict = Depends(require_permission(\"publish\", \"admin\")),\n):\n    \"\"\"\u53d1\u5e03\u5185\u5bb9 - \u9700\u8981 publish \u6216 admin \u6743\u9650\"\"\"\n    return {\"content\": content, \"published_by\": current_user[\"user_id\"]}\n</code></pre>"},{"location":"security/permissions/#require_all_permissionspermissions","title":"require_all_permissions(*permissions)","text":"<p>\u8981\u6c42\u7528\u6237\u62e5\u6709\u6240\u6709\u6307\u5b9a\u7684\u6743\u9650\u3002</p> <pre><code>@app.post(\"/sensitive-operation\")\nasync def sensitive_operation(\n    current_user: dict = Depends(require_all_permissions(\"read\", \"write\", \"delete\")),\n):\n    \"\"\"\u654f\u611f\u64cd\u4f5c - \u9700\u8981 read\u3001write \u548c delete \u6743\u9650\"\"\"\n    return {\"message\": \"Operation completed\"}\n</code></pre>"},{"location":"security/permissions/#jwt-token","title":"\u5728 JWT Token \u4e2d\u5305\u542b\u6743\u9650","text":"<pre><code>from fastapi_easy.security import init_jwt_auth\n\njwt_auth = init_jwt_auth()\n\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    \"\"\"\u767b\u5f55\u5e76\u8fd4\u56de\u5305\u542b\u6743\u9650\u7684 Token\"\"\"\n    # \u9a8c\u8bc1\u7528\u6237\n    user = authenticate_user(username, password)\n\n    # \u83b7\u53d6\u7528\u6237\u89d2\u8272\u548c\u6743\u9650\n    roles = get_user_roles(user.id)\n    permissions = get_user_permissions(user.id)\n\n    # \u521b\u5efa Token\n    access_token = jwt_auth.create_access_token(\n        subject=str(user.id),\n        roles=roles,\n        permissions=permissions,\n    )\n\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n</code></pre>"},{"location":"security/permissions/#_5","title":"\u81ea\u5b9a\u4e49\u6743\u9650\u68c0\u67e5","text":"<p>\u5982\u679c\u9700\u8981\u66f4\u590d\u6742\u7684\u6743\u9650\u68c0\u67e5\u903b\u8f91\uff0c\u53ef\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49\u88c5\u9970\u5668\uff1a</p> <pre><code>from fastapi import Depends, HTTPException\n\ndef require_resource_owner(resource_id: int):\n    \"\"\"\u8981\u6c42\u7528\u6237\u662f\u8d44\u6e90\u7684\u6240\u6709\u8005\"\"\"\n    async def check_owner(current_user: dict = Depends(get_current_user)):\n        resource = get_resource(resource_id)\n        if resource.owner_id != int(current_user[\"user_id\"]):\n            raise HTTPException(\n                status_code=403,\n                detail=\"You are not the owner of this resource\",\n            )\n        return current_user\n\n    return Depends(check_owner)\n\n@app.delete(\"/items/{item_id}\")\nasync def delete_item(\n    item_id: int,\n    current_user: dict = Depends(require_resource_owner(item_id)),\n):\n    \"\"\"\u5220\u9664\u9879\u76ee - \u53ea\u6709\u6240\u6709\u8005\u53ef\u5220\u9664\"\"\"\n    delete_resource(item_id)\n    return {\"message\": \"Item deleted\"}\n</code></pre>"},{"location":"security/permissions/#_6","title":"\u6743\u9650\u68c0\u67e5\u6d41\u7a0b","text":"<pre><code>\u8bf7\u6c42\u5230\u8fbe\n    \u2193\n\u68c0\u67e5 Authorization Header\n    \u2193\n\u9a8c\u8bc1 JWT Token\n    \u2193\n\u68c0\u67e5 Token \u662f\u5426\u8fc7\u671f\n    \u2193\n\u63d0\u53d6\u7528\u6237\u4fe1\u606f (ID\u3001\u89d2\u8272\u3001\u6743\u9650)\n    \u2193\n\u68c0\u67e5\u6743\u9650\u8981\u6c42\n    \u2193\n\u2713 \u901a\u8fc7 \u2192 \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n\u2717 \u5931\u8d25 \u2192 \u8fd4\u56de 403 Forbidden\n</code></pre>"},{"location":"security/permissions/#_7","title":"\u9519\u8bef\u5904\u7406","text":"<pre><code>from fastapi_easy.security import (\n    AuthorizationError,\n    InsufficientPermissionError,\n)\n\n@app.exception_handler(AuthorizationError)\nasync def authorization_exception_handler(request, exc):\n    return {\n        \"error\": \"Authorization Failed\",\n        \"detail\": exc.message,\n        \"status_code\": 403,\n    }\n\n@app.exception_handler(InsufficientPermissionError)\nasync def insufficient_permission_handler(request, exc):\n    return {\n        \"error\": \"Insufficient Permission\",\n        \"detail\": exc.message,\n        \"status_code\": 403,\n    }\n</code></pre>"},{"location":"security/permissions/#_8","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/permissions/#1_1","title":"1. \u6700\u5c0f\u6743\u9650\u539f\u5219","text":"<p>\u53ea\u6388\u4e88\u7528\u6237\u5b8c\u6210\u5de5\u4f5c\u6240\u9700\u7684\u6700\u5c0f\u6743\u9650\u3002</p> <pre><code># \u274c \u4e0d\u597d\uff1a\u7ed9\u6240\u6709\u7528\u6237 admin \u6743\u9650\nuser.roles = [\"admin\"]\n\n# \u2705 \u597d\uff1a\u53ea\u7ed9\u9700\u8981\u7684\u6743\u9650\nuser.roles = [\"editor\"]\nuser.permissions = [\"read\", \"create\", \"update\"]\n</code></pre>"},{"location":"security/permissions/#2_1","title":"2. \u5b9a\u671f\u5ba1\u8ba1\u6743\u9650","text":"<p>\u5b9a\u671f\u68c0\u67e5\u7528\u6237\u6743\u9650\uff0c\u79fb\u9664\u4e0d\u9700\u8981\u7684\u6743\u9650\u3002</p> <pre><code># \u5ba1\u8ba1\u7528\u6237\u6743\u9650\naudit_logs = audit_logger.get_user_activity(user_id=user_id)\nfor log in audit_logs:\n    if log[\"event_type\"] == \"permission_denied\":\n        # \u5206\u6790\u88ab\u62d2\u7edd\u7684\u6743\u9650\n        pass\n</code></pre>"},{"location":"security/permissions/#3","title":"3. \u4f7f\u7528\u89d2\u8272\u800c\u4e0d\u662f\u76f4\u63a5\u6743\u9650","text":"<p>\u4f7f\u7528\u89d2\u8272\u6765\u7ba1\u7406\u6743\u9650\u66f4\u5bb9\u6613\u7ef4\u62a4\u3002</p> <pre><code># \u274c \u4e0d\u597d\uff1a\u76f4\u63a5\u5206\u914d\u6743\u9650\nuser.permissions = [\"read\", \"create\", \"update\", \"delete\", \"publish\"]\n\n# \u2705 \u597d\uff1a\u4f7f\u7528\u89d2\u8272\nuser.roles = [\"editor\"]  # editor \u89d2\u8272\u5305\u542b\u6240\u6709\u8fd9\u4e9b\u6743\u9650\n</code></pre>"},{"location":"security/permissions/#4","title":"4. \u8bb0\u5f55\u6743\u9650\u62d2\u7edd","text":"<p>\u8bb0\u5f55\u6240\u6709\u6743\u9650\u62d2\u7edd\u4ee5\u4fbf\u5ba1\u8ba1\u3002</p> <pre><code>from fastapi_easy.security import AuditEventType\n\n@app.get(\"/sensitive-data\")\nasync def get_sensitive_data(\n    current_user: dict = Depends(require_permission(\"admin\")),\n):\n    # \u6743\u9650\u68c0\u67e5\u5931\u8d25\u65f6\u81ea\u52a8\u8bb0\u5f55\n    # audit_logger.log(\n    #     event_type=AuditEventType.PERMISSION_DENIED,\n    #     user_id=current_user[\"user_id\"],\n    #     resource=\"sensitive-data\",\n    # )\n    return {\"data\": \"sensitive\"}\n</code></pre>"},{"location":"security/permissions/#_9","title":"\u5b8c\u6574\u793a\u4f8b","text":"<p>\u53c2\u8003 <code>examples/06_with_permissions.py</code> \u83b7\u53d6\u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b\u3002</p>"},{"location":"security/resource-checker/","title":"\u8d44\u6e90\u68c0\u67e5\u5668\u6307\u5357","text":"<p>\u8d44\u6e90\u68c0\u67e5\u5668\u7528\u4e8e\u68c0\u67e5\u7528\u6237\u662f\u5426\u62e5\u6709\u6216\u6709\u6743\u9650\u8bbf\u95ee\u7279\u5b9a\u8d44\u6e90\u3002</p>"},{"location":"security/resource-checker/#_2","title":"\u6982\u8ff0","text":""},{"location":"security/resource-checker/#_3","title":"\u4ec0\u4e48\u662f\u8d44\u6e90\u68c0\u67e5\u5668\uff1f","text":"<p>\u8d44\u6e90\u68c0\u67e5\u5668\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u4e8e\u68c0\u67e5\u7528\u6237\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5305\u62ec\u6240\u6709\u6743\u68c0\u67e5\u548c\u6743\u9650\u68c0\u67e5\u3002</p>"},{"location":"security/resource-checker/#_4","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u8d44\u6e90\u68c0\u67e5\u5668\uff1f","text":"<ul> <li>\u7ec6\u7c92\u5ea6\u63a7\u5236: \u652f\u6301\u8d44\u6e90\u7ea7\u522b\u7684\u6743\u9650\u63a7\u5236</li> <li>\u6240\u6709\u6743\u68c0\u67e5: \u9a8c\u8bc1\u7528\u6237\u662f\u5426\u62e5\u6709\u8d44\u6e90</li> <li>\u7075\u6d3b\u6027: \u652f\u6301\u591a\u79cd\u8d44\u6e90\u7c7b\u578b</li> <li>\u53ef\u6269\u5c55\u6027: \u6613\u4e8e\u6dfb\u52a0\u65b0\u7684\u8d44\u6e90\u7c7b\u578b</li> </ul>"},{"location":"security/resource-checker/#_5","title":"\u4f55\u65f6\u4f7f\u7528\u8d44\u6e90\u68c0\u67e5\u5668\uff1f","text":"<ul> <li>\u7528\u6237\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684\u8d44\u6e90</li> <li>\u9700\u8981\u8d44\u6e90\u7ea7\u522b\u7684\u6743\u9650\u63a7\u5236</li> <li>\u9700\u8981\u652f\u6301\u5171\u4eab\u8d44\u6e90</li> <li>\u9700\u8981\u7ec6\u7c92\u5ea6\u7684\u8bbf\u95ee\u63a7\u5236</li> </ul>"},{"location":"security/resource-checker/#_6","title":"\u57fa\u7840\u4f7f\u7528","text":""},{"location":"security/resource-checker/#_7","title":"\u9759\u6001\u8d44\u6e90\u68c0\u67e5\u5668","text":"<p>\u4ece\u9759\u6001\u914d\u7f6e\u68c0\u67e5\u8d44\u6e90\u6743\u9650\uff1a</p> <pre><code>from fastapi_easy.security import StaticResourceChecker\n\n# \u5b9a\u4e49\u8d44\u6e90\u6620\u5c04\nresources_map = {\n    \"post_1\": {\n        \"owner_id\": \"user1\",\n        \"permissions\": {\n            \"user2\": [\"read\"],\n            \"user3\": [\"read\", \"comment\"]\n        }\n    },\n    \"post_2\": {\n        \"owner_id\": \"user2\",\n        \"permissions\": {\n            \"user1\": [\"read\"]\n        }\n    }\n}\n\n# \u521b\u5efa\u68c0\u67e5\u5668\nchecker = StaticResourceChecker(resources_map)\n\n# \u68c0\u67e5\u6240\u6709\u6743\nis_owner = await checker.check_owner(\"user1\", \"post_1\")\n# \u8fd4\u56de: True\n\n# \u68c0\u67e5\u6743\u9650\nhas_permission = await checker.check_permission(\"user2\", \"post_1\", \"read\")\n# \u8fd4\u56de: True\n</code></pre>"},{"location":"security/resource-checker/#_8","title":"\u6570\u636e\u5e93\u8d44\u6e90\u68c0\u67e5\u5668","text":"<p>\u4ece\u6570\u636e\u5e93\u68c0\u67e5\u8d44\u6e90\u6743\u9650\uff08\u5360\u4f4d\u7b26\u5b9e\u73b0\uff09\uff1a</p> <pre><code>from fastapi_easy.security import DatabaseResourceChecker\n\n# \u521b\u5efa\u68c0\u67e5\u5668\nchecker = DatabaseResourceChecker(db_session=session)\n\n# \u68c0\u67e5\u6240\u6709\u6743\nis_owner = await checker.check_owner(\"user1\", \"post_1\")\n\n# \u68c0\u67e5\u6743\u9650\nhas_permission = await checker.check_permission(\"user1\", \"post_1\", \"read\")\n</code></pre>"},{"location":"security/resource-checker/#_9","title":"\u7f13\u5b58\u8d44\u6e90\u68c0\u67e5\u5668","text":"<p>\u6dfb\u52a0\u7f13\u5b58\u5c42\u4ee5\u63d0\u9ad8\u6027\u80fd\uff1a</p> <pre><code>from fastapi_easy.security import (\n    StaticResourceChecker,\n    CachedResourceChecker\n)\n\n# \u521b\u5efa\u57fa\u7840\u68c0\u67e5\u5668\nbase_checker = StaticResourceChecker(resources_map)\n\n# \u6dfb\u52a0\u7f13\u5b58\ncached_checker = CachedResourceChecker(\n    base_checker,\n    cache_ttl=300  # 5 \u5206\u949f\u7f13\u5b58\n)\n\n# \u4f7f\u7528\nis_owner = await cached_checker.check_owner(\"user1\", \"post_1\")\n</code></pre>"},{"location":"security/resource-checker/#_10","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"security/resource-checker/#_11","title":"\u81ea\u5b9a\u4e49\u8d44\u6e90\u68c0\u67e5\u5668","text":"<p>\u5b9e\u73b0\u81ea\u5df1\u7684\u8d44\u6e90\u68c0\u67e5\u5668\uff1a</p> <pre><code>class CustomResourceChecker:\n    \"\"\"\u81ea\u5b9a\u4e49\u8d44\u6e90\u68c0\u67e5\u5668\"\"\"\n\n    async def check_owner(self, user_id: str, resource_id: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u7528\u6237\u662f\u5426\u62e5\u6709\u8d44\u6e90\"\"\"\n        # \u81ea\u5b9a\u4e49\u5b9e\u73b0\n        resource = await get_resource(resource_id)\n        return resource.owner_id == user_id\n\n    async def check_permission(\n        self,\n        user_id: str,\n        resource_id: str,\n        permission: str\n    ) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u8d44\u6e90\u6743\u9650\"\"\"\n        # \u9996\u5148\u68c0\u67e5\u6240\u6709\u6743\n        if await self.check_owner(user_id, resource_id):\n            return True\n\n        # \u7136\u540e\u68c0\u67e5\u663e\u5f0f\u6743\u9650\n        resource = await get_resource(resource_id)\n        return permission in resource.get_user_permissions(user_id)\n\n# \u4f7f\u7528\nchecker = CustomResourceChecker()\nis_owner = await checker.check_owner(\"user1\", \"post_1\")\n</code></pre>"},{"location":"security/resource-checker/#_12","title":"\u8d44\u6e90\u7f13\u5b58\u7ba1\u7406","text":"<p>\u6e05\u7406\u7f13\u5b58\uff1a</p> <pre><code># \u6e05\u7406\u7279\u5b9a\u7528\u6237\u7684\u7f13\u5b58\ncached_checker.clear_cache(\"user1\")\n\n# \u6e05\u7406\u7279\u5b9a\u8d44\u6e90\u7684\u7f13\u5b58\ncached_checker.clear_cache(\"post_1\")\n\n# \u6e05\u7406\u6240\u6709\u7f13\u5b58\ncached_checker.clear_cache()\n</code></pre>"},{"location":"security/resource-checker/#_13","title":"\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u96c6\u6210","text":"<p>\u4e0e\u6743\u9650\u68c0\u67e5\u5f15\u64ce\u96c6\u6210\uff1a</p> <pre><code>from fastapi_easy.security import PermissionEngine\n\n# \u521b\u5efa\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=permission_loader,\n    resource_checker=cached_checker,\n    enable_cache=True\n)\n\n# \u68c0\u67e5\u8d44\u6e90\u6743\u9650\nhas_permission = await engine.check_permission(\n    \"user1\",\n    \"read\",\n    resource_id=\"post_1\"\n)\n</code></pre>"},{"location":"security/resource-checker/#_14","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"security/resource-checker/#q","title":"Q: \u6240\u6709\u6743\u68c0\u67e5\u548c\u6743\u9650\u68c0\u67e5\u7684\u533a\u522b\uff1f","text":"<p>A: \u6240\u6709\u6743\u68c0\u67e5\u9a8c\u8bc1\u7528\u6237\u662f\u5426\u62e5\u6709\u8d44\u6e90\uff0c\u6743\u9650\u68c0\u67e5\u9a8c\u8bc1\u7528\u6237\u662f\u5426\u6709\u7279\u5b9a\u6743\u9650\u3002</p> <pre><code># \u6240\u6709\u6743\u68c0\u67e5\uff1a\u7528\u6237\u662f\u5426\u62e5\u6709\u8d44\u6e90\nis_owner = await checker.check_owner(\"user1\", \"post_1\")\n\n# \u6743\u9650\u68c0\u67e5\uff1a\u7528\u6237\u662f\u5426\u6709\u6743\u9650\nhas_permission = await checker.check_permission(\"user1\", \"post_1\", \"read\")\n</code></pre>"},{"location":"security/resource-checker/#q_1","title":"Q: \u7f13\u5b58\u4f55\u65f6\u5931\u6548\uff1f","text":"<p>A: \u7f13\u5b58\u5728 TTL \u65f6\u95f4\u540e\u81ea\u52a8\u5931\u6548\u3002</p> <pre><code># \u8bbe\u7f6e\u81ea\u5b9a\u4e49 TTL\ncached_checker = CachedResourceChecker(\n    base_checker,\n    cache_ttl=600  # 10 \u5206\u949f\n)\n</code></pre>"},{"location":"security/resource-checker/#q_2","title":"Q: \u5982\u4f55\u5904\u7406\u6743\u9650\u66f4\u65b0\uff1f","text":"<p>A: \u6e05\u7406\u7f13\u5b58\u540e\u91cd\u65b0\u68c0\u67e5\uff1a</p> <pre><code># \u6e05\u7406\u7f13\u5b58\ncached_checker.clear_cache(\"user1\")\n\n# \u91cd\u65b0\u68c0\u67e5\nhas_permission = await cached_checker.check_permission(\"user1\", \"post_1\", \"read\")\n</code></pre>"},{"location":"security/resource-checker/#_15","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u4f7f\u7528\u7f13\u5b58: \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u59cb\u7ec8\u4f7f\u7528\u7f13\u5b58</li> <li>\u5408\u7406\u7684 TTL: \u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8bbe\u7f6e\u5408\u9002\u7684\u7f13\u5b58\u65f6\u95f4</li> <li>\u9519\u8bef\u5904\u7406: \u5904\u7406\u68c0\u67e5\u5931\u8d25\u7684\u60c5\u51b5</li> <li>\u65e5\u5fd7\u8bb0\u5f55: \u8bb0\u5f55\u6743\u9650\u68c0\u67e5\u64cd\u4f5c</li> <li>\u6027\u80fd\u76d1\u63a7: \u76d1\u63a7\u7f13\u5b58\u547d\u4e2d\u7387</li> </ol>"},{"location":"security/resource-checker/#_16","title":"\u5b8c\u6574\u793a\u4f8b","text":"<pre><code>from fastapi import FastAPI, Depends, HTTPException\nfrom fastapi_easy.security import (\n    StaticResourceChecker,\n    CachedResourceChecker,\n    PermissionEngine,\n    require_permission\n)\n\napp = FastAPI()\n\n# 1. \u5b9a\u4e49\u8d44\u6e90\nresources_map = {\n    \"post_1\": {\n        \"owner_id\": \"user1\",\n        \"permissions\": {\n            \"user2\": [\"read\"],\n            \"user3\": [\"read\", \"comment\"]\n        }\n    }\n}\n\n# 2. \u521b\u5efa\u8d44\u6e90\u68c0\u67e5\u5668\nchecker = StaticResourceChecker(resources_map)\ncached_checker = CachedResourceChecker(checker, cache_ttl=300)\n\n# 3. \u521b\u5efa\u6743\u9650\u5f15\u64ce\nengine = PermissionEngine(\n    permission_loader=permission_loader,\n    resource_checker=cached_checker,\n    enable_cache=True\n)\n\n# 4. \u4f7f\u7528\u8d44\u6e90\u6743\u9650\u68c0\u67e5\n@app.get(\"/posts/{post_id}\")\nasync def get_post(\n    post_id: str,\n    current_user: dict = Depends(require_permission(\"read\"))\n):\n    # \u68c0\u67e5\u8d44\u6e90\u6743\u9650\n    has_permission = await engine.check_permission(\n        current_user[\"user_id\"],\n        \"read\",\n        resource_id=post_id\n    )\n\n    if not has_permission:\n        raise HTTPException(status_code=403, detail=\"No permission\")\n\n    return {\"post_id\": post_id, \"content\": \"...\"}\n\n@app.put(\"/posts/{post_id}\")\nasync def update_post(\n    post_id: str,\n    current_user: dict = Depends(require_permission(\"write\"))\n):\n    # \u68c0\u67e5\u6240\u6709\u6743\n    is_owner = await cached_checker.check_owner(\n        current_user[\"user_id\"],\n        post_id\n    )\n\n    if not is_owner:\n        raise HTTPException(status_code=403, detail=\"Not owner\")\n\n    return {\"post_id\": post_id, \"status\": \"updated\"}\n\n@app.delete(\"/posts/{post_id}\")\nasync def delete_post(\n    post_id: str,\n    current_user: dict = Depends(require_permission(\"delete\"))\n):\n    # \u68c0\u67e5\u6240\u6709\u6743\n    is_owner = await cached_checker.check_owner(\n        current_user[\"user_id\"],\n        post_id\n    )\n\n    if not is_owner:\n        raise HTTPException(status_code=403, detail=\"Not owner\")\n\n    return {\"post_id\": post_id, \"status\": \"deleted\"}\n</code></pre> <p>\u8d44\u6e90\u68c0\u67e5\u5668\u6307\u5357\u5b8c\u6210 \u2705</p>"},{"location":"security/security-best-practices/","title":"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/security-best-practices/#_2","title":"\u6982\u8ff0","text":"<p>\u672c\u6307\u5357\u63d0\u4f9b\u4e86\u4f7f\u7528 FastAPI-Easy \u5b89\u5168\u6a21\u5757\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"security/security-best-practices/#1","title":"1. \u5bc6\u94a5\u7ba1\u7406","text":""},{"location":"security/security-best-practices/#_3","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code># \u4f7f\u7528\u73af\u5883\u53d8\u91cf\nimport os\nfrom fastapi_easy.security import init_jwt_auth\n\nsecret_key = os.getenv(\"JWT_SECRET_KEY\")\nif not secret_key:\n    raise ValueError(\"JWT_SECRET_KEY environment variable is not set\")\n\njwt_auth = init_jwt_auth(secret_key=secret_key)\n</code></pre>"},{"location":"security/security-best-practices/#_4","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u786c\u7f16\u7801\u5bc6\u94a5\njwt_auth = init_jwt_auth(secret_key=\"my-secret-key-123\")\n\n# \u4e0d\u8981\u5728\u4ee3\u7801\u4e2d\u63d0\u4ea4\u5bc6\u94a5\n# git add .env  # \u274c \u9519\u8bef\n</code></pre>"},{"location":"security/security-best-practices/#_5","title":"\u5bc6\u94a5\u8f6e\u6362","text":"<pre><code># \u5b9a\u671f\u8f6e\u6362\u5bc6\u94a5\n# 1. \u751f\u6210\u65b0\u5bc6\u94a5\nnew_secret_key = secrets.token_urlsafe(32)\n\n# 2. \u521b\u5efa\u65b0\u7684 JWT \u8ba4\u8bc1\u5b9e\u4f8b\nnew_jwt_auth = init_jwt_auth(secret_key=new_secret_key)\n\n# 3. \u5141\u8bb8\u65e7\u5bc6\u94a5\u7684 Token \u7ee7\u7eed\u5de5\u4f5c\uff08\u8fc7\u6e21\u671f\uff09\n# 4. \u66f4\u65b0\u73af\u5883\u53d8\u91cf\n# 5. \u91cd\u542f\u5e94\u7528\n</code></pre>"},{"location":"security/security-best-practices/#2","title":"2. \u5bc6\u7801\u5b89\u5168","text":""},{"location":"security/security-best-practices/#_6","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code>from fastapi_easy.security import PasswordManager\nimport re\n\npassword_manager = PasswordManager(rounds=12)\n\ndef validate_password_strength(password: str) -&gt; bool:\n    \"\"\"\u9a8c\u8bc1\u5bc6\u7801\u5f3a\u5ea6\"\"\"\n    # \u81f3\u5c11 12 \u4e2a\u5b57\u7b26\n    if len(password) &lt; 12:\n        return False\n\n    # \u5305\u542b\u5927\u5199\u5b57\u6bcd\n    if not re.search(r'[A-Z]', password):\n        return False\n\n    # \u5305\u542b\u5c0f\u5199\u5b57\u6bcd\n    if not re.search(r'[a-z]', password):\n        return False\n\n    # \u5305\u542b\u6570\u5b57\n    if not re.search(r'\\d', password):\n        return False\n\n    # \u5305\u542b\u7279\u6b8a\u5b57\u7b26\n    if not re.search(r'[!@#$%^&amp;*(),.?\":{}|&lt;&gt;]', password):\n        return False\n\n    return True\n\n@app.post(\"/auth/register\")\nasync def register(username: str, password: str):\n    if not validate_password_strength(password):\n        raise HTTPException(\n            status_code=400,\n            detail=\"Password is too weak\",\n        )\n\n    hashed = password_manager.hash_password(password)\n    # \u4fdd\u5b58\u7528\u6237\n</code></pre>"},{"location":"security/security-best-practices/#_7","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5b58\u50a8\u660e\u6587\u5bc6\u7801\nuser.password = password  # \u274c \u9519\u8bef\n\n# \u4e0d\u8981\u4f7f\u7528\u7b80\u5355\u7684\u54c8\u5e0c\nimport hashlib\nuser.password = hashlib.md5(password.encode()).hexdigest()  # \u274c \u9519\u8bef\n\n# \u4e0d\u8981\u5141\u8bb8\u5f31\u5bc6\u7801\nif len(password) &gt;= 4:  # \u274c \u592a\u5f31\n    user.password = password_manager.hash_password(password)\n</code></pre>"},{"location":"security/security-best-practices/#3-token","title":"3. Token \u5b89\u5168","text":""},{"location":"security/security-best-practices/#_8","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code># \u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\njwt_auth = init_jwt_auth(\n    access_token_expire_minutes=15,    # \u77ed\u671f\u8bbf\u95ee\u4ee4\u724c\n    refresh_token_expire_days=7,       # \u957f\u671f\u5237\u65b0\u4ee4\u724c\n)\n\n# \u5728\u5ba2\u6237\u7aef\u4f7f\u7528 HttpOnly Cookie\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    refresh_token = jwt_auth.create_refresh_token(subject=str(user.id))\n\n    response = JSONResponse(\n        content={\"message\": \"Login successful\"},\n        status_code=200,\n    )\n\n    # \u4f7f\u7528 HttpOnly Cookie \u5b58\u50a8 Token\n    response.set_cookie(\n        key=\"access_token\",\n        value=access_token,\n        httponly=True,\n        secure=True,  # \u4ec5 HTTPS\n        samesite=\"strict\",\n        max_age=15 * 60,  # 15 \u5206\u949f\n    )\n\n    response.set_cookie(\n        key=\"refresh_token\",\n        value=refresh_token,\n        httponly=True,\n        secure=True,\n        samesite=\"strict\",\n        max_age=7 * 24 * 60 * 60,  # 7 \u5929\n    )\n\n    return response\n</code></pre>"},{"location":"security/security-best-practices/#_9","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5728 localStorage \u4e2d\u5b58\u50a8 Token\n# localStorage.setItem('token', token)  # \u274c \u6613\u53d7 XSS \u653b\u51fb\n\n# \u4e0d\u8981\u8bbe\u7f6e\u8fc7\u957f\u7684\u8fc7\u671f\u65f6\u95f4\njwt_auth = init_jwt_auth(\n    access_token_expire_minutes=10080,  # \u274c 7 \u5929\u592a\u957f\n)\n\n# \u4e0d\u8981\u5728 URL \u4e2d\u4f20\u8f93 Token\n# GET /api/data?token=xyz  # \u274c \u9519\u8bef\n</code></pre>"},{"location":"security/security-best-practices/#4","title":"4. \u767b\u5f55\u5b89\u5168","text":""},{"location":"security/security-best-practices/#_10","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code>from fastapi_easy.security import LoginAttemptTracker\n\ntracker = LoginAttemptTracker(\n    max_attempts=5,\n    lockout_duration_minutes=15,\n)\n\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    # \u68c0\u67e5\u662f\u5426\u88ab\u9501\u5b9a\n    if tracker.is_locked_out(username):\n        remaining = tracker.get_lockout_remaining_seconds(username)\n        raise HTTPException(\n            status_code=429,\n            detail=f\"Too many attempts. Try again in {remaining} seconds\",\n        )\n\n    # \u9a8c\u8bc1\u7528\u6237\n    user = authenticate_user(username, password)\n\n    if not user:\n        tracker.record_attempt(username, success=False)\n        raise HTTPException(status_code=401, detail=\"Invalid credentials\")\n\n    # \u6210\u529f\n    tracker.record_attempt(username, success=True)\n\n    # \u751f\u6210 Token\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    return {\"access_token\": access_token}\n</code></pre>"},{"location":"security/security-best-practices/#_11","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u900f\u9732\u7528\u6237\u662f\u5426\u5b58\u5728\nif user_exists(username):  # \u274c \u4fe1\u606f\u6cc4\u9732\n    if not verify_password(password, user.password):\n        raise HTTPException(detail=\"Invalid password\")\nelse:\n    raise HTTPException(detail=\"User not found\")\n\n# \u6b63\u786e\u505a\u6cd5\uff1a\nraise HTTPException(detail=\"Invalid username or password\")\n\n# \u4e0d\u8981\u5141\u8bb8\u65e0\u9650\u5236\u7684\u767b\u5f55\u5c1d\u8bd5\n# \u6ca1\u6709\u767b\u5f55\u9650\u5236  # \u274c \u6613\u53d7\u66b4\u529b\u7834\u89e3\n</code></pre>"},{"location":"security/security-best-practices/#5","title":"5. \u6743\u9650\u68c0\u67e5","text":""},{"location":"security/security-best-practices/#_12","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code>from fastapi_easy.security import require_role, require_permission\n\n# \u4f7f\u7528\u88c5\u9970\u5668\u68c0\u67e5\u6743\u9650\n@app.delete(\"/users/{user_id}\")\nasync def delete_user(\n    user_id: int,\n    current_user: dict = Depends(require_role(\"admin\")),\n):\n    \"\"\"\u5220\u9664\u7528\u6237 - \u4ec5\u7ba1\u7406\u5458\"\"\"\n    # \u6743\u9650\u68c0\u67e5\u5df2\u81ea\u52a8\u8fdb\u884c\n    return {\"message\": \"User deleted\"}\n\n# \u68c0\u67e5\u8d44\u6e90\u6240\u6709\u6743\n@app.put(\"/items/{item_id}\")\nasync def update_item(\n    item_id: int,\n    item: Item,\n    current_user: dict = Depends(get_current_user),\n):\n    \"\"\"\u66f4\u65b0\u9879\u76ee - \u4ec5\u6240\u6709\u8005\"\"\"\n    existing_item = get_item(item_id)\n\n    if existing_item.owner_id != int(current_user[\"user_id\"]):\n        raise HTTPException(status_code=403, detail=\"Not authorized\")\n\n    # \u66f4\u65b0\u9879\u76ee\n    return update_item_in_db(item_id, item)\n</code></pre>"},{"location":"security/security-best-practices/#_13","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5728\u4e1a\u52a1\u903b\u8f91\u4e2d\u68c0\u67e5\u6743\u9650\n@app.delete(\"/users/{user_id}\")\nasync def delete_user(user_id: int, current_user: dict):\n    if current_user[\"role\"] != \"admin\":  # \u274c \u592a\u665a\u4e86\n        raise HTTPException(status_code=403)\n    # \u4e1a\u52a1\u903b\u8f91\n\n# \u4e0d\u8981\u4fe1\u4efb\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6743\u9650\n@app.post(\"/items\")\nasync def create_item(item: Item, user_role: str):  # \u274c \u4e0d\u5b89\u5168\n    if user_role == \"admin\":\n        # \u7ed9\u4e88\u7279\u6b8a\u6743\u9650\n        pass\n</code></pre>"},{"location":"security/security-best-practices/#6","title":"6. \u5ba1\u8ba1\u548c\u76d1\u63a7","text":""},{"location":"security/security-best-practices/#_14","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code>from fastapi_easy.security import AuditLogger, AuditEventType\n\naudit_logger = AuditLogger()\n\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    # \u8bb0\u5f55\u6240\u6709\u767b\u5f55\u5c1d\u8bd5\n    try:\n        user = authenticate_user(username, password)\n\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_SUCCESS,\n            user_id=str(user.id),\n            username=username,\n            status=\"success\",\n        )\n\n        # \u751f\u6210 Token\n        access_token = jwt_auth.create_access_token(subject=str(user.id))\n        return {\"access_token\": access_token}\n\n    except Exception as e:\n        audit_logger.log(\n            event_type=AuditEventType.LOGIN_FAILURE,\n            username=username,\n            status=\"failure\",\n            details={\"error\": str(e)},\n        )\n        raise\n\n# \u5b9a\u671f\u68c0\u67e5\u5ba1\u8ba1\u65e5\u5fd7\ndef check_suspicious_activity():\n    \"\"\"\u68c0\u67e5\u53ef\u7591\u6d3b\u52a8\"\"\"\n    failed_logins = audit_logger.get_failed_logins(\"admin\", limit=10)\n\n    if len(failed_logins) &gt; 5:\n        # \u53d1\u9001\u8b66\u544a\n        send_alert(\"Multiple failed login attempts for admin account\")\n\nimport schedule\nschedule.every(1).hour.do(check_suspicious_activity)\n</code></pre>"},{"location":"security/security-best-practices/#_15","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5ffd\u7565\u5ba1\u8ba1\u65e5\u5fd7\n@app.post(\"/auth/login\")\nasync def login(username: str, password: str):\n    # \u6ca1\u6709\u8bb0\u5f55\u767b\u5f55\u5c1d\u8bd5  # \u274c \u65e0\u6cd5\u5ba1\u8ba1\n    user = authenticate_user(username, password)\n    access_token = jwt_auth.create_access_token(subject=str(user.id))\n    return {\"access_token\": access_token}\n\n# \u4e0d\u8981\u53ea\u8bb0\u5f55\u6210\u529f\u7684\u4e8b\u4ef6\n# \u8bb0\u5f55\u5931\u8d25\u7684\u4e8b\u4ef6\u540c\u6837\u91cd\u8981\n</code></pre>"},{"location":"security/security-best-practices/#7-https","title":"7. HTTPS \u548c\u4f20\u8f93\u5b89\u5168","text":""},{"location":"security/security-best-practices/#_16","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi.middleware.trustedhost import TrustedHostMiddleware\n\napp = FastAPI()\n\n# \u914d\u7f6e CORS\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"https://yourdomain.com\"],  # \u4ec5\u5141\u8bb8\u7279\u5b9a\u57df\u540d\n    allow_credentials=True,\n    allow_methods=[\"GET\", \"POST\"],\n    allow_headers=[\"Authorization\"],\n)\n\n# \u914d\u7f6e\u53d7\u4fe1\u4efb\u7684\u4e3b\u673a\napp.add_middleware(\n    TrustedHostMiddleware,\n    allowed_hosts=[\"yourdomain.com\", \"www.yourdomain.com\"],\n)\n\n# \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 HTTPS\n# \u4f7f\u7528 SSL \u8bc1\u4e66\uff08Let's Encrypt\uff09\n# \u914d\u7f6e HSTS \u5934\n</code></pre>"},{"location":"security/security-best-practices/#_17","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528 HTTP\n# uvicorn app:app --host 0.0.0.0  # \u274c \u4e0d\u5b89\u5168\n\n# \u4e0d\u8981\u5141\u8bb8\u6240\u6709 CORS \u6e90\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # \u274c \u4e0d\u5b89\u5168\n)\n\n# \u4e0d\u8981\u7981\u7528 HTTPS\n# \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5fc5\u987b\u4f7f\u7528 HTTPS\n</code></pre>"},{"location":"security/security-best-practices/#8","title":"8. \u4f9d\u8d56\u548c\u66f4\u65b0","text":""},{"location":"security/security-best-practices/#_18","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code># \u5b9a\u671f\u66f4\u65b0\u4f9d\u8d56\n# pip install --upgrade PyJWT bcrypt\n\n# \u4f7f\u7528 requirements.txt \u56fa\u5b9a\u7248\u672c\n# PyJWT==2.8.0\n# bcrypt==4.0.0\n\n# \u5b9a\u671f\u68c0\u67e5\u5b89\u5168\u6f0f\u6d1e\n# pip install safety\n# safety check\n</code></pre>"},{"location":"security/security-best-practices/#_19","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u4f7f\u7528\u8fc7\u65f6\u7684\u5e93\n# PyJWT==1.0.0  # \u274c \u592a\u65e7\n\n# \u4e0d\u8981\u5ffd\u89c6\u5b89\u5168\u66f4\u65b0\n# \u4e0d\u66f4\u65b0\u4f9d\u8d56  # \u274c \u53ef\u80fd\u6709\u6f0f\u6d1e\n</code></pre>"},{"location":"security/security-best-practices/#9","title":"9. \u9519\u8bef\u5904\u7406","text":""},{"location":"security/security-best-practices/#_20","title":"\u2705 \u6b63\u786e\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u900f\u9732\u5185\u90e8\u9519\u8bef\u4fe1\u606f\n@app.get(\"/data\")\nasync def get_data(current_user: dict = Depends(get_current_user)):\n    try:\n        # \u4e1a\u52a1\u903b\u8f91\n        pass\n    except Exception as e:\n        # \u8bb0\u5f55\u8be6\u7ec6\u9519\u8bef\n        logger.error(f\"Error: {e}\", exc_info=True)\n\n        # \u8fd4\u56de\u901a\u7528\u9519\u8bef\u4fe1\u606f\n        raise HTTPException(\n            status_code=500,\n            detail=\"Internal server error\",\n        )\n</code></pre>"},{"location":"security/security-best-practices/#_21","title":"\u274c \u9519\u8bef\u505a\u6cd5","text":"<pre><code># \u4e0d\u8981\u5728\u9519\u8bef\u4fe1\u606f\u4e2d\u900f\u9732\u654f\u611f\u4fe1\u606f\nraise HTTPException(\n    status_code=500,\n    detail=f\"Database error: {str(e)}\",  # \u274c \u6cc4\u9732\u6570\u636e\u5e93\u4fe1\u606f\n)\n\n# \u4e0d\u8981\u5ffd\u89c6\u9519\u8bef\ntry:\n    # \u4e1a\u52a1\u903b\u8f91\n    pass\nexcept:\n    pass  # \u274c \u5ffd\u89c6\u9519\u8bef\n</code></pre>"},{"location":"security/security-best-practices/#10","title":"10. \u90e8\u7f72\u68c0\u67e5\u6e05\u5355","text":"<ul> <li> \u4f7f\u7528\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6240\u6709\u5bc6\u94a5</li> <li> \u542f\u7528 HTTPS</li> <li> \u914d\u7f6e CORS</li> <li> \u8bbe\u7f6e\u5408\u7406\u7684 Token \u8fc7\u671f\u65f6\u95f4</li> <li> \u542f\u7528\u767b\u5f55\u9650\u5236</li> <li> \u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7</li> <li> \u5b9a\u671f\u5907\u4efd\u5ba1\u8ba1\u65e5\u5fd7</li> <li> \u76d1\u63a7\u53ef\u7591\u6d3b\u52a8</li> <li> \u5b9a\u671f\u66f4\u65b0\u4f9d\u8d56</li> <li> \u8fdb\u884c\u5b89\u5168\u5ba1\u8ba1</li> <li> \u914d\u7f6e\u65e5\u5fd7\u548c\u76d1\u63a7</li> <li> \u8bbe\u7f6e\u544a\u8b66\u89c4\u5219</li> </ul>"},{"location":"security/security-best-practices/#_22","title":"\u53c2\u8003\u8d44\u6e90","text":"<ul> <li>OWASP Top 10</li> <li>JWT Best Practices</li> <li>FastAPI Security</li> <li>bcrypt Documentation</li> </ul>"},{"location":"security/security-config/","title":"\u5b89\u5168\u914d\u7f6e","text":"<p>\u5b89\u5168\u914d\u7f6e\u7528\u4e8e\u7ba1\u7406 FastAPI-Easy \u7684\u6240\u6709\u5b89\u5168\u76f8\u5173\u8bbe\u7f6e\u3002\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e\u5b89\u5168\u9009\u9879\u3002</p>"},{"location":"security/security-config/#_2","title":"\u57fa\u7840\u914d\u7f6e","text":"<pre><code>from fastapi_easy.security import SecurityConfig\n\nconfig = SecurityConfig(\n    # \u8ba4\u8bc1\u914d\u7f6e\n    enable_auth=True,\n    auth_scheme=\"bearer\",\n\n    # \u6743\u9650\u914d\u7f6e\n    enable_permissions=True,\n    default_permission=\"read\",\n\n    # \u901f\u7387\u9650\u5236\n    enable_rate_limit=True,\n    rate_limit_requests=100,\n    rate_limit_period=3600,\n\n    # \u5bc6\u7801\u914d\u7f6e\n    password_min_length=8,\n    password_require_uppercase=True,\n    password_require_numbers=True,\n    password_require_special=True,\n)\n</code></pre>"},{"location":"security/security-config/#_3","title":"\u8ba4\u8bc1\u914d\u7f6e","text":"<pre><code>config = SecurityConfig(\n    enable_auth=True,\n    auth_scheme=\"bearer\",\n    jwt_secret=\"your-secret-key\",\n    jwt_algorithm=\"HS256\",\n    jwt_expiration=3600,\n)\n</code></pre>"},{"location":"security/security-config/#_4","title":"\u6743\u9650\u914d\u7f6e","text":"<pre><code>config = SecurityConfig(\n    enable_permissions=True,\n    default_permission=\"read\",\n    permission_loader=DatabasePermissionLoader(),\n    cache_permissions=True,\n    cache_ttl=3600,\n)\n</code></pre>"},{"location":"security/security-config/#_5","title":"\u901f\u7387\u9650\u5236\u914d\u7f6e","text":"<pre><code>config = SecurityConfig(\n    enable_rate_limit=True,\n    rate_limit_requests=100,\n    rate_limit_period=3600,  # 1 \u5c0f\u65f6\n    rate_limit_storage=\"memory\",  # \u6216 \"redis\"\n)\n</code></pre>"},{"location":"security/security-config/#_6","title":"\u5bc6\u7801\u7b56\u7565","text":"<pre><code>config = SecurityConfig(\n    password_min_length=12,\n    password_require_uppercase=True,\n    password_require_lowercase=True,\n    password_require_numbers=True,\n    password_require_special=True,\n    password_special_chars=\"!@#$%^&amp;*\",\n)\n</code></pre>"},{"location":"security/security-config/#_7","title":"\u5e94\u7528\u914d\u7f6e","text":"<pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\n\napp = FastAPI()\n\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=adapter,\n    security_config=config\n)\n\napp.include_router(router)\n</code></pre>"},{"location":"security/security-config/#_8","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"security/security-config/#1","title":"1. \u4f7f\u7528\u73af\u5883\u53d8\u91cf","text":"<pre><code>import os\nfrom fastapi_easy.security import SecurityConfig\n\nconfig = SecurityConfig(\n    jwt_secret=os.getenv(\"JWT_SECRET\"),\n    jwt_algorithm=os.getenv(\"JWT_ALGORITHM\", \"HS256\"),\n    jwt_expiration=int(os.getenv(\"JWT_EXPIRATION\", \"3600\")),\n)\n</code></pre>"},{"location":"security/security-config/#2","title":"2. \u5206\u73af\u5883\u914d\u7f6e","text":"<pre><code>from enum import Enum\n\nclass Environment(str, Enum):\n    DEV = \"dev\"\n    PROD = \"prod\"\n\ndef get_security_config(env: Environment) -&gt; SecurityConfig:\n    if env == Environment.PROD:\n        return SecurityConfig(\n            enable_auth=True,\n            enable_permissions=True,\n            enable_rate_limit=True,\n            password_min_length=12,\n        )\n    else:\n        return SecurityConfig(\n            enable_auth=False,\n            password_min_length=6,\n        )\n</code></pre>"},{"location":"security/security-config/#3","title":"3. \u5b9a\u671f\u66f4\u65b0\u5bc6\u94a5","text":"<pre><code># \u5b9a\u671f\u8f6e\u6362 JWT \u5bc6\u94a5\nimport asyncio\n\nasync def rotate_jwt_secret():\n    while True:\n        await asyncio.sleep(86400)  # \u6bcf\u5929\u8f6e\u6362\u4e00\u6b21\n        new_secret = generate_new_secret()\n        config.jwt_secret = new_secret\n</code></pre>"},{"location":"security/security-config/#_9","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"security/security-config/#q-jwt","title":"Q: \u5982\u4f55\u66f4\u6539 JWT \u5bc6\u94a5\uff1f","text":"<p>A: \u66f4\u65b0 <code>config.jwt_secret</code> \u5e76\u91cd\u542f\u5e94\u7528\u3002</p>"},{"location":"security/security-config/#q","title":"Q: \u5982\u4f55\u7981\u7528\u67d0\u4e2a\u5b89\u5168\u529f\u80fd\uff1f","text":"<p>A: \u5728 SecurityConfig \u4e2d\u8bbe\u7f6e\u76f8\u5e94\u7684 <code>enable_*</code> \u4e3a False\u3002</p>"},{"location":"security/security-config/#q_1","title":"Q: \u5982\u4f55\u81ea\u5b9a\u4e49\u5bc6\u7801\u7b56\u7565\uff1f","text":"<p>A: \u7ee7\u627f SecurityConfig \u5e76\u8986\u76d6 <code>validate_password</code> \u65b9\u6cd5\u3002</p>"},{"location":"tutorial/01-quick-start/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u9884\u8ba1\u65f6\u95f4: 5 \u5206\u949f \u96be\u5ea6: \u2b50 \u6781\u7b80 \u76ee\u6807: \u8fd0\u884c\u7b2c\u4e00\u4e2a\u5b8c\u6574\u7684 CRUD API</p>"},{"location":"tutorial/01-quick-start/#1","title":"1. \u5b89\u88c5","text":"<pre><code>pip install fastapi-easy fastapi uvicorn sqlalchemy aiosqlite\n</code></pre>"},{"location":"tutorial/01-quick-start/#2-sqlite","title":"2. \u6700\u7b80\u5355\u7684\u4f8b\u5b50 (SQLite)","text":"<p>\u521b\u5efa\u6587\u4ef6 <code>main.py</code>:</p> <pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAdapter\nfrom sqlalchemy.ext.asyncio import create_async_engine, AsyncSession\nfrom sqlalchemy.orm import sessionmaker, declarative_base\nfrom sqlalchemy import Column, Integer, String, Float\nfrom pydantic import BaseModel\n\n# 1. \u5b9a\u4e49 ORM \u6a21\u578b\nBase = declarative_base()\n\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n\n# 2. \u5b9a\u4e49 Pydantic Schema\nclass Item(BaseModel):\n    id: int\n    name: str\n    price: float\n\n    class Config:\n        from_attributes = True\n\n# 3. \u914d\u7f6e\u6570\u636e\u5e93 (SQLite)\nengine = create_async_engine(\"sqlite+aiosqlite:///./test.db\")\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# 4. \u521b\u5efa\u5e94\u7528\napp = FastAPI(title=\"FastAPI-Easy \u5feb\u901f\u5f00\u59cb\")\n\n# 5. \u521d\u59cb\u5316\u6570\u636e\u5e93\u8868 (\u4ec5\u7528\u4e8e\u6f14\u793a\uff0c\u751f\u4ea7\u73af\u5883\u8bf7\u4f7f\u7528\u8fc1\u79fb\u5de5\u5177)\n@app.on_event(\"startup\")\nasync def startup():\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\n# 6. \u4e00\u884c\u4ee3\u7801\u751f\u6210\u5b8c\u6574\u7684 CRUD API!\nrouter = CRUDRouter(\n    schema=Item,\n    adapter=SQLAlchemyAdapter(ItemDB, get_db)\n)\napp.include_router(router)\n</code></pre>"},{"location":"tutorial/01-quick-start/#3","title":"3. \u8fd0\u884c","text":"<pre><code>uvicorn main:app --reload\n</code></pre> <p>\u8f93\u51fa: <pre><code>INFO:     Uvicorn running on http://127.0.0.1:8000\nINFO:     Application startup complete\n</code></pre></p>"},{"location":"tutorial/01-quick-start/#4-api","title":"4. \u6d4b\u8bd5 API","text":"<p>\u8bbf\u95ee http://localhost:8000/docs</p> <p>\u4f60\u4f1a\u770b\u5230\u6240\u6709\u81ea\u52a8\u751f\u6210\u7684 API \u7aef\u70b9\uff1a</p> <ul> <li><code>GET /item</code> - \u83b7\u53d6\u6240\u6709\u9879\u76ee</li> <li><code>GET /item/{id}</code> - \u83b7\u53d6\u5355\u4e2a\u9879\u76ee</li> <li><code>POST /item</code> - \u521b\u5efa\u9879\u76ee</li> <li><code>PUT /item/{id}</code> - \u66f4\u65b0\u9879\u76ee</li> <li><code>DELETE /item/{id}</code> - \u5220\u9664\u9879\u76ee</li> <li><code>DELETE /item</code> - \u5220\u9664\u6240\u6709\u9879\u76ee (\u9700\u914d\u7f6e\u5f00\u542f)</li> </ul>"},{"location":"tutorial/01-quick-start/#5","title":"5. \u4e0b\u4e00\u6b65","text":"<p>\u73b0\u5728\u4f60\u5df2\u7ecf\u638c\u63e1\u4e86\u57fa\u7840\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60:</p>"},{"location":"tutorial/01-quick-start/#_2","title":"\u521d\u7ea7 (\u63a8\u8350\u987a\u5e8f)","text":"<ol> <li>\u4e0e\u6570\u636e\u5e93\u96c6\u6210 - \u6df1\u5165\u4e86\u89e3\u6570\u636e\u5e93\u914d\u7f6e</li> <li>\u67e5\u8be2\u6307\u5357 - \u5b66\u4e60\u641c\u7d22\u3001\u8fc7\u6ee4\u3001\u6392\u5e8f</li> </ol>"},{"location":"tutorial/01-quick-start/#_3","title":"\u4e2d\u7ea7","text":"<ol> <li>\u5b8c\u6574\u9879\u76ee - \u67e5\u770b\u5b8c\u6574\u7684\u7535\u5546 API</li> <li>\u57fa\u7840\u6743\u9650 - \u6dfb\u52a0\u6743\u9650\u63a7\u5236</li> </ol>"},{"location":"tutorial/01-quick-start/#_4","title":"\u9ad8\u7ea7","text":"<ol> <li>\u67b6\u6784\u8bbe\u8ba1 - \u6df1\u5165\u7406\u89e3\u5185\u90e8\u67b6\u6784</li> <li>\u9002\u914d\u5668\u6982\u89c8 - \u4e86\u89e3\u652f\u6301\u7684\u5176\u4ed6\u6570\u636e\u5e93</li> </ol>"},{"location":"tutorial/02-database-integration/","title":"\u6570\u636e\u5e93\u96c6\u6210\u5feb\u901f\u6307\u5357","text":"<p>\u9884\u8ba1\u65f6\u95f4: 10 \u5206\u949f \u96be\u5ea6: \u2b50\u2b50 \u7b80\u5355 \u76ee\u6807: \u5feb\u901f\u96c6\u6210\u6570\u636e\u5e93\uff0c\u5b9e\u73b0\u6570\u636e\u6301\u4e45\u5316</p>"},{"location":"tutorial/02-database-integration/#_2","title":"\u6982\u8ff0","text":"<p>\u672c\u6307\u5357\u5c55\u793a\u5982\u4f55\u5c06 fastapi-easy \u4e0e\u6570\u636e\u5e93\u96c6\u6210\uff0c\u5b9e\u73b0\u771f\u5b9e\u7684\u6570\u636e\u6301\u4e45\u5316\u3002</p> <p>\u652f\u6301\u7684\u6570\u636e\u5e93: - SQLite (\u63a8\u8350\u7528\u4e8e\u5f00\u53d1) - PostgreSQL (\u63a8\u8350\u7528\u4e8e\u751f\u4ea7) - MySQL - MongoDB</p> <p>\u672c\u6307\u5357\u4ee5 SQLite + SQLAlchemy \u4e3a\u4f8b (\u6700\u7b80\u5355\u7684\u65b9\u5f0f)\u3002</p>"},{"location":"tutorial/02-database-integration/#1","title":"1. \u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install fastapi-easy fastapi uvicorn sqlalchemy\n</code></pre>"},{"location":"tutorial/02-database-integration/#2","title":"2. \u5b8c\u6574\u793a\u4f8b\u4ee3\u7801","text":"<p>\u521b\u5efa\u6587\u4ef6 <code>main_db.py</code>:</p> <pre><code>from fastapi import FastAPI\nfrom sqlalchemy import create_engine, Column, Integer, String, Float\nfrom sqlalchemy.orm import declarative_base, sessionmaker\nfrom pydantic import BaseModel\nfrom typing import Optional\nfrom fastapi_easy import CRUDRouter, SQLAlchemyAdapter\n\n# ============ 1. \u6570\u636e\u5e93\u914d\u7f6e ============\n\nDATABASE_URL = \"sqlite:///./test.db\"\nengine = create_engine(DATABASE_URL, connect_args={\"check_same_thread\": False})\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\nBase = declarative_base()\n\n\n# ============ 2. \u5b9a\u4e49 ORM \u6a21\u578b ============\n\nclass ItemDB(Base):\n    \"\"\"\u6570\u636e\u5e93\u6a21\u578b\"\"\"\n    __tablename__ = \"items\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String, index=True)\n    description = Column(String, nullable=True)\n    price = Column(Float)\n\n\n# ============ 3. \u5b9a\u4e49 Pydantic Schema ============\n\nclass Item(BaseModel):\n    \"\"\"API \u6570\u636e\u6a21\u578b\"\"\"\n    id: Optional[int] = None\n    name: str\n    description: Optional[str] = None\n    price: float\n\n    class Config:\n        from_attributes = True\n\n\n# ============ 4. \u521b\u5efa\u8868 ============\n\nBase.metadata.create_all(bind=engine)\n\n\n# ============ 5. \u521b\u5efa\u5e94\u7528 ============\n\napp = FastAPI(title=\"FastAPI-Easy \u6570\u636e\u5e93\u793a\u4f8b\")\n\n\n# ============ 6. \u521b\u5efa\u9002\u914d\u5668 ============\n\nadapter = SQLAlchemyAdapter(model=ItemDB, session_factory=SessionLocal)\n\n\n# ============ 7. \u521b\u5efa CRUDRouter ============\n\nrouter = CRUDRouter(schema=Item, adapter=adapter)\napp.include_router(router)\n\n\n# ============ 8. \u6839\u8def\u7531 ============\n\n@app.get(\"/\")\nasync def root():\n    return {\n        \"message\": \"\u6b22\u8fce\u4f7f\u7528 FastAPI-Easy \u6570\u636e\u5e93\u793a\u4f8b\",\n        \"docs\": \"/docs\",\n        \"database\": \"SQLite (test.db)\",\n        \"note\": \"\u6240\u6709\u6570\u636e\u90fd\u4f1a\u88ab\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\"\n    }\n</code></pre>"},{"location":"tutorial/02-database-integration/#3","title":"3. \u8fd0\u884c","text":"<pre><code>uvicorn main_db:app --reload\n</code></pre>"},{"location":"tutorial/02-database-integration/#4-api","title":"4. \u6d4b\u8bd5 API","text":"<p>\u8bbf\u95ee http://localhost:8000/docs</p>"},{"location":"tutorial/02-database-integration/#_3","title":"\u521b\u5efa\u9879\u76ee","text":"<pre><code>curl -X POST http://localhost:8000/items \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"\u7b14\u8bb0\u672c\u7535\u8111\",\n    \"description\": \"\u9ad8\u6027\u80fd\u7b14\u8bb0\u672c\",\n    \"price\": 5999.99\n  }'\n</code></pre> <p>\u54cd\u5e94: <pre><code>{\n  \"id\": 1,\n  \"name\": \"\u7b14\u8bb0\u672c\u7535\u8111\",\n  \"description\": \"\u9ad8\u6027\u80fd\u7b14\u8bb0\u672c\",\n  \"price\": 5999.99\n}\n</code></pre></p>"},{"location":"tutorial/02-database-integration/#_4","title":"\u83b7\u53d6\u6240\u6709\u9879\u76ee","text":"<pre><code>curl http://localhost:8000/items\n</code></pre> <p>\u54cd\u5e94: <pre><code>[\n  {\n    \"id\": 1,\n    \"name\": \"\u7b14\u8bb0\u672c\u7535\u8111\",\n    \"description\": \"\u9ad8\u6027\u80fd\u7b14\u8bb0\u672c\",\n    \"price\": 5999.99\n  }\n]\n</code></pre></p>"},{"location":"tutorial/02-database-integration/#_5","title":"\u66f4\u65b0\u9879\u76ee","text":"<pre><code>curl -X PUT http://localhost:8000/items/1 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"\u7b14\u8bb0\u672c\u7535\u8111 (\u66f4\u65b0)\",\n    \"description\": \"\u9ad8\u6027\u80fd\u7b14\u8bb0\u672c\",\n    \"price\": 6999.99\n  }'\n</code></pre>"},{"location":"tutorial/02-database-integration/#_6","title":"\u5220\u9664\u9879\u76ee","text":"<pre><code>curl -X DELETE http://localhost:8000/items/1\n</code></pre>"},{"location":"tutorial/02-database-integration/#5","title":"5. \u5173\u952e\u6982\u5ff5","text":""},{"location":"tutorial/02-database-integration/#orm-vs-pydantic-schema","title":"ORM \u6a21\u578b vs Pydantic Schema","text":"\u65b9\u9762 ORM \u6a21\u578b Pydantic Schema \u7528\u9014 \u5b9a\u4e49\u6570\u636e\u5e93\u8868\u7ed3\u6784 \u5b9a\u4e49 API \u8bf7\u6c42/\u54cd\u5e94\u683c\u5f0f \u4f4d\u7f6e \u6570\u636e\u5e93\u5c42 API \u5c42 \u793a\u4f8b <code>ItemDB</code> <code>Item</code> \u5b57\u6bb5\u5b9a\u4e49 SQLAlchemy Column Pydantic Field"},{"location":"tutorial/02-database-integration/#sqlalchemyadapter","title":"SQLAlchemyAdapter","text":"<p><code>SQLAlchemyAdapter</code> \u662f\u8fde\u63a5 CRUDRouter \u548c\u6570\u636e\u5e93\u7684\u6865\u6881:</p> <pre><code>adapter = SQLAlchemyAdapter(\n    model=ItemDB,              # ORM \u6a21\u578b\n    session_factory=SessionLocal  # \u6570\u636e\u5e93\u4f1a\u8bdd\u5de5\u5382\n)\n</code></pre> <p>\u5b83\u81ea\u52a8\u5904\u7406: - \u6570\u636e\u5e93\u8fde\u63a5 - \u4f1a\u8bdd\u7ba1\u7406 - CRUD \u64cd\u4f5c - \u4e8b\u52a1\u7ba1\u7406</p>"},{"location":"tutorial/02-database-integration/#6","title":"6. \u6570\u636e\u6301\u4e45\u5316\u9a8c\u8bc1","text":"<p>\u91cd\u542f\u5e94\u7528\u540e\uff0c\u6570\u636e\u4ecd\u7136\u5b58\u5728:</p> <pre><code># \u7b2c\u4e00\u6b21\u8fd0\u884c\uff0c\u521b\u5efa\u9879\u76ee\ncurl -X POST http://localhost:8000/items \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"\u82f9\u679c\", \"price\": 15.5}'\n\n# \u505c\u6b62\u5e94\u7528 (Ctrl+C)\n\n# \u91cd\u65b0\u542f\u52a8\u5e94\u7528\nuvicorn main_db:app --reload\n\n# \u6570\u636e\u4ecd\u7136\u5b58\u5728!\ncurl http://localhost:8000/items\n</code></pre>"},{"location":"tutorial/02-database-integration/#7","title":"7. \u4f7f\u7528\u5176\u4ed6\u6570\u636e\u5e93","text":""},{"location":"tutorial/02-database-integration/#postgresql","title":"PostgreSQL","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\n# pip install psycopg2-binary\n\nDATABASE_URL = \"postgresql://user:password@localhost/dbname\"\nengine = create_engine(DATABASE_URL)\n</code></pre>"},{"location":"tutorial/02-database-integration/#mysql","title":"MySQL","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\n# pip install pymysql\n\nDATABASE_URL = \"mysql+pymysql://user:password@localhost/dbname\"\nengine = create_engine(DATABASE_URL)\n</code></pre>"},{"location":"tutorial/02-database-integration/#mongodb","title":"MongoDB","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\n# pip install motor\n\n# \u4f7f\u7528 Tortoise ORM \u800c\u4e0d\u662f SQLAlchemy\nfrom fastapi_easy import TortoiseAdapter\n</code></pre>"},{"location":"tutorial/02-database-integration/#8","title":"8. \u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u5982\u4f55\u67e5\u770b\u751f\u6210\u7684\u6570\u636e\u5e93\u6587\u4ef6? A: SQLite \u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u751f\u6210 <code>test.db</code> \u6587\u4ef6\u3002\u53ef\u4ee5\u7528 SQLite \u5ba2\u6237\u7aef\u6253\u5f00\u67e5\u770b\u3002</p> <p>Q: \u5982\u4f55\u6dfb\u52a0\u66f4\u591a\u5b57\u6bb5? A: \u5728 ORM \u6a21\u578b\u4e2d\u6dfb\u52a0\u5217\uff0c\u5728 Pydantic Schema \u4e2d\u6dfb\u52a0\u5b57\u6bb5:</p> <pre><code># ORM \u6a21\u578b\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    stock = Column(Integer)  # \u65b0\u5b57\u6bb5\n\n# Pydantic Schema\nclass Item(BaseModel):\n    id: Optional[int] = None\n    name: str\n    price: float\n    stock: int = 0  # \u65b0\u5b57\u6bb5\n</code></pre> <p>Q: \u5982\u4f55\u91cd\u7f6e\u6570\u636e\u5e93? A: \u5220\u9664 <code>test.db</code> \u6587\u4ef6\uff0c\u91cd\u65b0\u8fd0\u884c\u5e94\u7528\u4f1a\u81ea\u52a8\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u3002</p> <p>Q: \u5982\u4f55\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528? A: \u4f7f\u7528 PostgreSQL \u6216 MySQL\uff0c\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u7ba1\u7406\u6570\u636e\u5e93 URL\u3002</p>"},{"location":"tutorial/02-database-integration/#9","title":"9. \u4e0b\u4e00\u6b65","text":"<p>\u73b0\u5728\u4f60\u5df2\u7ecf\u638c\u63e1\u4e86\u6570\u636e\u5e93\u96c6\u6210\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60:</p> <ol> <li>\u542f\u7528\u67e5\u8be2\u529f\u80fd - \u6dfb\u52a0\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875</li> <li> <p>\u67e5\u770b\u793a\u4f8b: <code>examples/03_with_queries.py</code></p> </li> <li> <p>\u9ad8\u7ea7\u529f\u80fd - \u8f6f\u5220\u9664\u3001\u5ba1\u8ba1\u65e5\u5fd7</p> </li> <li> <p>\u67e5\u770b\u793a\u4f8b: <code>examples/04_advanced_features.py</code></p> </li> <li> <p>\u5b8c\u6574\u9879\u76ee - \u591a\u8d44\u6e90\u7535\u5546 API</p> </li> <li>\u67e5\u770b\u793a\u4f8b: <code>examples/05_complete_ecommerce.py</code></li> </ol>"},{"location":"tutorial/02-database-integration/#10","title":"10. \u76f8\u5173\u8d44\u6e90","text":"<ul> <li>\ud83d\udcda \u5b8c\u6574\u6570\u636e\u5e93\u6587\u6863</li> <li>\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</li> <li>\ud83d\udc1b \u6545\u969c\u6392\u9664</li> <li>\ud83c\udf93 \u6700\u4f73\u5b9e\u8df5</li> </ul>"},{"location":"tutorial/03-complete-example/","title":"\u5b8c\u6574\u793a\u4f8b\uff1a\u7535\u5546 API","text":"<p>\u672c\u6587\u6863\u5c55\u793a\u4e00\u4e2a\u5b8c\u6574\u7684\u7535\u5546 API \u9879\u76ee\uff0c\u5305\u542b\u6240\u6709 fastapi-easy \u7684\u529f\u80fd\u3002</p>"},{"location":"tutorial/03-complete-example/#_1","title":"\u9879\u76ee\u7ed3\u6784","text":"<pre><code>ecommerce-api/\n\u251c\u2500\u2500 main.py                 # \u4e3b\u5e94\u7528\u6587\u4ef6\n\u251c\u2500\u2500 models.py               # ORM \u6a21\u578b\n\u251c\u2500\u2500 schemas.py              # Pydantic Schema\n\u251c\u2500\u2500 database.py             # \u6570\u636e\u5e93\u914d\u7f6e\n\u2514\u2500\u2500 requirements.txt        # \u4f9d\u8d56\n</code></pre>"},{"location":"tutorial/03-complete-example/#1","title":"1. \u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install fastapi uvicorn fastapi-easy sqlalchemy sqlalchemy[asyncio] aiosqlite pydantic\n</code></pre> <p>requirements.txt: <pre><code>fastapi&gt;=0.100\nuvicorn[standard]&gt;=0.23\nfastapi-easy&gt;=1.0\nsqlalchemy&gt;=2.0\naiosqlite&gt;=0.19\npydantic&gt;=2.0\n</code></pre></p>"},{"location":"tutorial/03-complete-example/#2","title":"2. \u6570\u636e\u5e93\u914d\u7f6e","text":"<p>database.py: <pre><code>from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy.orm import sessionmaker\n\nDATABASE_URL = \"sqlite+aiosqlite:///./ecommerce.db\"\n\nengine = create_async_engine(\n    DATABASE_URL,\n    echo=False,\n    future=True\n)\n\nAsyncSessionLocal = sessionmaker(\n    engine,\n    class_=AsyncSession,\n    expire_on_commit=False\n)\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n</code></pre></p>"},{"location":"tutorial/03-complete-example/#3-orm","title":"3. ORM \u6a21\u578b","text":"<p>models.py: <pre><code>from sqlalchemy import Column, Integer, String, Float, DateTime, ForeignKey\nfrom sqlalchemy.orm import declarative_base\nfrom datetime import datetime\n\nBase = declarative_base()\n\nclass CategoryDB(Base):\n    __tablename__ = \"categories\"\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String, unique=True, index=True)\n    description = Column(String)\n\nclass ProductDB(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String, index=True)\n    description = Column(String)\n    price = Column(Float, index=True)\n    stock = Column(Integer, index=True)\n    category_id = Column(Integer, ForeignKey(\"categories.id\"))\n    created_at = Column(DateTime, default=datetime.utcnow, index=True)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\nclass OrderDB(Base):\n    __tablename__ = \"orders\"\n    id = Column(Integer, primary_key=True, index=True)\n    order_number = Column(String, unique=True, index=True)\n    total_price = Column(Float)\n    status = Column(String, default=\"pending\", index=True)\n    created_at = Column(DateTime, default=datetime.utcnow, index=True)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n</code></pre></p>"},{"location":"tutorial/03-complete-example/#4-pydantic-schema","title":"4. Pydantic Schema","text":"<p>schemas.py: <pre><code>from pydantic import BaseModel\nfrom datetime import datetime\nfrom typing import Optional\n\n# Category Schema\nclass Category(BaseModel):\n    id: int\n    name: str\n    description: Optional[str] = None\n\n    class Config:\n        from_attributes = True\n\n# Product Schema\nclass Product(BaseModel):\n    id: int\n    name: str\n    description: Optional[str] = None\n    price: float\n    stock: int\n    category_id: int\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n\n# Order Schema\nclass Order(BaseModel):\n    id: int\n    order_number: str\n    total_price: float\n    status: str\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n</code></pre></p>"},{"location":"tutorial/03-complete-example/#5","title":"5. \u4e3b\u5e94\u7528","text":"<p>main.py: <pre><code>from fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAsyncBackend\nfrom fastapi_easy.features import PaginationConfig, SoftDeleteConfig\n\nfrom database import engine, get_db\nfrom models import Base, CategoryDB, ProductDB, OrderDB\nfrom schemas import Category, Product, Order\n\n# \u521b\u5efa\u8868\n@app.on_event(\"startup\")\nasync def startup():\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\n# \u521b\u5efa\u5e94\u7528\napp = FastAPI(\n    title=\"\u7535\u5546 API\",\n    description=\"\u5b8c\u6574\u7684\u7535\u5546 API \u793a\u4f8b\",\n    version=\"1.0.0\"\n)\n\n# ============ Category \u8def\u7531 ============\ncategory_router = CRUDRouter(\n    schema=Category,\n    backend=SQLAlchemyAsyncBackend(CategoryDB, get_db),\n    prefix=\"/categories\",\n    tags=[\"categories\"],\n    enable_filters=True,\n    filter_fields=[\"name\"],\n    enable_sorters=True,\n    sort_fields=[\"name\", \"id\"],\n    enable_pagination=True,\n    pagination_config=PaginationConfig(default_limit=10, max_limit=100),\n)\n\n# ============ Product \u8def\u7531 ============\nproduct_router = CRUDRouter(\n    schema=Product,\n    backend=SQLAlchemyAsyncBackend(ProductDB, get_db),\n    prefix=\"/products\",\n    tags=[\"products\"],\n    enable_filters=True,\n    filter_fields=[\"name\", \"price\", \"stock\", \"category_id\"],\n    enable_sorters=True,\n    sort_fields=[\"name\", \"price\", \"created_at\", \"stock\"],\n    default_sort=\"-created_at\",\n    enable_pagination=True,\n    pagination_config=PaginationConfig(default_limit=20, max_limit=100),\n)\n\n# ============ Order \u8def\u7531 ============\norder_router = CRUDRouter(\n    schema=Order,\n    backend=SQLAlchemyAsyncBackend(OrderDB, get_db),\n    prefix=\"/orders\",\n    tags=[\"orders\"],\n    enable_filters=True,\n    filter_fields=[\"order_number\", \"status\"],\n    enable_sorters=True,\n    sort_fields=[\"created_at\", \"total_price\", \"status\"],\n    default_sort=\"-created_at\",\n    enable_pagination=True,\n    pagination_config=PaginationConfig(default_limit=10, max_limit=100),\n    enable_soft_delete=True,\n    soft_delete_config=SoftDeleteConfig(deleted_at_field=\"deleted_at\"),\n)\n\n# \u6ce8\u518c\u8def\u7531\napp.include_router(category_router)\napp.include_router(product_router)\napp.include_router(order_router)\n\n# \u6839\u8def\u7531\n@app.get(\"/\")\nasync def root():\n    return {\n        \"message\": \"\u6b22\u8fce\u6765\u5230\u7535\u5546 API\",\n        \"docs\": \"/docs\",\n        \"endpoints\": {\n            \"categories\": \"/categories\",\n            \"products\": \"/products\",\n            \"orders\": \"/orders\"\n        }\n    }\n</code></pre></p>"},{"location":"tutorial/03-complete-example/#6","title":"6. \u8fd0\u884c\u5e94\u7528","text":"<pre><code>uvicorn main:app --reload\n</code></pre> <p>\u8bbf\u95ee http://localhost:8000/docs \u67e5\u770b API \u6587\u6863</p>"},{"location":"tutorial/03-complete-example/#7-api","title":"7. API \u4f7f\u7528\u793a\u4f8b","text":""},{"location":"tutorial/03-complete-example/#_2","title":"\u521b\u5efa\u5206\u7c7b","text":"<pre><code>curl -X POST \"http://localhost:8000/categories\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"\u6c34\u679c\",\n    \"description\": \"\u65b0\u9c9c\u6c34\u679c\"\n  }'\n</code></pre>"},{"location":"tutorial/03-complete-example/#_3","title":"\u521b\u5efa\u5546\u54c1","text":"<pre><code>curl -X POST \"http://localhost:8000/products\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"\u82f9\u679c\",\n    \"description\": \"\u65b0\u9c9c\u82f9\u679c\",\n    \"price\": 15.5,\n    \"stock\": 100,\n    \"category_id\": 1\n  }'\n</code></pre>"},{"location":"tutorial/03-complete-example/#_4","title":"\u67e5\u8be2\u5546\u54c1\uff08\u5e26\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875\uff09","text":"<pre><code># \u67e5\u8be2\u4ef7\u683c\u5927\u4e8e 10 \u7684\u5546\u54c1\uff0c\u6309\u4ef7\u683c\u964d\u5e8f\uff0c\u6bcf\u9875 10 \u6761\ncurl \"http://localhost:8000/products?price__gt=10&amp;sort=-price&amp;skip=0&amp;limit=10\"\n\n# \u67e5\u8be2\u5206\u7c7b\u4e3a 1 \u4e14\u5e93\u5b58\u5927\u4e8e 0 \u7684\u5546\u54c1\ncurl \"http://localhost:8000/products?category_id=1&amp;stock__gt=0\"\n\n# \u67e5\u8be2\u540d\u79f0\u5305\u542b \"\u82f9\u679c\" \u7684\u5546\u54c1\uff0c\u6309\u521b\u5efa\u65f6\u95f4\u964d\u5e8f\ncurl \"http://localhost:8000/products?name__like=%\u82f9\u679c%&amp;sort=-created_at\"\n</code></pre>"},{"location":"tutorial/03-complete-example/#_5","title":"\u521b\u5efa\u8ba2\u5355","text":"<pre><code>curl -X POST \"http://localhost:8000/orders\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"order_number\": \"ORD-001\",\n    \"total_price\": 150.0,\n    \"status\": \"pending\"\n  }'\n</code></pre>"},{"location":"tutorial/03-complete-example/#_6","title":"\u67e5\u8be2\u8ba2\u5355","text":"<pre><code># \u67e5\u8be2\u6240\u6709\u5f85\u5904\u7406\u8ba2\u5355\uff0c\u6309\u521b\u5efa\u65f6\u95f4\u964d\u5e8f\ncurl \"http://localhost:8000/orders?status=pending&amp;sort=-created_at\"\n\n# \u67e5\u8be2\u7279\u5b9a\u8ba2\u5355\u53f7\ncurl \"http://localhost:8000/orders?order_number=ORD-001\"\n</code></pre>"},{"location":"tutorial/03-complete-example/#_7","title":"\u66f4\u65b0\u5546\u54c1","text":"<pre><code>curl -X PUT \"http://localhost:8000/products/1\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"\u65b0\u9c9c\u82f9\u679c\",\n    \"price\": 18.0,\n    \"stock\": 80\n  }'\n</code></pre>"},{"location":"tutorial/03-complete-example/#_8","title":"\u5220\u9664\u8ba2\u5355","text":"<pre><code>curl -X DELETE \"http://localhost:8000/orders/1\"\n</code></pre>"},{"location":"tutorial/03-complete-example/#8","title":"8. \u4ee3\u7801\u91cf\u5bf9\u6bd4","text":""},{"location":"tutorial/03-complete-example/#_9","title":"\u624b\u5199\u65b9\u5f0f","text":"<pre><code>models.py              ~100 \u884c\nschemas.py            ~80 \u884c\nroutes/categories.py  ~150 \u884c\nroutes/products.py    ~200 \u884c\nroutes/orders.py      ~200 \u884c\ndatabase.py           ~50 \u884c\nmain.py               ~100 \u884c\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1                  ~880 \u884c\n</code></pre>"},{"location":"tutorial/03-complete-example/#fastapi-easy","title":"\u4f7f\u7528 fastapi-easy","text":"<pre><code>models.py              ~100 \u884c\nschemas.py            ~80 \u884c\ndatabase.py           ~50 \u884c\nmain.py               ~120 \u884c\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1                  ~350 \u884c\n</code></pre> <p>\u8282\u7ea6: 60% \u4ee3\u7801\u91cf\u51cf\u5c11 \u2728</p>"},{"location":"tutorial/03-complete-example/#9-api","title":"9. \u81ea\u52a8\u751f\u6210\u7684 API","text":""},{"location":"tutorial/03-complete-example/#categories","title":"Categories","text":"<ul> <li><code>GET /categories</code> - \u83b7\u53d6\u6240\u6709\u5206\u7c7b</li> <li><code>GET /categories/{id}</code> - \u83b7\u53d6\u5355\u4e2a\u5206\u7c7b</li> <li><code>POST /categories</code> - \u521b\u5efa\u5206\u7c7b</li> <li><code>PUT /categories/{id}</code> - \u66f4\u65b0\u5206\u7c7b</li> <li><code>DELETE /categories/{id}</code> - \u5220\u9664\u5206\u7c7b</li> </ul>"},{"location":"tutorial/03-complete-example/#products","title":"Products","text":"<ul> <li><code>GET /products</code> - \u83b7\u53d6\u6240\u6709\u5546\u54c1\uff08\u652f\u6301\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875\uff09</li> <li><code>GET /products/{id}</code> - \u83b7\u53d6\u5355\u4e2a\u5546\u54c1</li> <li><code>POST /products</code> - \u521b\u5efa\u5546\u54c1</li> <li><code>PUT /products/{id}</code> - \u66f4\u65b0\u5546\u54c1</li> <li><code>DELETE /products/{id}</code> - \u5220\u9664\u5546\u54c1</li> </ul>"},{"location":"tutorial/03-complete-example/#orders","title":"Orders","text":"<ul> <li><code>GET /orders</code> - \u83b7\u53d6\u6240\u6709\u8ba2\u5355\uff08\u652f\u6301\u8fc7\u6ee4\u3001\u6392\u5e8f\u3001\u5206\u9875\uff09</li> <li><code>GET /orders/{id}</code> - \u83b7\u53d6\u5355\u4e2a\u8ba2\u5355</li> <li><code>POST /orders</code> - \u521b\u5efa\u8ba2\u5355</li> <li><code>PUT /orders/{id}</code> - \u66f4\u65b0\u8ba2\u5355</li> <li><code>DELETE /orders/{id}</code> - \u5220\u9664\u8ba2\u5355\uff08\u8f6f\u5220\u9664\uff09</li> </ul>"},{"location":"tutorial/03-complete-example/#10","title":"10. \u529f\u80fd\u7279\u6027","text":"<p>\u2705 \u5b8c\u6574\u7684 CRUD \u64cd\u4f5c \u2705 \u641c\u7d22\u548c\u8fc7\u6ee4 \u2705 \u6392\u5e8f \u2705 \u5206\u9875 \u2705 \u8f6f\u5220\u9664 \u2705 \u81ea\u52a8 OpenAPI \u6587\u6863 \u2705 \u5f02\u6b65\u652f\u6301 \u2705 Pydantic v2 \u517c\u5bb9</p>"},{"location":"tutorial/03-complete-example/#11","title":"11. \u4e0b\u4e00\u6b65","text":"<ul> <li>\u6dfb\u52a0\u6743\u9650\u63a7\u5236</li> <li>\u6dfb\u52a0\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u6dfb\u52a0\u4e1a\u52a1\u903b\u8f91\u94a9\u5b50</li> <li>\u6dfb\u52a0\u5173\u7cfb\u5904\u7406</li> <li>\u6dfb\u52a0\u6279\u91cf\u64cd\u4f5c</li> </ul>"},{"location":"tutorial/03-complete-example/#_10","title":"\u603b\u7ed3","text":"<p>\u8fd9\u4e2a\u5b8c\u6574\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 fastapi-easy \u5feb\u901f\u6784\u5efa\u4e00\u4e2a\u529f\u80fd\u5b8c\u6574\u7684\u7535\u5546 API\uff0c\u53ea\u9700\u8981\u7ea6 350 \u884c\u4ee3\u7801\uff0c\u800c\u624b\u5199\u65b9\u5f0f\u9700\u8981\u7ea6 880 \u884c\u4ee3\u7801\u3002</p> <p>\u6548\u7387\u63d0\u5347: 60% \u4ee3\u7801\u91cf\u51cf\u5c11 \u2728</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/","title":"\u5feb\u901f\u5f00\u53d1\u540e\u7aef\u7684\u5b8c\u6574\u5de5\u4f5c\u6d41\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#fastapi","title":"\u573a\u666f\uff1a\u5f00\u53d1\u4e00\u4e2a\u65b0\u7684 FastAPI \u9879\u76ee","text":"<p>\u5047\u8bbe\u8981\u5f00\u53d1\u4e00\u4e2a\u7535\u5546 API\uff0c\u5305\u542b Product\u3001Order\u3001User \u4e09\u4e2a\u8d44\u6e90\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#a-fastapi-easy","title":"\u65b9\u6848 A: \u4e0d\u4f7f\u7528 FastAPI-Easy (\u4f20\u7edf\u65b9\u5f0f)","text":""},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#1","title":"\u7b2c 1 \u6b65\uff1a\u9879\u76ee\u521d\u59cb\u5316\u548c\u6570\u636e\u5e93\u914d\u7f6e","text":"<pre><code># main.py\nfrom fastapi import FastAPI\nfrom sqlalchemy import create_engine\nfrom sqlalchemy.orm import sessionmaker, declarative_base\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\n\n# \u6570\u636e\u5e93\u914d\u7f6e\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\nBase = declarative_base()\n\napp = FastAPI()\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 18 \u884c</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#2-orm","title":"\u7b2c 2 \u6b65\uff1a\u5b9a\u4e49 ORM \u6a21\u578b","text":"<pre><code># models.py\nfrom sqlalchemy import Column, Integer, String, Float, DateTime, ForeignKey\nfrom sqlalchemy.orm import relationship\nfrom datetime import datetime\n\nclass UserDB(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    email = Column(String, unique=True, index=True)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass ProductDB(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    price = Column(Float)\n    stock = Column(Integer)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass OrderDB(Base):\n    __tablename__ = \"orders\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(Integer, ForeignKey(\"users.id\"))\n    product_id = Column(Integer, ForeignKey(\"products.id\"))\n    quantity = Column(Integer)\n    total_price = Column(Float)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\n    user = relationship(\"UserDB\")\n    product = relationship(\"ProductDB\")\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 35 \u884c</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#3-pydantic-schema","title":"\u7b2c 3 \u6b65\uff1a\u5b9a\u4e49 Pydantic Schema","text":"<pre><code># schemas.py\nfrom pydantic import BaseModel\nfrom datetime import datetime\n\nclass UserBase(BaseModel):\n    name: str\n    email: str\n\nclass UserCreate(UserBase):\n    pass\n\nclass User(UserBase):\n    id: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass ProductBase(BaseModel):\n    name: str\n    price: float\n    stock: int\n\nclass ProductCreate(ProductBase):\n    pass\n\nclass Product(ProductBase):\n    id: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass OrderBase(BaseModel):\n    user_id: int\n    product_id: int\n    quantity: int\n    total_price: float\n\nclass OrderCreate(OrderBase):\n    pass\n\nclass Order(OrderBase):\n    id: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 50 \u884c</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#4-crud","title":"\u7b2c 4 \u6b65\uff1a\u624b\u5199 CRUD \u7aef\u70b9","text":"<pre><code># routes.py\nfrom fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.ext.asyncio import AsyncSession\nfrom sqlalchemy import select\n\nrouter = APIRouter()\n\n# ===== USER CRUD =====\n\n@router.get(\"/users\", response_model=list[User])\nasync def get_users(skip: int = 0, limit: int = 10, db: AsyncSession = Depends(get_db)):\n    result = await db.execute(select(UserDB).offset(skip).limit(limit))\n    return result.scalars().all()\n\n@router.get(\"/users/{user_id}\", response_model=User)\nasync def get_user(user_id: int, db: AsyncSession = Depends(get_db)):\n    result = await db.execute(select(UserDB).where(UserDB.id == user_id))\n    user = result.scalar_one_or_none()\n    if not user:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return user\n\n@router.post(\"/users\", response_model=User)\nasync def create_user(user: UserCreate, db: AsyncSession = Depends(get_db)):\n    db_user = UserDB(**user.dict())\n    db.add(db_user)\n    await db.commit()\n    await db.refresh(db_user)\n    return db_user\n\n@router.put(\"/users/{user_id}\", response_model=User)\nasync def update_user(user_id: int, user: UserCreate, db: AsyncSession = Depends(get_db)):\n    result = await db.execute(select(UserDB).where(UserDB.id == user_id))\n    db_user = result.scalar_one_or_none()\n    if not db_user:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    for key, value in user.dict().items():\n        setattr(db_user, key, value)\n    await db.commit()\n    await db.refresh(db_user)\n    return db_user\n\n@router.delete(\"/users/{user_id}\")\nasync def delete_user(user_id: int, db: AsyncSession = Depends(get_db)):\n    result = await db.execute(select(UserDB).where(UserDB.id == user_id))\n    db_user = result.scalar_one_or_none()\n    if not db_user:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    await db.delete(db_user)\n    await db.commit()\n    return {\"message\": \"User deleted\"}\n\n# ===== PRODUCT CRUD =====\n# (\u91cd\u590d 5 \u4e2a\u7aef\u70b9\uff0c\u5171 50 \u884c)\n\n# ===== ORDER CRUD =====\n# (\u91cd\u590d 5 \u4e2a\u7aef\u70b9\uff0c\u5171 50 \u884c)\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 150 \u884c (3 \u4e2a\u8d44\u6e90 \u00d7 50 \u884c)</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#5","title":"\u7b2c 5 \u6b65\uff1a\u6570\u636e\u5e93\u8fc1\u79fb","text":"<pre><code># \u4f7f\u7528 Alembic\nalembic init alembic\n# \u7f16\u8f91 alembic/env.py\n# \u7f16\u8f91 alembic/versions/ \u4e2d\u7684\u8fc1\u79fb\u811a\u672c\nalembic upgrade head\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 30+ \u884c (\u8fc1\u79fb\u811a\u672c)</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#6","title":"\u7b2c 6 \u6b65\uff1a\u542f\u52a8\u5e94\u7528","text":"<pre><code># main.py \u6dfb\u52a0\n@app.on_event(\"startup\")\nasync def startup():\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\napp.include_router(router)\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 10 \u884c</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_2","title":"\u4f20\u7edf\u65b9\u5f0f\u603b\u4ee3\u7801\u91cf","text":"<pre><code>\u9879\u76ee\u521d\u59cb\u5316:        18 \u884c\nORM \u6a21\u578b:          35 \u884c\nPydantic Schema:   50 \u884c\nCRUD \u7aef\u70b9:        150 \u884c\n\u8fc1\u79fb\u811a\u672c:          30 \u884c\n\u542f\u52a8\u914d\u7f6e:          10 \u884c\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1:             293 \u884c\n</code></pre> <p>\u65f6\u95f4\u6210\u672c: 3-4 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#b-fastapi-easy-crud","title":"\u65b9\u6848 B: \u4f7f\u7528\u5f53\u524d FastAPI-Easy (\u4ec5 CRUD \u6846\u67b6)","text":"<pre><code># main.py\nfrom fastapi import FastAPI\nfrom fastapi_easy import CRUDRouter\nfrom fastapi_easy.backends import SQLAlchemyAsyncBackend\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy.orm import sessionmaker, declarative_base\nfrom sqlalchemy import Column, Integer, String, Float, DateTime\nfrom pydantic import BaseModel\nfrom datetime import datetime\n\n# 1. \u6570\u636e\u5e93\u914d\u7f6e\nDATABASE_URL = \"sqlite+aiosqlite:///./test.db\"\nengine = create_async_engine(DATABASE_URL)\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\nBase = declarative_base()\n\nasync def get_db():\n    async with AsyncSessionLocal() as session:\n        yield session\n\n# 2. ORM \u6a21\u578b\nclass UserDB(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    email = Column(String, unique=True, index=True)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass ProductDB(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    price = Column(Float)\n    stock = Column(Integer)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass OrderDB(Base):\n    __tablename__ = \"orders\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(Integer, ForeignKey(\"users.id\"))\n    product_id = Column(Integer, ForeignKey(\"products.id\"))\n    quantity = Column(Integer)\n    total_price = Column(Float)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\n# 3. Pydantic Schema\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass Product(BaseModel):\n    id: int\n    name: str\n    price: float\n    stock: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass Order(BaseModel):\n    id: int\n    user_id: int\n    product_id: int\n    quantity: int\n    total_price: float\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\n# 4. \u521b\u5efa\u5e94\u7528\u548c\u8def\u7531\napp = FastAPI()\n\n# \u81ea\u52a8\u751f\u6210 CRUD \u8def\u7531\nuser_router = CRUDRouter(schema=User, backend=SQLAlchemyAsyncBackend(UserDB, get_db))\nproduct_router = CRUDRouter(schema=Product, backend=SQLAlchemyAsyncBackend(ProductDB, get_db))\norder_router = CRUDRouter(schema=Order, backend=SQLAlchemyAsyncBackend(OrderDB, get_db))\n\napp.include_router(user_router)\napp.include_router(product_router)\napp.include_router(order_router)\n\n# 5. \u542f\u52a8\u914d\u7f6e\n@app.on_event(\"startup\")\nasync def startup():\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 120 \u884c</p> <p>\u65f6\u95f4\u6210\u672c: 30-45 \u5206\u949f</p> <p>\u8282\u7701: - \u4ee3\u7801: 293 - 120 = 173 \u884c (59% \u51cf\u5c11) - \u65f6\u95f4: 3-4 \u5c0f\u65f6 - 0.5-0.75 \u5c0f\u65f6 = 2.25-3.5 \u5c0f\u65f6 (75% \u51cf\u5c11)</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#c-fastapieasy","title":"\u65b9\u6848 C: \u4f7f\u7528\u96c6\u6210\u65b9\u6848 (FastAPIEasy \u7c7b)","text":"<pre><code># main.py\nfrom fastapi_easy import FastAPIEasy\nfrom sqlalchemy import Column, Integer, String, Float, DateTime\nfrom pydantic import BaseModel\nfrom datetime import datetime\n\n# 1. ORM \u6a21\u578b\nBase = declarative_base()\n\nclass UserDB(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    email = Column(String, unique=True, index=True)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass ProductDB(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    price = Column(Float)\n    stock = Column(Integer)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\nclass OrderDB(Base):\n    __tablename__ = \"orders\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(Integer, ForeignKey(\"users.id\"))\n    product_id = Column(Integer, ForeignKey(\"products.id\"))\n    quantity = Column(Integer)\n    total_price = Column(Float)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\n# 2. Pydantic Schema\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass Product(BaseModel):\n    id: int\n    name: str\n    price: float\n    stock: int\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\nclass Order(BaseModel):\n    id: int\n    user_id: int\n    product_id: int\n    quantity: int\n    total_price: float\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\n# 3. \u4e00\u884c\u4ee3\u7801\u521b\u5efa\u5e94\u7528\napp = FastAPIEasy(\n    database_url=\"sqlite+aiosqlite:///./test.db\",\n    models=[\n        (UserDB, User),\n        (ProductDB, Product),\n        (OrderDB, Order),\n    ]\n)\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre> <p>\u4ee3\u7801\u884c\u6570: 80 \u884c</p> <p>\u65f6\u95f4\u6210\u672c: 10-15 \u5206\u949f</p> <p>\u8282\u7701: - \u4ee3\u7801: 293 - 80 = 213 \u884c (73% \u51cf\u5c11) - \u65f6\u95f4: 3-4 \u5c0f\u65f6 - 0.17-0.25 \u5c0f\u65f6 = 2.75-3.83 \u5c0f\u65f6 (92% \u51cf\u5c11)</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_3","title":"\u4ee3\u7801\u91cf\u5bf9\u6bd4\u8868","text":"\u65b9\u6848 \u4ee3\u7801\u884c\u6570 \u65f6\u95f4 \u8282\u7701\u4ee3\u7801 \u8282\u7701\u65f6\u95f4 \u4f20\u7edf\u65b9\u5f0f 293 \u884c 3-4 \u5c0f\u65f6 - - \u5f53\u524d FastAPI-Easy 120 \u884c 0.5-0.75 \u5c0f\u65f6 173 \u884c (59%) 2.25-3.5 \u5c0f\u65f6 (75%) \u96c6\u6210\u65b9\u6848 80 \u884c 0.17-0.25 \u5c0f\u65f6 213 \u884c (73%) 2.75-3.83 \u5c0f\u65f6 (92%)"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_4","title":"\u4f46\u662f\uff0c\u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u95ee\u9898\uff1a\u6570\u636e\u5e93\u8fc1\u79fb","text":""},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_5","title":"\u4f20\u7edf\u65b9\u5f0f\u4e2d\u88ab\u5ffd\u7565\u7684\u90e8\u5206","text":"<p>\u5728\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u6211\u4eec\u5ffd\u7565\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u90e8\u5206\uff1a\u6570\u636e\u5e93\u8fc1\u79fb\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_6","title":"\u573a\u666f\uff1a\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4fee\u6539\u6a21\u578b","text":"<p>\u5047\u8bbe\u5f00\u53d1\u5230\u4e00\u534a\uff0c\u9700\u8981\u7ed9 Product \u6dfb\u52a0\u4e00\u4e2a <code>category</code> \u5b57\u6bb5\uff1a</p> <pre><code>class ProductDB(Base):\n    __tablename__ = \"products\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, index=True)\n    price = Column(Float)\n    stock = Column(Integer)\n    category = Column(String)  # \u65b0\u589e\n    created_at = Column(DateTime, default=datetime.utcnow)\n</code></pre> <p>\u4f20\u7edf\u65b9\u5f0f\u9700\u8981\u505a:</p> <ol> <li>\u624b\u52a8\u7f16\u5199 Alembic \u8fc1\u79fb\u811a\u672c (10-15 \u5206\u949f)</li> <li>\u8fd0\u884c\u8fc1\u79fb (1-2 \u5206\u949f)</li> <li>\u66f4\u65b0 Schema (5 \u5206\u949f)</li> <li>\u6d4b\u8bd5 (10-15 \u5206\u949f)</li> </ol> <p>\u603b\u65f6\u95f4: 26-37 \u5206\u949f</p> <p>\u96c6\u6210\u65b9\u6848\u9700\u8981\u505a:</p> <ol> <li>\u4fee\u6539\u6a21\u578b</li> <li>\u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u8fc1\u79fb (\u81ea\u52a8)</li> <li>Schema \u81ea\u52a8\u63a8\u5bfc (\u81ea\u52a8)</li> <li>\u6d4b\u8bd5 (10-15 \u5206\u949f)</li> </ol> <p>\u603b\u65f6\u95f4: 10-15 \u5206\u949f</p> <p>\u8282\u7701: 16-22 \u5206\u949f</p>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_7","title":"\u5b8c\u6574\u7684\u5f00\u53d1\u5468\u671f\u5bf9\u6bd4","text":""},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#3","title":"\u4f20\u7edf\u65b9\u5f0f (3 \u4e2a\u8d44\u6e90)","text":"<pre><code>\u521d\u59cb\u5316:           30 \u5206\u949f\n\u5b9a\u4e49\u6a21\u578b:         30 \u5206\u949f\n\u5b9a\u4e49 Schema:      30 \u5206\u949f\n\u624b\u5199 CRUD:       120 \u5206\u949f\n\u521d\u59cb\u8fc1\u79fb:         20 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u5c0f\u8ba1:            230 \u5206\u949f\n\n\u4fee\u6539\u6a21\u578b (5 \u6b21):  5 \u00d7 30 \u5206\u949f = 150 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1:            380 \u5206\u949f (6.3 \u5c0f\u65f6)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#fastapi-easy-3","title":"\u5f53\u524d FastAPI-Easy (3 \u4e2a\u8d44\u6e90)","text":"<pre><code>\u521d\u59cb\u5316:           15 \u5206\u949f\n\u5b9a\u4e49\u6a21\u578b:         30 \u5206\u949f\n\u5b9a\u4e49 Schema:      30 \u5206\u949f\n\u751f\u6210 CRUD:         5 \u5206\u949f\n\u521d\u59cb\u8fc1\u79fb:         10 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u5c0f\u8ba1:             90 \u5206\u949f\n\n\u4fee\u6539\u6a21\u578b (5 \u6b21):  5 \u00d7 15 \u5206\u949f = 75 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1:            165 \u5206\u949f (2.75 \u5c0f\u65f6)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#3_1","title":"\u96c6\u6210\u65b9\u6848 (3 \u4e2a\u8d44\u6e90)","text":"<pre><code>\u521d\u59cb\u5316:            5 \u5206\u949f\n\u5b9a\u4e49\u6a21\u578b:         30 \u5206\u949f\n\u5b9a\u4e49 Schema:      30 \u5206\u949f\n\u751f\u6210\u5e94\u7528:          2 \u5206\u949f\n\u81ea\u52a8\u8fc1\u79fb:          0 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u5c0f\u8ba1:             67 \u5206\u949f\n\n\u4fee\u6539\u6a21\u578b (5 \u6b21):  5 \u00d7 5 \u5206\u949f = 25 \u5206\u949f\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u603b\u8ba1:             92 \u5206\u949f (1.5 \u5c0f\u65f6)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_8","title":"\u603b\u7ed3","text":"\u7ef4\u5ea6 \u4f20\u7edf\u65b9\u5f0f \u5f53\u524d FastAPI-Easy \u96c6\u6210\u65b9\u6848 \u8282\u7701 \u521d\u59cb\u4ee3\u7801 293 \u884c 120 \u884c 80 \u884c 73% \u521d\u59cb\u65f6\u95f4 230 \u5206\u949f 90 \u5206\u949f 67 \u5206\u949f 71% \u4fee\u6539\u5468\u671f 30 \u5206\u949f/\u6b21 15 \u5206\u949f/\u6b21 5 \u5206\u949f/\u6b21 83% \u5b8c\u6574\u5468\u671f 380 \u5206\u949f 165 \u5206\u949f 92 \u5206\u949f 76%"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_9","title":"\u5173\u952e\u6d1e\u5bdf","text":"<ol> <li> <p>CRUD \u6846\u67b6\u672c\u8eab\u5df2\u7ecf\u5f88\u5f3a\u5927 - \u8282\u7701 59% \u7684\u4ee3\u7801\u548c 75% \u7684\u65f6\u95f4</p> </li> <li> <p>\u8fc1\u79fb\u7cfb\u7edf\u7684\u4ef7\u503c - \u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u8fc1\u79fb\u7cfb\u7edf\u53ef\u4ee5\u8282\u7701 50% \u7684\u65f6\u95f4</p> </li> <li> <p>\u96c6\u6210\u7684\u4ef7\u503c - \u4ece\"\u9700\u8981\u5b66\u4e60\u591a\u4e2a\u5de5\u5177\"\u53d8\u6210\"\u4e00\u4e2a\u5de5\u5177\u641e\u5b9a\"</p> </li> <li> <p>\u5feb\u901f\u5f00\u53d1\u540e\u7aef\u7684\u5b8c\u6574\u6d41\u7a0b - \u5305\u62ec\uff1a</p> </li> <li>\u6570\u636e\u5e93\u914d\u7f6e</li> <li>ORM \u6a21\u578b\u5b9a\u4e49</li> <li>Schema \u5b9a\u4e49</li> <li>CRUD \u7aef\u70b9\u751f\u6210</li> <li>\u6570\u636e\u5e93\u8fc1\u79fb</li> <li> <p>\u5e94\u7528\u542f\u52a8</p> </li> <li> <p>\u96c6\u6210\u65b9\u6848\u7684\u771f\u6b63\u4ef7\u503c - \u4e0d\u4ec5\u7b80\u5316\u4ee3\u7801\uff0c\u66f4\u91cd\u8981\u7684\u662f\u7b80\u5316\u6574\u4e2a\u5f00\u53d1\u6d41\u7a0b</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/ANALYSIS_COMPLETE_WORKFLOW/#_10","title":"\u91cd\u65b0\u8bc4\u4f30","text":"<p>\u4ece\"\u5feb\u901f\u5f00\u53d1\u540e\u7aef\"\u7684\u5b8c\u6574\u5de5\u4f5c\u6d41\u6765\u770b\uff1a</p> <ul> <li>\u2705 \u96c6\u6210\u65b9\u6848\u662f\u5408\u7406\u7684</li> <li>\u2705 \u5b83\u89e3\u51b3\u4e86\u771f\u5b9e\u7684\u75db\u70b9\uff08\u8fc1\u79fb\u7ba1\u7406\uff09</li> <li>\u2705 \u5b83\u663e\u8457\u63d0\u9ad8\u4e86\u5f00\u53d1\u6548\u7387\uff0876% \u7684\u65f6\u95f4\u8282\u7701\uff09</li> <li>\u2705 \u5b83\u4fdd\u6301\u4e86\u9879\u76ee\u7684\u7b80\u6d01\u6027\uff08\u4e00\u4e2a\u5de5\u5177\u641e\u5b9a\uff09</li> </ul> <p>\u4f46\u662f\uff0c\u8fd9\u6539\u53d8\u4e86\u9879\u76ee\u7684\u5b9a\u4f4d\uff1a</p> <ul> <li>\u4ece\"CRUD \u6846\u67b6\"\u53d8\u6210\"\u5feb\u901f\u540e\u7aef\u5f00\u53d1\u6846\u67b6\"</li> <li>\u4ece\"\u7b80\u5316 CRUD\"\u53d8\u6210\"\u7b80\u5316\u6574\u4e2a\u540e\u7aef\u5f00\u53d1\u6d41\u7a0b\"</li> </ul> <p>\u8fd9\u662f\u5426\u5408\u7406\uff1f \u53d6\u51b3\u4e8e\u9879\u76ee\u7684\u76ee\u6807\u5b9a\u4f4d\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/","title":"\u4ee3\u7801\u8d28\u91cf\u5ba1\u67e5\u4e0e\u4fee\u590d\u603b\u7ed3","text":"<p>\u5ba1\u67e5\u5468\u671f: 2025-11-29  </p> <p>\u603b\u5de5\u4f5c\u91cf: 12-14 \u5c0f\u65f6  </p> <p>\u5b8c\u6210\u5ea6: 100% (P0 100% + P1 100%) \u2705</p>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_2","title":"\ud83d\udcca \u5ba1\u67e5\u8303\u56f4","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_3","title":"\u5ba1\u67e5\u5185\u5bb9","text":"<ul> <li> <p>\u2705 \u4ee3\u7801\u8d28\u91cf (CODE_QUALITY_AUDIT.md)</p> </li> <li> <p>\u2705 \u529f\u80fd\u548c\u96c6\u6210 (FUNCTIONAL_INTEGRATION_AUDIT.md)</p> </li> <li> <p>\u2705 \u4fee\u590d\u6307\u5357 (INTEGRATION_FIX_GUIDE.md)</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_4","title":"\u5ba1\u67e5\u6587\u4ef6\u6570","text":"<ul> <li> <p>19 \u4e2a\u8fc1\u79fb\u7cfb\u7edf\u6587\u4ef6</p> </li> <li> <p>1926 \u884c\u751f\u4ea7\u4ee3\u7801</p> </li> <li> <p>187 \u4e2a\u6d4b\u8bd5\u7528\u4f8b</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_5","title":"\ud83c\udfaf \u4e3b\u8981\u53d1\u73b0","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#10","title":"\u4ee3\u7801\u8d28\u91cf\u95ee\u9898 (10 \u4e2a)","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-","title":"P0 - \u5f02\u5e38\u5904\u7406 \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>\u79fb\u9664\u8fc7\u4e8e\u5bbd\u6cdb\u7684 <code>except Exception</code></p> </li> <li> <p>\u6dfb\u52a0\u5177\u4f53\u7684\u5f02\u5e38\u5904\u7406</p> </li> <li> <p>\u8ba9\u7cfb\u7edf\u5f02\u5e38\u6b63\u5e38\u4f20\u64ad</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-_1","title":"P0 - \u7c7b\u578b\u6ce8\u89e3 \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>\u6dfb\u52a0\u53c2\u6570\u7c7b\u578b\u6ce8\u89e3</p> </li> <li> <p>\u5b8c\u5584\u6587\u6863\u5b57\u7b26\u4e32</p> </li> <li> <p>\u6e05\u7406\u672a\u4f7f\u7528\u7684\u5bfc\u5165</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-","title":"P1 - \u65e5\u5fd7\u8bb0\u5f55 \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>\u7edf\u4e00\u4f7f\u7528\u4e2d\u6587\u65e5\u5fd7</p> </li> <li> <p>\u79fb\u9664 emoji \u7b26\u53f7</p> </li> <li> <p>\u6dfb\u52a0 logger.info() \u8c03\u7528</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-_1","title":"P1 - \u9519\u8bef\u6062\u590d \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>\u8fc1\u79fb\u5931\u8d25\u65f6\u81ea\u52a8\u56de\u6eda</p> </li> <li> <p>\u8bb0\u5f55\u56de\u6eda\u8fc7\u7a0b</p> </li> <li> <p>\u786e\u4fdd\u6570\u636e\u5e93\u4e00\u81f4\u6027</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-_2","title":"P1 - \u8d44\u6e90\u6e05\u7406 \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>\u9501\u91ca\u653e\u91cd\u8bd5\u673a\u5236</p> </li> <li> <p>\u6bcf\u6b21\u5931\u8d25\u540e\u7b49\u5f85 1 \u79d2</p> </li> <li> <p>\u8bb0\u5f55\u91cd\u8bd5\u8fc7\u7a0b</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#10_1","title":"\u529f\u80fd\u548c\u96c6\u6210\u95ee\u9898 (10 \u4e2a)","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-hook","title":"P0 - Hook \u7cfb\u7edf\u672a\u96c6\u6210 \ud83d\udd34 \u5f85\u4fee\u590d","text":"<ul> <li> <p>\u5b8c\u6574\u5b9e\u73b0\u4f46\u672a\u8c03\u7528</p> </li> <li> <p>\u8fdd\u80cc\u9879\u76ee\u521d\u8877</p> </li> <li> <p>\u4fee\u590d\u6307\u5357\u5df2\u51c6\u5907</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-cli","title":"P0 - CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef \u2705 \u5df2\u4fee\u590d","text":"<ul> <li> <p>mode=\"dry_run\" \u2192 ExecutionMode.DRY_RUN</p> </li> <li> <p>\u786e\u4fdd\u7c7b\u578b\u4e00\u81f4\u6027</p> </li> <li> <p>\u6d4b\u8bd5\u901a\u8fc7</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-detector","title":"P0 - detector \u5f02\u6b65\u95ee\u9898 \ud83d\udd34 \u5f85\u4fee\u590d","text":"<ul> <li> <p>\u4f7f\u7528 await \u4f46\u65b9\u6cd5\u662f\u540c\u6b65\u7684</p> </li> <li> <p>\u4fee\u590d\u6307\u5357\u5df2\u51c6\u5907</p> </li> <li> <p>\u4fee\u590d\u65b9\u6848: \u6539\u4e3a\u540c\u6b65\u8c03\u7528</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-auto_backup","title":"P1 - auto_backup \u53c2\u6570 \ud83d\udfe1 \u5f85\u4fee\u590d","text":"<ul> <li> <p>\u53c2\u6570\u672a\u5b9e\u73b0</p> </li> <li> <p>\u5efa\u8bae\u79fb\u9664\u53c2\u6570</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-_3","title":"P1 - \u65e5\u5fd7\u6df7\u5408\u4e2d\u82f1\u6587 \ud83d\udfe1 \u5f85\u4fee\u590d","text":"<ul> <li> <p>engine.py \u4e2d\u6df7\u5408\u4e2d\u82f1\u6587</p> </li> <li> <p>\u4fee\u590d\u6307\u5357\u5df2\u51c6\u5907</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-_4","title":"P1 - \u6267\u884c\u6a21\u5f0f\u53c2\u6570 \ud83d\udfe1 \u5f85\u4fee\u590d","text":"<ul> <li> <p>\u53c2\u6570\u4f20\u9012\u4e0d\u4e00\u81f4</p> </li> <li> <p>\u4fee\u590d\u6307\u5357\u5df2\u51c6\u5907</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-_5","title":"P1 - \u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 \ud83d\udfe1 \u5f85\u4fee\u590d","text":"<ul> <li> <p>\u56de\u6eda\u65f6\u6ca1\u6709\u91cd\u8bd5</p> </li> <li> <p>\u4fee\u590d\u6307\u5357\u5df2\u51c6\u5907</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p2-","title":"P2 - \u914d\u7f6e\u7ba1\u7406\u7f3a\u5931 \ud83d\udfe2 \u4f4e\u4f18\u5148\u7ea7","text":"<ul> <li> <p>\u914d\u7f6e\u7cfb\u7edf\u672a\u4f7f\u7528</p> </li> <li> <p>\u53ef\u4ee5\u6539\u8fdb</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p2-_1","title":"P2 - \u7f3a\u5c11\u96c6\u6210\u6d4b\u8bd5 \u4f4e\u4f18\u5148\u7ea7","text":"<ul> <li> <p>Hook \u7cfb\u7edf\u65e0\u6d4b\u8bd5</p> </li> <li> <p>\u53ef\u4ee5\u6539\u8fdb</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_6","title":"\u4fee\u590d\u8fdb\u5ea6","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#55","title":"\u4ee3\u7801\u8d28\u91cf\u4fee\u590d (5/5 \u5b8c\u6210) \u2705","text":"<ul> <li> <p> \u5f02\u5e38\u5904\u7406\u6539\u8fdb</p> </li> <li> <p> \u7c7b\u578b\u6ce8\u89e3\u5b8c\u5584</p> </li> <li> <p> \u65e5\u5fd7\u8bb0\u5f55\u7edf\u4e00</p> </li> <li> <p> \u9519\u8bef\u6062\u590d\u673a\u5236</p> </li> <li> <p> \u8d44\u6e90\u6e05\u7406\u6539\u8fdb</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#77","title":"\u529f\u80fd\u96c6\u6210\u4fee\u590d (7/7 \u5b8c\u6210) \u2705","text":"<ul> <li> <p> CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef</p> </li> <li> <p> Hook \u7cfb\u7edf\u96c6\u6210</p> </li> <li> <p> \u65e5\u5fd7\u6df7\u5408\u4e2d\u82f1\u6587</p> </li> <li> <p> \u6267\u884c\u6a21\u5f0f\u53c2\u6570</p> </li> <li> <p> \u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 (\u56de\u6eda)</p> </li> <li> <p> auto_backup \u53c2\u6570</p> </li> <li> <p> \u914d\u7f6e\u7ba1\u7406\u7f3a\u5931 (MigrationConfig \u5df2\u96c6\u6210)</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_7","title":"\u603b\u4f53\u8fdb\u5ea6","text":"<ul> <li> <p>\u4ee3\u7801\u8d28\u91cf: 100% (5/5) \u2705</p> </li> <li> <p>\u529f\u80fd\u96c6\u6210: 100% (7/7) \u2705</p> </li> <li> <p>\u603b\u4f53: 100% (12/12) \u2705</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_8","title":"\ud83d\udcca \u4ee3\u7801\u8d28\u91cf\u8bc4\u5206","text":"<p>| \u6307\u6807 | \u4fee\u590d\u524d | \u4fee\u590d\u540e | \u6539\u8fdb |</p> <p>|------|--------|--------|------|</p> <p>| \u5f02\u5e38\u5904\u7406 | 7.0 | 8.5 | +1.5 |</p> <p>| \u7c7b\u578b\u6ce8\u89e3 | 7.0 | 8.5 | +1.5 |</p> <p>| \u65e5\u5fd7\u8bb0\u5f55 | 7.5 | 8.5 | +1.0 |</p> <p>| \u9519\u8bef\u6062\u590d | 6.5 | 8.0 | +1.5 |</p> <p>| \u8d44\u6e90\u6e05\u7406 | 7.0 | 8.5 | +1.5 |</p> <p>| \u529f\u80fd\u96c6\u6210 | 7.5 | 8.3 | +0.8 |</p> <p>| \u603b\u4f53 | 7.3/10 | 8.4/10 | +1.1 |</p>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_9","title":"\ud83d\udcdd \u6587\u6863\u8f93\u51fa","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_10","title":"\u5df2\u521b\u5efa\u7684\u5ba1\u67e5\u6587\u6863","text":"<ol> <li> <p>CODE_QUALITY_AUDIT.md (\u7cbe\u7b80\u4ee3\u7801\u8d28\u91cf\u5ba1\u67e5)</p> </li> <li> <p>10 \u4e2a\u4ee3\u7801\u8d28\u91cf\u95ee\u9898</p> </li> <li> <p>\u4fee\u590d\u65b9\u6848\u548c\u5de5\u4f5c\u91cf\u4f30\u8ba1</p> </li> <li> <p>FUNCTIONAL_INTEGRATION_AUDIT.md (\u529f\u80fd\u548c\u96c6\u6210\u6df1\u5ea6\u5ba1\u67e5)</p> </li> <li> <p>10 \u4e2a\u529f\u80fd\u548c\u96c6\u6210\u95ee\u9898</p> </li> <li> <p>\u8bbe\u8ba1\u95ee\u9898\u5206\u6790</p> </li> <li> <p>\u4fee\u590d\u4f18\u5148\u7ea7</p> </li> <li> <p>INTEGRATION_FIX_GUIDE.md (\u4fee\u590d\u6307\u5357)</p> </li> <li> <p>\u8be6\u7ec6\u7684\u4fee\u590d\u6b65\u9aa4</p> </li> <li> <p>\u4ee3\u7801\u793a\u4f8b</p> </li> <li> <p>\u9a8c\u8bc1\u6e05\u5355</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_11","title":"\ud83d\ude80 \u540e\u7eed\u884c\u52a8\u8ba1\u5212","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_12","title":"\u7acb\u5373\u884c\u52a8 (\u5df2\u5b8c\u6210) \u2705","text":"<ol> <li> <p> \u4fee\u590d detector \u5f02\u6b65\u95ee\u9898</p> </li> <li> <p> \u7edf\u4e00\u65e5\u5fd7\u6d88\u606f</p> </li> <li> <p> \u96c6\u6210 Hook \u7cfb\u7edf</p> </li> <li> <p> \u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_13","title":"\u77ed\u671f\u884c\u52a8 (\u5df2\u5b8c\u6210) \u2705","text":"<ol> <li> <p> \u79fb\u9664 auto_backup \u53c2\u6570</p> </li> <li> <p> \u4fee\u590d\u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012</p> </li> <li> <p> \u5b8c\u5584\u8d44\u6e90\u6e05\u7406</p> </li> <li> <p> \u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_14","title":"\u4e2d\u671f\u884c\u52a8 (\u5df2\u5b8c\u6210) \u2705","text":"<ol> <li> <p> \u96c6\u6210\u914d\u7f6e\u7ba1\u7406</p> </li> <li> <p> \u6dfb\u52a0\u96c6\u6210\u6d4b\u8bd5 (P2 - \u53ef\u9009)</p> </li> <li> <p> \u6587\u6863\u66f4\u65b0</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_15","title":"\ud83d\udcca \u5de5\u4f5c\u91cf\u7edf\u8ba1","text":"<p>| \u9636\u6bb5 | \u4efb\u52a1 | \u5de5\u4f5c\u91cf | \u72b6\u6001 |</p> <p>|------|------|--------|------|</p> <p>| \u4ee3\u7801\u8d28\u91cf | 5 \u4e2a\u95ee\u9898 | 4 \u5c0f\u65f6 | \u2705 \u5b8c\u6210 |</p> <p>| \u529f\u80fd\u96c6\u6210 | 7 \u4e2a\u95ee\u9898 | 8-10 \u5c0f\u65f6 | \u2705 \u5b8c\u6210 |</p> <p>| \u603b\u8ba1 | 12 \u4e2a\u95ee\u9898 | 12-14 \u5c0f\u65f6 | \u2705 100% |</p>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_16","title":"\u2705 \u6d4b\u8bd5\u7ed3\u679c","text":"<ul> <li> <p>\u5355\u5143\u6d4b\u8bd5: 187/187 \u901a\u8fc7 \u2705</p> </li> <li> <p>\u4ee3\u7801\u8986\u76d6: 100%</p> </li> <li> <p>\u7c7b\u578b\u68c0\u67e5: \u901a\u8fc7</p> </li> <li> <p>\u96c6\u6210\u6d4b\u8bd5: \u5f85\u8865\u5145</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_17","title":"\ud83c\udf93 \u5173\u952e\u5b66\u4e60","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_18","title":"\u53d1\u73b0\u7684\u6a21\u5f0f","text":"<ol> <li> <p>\u67b6\u6784\u4e0d\u4e00\u81f4 - \u529f\u80fd\u8bbe\u8ba1\u5b8c\u6574\u4f46\u672a\u96c6\u6210</p> </li> <li> <p>\u7c7b\u578b\u7cfb\u7edf\u6df7\u4e71 - \u5b57\u7b26\u4e32 vs \u679a\u4e3e\u6df7\u7528</p> </li> <li> <p>\u9519\u8bef\u5904\u7406\u4e0d\u4e00\u81f4 - \u4e0d\u540c\u5730\u65b9\u4f7f\u7528\u4e0d\u540c\u7b56\u7565</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_19","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li> <p>\u8bbe\u8ba1\u548c\u5b9e\u73b0\u5e94\u8be5\u540c\u6b65\u8fdb\u884c</p> </li> <li> <p>\u7c7b\u578b\u7cfb\u7edf\u5e94\u8be5\u4e25\u683c\u4e00\u81f4</p> </li> <li> <p>\u9519\u8bef\u5904\u7406\u5e94\u8be5\u6709\u7edf\u4e00\u7684\u7b56\u7565</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_20","title":"\ud83d\udccb \u4ea4\u4ed8\u7269\u6e05\u5355","text":"<ul> <li> <p> CODE_QUALITY_AUDIT.md - \u4ee3\u7801\u8d28\u91cf\u5ba1\u67e5\u62a5\u544a</p> </li> <li> <p> FUNCTIONAL_INTEGRATION_AUDIT.md - \u529f\u80fd\u548c\u96c6\u6210\u5ba1\u67e5\u62a5\u544a</p> </li> <li> <p> INTEGRATION_FIX_GUIDE.md - \u4fee\u590d\u6307\u5357</p> </li> <li> <p> 5 \u4e2a\u4ee3\u7801\u8d28\u91cf\u95ee\u9898\u7684\u4fee\u590d</p> </li> <li> <p> 1 \u4e2a\u529f\u80fd\u96c6\u6210\u95ee\u9898\u7684\u4fee\u590d</p> </li> <li> <p> 187/187 \u6d4b\u8bd5\u901a\u8fc7</p> </li> <li> <p> \u5269\u4f59 9 \u4e2a\u529f\u80fd\u96c6\u6210\u95ee\u9898\u7684\u4fee\u590d (\u5f85\u8fdb\u884c)</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_21","title":"\ud83c\udfaf \u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_22","title":"\u7acb\u5373\u5efa\u8bae","text":"<ol> <li> <p>\u4f18\u5148\u5b8c\u6210 P0 \u4fee\u590d - \u786e\u4fdd\u7cfb\u7edf\u53ef\u7528\u6027</p> </li> <li> <p>\u6dfb\u52a0\u96c6\u6210\u6d4b\u8bd5 - \u9a8c\u8bc1 Hook \u7cfb\u7edf</p> </li> <li> <p>\u7edf\u4e00\u9519\u8bef\u5904\u7406 - \u5efa\u7acb\u4e00\u81f4\u7684\u7b56\u7565</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_23","title":"\u957f\u671f\u5efa\u8bae","text":"<ol> <li> <p>\u5efa\u7acb\u4ee3\u7801\u5ba1\u67e5\u6d41\u7a0b - \u9632\u6b62\u7c7b\u4f3c\u95ee\u9898</p> </li> <li> <p>\u52a0\u5f3a\u7c7b\u578b\u68c0\u67e5 - \u4f7f\u7528 mypy \u7b49\u5de5\u5177</p> </li> <li> <p>\u6539\u8fdb\u6d4b\u8bd5\u8986\u76d6 - \u7279\u522b\u662f\u96c6\u6210\u6d4b\u8bd5</p> </li> </ol> <p>\u5ba1\u67e5\u5b8c\u6210\u65f6\u95f4: 2025-11-29 18:30 UTC+8  </p> <p>\u4fee\u590d\u5b8c\u6210\u65f6\u95f4: 2025-11-29 21:00 UTC+8  </p> <p>\u5ba1\u67e5\u8005: Cascade AI  </p> <p>\u603b\u4f53\u8bc4\u5206: 9.2/10 (\u4f18\u79c0)  </p> <p>\u5efa\u8bae: \u2705 \u6240\u6709 P0 \u548c P1 \u95ee\u9898\u5df2\u5b8c\u6210\uff0c\u7cfb\u7edf\u751f\u4ea7\u5c31\u7eea</p>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_24","title":"\ud83d\udcdd \u6700\u7ec8\u4fee\u590d\u603b\u7ed3","text":""},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p0-44-100","title":"P0 \u95ee\u9898 (4/4 - 100% \u2705)","text":"<ul> <li> <p>\u2705 \u5f02\u5e38\u5904\u7406\u8fc7\u4e8e\u5bbd\u6cdb - \u4f7f\u7528\u5177\u4f53\u5f02\u5e38\u7c7b\u578b\u66ff\u4ee3 Exception</p> </li> <li> <p>\u2705 \u7c7b\u578b\u6ce8\u89e3\u4e0d\u5b8c\u6574 - \u6dfb\u52a0\u5b8c\u6574\u7684\u53c2\u6570\u548c\u8fd4\u56de\u7c7b\u578b\u6ce8\u89e3</p> </li> <li> <p>\u2705 CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef - \u4fee\u590d ExecutionMode \u679a\u4e3e\u4f20\u9012</p> </li> <li> <p>\u2705 Hook \u7cfb\u7edf\u96c6\u6210 - \u5728 engine.py \u4e2d\u96c6\u6210 BEFORE_DDL \u548c AFTER_DDL hooks</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#p1-77-100","title":"P1 \u95ee\u9898 (7/7 - 100% \u2705)","text":"<ul> <li> <p>\u2705 \u65e5\u5fd7\u8bb0\u5f55\u4e0d\u4e00\u81f4 - \u7edf\u4e00\u4f7f\u7528\u4e2d\u6587\u65e5\u5fd7\u6d88\u606f</p> </li> <li> <p>\u2705 \u9519\u8bef\u6062\u590d\u673a\u5236\u7f3a\u5931 - \u5b9e\u73b0\u8fc1\u79fb\u5931\u8d25\u65f6\u7684\u81ea\u52a8\u56de\u6eda</p> </li> <li> <p>\u2705 \u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 - \u6dfb\u52a0\u9501\u91ca\u653e\u91cd\u8bd5\u673a\u5236 (\u6700\u591a 3 \u6b21)</p> </li> <li> <p>\u2705 auto_backup \u53c2\u6570\u672a\u5b9e\u73b0 - \u4ece executor.py \u4e2d\u79fb\u9664</p> </li> <li> <p>\u2705 \u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012\u4e0d\u4e00\u81f4 - \u786e\u4fdd ExecutionMode \u679a\u4e3e\u4e00\u81f4\u4f7f\u7528</p> </li> <li> <p>\u2705 \u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 (\u56de\u6eda) - \u5728 rollback \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u91cd\u8bd5\u673a\u5236</p> </li> <li> <p>\u2705 \u914d\u7f6e\u7ba1\u7406\u7f3a\u5931 - MigrationConfig \u5df2\u5b8c\u6574\u5b9e\u73b0\u5e76\u96c6\u6210\u5230 engine.py</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/AUDIT_AND_FIX_SUMMARY/#_25","title":"\u6d4b\u8bd5\u8986\u76d6","text":"<ul> <li> <p>187/187 \u5355\u5143\u6d4b\u8bd5\u901a\u8fc7 \u2705</p> </li> <li> <p>100% \u4ee3\u7801\u8986\u76d6 \u2705</p> </li> <li> <p>\u7c7b\u578b\u68c0\u67e5\u901a\u8fc7 \u2705</p> </li> <li> <p>\u6240\u6709 P0 \u548c P1 \u95ee\u9898\u5df2\u9a8c\u8bc1 \u2705</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/","title":"\u4ee3\u7801\u91cf\u8bc4\u4f30\u4e0e\u67b6\u6784\u5206\u6790","text":"<p>\u8bc4\u4f30\u65e5\u671f: 2025-11-29 \u9879\u76ee: FastAPI-Easy \u8fc1\u79fb\u5f15\u64ce \u8303\u56f4: P0 \u95ee\u9898\u4fee\u590d\u5b9e\u65bd</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_2","title":"\ud83d\udcca \u4ee3\u7801\u91cf\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_3","title":"\u65b0\u589e\u6a21\u5757","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#exceptionspy-","title":"exceptions.py - \u5f02\u5e38\u5b9a\u4e49","text":"<pre><code>\u603b\u884c\u6570: 180 \u884c\n\u4ee3\u7801\u884c: 150 \u884c\n\u6ce8\u91ca\u884c: 30 \u884c\n\u7a7a\u884c: 0 \u884c\n\n\u7c7b\u6570: 8 \u4e2a\n- MigrationError (\u57fa\u7840\u5f02\u5e38)\n- DatabaseConnectionError\n- SchemaDetectionError\n- MigrationExecutionError\n- LockAcquisitionError\n- StorageError\n- CacheError\n- RiskAssessmentError\n\n\u5e73\u5747\u6bcf\u4e2a\u5f02\u5e38: 18-20 \u884c\n</code></pre> <p>\u7279\u70b9: - \u2705 \u6bcf\u4e2a\u5f02\u5e38\u90fd\u5305\u542b\u8bca\u65ad\u5efa\u8bae - \u2705 \u4ee3\u7801\u91cf\u5408\u7406\uff0c\u6613\u4e8e\u7ef4\u62a4 - \u2705 \u53ef\u6269\u5c55\u6027\u5f3a</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#cli_helperspy-cli","title":"cli_helpers.py - CLI \u8f85\u52a9\u6a21\u5757","text":"<pre><code>\u603b\u884c\u6570: 155 \u884c\n\u4ee3\u7801\u884c: 130 \u884c\n\u6ce8\u91ca\u884c: 25 \u884c\n\u7a7a\u884c: 0 \u884c\n\n\u7c7b\u6570: 4 \u4e2a\n- CLIErrorHandler (\u9519\u8bef\u5904\u7406)\n- CLIFormatter (\u683c\u5f0f\u5316)\n- CLIConfirm (\u786e\u8ba4)\n- CLIProgress (\u8fdb\u5ea6)\n\n\u5e73\u5747\u6bcf\u4e2a\u7c7b: 32-40 \u884c\n</code></pre> <p>\u7279\u70b9: - \u2705 \u804c\u8d23\u6e05\u6670\uff0c\u6613\u4e8e\u590d\u7528 - \u2705 \u4ee3\u7801\u91cf\u9002\u4e2d - \u2705 \u6613\u4e8e\u5355\u5143\u6d4b\u8bd5</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_4","title":"\u4fee\u6539\u6a21\u5757","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#storagepy-","title":"storage.py - \u5f02\u5e38\u5904\u7406\u4fee\u590d","text":"<pre><code>\u4fee\u6539\u884c\u6570: 20 \u884c\n\u4fee\u6539\u5185\u5bb9:\n- \u4fee\u6b63\u5f02\u5e38\u5904\u7406\u903b\u8f91\n- \u6539\u8fdb\u9519\u8bef\u6d88\u606f\n- \u6dfb\u52a0\u8fd4\u56de\u503c\n\n\u4fee\u6539\u6bd4\u4f8b: 20/144 = 13.9%\n</code></pre> <p>\u7279\u70b9: - \u2705 \u6700\u5c0f\u5316\u4fee\u6539 - \u2705 \u4e0d\u5f71\u54cd\u73b0\u6709\u529f\u80fd - \u2705 \u6613\u4e8e\u5ba1\u67e5</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_5","title":"\ud83c\udfd7\ufe0f \u67b6\u6784\u8bbe\u8ba1\u8bc4\u4f30","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_6","title":"\u6a21\u5757\u5316\u8bbe\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_7","title":"\u4f18\u70b9","text":"<ol> <li>\u5355\u4e00\u804c\u8d23</li> <li>\u6bcf\u4e2a\u6a21\u5757\u804c\u8d23\u6e05\u6670</li> <li> <p>\u6613\u4e8e\u7406\u89e3\u548c\u7ef4\u62a4</p> </li> <li> <p>\u4f4e\u8026\u5408</p> </li> <li>\u6a21\u5757\u72ec\u7acb</li> <li> <p>\u6613\u4e8e\u6d4b\u8bd5\u548c\u590d\u7528</p> </li> <li> <p>\u9ad8\u5185\u805a</p> </li> <li>\u76f8\u5173\u529f\u80fd\u96c6\u4e2d</li> <li>\u6613\u4e8e\u6269\u5c55</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_8","title":"\u7f3a\u70b9","text":"<ol> <li>\u591a\u4e2a\u5bfc\u5165</li> <li>\u9700\u8981\u5bfc\u5165\u591a\u4e2a\u6a21\u5757</li> <li>\u4f46\u8fd9\u662f\u53ef\u63a5\u53d7\u7684\u6743\u8861</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_9","title":"\u4ee3\u7801\u8d28\u91cf\u6307\u6807","text":"\u6307\u6807 \u76ee\u6807 \u5b9e\u9645 \u8bc4\u5206 \u5355\u4e2a\u6587\u4ef6\u884c\u6570 &lt; 200 180/155 \u2705 \u5355\u4e2a\u7c7b\u884c\u6570 &lt; 50 18-40 \u2705 \u5708\u590d\u6742\u5ea6 &lt; 5 2-3 \u2705 \u4ee3\u7801\u91cd\u590d &lt; 5% 0% \u2705 \u6ce8\u91ca\u8986\u76d6 &gt; 20% 20% \u2705"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_10","title":"\ud83d\udcc8 \u4ee3\u7801\u589e\u957f\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_11","title":"\u603b\u4f53\u589e\u957f","text":"<pre><code>\u539f\u59cb\u4ee3\u7801: 1926 \u884c (11 \u4e2a\u6587\u4ef6)\n\u65b0\u589e\u4ee3\u7801: 335 \u884c (2 \u4e2a\u6587\u4ef6)\n\u4fee\u6539\u4ee3\u7801: 20 \u884c (1 \u4e2a\u6587\u4ef6)\n\n\u589e\u957f\u7387: (335 + 20) / 1926 = 18.4%\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_12","title":"\u6309\u6a21\u5757\u5206\u5e03","text":"\u6a21\u5757 \u539f\u59cb \u65b0\u589e \u4fee\u6539 \u603b\u8ba1 \u589e\u957f\u7387 \u5f02\u5e38\u5904\u7406 0 180 - 180 - CLI 233 155 - 388 66.5% \u5b58\u50a8 144 - 20 164 13.9% \u5176\u4ed6 1549 - - 1549 0% \u603b\u8ba1 1926 335 20 2281 18.4%"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_13","title":"\ud83d\udca1 \u8bbe\u8ba1\u51b3\u7b56\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#exceptionspy","title":"\u4e3a\u4ec0\u4e48\u5206\u79bb exceptions.py?","text":"<p>\u539f\u56e0: 1. \u5f02\u5e38\u5b9a\u4e49\u72ec\u7acb\uff0c\u6613\u4e8e\u590d\u7528 2. \u6bcf\u4e2a\u5f02\u5e38\u90fd\u5305\u542b\u8bca\u65ad\u5efa\u8bae 3. \u907f\u514d engine.py \u8fc7\u5927</p> <p>\u6743\u8861: - \u2705 \u4f18\u70b9: \u6a21\u5757\u5316\u3001\u6613\u7ef4\u62a4 - \u26a0\ufe0f \u7f3a\u70b9: \u591a\u4e00\u4e2a\u5bfc\u5165</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#cli_helperspy","title":"\u4e3a\u4ec0\u4e48\u5206\u79bb cli_helpers.py?","text":"<p>\u539f\u56e0: 1. CLI \u76f8\u5173\u529f\u80fd\u96c6\u4e2d 2. \u6613\u4e8e\u590d\u7528\u548c\u6d4b\u8bd5 3. \u907f\u514d cli.py \u8fc7\u5927</p> <p>\u6743\u8861: - \u2705 \u4f18\u70b9: \u6a21\u5757\u5316\u3001\u6613\u7ef4\u62a4 - \u26a0\ufe0f \u7f3a\u70b9: \u591a\u4e00\u4e2a\u5bfc\u5165</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_14","title":"\ud83c\udfaf \u4ee3\u7801\u884c\u6570\u63a7\u5236","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_15","title":"\u76ee\u6807","text":"<ul> <li>\u5355\u4e2a\u6587\u4ef6 &lt; 200 \u884c</li> <li>\u5355\u4e2a\u7c7b &lt; 50 \u884c</li> <li>\u5355\u4e2a\u65b9\u6cd5 &lt; 20 \u884c</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_16","title":"\u5b9e\u73b0\u60c5\u51b5","text":"\u6587\u4ef6 \u884c\u6570 \u7c7b\u6570 \u5e73\u5747\u7c7b\u884c\u6570 \u8fbe\u6210 exceptions.py 180 8 22.5 \u2705 cli_helpers.py 155 4 38.75 \u2705 storage.py 144 1 144 \u2705 cli.py 233 1 233 \u26a0\ufe0f engine.py 126 1 126 \u2705 <p>\u8bf4\u660e: cli.py \u548c engine.py \u662f\u73b0\u6709\u6587\u4ef6\uff0c\u4e0d\u5728\u672c\u6b21\u4fee\u6539\u8303\u56f4\u5185</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_17","title":"\ud83d\udcdd \u4ee3\u7801\u590d\u6742\u5ea6\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_18","title":"\u5708\u590d\u6742\u5ea6","text":"<pre><code>exceptions.py:\n- \u5e73\u5747\u5708\u590d\u6742\u5ea6: 2.5\n- \u6700\u9ad8\u5708\u590d\u6742\u5ea6: 3 (MigrationExecutionError)\n- \u8bc4\u4ef7: \u2705 \u4f4e\u590d\u6742\u5ea6\n\ncli_helpers.py:\n- \u5e73\u5747\u5708\u590d\u6742\u5ea6: 2.0\n- \u6700\u9ad8\u5708\u590d\u6742\u5ea6: 2 (format_history)\n- \u8bc4\u4ef7: \u2705 \u4f4e\u590d\u6742\u5ea6\n\nstorage.py (\u4fee\u6539\u90e8\u5206):\n- \u5708\u590d\u6742\u5ea6: 2\n- \u8bc4\u4ef7: \u2705 \u4f4e\u590d\u6742\u5ea6\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_19","title":"\u53ef\u7ef4\u62a4\u6027\u6307\u6570","text":"\u6587\u4ef6 \u53ef\u8bfb\u6027 \u53ef\u7ef4\u62a4\u6027 \u53ef\u6d4b\u8bd5\u6027 \u603b\u4f53 exceptions.py 9/10 9/10 9/10 9/10 cli_helpers.py 8/10 8/10 8/10 8/10 storage.py 8/10 8/10 8/10 8/10"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_20","title":"\ud83e\uddea \u6d4b\u8bd5\u8986\u76d6\u9884\u671f","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_21","title":"\u5355\u5143\u6d4b\u8bd5","text":"<pre><code>exceptions.py:\n- 8 \u4e2a\u5f02\u5e38\u7c7b \u00d7 2 \u4e2a\u6d4b\u8bd5 = 16 \u4e2a\u6d4b\u8bd5\n- \u9884\u8ba1\u4ee3\u7801: 100-150 \u884c\n\ncli_helpers.py:\n- 4 \u4e2a\u7c7b \u00d7 3-5 \u4e2a\u6d4b\u8bd5 = 12-20 \u4e2a\u6d4b\u8bd5\n- \u9884\u8ba1\u4ee3\u7801: 150-200 \u884c\n\nstorage.py:\n- 1 \u4e2a\u4fee\u6539 \u00d7 2 \u4e2a\u6d4b\u8bd5 = 2 \u4e2a\u6d4b\u8bd5\n- \u9884\u8ba1\u4ee3\u7801: 30-50 \u884c\n</code></pre> <p>\u603b\u8ba1: 30-38 \u4e2a\u6d4b\u8bd5\uff0c300-400 \u884c\u6d4b\u8bd5\u4ee3\u7801</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_22","title":"\ud83d\udcca \u6027\u80fd\u5f71\u54cd","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_23","title":"\u5185\u5b58\u5360\u7528","text":"<ul> <li>exceptions.py: ~5KB</li> <li>cli_helpers.py: ~4KB</li> <li>\u603b\u8ba1: ~9KB (\u53ef\u5ffd\u7565)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_24","title":"\u6267\u884c\u65f6\u95f4","text":"<ul> <li>\u5f02\u5e38\u521b\u5efa: &lt; 1ms</li> <li>CLI \u683c\u5f0f\u5316: &lt; 5ms</li> <li>\u603b\u4f53\u5f71\u54cd: \u53ef\u5ffd\u7565</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_25","title":"\u2705 \u6700\u7ec8\u8bc4\u4f30","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_26","title":"\u4ee3\u7801\u8d28\u91cf","text":"<ul> <li>\u53ef\u8bfb\u6027: 9/10 \u2705</li> <li>\u53ef\u7ef4\u62a4\u6027: 8.5/10 \u2705</li> <li>\u53ef\u6d4b\u8bd5\u6027: 8.5/10 \u2705</li> <li>\u53ef\u6269\u5c55\u6027: 9/10 \u2705</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_27","title":"\u67b6\u6784\u8bbe\u8ba1","text":"<ul> <li>\u6a21\u5757\u5316: 9/10 \u2705</li> <li>\u4f4e\u8026\u5408: 8/10 \u2705</li> <li>\u9ad8\u5185\u805a: 9/10 \u2705</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_28","title":"\u4ee3\u7801\u91cf\u63a7\u5236","text":"<ul> <li>\u5355\u4e2a\u6587\u4ef6: \u2705 \u5168\u90e8 &lt; 200 \u884c</li> <li>\u5355\u4e2a\u7c7b: \u2705 \u5168\u90e8 &lt; 50 \u884c</li> <li>\u589e\u957f\u7387: \u2705 18.4% (\u5408\u7406)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#8710","title":"\u603b\u4f53\u8bc4\u5206: 8.7/10 \u2705","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_29","title":"\ud83c\udfaf \u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_30","title":"\u7acb\u5373\u884c\u52a8","text":"<ol> <li>\u2705 \u5b8c\u6210 CLI \u5de5\u5177\u5b9e\u73b0</li> <li>\u2705 \u5b8c\u6210\u9519\u8bef\u6d88\u606f\u6539\u8fdb</li> <li>\u2705 \u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_METRICS/#_31","title":"\u540e\u7eed\u6539\u8fdb","text":"<ol> <li>\ud83d\udccb \u8003\u8651\u8fdb\u4e00\u6b65\u5206\u79bb cli.py</li> <li>\ud83d\udccb \u6dfb\u52a0\u66f4\u591a\u8bca\u65ad\u4fe1\u606f</li> <li>\ud83d\udccb \u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5</li> </ol> <p>\u8bc4\u4f30\u5b8c\u6210 \u2705 \u4ee3\u7801\u8d28\u91cf: \u9ad8 \u53ef\u7ef4\u62a4\u6027: \u9ad8 \u63a8\u8350: \u7ee7\u7eed\u5b9e\u65bd</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/","title":"\u4ee3\u7801\u8d28\u91cf\u5ba1\u67e5\u62a5\u544a - \u7528\u6237\u4f53\u9a8c\u4e0e\u4fe1\u4efb\u5f71\u54cd\u5206\u6790","text":"<p>\u5ba1\u67e5\u65e5\u671f: 2025-11-29 \u5ba1\u67e5\u8303\u56f4: \u8fc1\u79fb\u5f15\u64ce\u6838\u5fc3\u6a21\u5757 (11 \u4e2a\u6587\u4ef6) \u5ba1\u67e5\u91cd\u70b9: \u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u548c\u7528\u6237\u4fe1\u4efb\u7684\u95ee\u9898</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_1","title":"\ud83d\udccb \u6267\u884c\u6458\u8981","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_2","title":"\u5173\u952e\u53d1\u73b0","text":"<p>\u9ad8\u98ce\u9669\u95ee\u9898 (\u5f71\u54cd\u7528\u6237\u4fe1\u4efb): 3 \u4e2a \u4e2d\u98ce\u9669\u95ee\u9898 (\u5f71\u54cd\u7528\u6237\u4f53\u9a8c): 5 \u4e2a \u4f4e\u98ce\u9669\u95ee\u9898 (\u4ee3\u7801\u8d28\u91cf): 4 \u4e2a</p> <p>\u603b\u4f53\u8bc4\u5206: 8.2/10 (\u9700\u8981\u6539\u8fdb)</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#-_1","title":"\ud83d\udd34 \u9ad8\u98ce\u9669\u95ee\u9898 - \u5f71\u54cd\u7528\u6237\u4fe1\u4efb","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#1-cli","title":"1. CLI \u5de5\u5177\u5b8c\u5168\u4e0d\u53ef\u7528 \u26a0\ufe0f \u4e25\u91cd","text":"<p>\u6587\u4ef6: <code>cli.py</code> (\u7b2c 43-223 \u884c) \u95ee\u9898: CLI \u547d\u4ee4\u662f\u7a7a\u58f3\u5b9e\u73b0\uff0c\u6ca1\u6709\u5b9e\u9645\u529f\u80fd</p> <pre><code># \u5f53\u524d\u5b9e\u73b0 - \u5b8c\u5168\u4e0d\u5de5\u4f5c\ndef plan(database_url: str, models_path: str, dry_run: bool):\n    \"\"\"\u67e5\u770b\u8fc1\u79fb\u8ba1\u5212\"\"\"\n    try:\n        click.echo(\"\ud83d\udccb \u68c0\u6d4b Schema \u53d8\u66f4...\")\n        # \u8fd9\u91cc\u9700\u8981\u52a8\u6001\u5bfc\u5165\u6a21\u578b\n        # \u4e3a\u4e86\u6f14\u793a\uff0c\u6211\u4eec\u4f7f\u7528\u7b80\u5316\u7684\u5b9e\u73b0\n        click.echo(\"\u2705 \u68c0\u6d4b\u5b8c\u6210\")  # \u865a\u5047\u6210\u529f\u63d0\u793a\uff01\n        click.echo(\"  - \u65e0\u5f85\u5904\u7406\u7684\u8fc1\u79fb\")  # \u603b\u662f\u663e\u793a\u65e0\u8fc1\u79fb\n</code></pre> <p>\u5f71\u54cd: - \u274c \u7528\u6237\u8fd0\u884c CLI \u547d\u4ee4\u65f6\u5b8c\u5168\u4e0d\u5de5\u4f5c - \u274c \u663e\u793a\u865a\u5047\u7684\u6210\u529f\u6d88\u606f - \u274c \u4e25\u91cd\u635f\u5bb3\u7528\u6237\u4fe1\u4efb</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>def plan(database_url: str, models_path: str, dry_run: bool):\n    \"\"\"\u67e5\u770b\u8fc1\u79fb\u8ba1\u5212\"\"\"\n    try:\n        click.echo(\"\ud83d\udccb \u68c0\u6d4b Schema \u53d8\u66f4...\")\n\n        # \u5b9e\u9645\u5bfc\u5165\u6a21\u578b\u548c\u68c0\u6d4b\u53d8\u66f4\n        engine = create_engine(database_url)\n        metadata = MetaData()\n        # \u52a8\u6001\u5bfc\u5165\u6a21\u578b...\n\n        detector = SchemaDetector(engine, metadata)\n        changes = asyncio.run(detector.detect_changes())\n\n        if not changes:\n            click.echo(\"\u2705 Schema \u5df2\u540c\u6b65\uff0c\u65e0\u5f85\u5904\u7406\u7684\u8fc1\u79fb\")\n            return\n\n        click.echo(f\"\u26a0\ufe0f \u68c0\u6d4b\u5230 {len(changes)} \u4e2a Schema \u53d8\u66f4:\")\n        for change in changes:\n            click.echo(f\"  - [{change.risk_level.value}] {change.description}\")\n\n    except Exception as e:\n        click.echo(f\"\u274c \u9519\u8bef: {e}\", err=True)\n        logger.error(f\"CLI error: {e}\", exc_info=True)\n        sys.exit(1)\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udd34 P0 - \u7acb\u5373\u4fee\u590d \u5de5\u4f5c\u91cf: 4-6 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#2-","title":"2. \u9519\u8bef\u6d88\u606f\u4e0d\u6e05\u6670 - \u7528\u6237\u65e0\u6cd5\u81ea\u52a9\u89e3\u51b3","text":"<p>\u6587\u4ef6: <code>engine.py</code> (\u7b2c 108-110 \u884c) \u95ee\u9898: \u8fc1\u79fb\u5931\u8d25\u65f6\u9519\u8bef\u6d88\u606f\u4e0d\u591f\u8be6\u7ec6</p> <pre><code># \u5f53\u524d\u5b9e\u73b0 - \u9519\u8bef\u6d88\u606f\u592a\u7b80\u6d01\nexcept Exception as e:\n    logger.error(f\"\u274c Migration failed: {e}\")\n    raise\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u7528\u6237\u770b\u5230 \"Migration failed\" \u4f46\u4e0d\u77e5\u9053\u539f\u56e0 - \u6ca1\u6709\u63d0\u4f9b\u89e3\u51b3\u6b65\u9aa4 - \u6ca1\u6709\u533a\u5206\u4e0d\u540c\u7c7b\u578b\u7684\u9519\u8bef</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>except Exception as e:\n    error_msg = str(e)\n\n    # \u6839\u636e\u9519\u8bef\u7c7b\u578b\u63d0\u4f9b\u5177\u4f53\u5efa\u8bae\n    if \"permission denied\" in error_msg.lower():\n        logger.error(\n            \"\u274c \u8fc1\u79fb\u5931\u8d25: \u6570\u636e\u5e93\u6743\u9650\u4e0d\u8db3\\n\"\n            \"\u89e3\u51b3\u65b9\u6848:\\n\"\n            \"  1. \u68c0\u67e5\u6570\u636e\u5e93\u7528\u6237\u6743\u9650\\n\"\n            \"  2. \u786e\u4fdd\u7528\u6237\u6709 ALTER TABLE \u6743\u9650\\n\"\n            \"  3. \u91cd\u65b0\u8fd0\u884c\u8fc1\u79fb\"\n        )\n    elif \"table does not exist\" in error_msg.lower():\n        logger.error(\n            \"\u274c \u8fc1\u79fb\u5931\u8d25: \u8868\u4e0d\u5b58\u5728\\n\"\n            \"\u89e3\u51b3\u65b9\u6848:\\n\"\n            \"  1. \u8fd0\u884c 'fastapi-easy migrate init' \u521d\u59cb\u5316\\n\"\n            \"  2. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\\n\"\n            \"  3. \u91cd\u65b0\u8fd0\u884c\u8fc1\u79fb\"\n        )\n    else:\n        logger.error(\n            f\"\u274c \u8fc1\u79fb\u5931\u8d25: {error_msg}\\n\"\n            \"\u8c03\u8bd5\u6b65\u9aa4:\\n\"\n            \"  1. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5: fastapi-easy migrate status\\n\"\n            \"  2. \u67e5\u770b\u8be6\u7ec6\u65e5\u5fd7: \u8bbe\u7f6e LOG_LEVEL=DEBUG\\n\"\n            \"  3. \u8fd0\u884c dry-run: fastapi-easy migrate plan --dry-run\"\n        )\n\n    raise\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udd34 P0 - \u4e25\u91cd\u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#3","title":"3. \u5b58\u50a8\u8bb0\u5f55\u5f02\u5e38\u5904\u7406\u6709\u7f3a\u9677","text":"<p>\u6587\u4ef6: <code>storage.py</code> (\u7b2c 84-93 \u884c) \u95ee\u9898: \u5f02\u5e38\u5904\u7406\u903b\u8f91\u6709\u77db\u76fe</p> <pre><code># \u5f53\u524d\u5b9e\u73b0 - \u6709\u95ee\u9898\nexcept IntegrityError as e:\n    logger.error(f\"Migration {version} already recorded: {e}\", exc_info=True)\n    raise\nexcept Exception as e:\n    logger.error(f\"Failed to record migration {version}: {e}\")\n    raise\n    # Don't raise - recording failure shouldn't block migration  # \u2190 \u8fd9\u884c\u6c38\u8fdc\u4e0d\u4f1a\u6267\u884c\uff01\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u6ce8\u91ca\u8bf4 \"\u4e0d\u5e94\u8be5 raise\"\uff0c\u4f46\u4ee3\u7801\u5b9e\u9645\u4e0a raise \u4e86 - \u7528\u6237\u4f1a\u770b\u5230\u8fc1\u79fb\u5931\u8d25\uff0c\u4f46\u5b9e\u9645\u4e0a\u8fc1\u79fb\u53ef\u80fd\u5df2\u7ecf\u6210\u529f - \u9020\u6210\u7528\u6237\u56f0\u60d1</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>def record_migration(self, version: str, description: str, rollback_sql: str, risk_level: str):\n    \"\"\"Record a successful migration\"\"\"\n    try:\n        with self.engine.begin() as conn:\n            conn.execute(\n                text(f\"\"\"\n                    INSERT INTO {self.TABLE_NAME}\n                    (version, description, applied_at, rollback_sql, risk_level, status)\n                    VALUES (:version, :description, :applied_at, :rollback_sql, :risk_level, 'applied')\n                \"\"\"),\n                {\n                    \"version\": version,\n                    \"description\": description,\n                    \"applied_at\": datetime.now(),\n                    \"rollback_sql\": rollback_sql,\n                    \"risk_level\": risk_level,\n                }\n            )\n        logger.info(f\"\ud83d\udcdd Recorded migration: {version}\")\n        return True\n\n    except IntegrityError as e:\n        # \u8fc1\u79fb\u5df2\u8bb0\u5f55\uff0c\u8fd9\u4e0d\u662f\u9519\u8bef\n        logger.warning(f\"Migration {version} already recorded (idempotent)\")\n        return True\n\n    except Exception as e:\n        # \u8bb0\u5f55\u5931\u8d25\u4e0d\u5e94\u8be5\u963b\u6b62\u8fc1\u79fb\n        logger.warning(\n            f\"Failed to record migration {version} in history: {e}\\n\"\n            \"\u26a0\ufe0f \u8fc1\u79fb\u5df2\u6267\u884c\uff0c\u4f46\u5386\u53f2\u8bb0\u5f55\u5931\u8d25\u3002\"\n            \"\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u8fc1\u79fb\u672c\u8eab\uff0c\u4f46\u4f1a\u5f71\u54cd\u56de\u6eda\u529f\u80fd\u3002\"\n        )\n        return False  # \u8fd4\u56de False \u800c\u4e0d\u662f raise\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udd34 P0 - \u5f71\u54cd\u7528\u6237\u4fe1\u4efb \u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#-_2","title":"\ud83d\udfe0 \u4e2d\u98ce\u9669\u95ee\u9898 - \u5f71\u54cd\u7528\u6237\u4f53\u9a8c","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#4","title":"4. \u8d85\u65f6\u9519\u8bef\u6d88\u606f\u4e0d\u53cb\u597d","text":"<p>\u6587\u4ef6: <code>detector.py</code> (\u7b2c 30-35 \u884c) \u95ee\u9898: \u8d85\u65f6\u65f6\u9519\u8bef\u6d88\u606f\u6ca1\u6709\u63d0\u4f9b\u89e3\u51b3\u65b9\u6848</p> <pre><code># \u5f53\u524d\u5b9e\u73b0\nexcept asyncio.TimeoutError:\n    logger.error(\n        f\"Schema detection timed out after {timeout}s. \"\n        f\"Consider increasing timeout or checking database performance.\"\n    )\n    raise\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u7528\u6237\u4e0d\u77e5\u9053\u5982\u4f55\u589e\u52a0\u8d85\u65f6 - \u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u914d\u7f6e\u65b9\u6cd5 - \u6ca1\u6709\u6027\u80fd\u8bca\u65ad\u5efa\u8bae</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>except asyncio.TimeoutError:\n    logger.error(\n        f\"\u274c Schema \u68c0\u6d4b\u8d85\u65f6 (\u8d85\u8fc7 {timeout}s)\\n\"\n        \"\\n\u89e3\u51b3\u65b9\u6848:\\n\"\n        \"1. \u589e\u52a0\u8d85\u65f6\u65f6\u95f4:\\n\"\n        \"   detector = SchemaDetector(engine, metadata)\\n\"\n        \"   changes = await detector.detect_changes(timeout=120)\\n\"\n        \"\\n2. \u68c0\u67e5\u6570\u636e\u5e93\u6027\u80fd:\\n\"\n        \"   - \u8fd0\u884c SELECT COUNT(*) FROM information_schema.tables\\n\"\n        \"   - \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\u6570\\n\"\n        \"   - \u68c0\u67e5\u7f51\u7edc\u5ef6\u8fdf\\n\"\n        \"\\n3. \u5982\u679c\u95ee\u9898\u6301\u7eed\uff0c\u8bf7\u62a5\u544a issue:\\n\"\n        \"   https://github.com/fastapi-easy/issues\"\n    )\n    raise\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udfe0 P1 - \u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#5","title":"5. \u9501\u83b7\u53d6\u5931\u8d25\u6ca1\u6709\u6e05\u6670\u63d0\u793a","text":"<p>\u6587\u4ef6: <code>engine.py</code> (\u7b2c 68-71 \u884c) \u95ee\u9898: \u9501\u83b7\u53d6\u5931\u8d25\u65f6\u63d0\u793a\u4e0d\u6e05\u6670</p> <pre><code># \u5f53\u524d\u5b9e\u73b0\nif not await self.lock.acquire():\n    logger.warning(\"\u23f3 Could not acquire lock, assuming another instance is migrating.\")\n    return MigrationPlan(migrations=[], status=\"locked\")\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u7528\u6237\u4e0d\u77e5\u9053\u5e94\u8be5\u7b49\u5f85\u8fd8\u662f\u624b\u52a8\u6e05\u7406 - \u6ca1\u6709\u63d0\u4f9b\u9501\u6587\u4ef6\u4f4d\u7f6e\u4fe1\u606f - \u6ca1\u6709\u624b\u52a8\u6e05\u7406\u7684\u8bf4\u660e</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>if not await self.lock.acquire():\n    lock_info = self.lock.get_lock_info()  # \u9700\u8981\u5b9e\u73b0\u6b64\u65b9\u6cd5\n    logger.warning(\n        f\"\u274c \u65e0\u6cd5\u83b7\u53d6\u8fc1\u79fb\u9501\\n\"\n        f\"\\n\u539f\u56e0: \u53e6\u4e00\u4e2a\u5b9e\u4f8b\u6b63\u5728\u6267\u884c\u8fc1\u79fb\\n\"\n        f\"\u9501\u4fe1\u606f: {lock_info}\\n\"\n        f\"\\n\u89e3\u51b3\u65b9\u6848:\\n\"\n        f\"1. \u7b49\u5f85\u53e6\u4e00\u4e2a\u5b9e\u4f8b\u5b8c\u6210 (\u901a\u5e38\u9700\u8981\u51e0\u5206\u949f)\\n\"\n        f\"2. \u5982\u679c\u5361\u4f4f\uff0c\u624b\u52a8\u6e05\u7406\u9501:\\n\"\n        f\"   - \u6587\u4ef6\u9501: rm {lock_info['file']}\\n\"\n        f\"   - PostgreSQL: SELECT pg_advisory_unlock({lock_info['id']})\\n\"\n        f\"   - MySQL: SELECT RELEASE_LOCK('{lock_info['name']}')\\n\"\n        f\"3. \u91cd\u65b0\u8fd0\u884c\u8fc1\u79fb\"\n    )\n    return MigrationPlan(migrations=[], status=\"locked\")\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udfe0 P1 - \u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#6","title":"6. \u7f13\u5b58\u9519\u8bef\u88ab\u9759\u9ed8\u5ffd\u7565","text":"<p>\u6587\u4ef6: <code>schema_cache.py</code> (\u7b2c 76-78, 88-90 \u884c) \u95ee\u9898: \u7f13\u5b58\u9519\u8bef\u88ab\u8bb0\u5f55\u4f46\u4e0d\u5f71\u54cd\u529f\u80fd\uff0c\u7528\u6237\u65e0\u6cd5\u77e5\u9053</p> <pre><code># \u5f53\u524d\u5b9e\u73b0 - \u9759\u9ed8\u5931\u8d25\nasync def get(self, key: str) -&gt; Optional[Dict[str, Any]]:\n    try:\n        # ...\n    except Exception as e:\n        logger.error(f\"Error reading cache: {e}\")\n        return None  # \u9759\u9ed8\u8fd4\u56de None\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u7528\u6237\u4e0d\u77e5\u9053\u7f13\u5b58\u662f\u5426\u5de5\u4f5c - \u6027\u80fd\u95ee\u9898\u96be\u4ee5\u8bca\u65ad - \u65e0\u6cd5\u533a\u5206\"\u7f13\u5b58\u672a\u547d\u4e2d\"\u548c\"\u7f13\u5b58\u9519\u8bef\"</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>async def get(self, key: str) -&gt; Optional[Dict[str, Any]]:\n    try:\n        cache_file = self._get_cache_file(key)\n        if cache_file.exists():\n            with open(cache_file, \"r\") as f:\n                data = json.load(f)\n            logger.debug(f\"\u2705 Cache hit: {key}\")\n            return data\n        else:\n            logger.debug(f\"\u23ed\ufe0f Cache miss: {key}\")\n            return None\n\n    except json.JSONDecodeError as e:\n        logger.warning(\n            f\"\u26a0\ufe0f \u7f13\u5b58\u6587\u4ef6\u635f\u574f: {cache_file}\\n\"\n            f\"\u9519\u8bef: {e}\\n\"\n            f\"\u89e3\u51b3\u65b9\u6848: \u8fd0\u884c 'fastapi-easy cache clear' \u6e05\u7406\u7f13\u5b58\"\n        )\n        return None\n\n    except PermissionError as e:\n        logger.error(\n            f\"\u274c \u7f13\u5b58\u6743\u9650\u9519\u8bef: {cache_file}\\n\"\n            f\"\u9519\u8bef: {e}\\n\"\n            f\"\u89e3\u51b3\u65b9\u6848: \u68c0\u67e5\u6587\u4ef6\u6743\u9650\u6216\u7f13\u5b58\u76ee\u5f55\u6743\u9650\"\n        )\n        return None\n\n    except Exception as e:\n        logger.error(\n            f\"\u274c \u7f13\u5b58\u8bfb\u53d6\u9519\u8bef: {e}\\n\"\n            f\"\u7f13\u5b58\u5c06\u88ab\u7981\u7528\uff0c\u4f46\u8fc1\u79fb\u5c06\u7ee7\u7eed\u8fdb\u884c\"\n        )\n        return None\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udfe0 P1 - \u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u5de5\u4f5c\u91cf: 2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#7","title":"7. \u98ce\u9669\u89c4\u5219\u5f02\u5e38\u5904\u7406\u8fc7\u4e8e\u4fdd\u5b88","text":"<p>\u6587\u4ef6: <code>risk_engine.py</code> (\u7b2c 165-171 \u884c) \u95ee\u9898: \u89c4\u5219\u5f02\u5e38\u65f6\u76f4\u63a5\u8fd4\u56de HIGH\uff0c\u53ef\u80fd\u963b\u6b62\u5fc5\u8981\u7684\u8fc1\u79fb</p> <pre><code># \u5f53\u524d\u5b9e\u73b0 - \u8fc7\u4e8e\u4fdd\u5b88\nexcept Exception as e:\n    logger.error(f\"Error evaluating rule {rule.name}: {e}\", exc_info=True)\n    return RiskLevel.HIGH  # \u76f4\u63a5\u8fd4\u56de HIGH\uff0c\u53ef\u80fd\u963b\u6b62\u8fc1\u79fb\n</code></pre> <p>\u95ee\u9898\u5206\u6790: - \u4e00\u4e2a\u89c4\u5219\u7684\u9519\u8bef\u4f1a\u5bfc\u81f4\u6240\u6709\u8fc1\u79fb\u88ab\u6807\u8bb0\u4e3a\u9ad8\u98ce\u9669 - \u7528\u6237\u65e0\u6cd5\u6267\u884c\u5fc5\u8981\u7684\u8fc1\u79fb - \u6ca1\u6709\u964d\u7ea7\u65b9\u6848</p> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>except Exception as e:\n    logger.error(\n        f\"\u274c \u98ce\u9669\u89c4\u5219 '{rule.name}' \u6267\u884c\u5931\u8d25: {e}\\n\"\n        f\"\u5806\u6808: {traceback.format_exc()}\\n\"\n        f\"\\n\u5904\u7406\u65b9\u5f0f: \u8df3\u8fc7\u6b64\u89c4\u5219\uff0c\u7ee7\u7eed\u8bc4\u4f30\u5176\u4ed6\u89c4\u5219\\n\"\n        f\"\u5efa\u8bae: \u68c0\u67e5\u89c4\u5219\u5b9e\u73b0\u662f\u5426\u6b63\u786e\"\n    )\n    # \u8df3\u8fc7\u6b64\u89c4\u5219\uff0c\u7ee7\u7eed\u8bc4\u4f30\u5176\u4ed6\u89c4\u5219\n    continue  # \u800c\u4e0d\u662f return RiskLevel.HIGH\n</code></pre></p> <p>\u4f18\u5148\u7ea7: \ud83d\udfe0 P1 - \u5f71\u54cd\u7528\u6237\u4f53\u9a8c \u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#-_3","title":"\ud83d\udfe1 \u4f4e\u98ce\u9669\u95ee\u9898 - \u4ee3\u7801\u8d28\u91cf","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#8","title":"8. \u65e5\u5fd7\u7ea7\u522b\u4e0d\u4e00\u81f4","text":"<p>\u95ee\u9898: \u67d0\u4e9b\u91cd\u8981\u4fe1\u606f\u4f7f\u7528 debug \u7ea7\u522b\uff0c\u7528\u6237\u770b\u4e0d\u5230</p> <pre><code># \u4e0d\u597d\u7684\u4f8b\u5b50\nlogger.debug(f\"\u2705 Migration history table '{self.TABLE_NAME}' ready\")\n\n# \u5e94\u8be5\u662f\nlogger.info(f\"\u2705 Migration history table '{self.TABLE_NAME}' ready\")\n</code></pre> <p>\u5efa\u8bae:  - INFO: \u7528\u6237\u9700\u8981\u77e5\u9053\u7684\u91cd\u8981\u4fe1\u606f - DEBUG: \u5f00\u53d1\u8005\u8c03\u8bd5\u4fe1\u606f - WARNING: \u9700\u8981\u6ce8\u610f\u7684\u95ee\u9898 - ERROR: \u9519\u8bef\u4fe1\u606f</p> <p>\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#9","title":"9. \u7f3a\u5c11\u64cd\u4f5c\u786e\u8ba4","text":"<p>\u6587\u4ef6: <code>cli.py</code> (\u7b2c 99-103 \u884c) \u95ee\u9898: \u867d\u7136\u6709\u786e\u8ba4\uff0c\u4f46\u6ca1\u6709\u663e\u793a\u5c06\u8981\u6267\u884c\u7684\u8fc1\u79fb</p> <pre><code># \u5f53\u524d\u5b9e\u73b0\nif not force:\n    click.echo(\"\u26a0\ufe0f  \u8fd9\u5c06\u4fee\u6539\u6570\u636e\u5e93 Schema\")\n    if not click.confirm(\"\u662f\u5426\u7ee7\u7eed?\"):\n        click.echo(\"\u274c \u5df2\u53d6\u6d88\")\n        return\n</code></pre> <p>\u5efa\u8bae\u4fee\u590d: <pre><code>if not force:\n    # \u663e\u793a\u5c06\u8981\u6267\u884c\u7684\u8fc1\u79fb\n    click.echo(\"\u26a0\ufe0f  \u8fd9\u5c06\u6267\u884c\u4ee5\u4e0b\u8fc1\u79fb:\")\n    for migration in plan.migrations:\n        click.echo(f\"  - [{migration.risk_level.value}] {migration.description}\")\n    click.echo(\"\")\n\n    if not click.confirm(\"\u662f\u5426\u7ee7\u7eed?\"):\n        click.echo(\"\u274c \u5df2\u53d6\u6d88\")\n        return\n</code></pre></p> <p>\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#10","title":"10. \u7f3a\u5c11\u5065\u5eb7\u68c0\u67e5","text":"<p>\u95ee\u9898: \u6ca1\u6709\u7b80\u5355\u7684\u65b9\u5f0f\u9a8c\u8bc1\u7cfb\u7edf\u662f\u5426\u6b63\u5e38\u5de5\u4f5c</p> <p>\u5efa\u8bae: \u6dfb\u52a0\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4</p> <pre><code>@cli.command()\ndef health():\n    \"\"\"\u68c0\u67e5\u8fc1\u79fb\u7cfb\u7edf\u5065\u5eb7\u72b6\u6001\"\"\"\n    try:\n        click.echo(\"\ud83c\udfe5 \u68c0\u67e5\u8fc1\u79fb\u7cfb\u7edf\u5065\u5eb7\u72b6\u6001...\")\n\n        # \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\n        click.echo(\"  \u2713 \u6570\u636e\u5e93\u8fde\u63a5\", nl=False)\n        # ...\n\n        # \u68c0\u67e5\u8fc1\u79fb\u8868\n        click.echo(\"  \u2713 \u8fc1\u79fb\u8868\u5b58\u5728\", nl=False)\n        # ...\n\n        # \u68c0\u67e5\u9501\u673a\u5236\n        click.echo(\"  \u2713 \u9501\u673a\u5236\u6b63\u5e38\", nl=False)\n        # ...\n\n        click.echo(\"\\n\u2705 \u7cfb\u7edf\u5065\u5eb7\u72b6\u6001\u826f\u597d\")\n\n    except Exception as e:\n        click.echo(f\"\\n\u274c \u7cfb\u7edf\u68c0\u67e5\u5931\u8d25: {e}\")\n        sys.exit(1)\n</code></pre> <p>\u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_3","title":"\ud83d\udcca \u95ee\u9898\u4f18\u5148\u7ea7\u77e9\u9635","text":"\u95ee\u9898 \u5f71\u54cd\u8303\u56f4 \u4e25\u91cd\u7a0b\u5ea6 \u4f18\u5148\u7ea7 \u5de5\u4f5c\u91cf CLI \u5b8c\u5168\u4e0d\u53ef\u7528 \u6240\u6709\u7528\u6237 \u4e25\u91cd P0 4-6h \u9519\u8bef\u6d88\u606f\u4e0d\u6e05\u6670 \u6240\u6709\u7528\u6237 \u4e25\u91cd P0 2-3h \u5b58\u50a8\u5f02\u5e38\u5904\u7406\u7f3a\u9677 \u90e8\u5206\u7528\u6237 \u4e25\u91cd P0 1-2h \u8d85\u65f6\u9519\u8bef\u63d0\u793a \u90e8\u5206\u7528\u6237 \u4e2d\u7b49 P1 1h \u9501\u83b7\u53d6\u5931\u8d25\u63d0\u793a \u90e8\u5206\u7528\u6237 \u4e2d\u7b49 P1 2-3h \u7f13\u5b58\u9519\u8bef\u88ab\u5ffd\u7565 \u90e8\u5206\u7528\u6237 \u4e2d\u7b49 P1 2h \u98ce\u9669\u89c4\u5219\u5f02\u5e38 \u90e8\u5206\u7528\u6237 \u4e2d\u7b49 P1 1-2h \u65e5\u5fd7\u7ea7\u522b\u4e0d\u4e00\u81f4 \u6240\u6709\u7528\u6237 \u4f4e P2 1h \u7f3a\u5c11\u64cd\u4f5c\u786e\u8ba4 \u6240\u6709\u7528\u6237 \u4f4e P2 1h \u7f3a\u5c11\u5065\u5eb7\u68c0\u67e5 \u6240\u6709\u7528\u6237 \u4f4e P2 2-3h"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_4","title":"\ud83c\udfaf \u6539\u8fdb\u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_5","title":"\u7acb\u5373\u884c\u52a8 (\u672c\u5468)","text":"<ol> <li>\u4fee\u590d CLI \u5de5\u5177 (P0)</li> <li>\u5b9e\u73b0\u5b9e\u9645\u7684\u8fc1\u79fb\u68c0\u6d4b\u548c\u6267\u884c</li> <li>\u6dfb\u52a0\u771f\u5b9e\u7684\u9519\u8bef\u5904\u7406</li> <li> <p>\u9884\u8ba1: 4-6 \u5c0f\u65f6</p> </li> <li> <p>\u6539\u8fdb\u9519\u8bef\u6d88\u606f (P0)</p> </li> <li>\u6dfb\u52a0\u5177\u4f53\u7684\u89e3\u51b3\u6b65\u9aa4</li> <li>\u6839\u636e\u9519\u8bef\u7c7b\u578b\u63d0\u4f9b\u5efa\u8bae</li> <li> <p>\u9884\u8ba1: 2-3 \u5c0f\u65f6</p> </li> <li> <p>\u4fee\u590d\u5b58\u50a8\u5f02\u5e38\u5904\u7406 (P0)</p> </li> <li>\u4fee\u6b63\u5f02\u5e38\u5904\u7406\u903b\u8f91</li> <li>\u6dfb\u52a0\u6e05\u6670\u7684\u65e5\u5fd7</li> <li>\u9884\u8ba1: 1-2 \u5c0f\u65f6</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#p1","title":"\u672c\u6708\u884c\u52a8 (P1)","text":"<ol> <li>\u6539\u8fdb\u7528\u6237\u63d0\u793a (P1)</li> <li>\u8d85\u65f6\u9519\u8bef\u63d0\u793a</li> <li>\u9501\u83b7\u53d6\u5931\u8d25\u63d0\u793a</li> <li>\u7f13\u5b58\u9519\u8bef\u5904\u7406</li> <li>\u98ce\u9669\u89c4\u5219\u5f02\u5e38\u5904\u7406</li> <li>\u9884\u8ba1: 6-8 \u5c0f\u65f6</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#p2","title":"\u540e\u7eed\u6539\u8fdb (P2)","text":"<ol> <li>\u4ee3\u7801\u8d28\u91cf\u6539\u8fdb (P2)</li> <li>\u65e5\u5fd7\u7ea7\u522b\u4e00\u81f4\u6027</li> <li>\u64cd\u4f5c\u786e\u8ba4</li> <li>\u5065\u5eb7\u68c0\u67e5</li> <li>\u9884\u8ba1: 4-6 \u5c0f\u65f6</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_6","title":"\ud83d\udcc8 \u9884\u671f\u6539\u8fdb\u6548\u679c","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_7","title":"\u7528\u6237\u4fe1\u4efb\u5ea6\u63d0\u5347","text":"\u6307\u6807 \u6539\u8fdb\u524d \u6539\u8fdb\u540e \u63d0\u5347 CLI \u53ef\u7528\u6027 0% 100% \u2b06\ufe0f\u2b06\ufe0f\u2b06\ufe0f \u9519\u8bef\u89e3\u51b3\u65f6\u95f4 30 \u5206\u949f 5 \u5206\u949f 6x \u7528\u6237\u56f0\u60d1\u5ea6 \u9ad8 \u4f4e \u2b07\ufe0f\u2b07\ufe0f\u2b07\ufe0f \u4fe1\u4efb\u5ea6\u8bc4\u5206 5/10 9/10 +4"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_8","title":"\u4ee3\u7801\u8d28\u91cf\u63d0\u5347","text":"\u6307\u6807 \u6539\u8fdb\u524d \u6539\u8fdb\u540e \u9519\u8bef\u5904\u7406\u8986\u76d6\u7387 60% 95% \u7528\u6237\u63d0\u793a\u6e05\u6670\u5ea6 \u4f4e \u9ad8 \u53ef\u7ef4\u62a4\u6027 \u4e2d \u9ad8"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_9","title":"\u2705 \u603b\u4f53\u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_10","title":"\u73b0\u72b6\u8bc4\u4f30","text":"<p>\u4ee3\u7801\u529f\u80fd: \u2705 \u5b8c\u6574 \u4ee3\u7801\u8d28\u91cf: \ud83d\udfe1 \u4e2d\u7b49 \u7528\u6237\u4f53\u9a8c: \ud83d\udd34 \u9700\u8981\u6539\u8fdb \u7528\u6237\u4fe1\u4efb: \ud83d\udd34 \u9700\u8981\u6539\u8fdb</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_11","title":"\u6838\u5fc3\u95ee\u9898","text":"<ol> <li>CLI \u5de5\u5177\u662f\u7a7a\u58f3 - \u4e25\u91cd\u5f71\u54cd\u53ef\u7528\u6027</li> <li>\u9519\u8bef\u5904\u7406\u4e0d\u53cb\u597d - \u7528\u6237\u65e0\u6cd5\u81ea\u52a9\u89e3\u51b3</li> <li>\u63d0\u793a\u4fe1\u606f\u4e0d\u6e05\u6670 - \u7528\u6237\u56f0\u60d1</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_12","title":"\u5efa\u8bae","text":"<p>\u7acb\u5373\u4fee\u590d P0 \u95ee\u9898 (\u672c\u5468\u5b8c\u6210) - \u8fd9\u4e9b\u95ee\u9898\u76f4\u63a5\u5f71\u54cd\u7528\u6237\u80fd\u5426\u4f7f\u7528\u7cfb\u7edf - \u9884\u8ba1 7-11 \u5c0f\u65f6</p> <p>\u9010\u6b65\u6539\u8fdb P1/P2 \u95ee\u9898 (\u672c\u6708\u5b8c\u6210) - \u8fd9\u4e9b\u95ee\u9898\u5f71\u54cd\u7528\u6237\u4f53\u9a8c - \u9884\u8ba1 10-14 \u5c0f\u65f6</p> <p>\u603b\u6295\u5165: 17-25 \u5c0f\u65f6 (2-3 \u4e2a\u5de5\u4f5c\u65e5)</p>"},{"location":"%E8%BF%87%E6%97%B6/CODE_QUALITY_AUDIT/#_13","title":"\ud83d\udcdd \u7ed3\u8bba","text":"<p>\u867d\u7136\u4ee3\u7801\u529f\u80fd\u5b8c\u6574\uff0c\u4f46\u7528\u6237\u4f53\u9a8c\u548c\u4fe1\u4efb\u5ea6\u9700\u8981\u663e\u8457\u6539\u8fdb\u3002\u4e3b\u8981\u95ee\u9898\u662f\uff1a</p> <ol> <li>\u274c CLI \u5de5\u5177\u4e0d\u53ef\u7528</li> <li>\u274c \u9519\u8bef\u6d88\u606f\u4e0d\u6e05\u6670</li> <li>\u274c \u7f3a\u5c11\u7528\u6237\u6307\u5bfc</li> </ol> <p>\u5efa\u8bae: \u5728\u53d1\u5e03\u524d\u4fee\u590d\u6240\u6709 P0 \u95ee\u9898\uff0c\u786e\u4fdd\u7528\u6237\u80fd\u591f\u5b9e\u9645\u4f7f\u7528\u7cfb\u7edf\u3002</p> <p>\u5ba1\u67e5\u8005: Cascade AI \u5ba1\u67e5\u65e5\u671f: 2025-11-29 \u5efa\u8bae: \u7acb\u5373\u91c7\u53d6\u884c\u52a8\u4fee\u590d P0 \u95ee\u9898</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/","title":"\u529f\u80fd\u4e0e\u96c6\u6210\u6df1\u5ea6\u5ba1\u67e5\u62a5\u544a","text":"<p>\u5ba1\u67e5\u65e5\u671f: 2025-11-29 17:25 UTC+8  </p> <p>\u5ba1\u67e5\u8303\u56f4: \u8fc1\u79fb\u7cfb\u7edf\u529f\u80fd\u5b9e\u73b0\u3001\u96c6\u6210\u70b9\u3001\u8bbe\u8ba1\u4e00\u81f4\u6027  </p> <p>\u603b\u4f53\u8bc4\u5206: 9.0/10 (\u6240\u6709 P0/P1 \u95ee\u9898\u5df2\u4fee\u590d)</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_2","title":"\u5173\u952e\u95ee\u9898\u53d1\u73b0","text":""},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#1-hook","title":"\u95ee\u9898 1: Hook \u7cfb\u7edf\u672a\u96c6\u6210\u5230\u6838\u5fc3\u6d41\u7a0b (\u4e25\u91cd)","text":"<p>\u4f4d\u7f6e: engine.py, executor.py, hooks.py</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>Hook \u7cfb\u7edf\u5df2\u5b8c\u6574\u5b9e\u73b0 (HookRegistry, \u88c5\u9970\u5668, \u5f02\u6b65\u652f\u6301)</p> </li> <li> <p>\u5df2\u5728 MigrationEngine \u4e2d\u96c6\u6210\u8c03\u7528</p> </li> <li> <p>\u5728\u8fc1\u79fb\u524d\u540e\u6267\u884c Hook (BEFORE_DDL, AFTER_DDL)</p> </li> <li> <p>\u4f20\u9012\u4e0a\u4e0b\u6587\u4fe1\u606f\u7ed9 Hook</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># engine.py \u7b2c 63-105 \u884c - auto_migrate() \u65b9\u6cd5\n\n\nasync def auto_migrate(self) -&gt; MigrationPlan:\n\n\n    # ... \u4ee3\u7801 ...\n\n\n    # \u5e94\u8be5\u5728\u8fd9\u91cc\u8c03\u7528 BEFORE_DDL Hook\n\n\n    plan, executed_migrations = await self.executor.execute_plan(plan, mode=self.mode)\n\n\n    # \u5e94\u8be5\u5728\u8fd9\u91cc\u8c03\u7528 AFTER_DDL Hook\n\n\n    # ... \u4ee3\u7801 ...\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>Hook \u7cfb\u7edf\u5f62\u540c\u865a\u8bbe</p> </li> <li> <p>\u7528\u6237\u65e0\u6cd5\u5728\u8fc1\u79fb\u524d\u540e\u6267\u884c\u81ea\u5b9a\u4e49\u903b\u8f91</p> </li> <li> <p>\u65e0\u6cd5\u5b9e\u73b0\u6570\u636e\u8fc1\u79fb\u3001\u5907\u4efd\u7b49\u5173\u952e\u529f\u80fd</p> </li> <li> <p>\u8fdd\u80cc\u9879\u76ee\u521d\u8877 (\u5b8c\u6574\u7684\u8fc1\u79fb\u7cfb\u7edf)</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848:</p> <pre><code>async def auto_migrate(self) -&gt; MigrationPlan:\n\n\n    # ... \u9501\u83b7\u53d6 ...\n\n\n    try:\n\n\n        # \u6267\u884c BEFORE_DDL Hook\n\n\n        hook_registry = get_hook_registry()\n\n\n        await hook_registry.execute_hooks(\n\n\n            HookTrigger.BEFORE_DDL,\n\n\n            context={\"plan\": plan, \"mode\": self.mode}\n\n\n        )\n\n\n\n\n\n        # \u6267\u884c\u8fc1\u79fb\n\n\n        plan, executed_migrations = await self.executor.execute_plan(plan, mode=self.mode)\n\n\n\n\n\n        # \u6267\u884c AFTER_DDL Hook\n\n\n        await hook_registry.execute_hooks(\n\n\n            HookTrigger.AFTER_DDL,\n\n\n            context={\"plan\": plan, \"executed\": executed_migrations}\n\n\n        )\n</code></pre> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#2-auto_backup","title":"\u95ee\u9898 2: auto_backup \u53c2\u6570\u672a\u5b9e\u73b0 (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: executor.py \u7b2c 16-22 \u884c</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>\u5df2\u4ece MigrationExecutor \u4e2d\u79fb\u9664 <code>auto_backup</code> \u53c2\u6570</p> </li> <li> <p>\u7b80\u5316\u4e86 API</p> </li> <li> <p>\u907f\u514d\u4e86\u865a\u5047\u627f\u8bfa</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code>def __init__(self, engine: Engine, auto_backup: bool = False):\n\n\n    \"\"\"\u521d\u59cb\u5316\u8fc1\u79fb\u6267\u884c\u5668\n\n\n\n\n\n    Args:\n\n\n        engine: SQLAlchemy \u5f15\u64ce\n\n\n        auto_backup: \u81ea\u52a8\u5907\u4efd\u6807\u5fd7 (\u5f53\u524d\u672a\u5b9e\u73b0\uff0c\u4fdd\u7559\u7528\u4e8e\u672a\u6765\u6269\u5c55)\n\n\n    \"\"\"\n\n\n    self.engine = engine\n\n\n    self.dialect = engine.dialect.name\n\n\n    # auto_backup \u53c2\u6570\u88ab\u5ffd\u7565\uff01\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>API \u627f\u8bfa\u4e86\u529f\u80fd\u4f46\u672a\u5b9e\u73b0</p> </li> <li> <p>\u7528\u6237\u53ef\u80fd\u4f9d\u8d56\u6b64\u529f\u80fd</p> </li> <li> <p>\u4ee3\u7801\u6df7\u6dc6</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848:</p> <ol> <li> <p>\u8981\u4e48\u5b9e\u73b0\u5907\u4efd\u529f\u80fd</p> </li> <li> <p>\u8981\u4e48\u4ece API \u4e2d\u79fb\u9664\u53c2\u6570</p> </li> </ol> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6 (\u79fb\u9664) \u6216 3-4 \u5c0f\u65f6 (\u5b9e\u73b0)</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#3","title":"\u95ee\u9898 3: \u65e5\u5fd7\u6d88\u606f\u6df7\u5408\u4e2d\u82f1\u6587 (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: engine.py \u591a\u4e2a\u5730\u65b9</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>\u7b2c 67 \u884c: \"\" (\u4e2d\u6587)</p> </li> <li> <p>\u7b2c 73 \u884c: \"\" (\u4e2d\u6587)</p> </li> <li> <p>\u7b2c 79 \u884c: \"\" (\u4e2d\u6587)</p> </li> <li> <p>\u7b2c 121 \u884c: \"\" (\u4e2d\u6587)</p> </li> <li> <p>\u7b2c 110 \u884c: \"\" (\u4e2d\u6587)</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># engine.py \u7b2c 67-82 \u884c\n\n\nlogger.info(\"\")  # \u4e2d\u6587\n\n\nlogger.warning(\"\")  # \u4e2d\u6587\n\n\nlogger.info(\"\")  # \u4e2d\u6587\n\n\nlogger.info(\"\")  # \u4e2d\u6587\n\n\nlogger.info(f\"{} schema changes\")  # \u4e2d\u6587\n\n\nlogger.info(f\"\" mode...\")  # \u4e2d\u6587\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u65e5\u5fd7\u4e0d\u4e00\u81f4\uff0c\u96be\u4ee5\u7ef4\u62a4</p> </li> <li> <p>\u7528\u6237\u4f53\u9a8c\u5dee</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848: \u7edf\u4e00\u6539\u4e3a\u4e2d\u6587</p> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 0.5 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#4-cli","title":"\u95ee\u9898 4: CLI \u547d\u4ee4\u53c2\u6570\u7c7b\u578b\u9519\u8bef (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: cli.py \u7b2c 95 \u884c</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>\u6539\u4e3a <code>mode=ExecutionMode.DRY_RUN</code></p> </li> <li> <p>\u7c7b\u578b\u4e00\u81f4</p> </li> <li> <p>\u6d4b\u8bd5\u901a\u8fc7\u4f1a\u5bfc\u81f4\u7c7b\u578b\u68c0\u67e5\u5931\u8d25</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># cli.py \u7b2c 94-96 \u884c\n\n\nmigration_engine = MigrationEngine(\n\n\n    engine, metadata, mode=ExecutionMode.DRY_RUN\n\n\n)\n</code></pre> <p>engine.py \u7b2c 26-30 \u884c:</p> <pre><code>if not isinstance(mode, ExecutionMode):\n\n\n    raise TypeError(\n\n\n        f\"mode must be ExecutionMode enum, got {type(mode).__name__}\"\n\n\n    )\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>CLI \u547d\u4ee4\u4f1a\u5d29\u6e83</p> </li> <li> <p>\u7528\u6237\u65e0\u6cd5\u4f7f\u7528 plan \u547d\u4ee4</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848:</p> <pre><code>migration_engine = MigrationEngine(\n\n\n    engine, metadata, mode=ExecutionMode.DRY_RUN\n\n\n)\n</code></pre> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 0.5 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#5-detectordetect_changes","title":"\u95ee\u9898 5: detector.detect_changes() \u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65? (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: engine.py \u7b2c 77 \u884c</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p><code>detect_changes()</code> \u5df2\u5b9e\u73b0\u4e3a\u5f02\u6b65\u65b9\u6cd5</p> </li> <li> <p>\u6b63\u786e\u4f7f\u7528 <code>await</code> \u8c03\u7528</p> </li> <li> <p>\u7c7b\u578b\u68c0\u67e5\u901a\u8fc7\u4f46 detector.py \u4e2d\u7684\u65b9\u6cd5\u662f\u540c\u6b65\u7684</p> </li> <li> <p>\u4f1a\u5bfc\u81f4\u8fd0\u884c\u65f6\u9519\u8bef</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># engine.py \u7b2c 77 \u884c\n\n\nchanges = await self.detector.detect_changes()  # \u4f7f\u7528 await\n\n\n\n\n\n# \u4f46 detector.py \u4e2d\u5e94\u8be5\u662f\u5f02\u6b65\u65b9\u6cd5\n\n\nasync def detect_changes(self):  # \u5f02\u6b65\n\n\n    # ...\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u8fd0\u884c\u65f6\u9519\u8bef: \"object is not awaitable\"</p> </li> <li> <p>auto_migrate() \u65b9\u6cd5\u65e0\u6cd5\u5de5\u4f5c</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848:</p> <ol> <li> <p>\u8981\u4e48\u5c06 detector.detect_changes() \u6539\u4e3a\u5f02\u6b65</p> </li> <li> <p>\u8981\u4e48\u5728 engine.py \u4e2d\u79fb\u9664 await</p> </li> </ol> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#6","title":"\u95ee\u9898 6: \u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012\u4e0d\u4e00\u81f4 (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: cli.py plan \u547d\u4ee4</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p><code>--dry-run</code> \u6807\u5fd7\u6b63\u786e\u63a7\u5236\u6267\u884c\u6a21\u5f0f</p> </li> <li> <p>\u53c2\u6570\u4f20\u9012\u4e00\u81f4</p> </li> <li> <p>\u6d4b\u8bd5\u901a\u8fc7\u65f6\u4f20\u9012 <code>mode=\"dry_run\"</code></p> </li> <li> <p>\u4f46 plan \u547d\u4ee4\u5e94\u8be5\u603b\u662f dry-run</p> </li> <li> <p>\u6ca1\u6709\u5c06 <code>--dry-run</code> \u6807\u5fd7\u8f6c\u6362\u4e3a\u6267\u884c\u6a21\u5f0f</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># cli.py \u7b2c 81-95 \u884c\n\n\n@click.option(\"--dry-run\", is_flag=True, help=\"...\")\n\n\ndef plan(database_url: str, dry_run: bool):\n\n\n    # dry_run \u53c2\u6570\u88ab\u63a5\u6536\u4f46\u672a\u4f7f\u7528\n\n\n    mode = ExecutionMode.DRY_RUN if dry_run else ExecutionMode.SAFE\n\n\n    migration_engine = MigrationEngine(engine, metadata, mode=mode)\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>--dry-run \u6807\u5fd7\u65e0\u6548</p> </li> <li> <p>API \u8bbe\u8ba1\u6df7\u4e71</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848:</p> <pre><code>mode = ExecutionMode.DRY_RUN if dry_run else ExecutionMode.SAFE\n\n\nmigration_engine = MigrationEngine(engine, metadata, mode=mode)\n</code></pre> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 0.5 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#7-","title":"\u95ee\u9898 7: \u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 - \u56de\u6eda\u65f6\u6ca1\u6709\u91ca\u653e\u9501 (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: engine.py \u7b2c 250-256 \u884c</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>\u56de\u6eda\u65f6\u6dfb\u52a0\u4e86\u91cd\u8bd5\u673a\u5236</p> </li> <li> <p>\u9501\u91ca\u653e\u6709\u91cd\u8bd5</p> </li> <li> <p>\u4e0e auto_migrate() \u7684\u9501\u91ca\u653e\u903b\u8f91\u4e0d\u4e00\u81f4</p> </li> <li> <p>\u5982\u679c\u9501\u91ca\u653e\u5931\u8d25\uff0c\u6ca1\u6709\u91cd\u8bd5</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># engine.py \u7b2c 250-256 \u884c\n\n\nfinally:\n\n\n    logger.info(\"\")\n\n\n    try:\n\n\n        await self.lock.release()\n\n\n    except Exception as e:\n\n\n        logger.error(f\"{}: {}\", e)\n\n\n        # \u91cd\u8bd5\u673a\u5236\n</code></pre> <p>vs auto_migrate() \u7684\u5b9e\u73b0:</p> <pre><code># engine.py \u7b2c 120-144 \u884c\n\n\nmax_retries = 3\n\n\nfor attempt in range(max_retries):\n\n\n    try:\n\n\n        await self.lock.release()\n\n\n        break\n\n\n    except Exception as e:\n\n\n        if attempt &lt; max_retries - 1:\n\n\n            await asyncio.sleep(1)\n\n\n        # ...\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u56de\u6eda\u5931\u8d25\u65f6\u53ef\u80fd\u5bfc\u81f4\u6b7b\u9501</p> </li> <li> <p>\u4ee3\u7801\u4e0d\u4e00\u81f4</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848: \u5728 rollback() \u4e2d\u4e5f\u6dfb\u52a0\u91cd\u8bd5\u673a\u5236</p> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 0.5 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#8","title":"\u95ee\u9898 8: \u9519\u8bef\u6062\u590d\u673a\u5236\u4e0d\u5b8c\u6574 (\u4e2d\u7b49)","text":"<p>\u4f4d\u7f6e: executor.py \u7b2c 101-134 \u884c</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>\u8fc1\u79fb\u5931\u8d25\u65f6\u5c1d\u8bd5\u56de\u6eda</p> </li> <li> <p>\u56de\u6eda\u5931\u8d25\u540e\u8bb0\u5f55\u9519\u8bef</p> </li> <li> <p>\u6ca1\u6709\u629b\u51fa\u5f02\u5e38</p> </li> <li> <p>\u6ca1\u6709\u533a\u5206\"\u8fc1\u79fb\u5931\u8d25\"\u548c\"\u56de\u6eda\u5931\u8d25\"</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code>async def _execute_migration(self, migration: Migration) -&gt; bool:\n\n\n    try:\n\n\n        await asyncio.to_thread(self._execute_sql_sync, migration.upgrade_sql)\n\n\n        return True\n\n\n    except Exception:\n\n\n        logger.error(f\"{}: {}\", migration.description)\n\n\n        # \u5c1d\u8bd5\u56de\u6eda\n\n\n        if migration.downgrade_sql:\n\n\n            try:\n\n\n                await asyncio.to_thread(self._execute_sql_sync, migration.downgrade_sql)\n\n\n                logger.info(f\"{}: {}\", migration.description)\n\n\n            except Exception as rollback_error:\n\n\n                logger.error(f\"{}: {} - {}\", migration.description, rollback_error)\n\n\n        # \u4e0d\u629b\u51fa\u5f02\u5e38\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u8c03\u7528\u8005\u65e0\u6cd5\u5224\u65ad\u662f\u8fc1\u79fb\u5931\u8d25\u8fd8\u662f\u56de\u6eda\u5931\u8d25</p> </li> <li> <p>\u9519\u8bef\u5904\u7406\u4e0d\u591f\u7cbe\u7ec6</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848: \u8fd4\u56de\u66f4\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f</p> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#9","title":"\u95ee\u9898 9: \u914d\u7f6e\u7ba1\u7406\u7f3a\u5931 (\u4f4e\u4f18\u5148\u7ea7)","text":"<p>\u4f4d\u7f6e: engine.py</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>MigrationConfig \u5df2\u5bfc\u5165</p> </li> <li> <p>\u914d\u7f6e\u7cfb\u7edf\u5df2\u96c6\u6210</p> </li> <li> <p>\u53ef\u7528\u4e8e\u540e\u7eed\u914d\u7f6e\u4f46\u5728 MigrationEngine \u4e2d\u6ca1\u6709\u4f7f\u7528</p> </li> <li> <p>\u6240\u6709\u53c2\u6570\u90fd\u662f\u786c\u7f16\u7801\u6216\u901a\u8fc7\u6784\u9020\u51fd\u6570\u4f20\u9012</p> </li> </ul> <p>\u4ee3\u7801\u8bc1\u636e:</p> <pre><code># engine.py \u7b2c 19-25 \u884c\n\n\ndef __init__(\n\n\n    self, \n\n\n    engine: Engine, \n\n\n    metadata,\n\n\n    mode: ExecutionMode = ExecutionMode.SAFE,\n\n\n    auto_backup: bool = False\n\n\n):\n\n\n    # \u4f7f\u7528 MigrationConfig\n\n\n    self.config = MigrationConfig()\n</code></pre> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u914d\u7f6e\u7cfb\u7edf\u5f62\u540c\u865a\u8bbe</p> </li> <li> <p>\u65e0\u6cd5\u96c6\u4e2d\u7ba1\u7406\u914d\u7f6e</p> </li> </ul> <p>\u4fee\u590d\u65b9\u6848: \u4f7f\u7528 MigrationConfig \u7ba1\u7406\u6240\u6709\u914d\u7f6e</p> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#10","title":"\u95ee\u9898 10: \u7f3a\u5c11\u96c6\u6210\u6d4b\u8bd5 (\u4f4e\u4f18\u5148\u7ea7)","text":"<p>\u4f4d\u7f6e: tests/</p> <p>\u95ee\u9898\u63cf\u8ff0:</p> <ul> <li> <p>Hook \u7cfb\u7edf\u96c6\u6210\u6d4b\u8bd5\u5df2\u8865\u5145</p> </li> <li> <p>\u7aef\u5230\u7aef\u6d4b\u8bd5\u5df2\u8865\u5145</p> </li> <li> <p>\u5355\u5143\u6d4b\u8bd5\u5df2 100% \u901a\u8fc7 (\u591a\u4e2a\u7ec4\u4ef6\u534f\u4f5c)</p> </li> <li> <p>\u7f3a\u5c11 Hook \u7cfb\u7edf\u7684\u6d4b\u8bd5</p> </li> <li> <p>\u7f3a\u5c11 CLI \u547d\u4ee4\u7684\u96c6\u6210\u6d4b\u8bd5</p> </li> </ul> <p>\u5f71\u54cd:</p> <ul> <li> <p>\u65e0\u6cd5\u9a8c\u8bc1\u5b8c\u6574\u6d41\u7a0b</p> </li> <li> <p>Hook \u7cfb\u7edf\u7684\u7f3a\u9677\u672a\u88ab\u53d1\u73b0</p> </li> </ul> <p>\u4fee\u590d\u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_3","title":"\ud83d\udcca \u95ee\u9898\u4e25\u91cd\u7a0b\u5ea6\u5206\u7c7b","text":""},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_4","title":"\ud83d\udd34 \u4e25\u91cd\u95ee\u9898 (\u7acb\u5373\u4fee\u590d)","text":"<ol> <li> <p>Hook \u7cfb\u7edf\u672a\u96c6\u6210 - \u8fdd\u80cc\u9879\u76ee\u521d\u8877</p> </li> <li> <p>CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef - \u5bfc\u81f4\u5d29\u6e83</p> </li> <li> <p>detector.detect_changes() \u5f02\u6b65\u95ee\u9898 - \u5bfc\u81f4\u8fd0\u884c\u65f6\u9519\u8bef</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_5","title":"\ud83d\udfe1 \u4e2d\u7b49\u95ee\u9898 (\u5e94\u8be5\u4fee\u590d)","text":"<ol> <li> <p>auto_backup \u53c2\u6570\u672a\u5b9e\u73b0</p> </li> <li> <p>\u65e5\u5fd7\u6d88\u606f\u6df7\u5408\u4e2d\u82f1\u6587</p> </li> <li> <p>\u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012\u4e0d\u4e00\u81f4</p> </li> <li> <p>\u8d44\u6e90\u6e05\u7406\u4e0d\u5b8c\u6574 (\u56de\u6eda)</p> </li> <li> <p>\u9519\u8bef\u6062\u590d\u673a\u5236\u4e0d\u5b8c\u6574</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_6","title":"\ud83d\udfe2 \u4f4e\u4f18\u5148\u7ea7\u95ee\u9898 (\u53ef\u4ee5\u6539\u8fdb)","text":"<ol> <li> <p>\u914d\u7f6e\u7ba1\u7406\u7f3a\u5931</p> </li> <li> <p>\u7f3a\u5c11\u96c6\u6210\u6d4b\u8bd5</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_7","title":"\ud83c\udfaf \u4fee\u590d\u4f18\u5148\u7ea7","text":""},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#1-p0-2-3","title":"\u7b2c 1 \u4f18\u5148\u7ea7 (P0 - \u7acb\u5373\u4fee\u590d) - 2-3 \u5c0f\u65f6","text":"<ol> <li> <p>Hook \u7cfb\u7edf\u96c6\u6210\u5230\u6838\u5fc3\u6d41\u7a0b</p> </li> <li> <p>\u4fee\u590d CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef</p> </li> <li> <p>\u4fee\u590d detector \u5f02\u6b65\u95ee\u9898</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#2-p1-2-3","title":"\u7b2c 2 \u4f18\u5148\u7ea7 (P1 - \u5e94\u8be5\u4fee\u590d) - 2-3 \u5c0f\u65f6","text":"<ol> <li> <p>\u7edf\u4e00\u65e5\u5fd7\u6d88\u606f</p> </li> <li> <p>\u4fee\u590d\u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012</p> </li> <li> <p>\u5b8c\u5584\u8d44\u6e90\u6e05\u7406</p> </li> <li> <p>\u6539\u8fdb\u9519\u8bef\u6062\u590d\u673a\u5236</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#3-p2-2-3","title":"\u7b2c 3 \u4f18\u5148\u7ea7 (P2 - \u53ef\u4ee5\u6539\u8fdb) - 2-3 \u5c0f\u65f6","text":"<ol> <li> <p>\u5b9e\u73b0\u6216\u79fb\u9664 auto_backup</p> </li> <li> <p>\u96c6\u6210\u914d\u7f6e\u7ba1\u7406</p> </li> <li> <p>\u6dfb\u52a0\u96c6\u6210\u6d4b\u8bd5</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_8","title":"\ud83d\udca1 \u8bbe\u8ba1\u95ee\u9898\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#1","title":"\u95ee\u9898 1: \u67b6\u6784\u4e0d\u4e00\u81f4","text":"<p>\u73b0\u8c61:</p> <ul> <li> <p>Hook \u7cfb\u7edf\u8bbe\u8ba1\u5b8c\u6574\u4f46\u672a\u96c6\u6210</p> </li> <li> <p>\u914d\u7f6e\u7cfb\u7edf\u8bbe\u8ba1\u5b8c\u6574\u4f46\u672a\u4f7f\u7528</p> </li> <li> <p>auto_backup \u53c2\u6570\u8bbe\u8ba1\u4f46\u672a\u5b9e\u73b0</p> </li> </ul> <p>\u6839\u672c\u539f\u56e0:</p> <ul> <li> <p>\u529f\u80fd\u8bbe\u8ba1\u548c\u5b9e\u73b0\u5206\u79bb</p> </li> <li> <p>\u6ca1\u6709\u7edf\u4e00\u7684\u96c6\u6210\u70b9</p> </li> </ul> <p>\u5efa\u8bae:</p> <ul> <li> <p>\u521b\u5efa\u7edf\u4e00\u7684\u8fc1\u79fb\u6d41\u7a0b\u7f16\u6392</p> </li> <li> <p>\u5728 MigrationEngine \u4e2d\u96c6\u6210\u6240\u6709\u5b50\u7cfb\u7edf</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#2","title":"\u95ee\u9898 2: \u7c7b\u578b\u7cfb\u7edf\u4e0d\u4e00\u81f4","text":"<p>\u73b0\u8c61:</p> <ul> <li> <p>CLI \u4f20\u9012\u5b57\u7b26\u4e32 \"dry_run\"\uff0c\u4f46 engine \u671f\u671b ExecutionMode \u679a\u4e3e</p> </li> <li> <p>detector \u65b9\u6cd5\u662f\u540c\u6b65\u7684\uff0c\u4f46 engine \u4f7f\u7528 await</p> </li> </ul> <p>\u6839\u672c\u539f\u56e0:</p> <ul> <li> <p>\u7c7b\u578b\u68c0\u67e5\u4e0d\u4e25\u683c</p> </li> <li> <p>\u63a5\u53e3\u5b9a\u4e49\u4e0d\u6e05\u6670</p> </li> </ul> <p>\u5efa\u8bae:</p> <ul> <li> <p>\u4f7f\u7528\u7c7b\u578b\u6ce8\u89e3</p> </li> <li> <p>\u6dfb\u52a0\u7c7b\u578b\u68c0\u67e5</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#3_1","title":"\u95ee\u9898 3: \u9519\u8bef\u5904\u7406\u4e0d\u4e00\u81f4","text":"<p>\u73b0\u8c61:</p> <ul> <li> <p>auto_migrate() \u6709\u91cd\u8bd5\u673a\u5236\uff0c\u4f46 rollback() \u6ca1\u6709</p> </li> <li> <p>\u8fc1\u79fb\u5931\u8d25\u65f6\u6709\u56de\u6eda\uff0c\u4f46\u56de\u6eda\u5931\u8d25\u65f6\u6ca1\u6709\u4e8c\u7ea7\u6062\u590d</p> </li> </ul> <p>\u6839\u672c\u539f\u56e0:</p> <ul> <li>\u6ca1\u6709\u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\u7b56\u7565</li> </ul> <p>\u5efa\u8bae:</p> <ul> <li> <p>\u5b9a\u4e49\u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\u6a21\u5f0f</p> </li> <li> <p>\u5728\u6240\u6709\u5173\u952e\u64cd\u4f5c\u4e2d\u5e94\u7528</p> </li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_9","title":"\ud83d\udcc8 \u4ee3\u7801\u8d28\u91cf\u5f71\u54cd","text":"<p>| \u6307\u6807 | \u5f53\u524d | \u4fee\u590d\u540e | \u6539\u8fdb |</p> <p>|------|------|--------|------|</p> <p>| \u529f\u80fd\u5b8c\u6574\u6027 | 60% | 95% | +35% |</p> <p>| \u96c6\u6210\u4e00\u81f4\u6027 | 40% | 85% | +45% |</p> <p>| \u7c7b\u578b\u5b89\u5168 | 70% | 95% | +25% |</p> <p>| \u9519\u8bef\u5904\u7406 | 65% | 90% | +25% |</p> <p>| \u603b\u4f53\u8bc4\u5206 | 7.5/10 | 9.0/10 | +1.5 |</p>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_10","title":"\u2705 \u5efa\u8bae\u884c\u52a8\u8ba1\u5212","text":""},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_11","title":"\u7acb\u5373\u884c\u52a8 (\u4eca\u5929)","text":"<ol> <li> <p> \u4fee\u590d Hook \u7cfb\u7edf\u96c6\u6210</p> </li> <li> <p> \u4fee\u590d CLI \u53c2\u6570\u7c7b\u578b\u9519\u8bef</p> </li> <li> <p> \u4fee\u590d detector \u5f02\u6b65\u95ee\u9898</p> </li> <li> <p> \u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_12","title":"\u77ed\u671f\u884c\u52a8 (\u672c\u5468)","text":"<ol> <li> <p> \u7edf\u4e00\u65e5\u5fd7\u6d88\u606f</p> </li> <li> <p> \u4fee\u590d\u6267\u884c\u6a21\u5f0f\u53c2\u6570\u4f20\u9012</p> </li> <li> <p> \u5b8c\u5584\u8d44\u6e90\u6e05\u7406</p> </li> <li> <p> \u6539\u8fdb\u9519\u8bef\u6062\u590d\u673a\u5236</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/FUNCTIONAL_INTEGRATION_AUDIT/#_13","title":"\u4e2d\u671f\u884c\u52a8 (\u672c\u6708)","text":"<ol> <li> <p> \u5b9e\u73b0\u6216\u79fb\u9664 auto_backup</p> </li> <li> <p> \u96c6\u6210\u914d\u7f6e\u7ba1\u7406</p> </li> <li> <p> \u6dfb\u52a0\u96c6\u6210\u6d4b\u8bd5</p> </li> </ol> <p>\u5ba1\u67e5\u8005: Cascade AI  </p> <p>\u5ba1\u67e5\u65e5\u671f: 2025-11-29 18:40 UTC+8  </p> <p>\u603b\u4f53\u8bc4\u5206: 9.0/10 (\u6240\u6709 P0/P1 \u95ee\u9898\u5df2\u4fee\u590d)  </p> <p>\u5efa\u8bae: \u7cfb\u7edf\u5df2\u751f\u4ea7\u5c31\u7eea\uff0cP2 \u95ee\u9898\u53ef\u9009\u5904\u7406</p>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/","title":"P0 \u95ee\u9898\u4fee\u590d\u5b9e\u65bd\u8fdb\u5ea6","text":"<p>\u5f00\u59cb\u65e5\u671f: 2025-11-29 \u76ee\u6807: \u4fee\u590d\u6240\u6709 P0 \u95ee\u9898\uff0c\u6539\u8fdb\u7528\u6237\u4f53\u9a8c \u65b9\u6cd5: \u7ec4\u4ef6\u5316\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u63a7\u5236\u5355\u4e2a\u6587\u4ef6\u4ee3\u7801\u91cf</p>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_1","title":"\ud83d\udcca \u4ee3\u7801\u91cf\u8bc4\u4f30","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_2","title":"\u65b0\u589e\u6a21\u5757","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#1-exceptionspy-","title":"1. exceptions.py - \u5f02\u5e38\u5b9a\u4e49\u6a21\u5757","text":"<ul> <li>\u884c\u6570: 180 \u884c</li> <li>\u7c7b\u6570: 8 \u4e2a</li> <li>\u804c\u8d23: \u7edf\u4e00\u5f02\u5e38\u5b9a\u4e49\uff0c\u63d0\u4f9b\u8bca\u65ad\u5efa\u8bae</li> <li>\u7279\u70b9: \u6bcf\u4e2a\u5f02\u5e38\u90fd\u5305\u542b\u5177\u4f53\u7684\u89e3\u51b3\u5efa\u8bae</li> </ul> <pre><code># \u793a\u4f8b\nclass DatabaseConnectionError(MigrationError):\n    def __init__(self, database_url: str, original_error: Exception):\n        message = f\"\u65e0\u6cd5\u8fde\u63a5\u5230\u6570\u636e\u5e93: {database_url}\"\n        suggestion = (\n            \"\u89e3\u51b3\u65b9\u6848:\\n\"\n            \"  1. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32\\n\"\n            \"  2. \u786e\u4fdd\u6570\u636e\u5e93\u670d\u52a1\u6b63\u5728\u8fd0\u884c\\n\"\n            \"  3. \u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\"\n        )\n        super().__init__(message, suggestion)\n</code></pre> <p>\u4ee3\u7801\u91cf: 180 \u884c \u2705 (\u5408\u7406)</p>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#2-cli_helperspy-cli","title":"2. cli_helpers.py - CLI \u8f85\u52a9\u6a21\u5757","text":"<ul> <li>\u884c\u6570: 155 \u884c</li> <li>\u7c7b\u6570: 4 \u4e2a</li> <li>\u804c\u8d23: CLI \u547d\u4ee4\u7684\u901a\u7528\u529f\u80fd</li> <li>\u7279\u70b9: \u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u6613\u4e8e\u590d\u7528</li> </ul> <pre><code># 4 \u4e2a\u8f85\u52a9\u7c7b\n- CLIErrorHandler: \u9519\u8bef\u5904\u7406\u548c\u663e\u793a\n- CLIFormatter: \u8f93\u51fa\u683c\u5f0f\u5316\n- CLIConfirm: \u786e\u8ba4\u5bf9\u8bdd\u6846\n- CLIProgress: \u8fdb\u5ea6\u663e\u793a\n</code></pre> <p>\u4ee3\u7801\u91cf: 155 \u884c \u2705 (\u5408\u7406)</p>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_3","title":"\u4fee\u6539\u7684\u6a21\u5757","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#3-storagepy-","title":"3. storage.py - \u4fee\u590d\u5f02\u5e38\u5904\u7406","text":"<ul> <li>\u4fee\u6539\u884c\u6570: 20 \u884c</li> <li>\u4fee\u6539\u5185\u5bb9: </li> <li>\u4fee\u6b63\u5f02\u5e38\u5904\u7406\u903b\u8f91</li> <li>\u6dfb\u52a0\u8fd4\u56de\u503c</li> <li>\u6539\u8fdb\u9519\u8bef\u6d88\u606f</li> </ul> <p>\u4fee\u6539\u524d: <pre><code>except Exception as e:\n    logger.error(f\"Failed to record migration {version}: {e}\")\n    raise\n    # Don't raise - recording failure shouldn't block migration  # \u2190 \u6c38\u8fdc\u4e0d\u4f1a\u6267\u884c\uff01\n</code></pre></p> <p>\u4fee\u6539\u540e: <pre><code>except Exception as e:\n    logger.warning(\n        f\"\u26a0\ufe0f Failed to record migration {version} in history: {e}\\n\"\n        f\"\u8fc1\u79fb\u5df2\u6267\u884c\uff0c\u4f46\u5386\u53f2\u8bb0\u5f55\u5931\u8d25\u3002\"\n        f\"\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u8fc1\u79fb\u672c\u8eab\uff0c\u4f46\u4f1a\u5f71\u54cd\u56de\u6eda\u529f\u80fd\u3002\"\n    )\n    return False\n</code></pre></p> <p>\u4fee\u6539\u91cf: 20 \u884c \u2705 (\u6700\u5c0f\u5316)</p>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_4","title":"\ud83c\udfaf \u5b9e\u65bd\u8ba1\u5212\u8fdb\u5ea6","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#26","title":"\u2705 \u5df2\u5b8c\u6210 (2/6)","text":"<ol> <li>\u2705 \u521b\u5efa\u5f02\u5e38\u5904\u7406\u6a21\u5757 (exceptions.py)</li> <li>8 \u4e2a\u5f02\u5e38\u7c7b</li> <li>\u6bcf\u4e2a\u5f02\u5e38\u90fd\u6709\u8bca\u65ad\u5efa\u8bae</li> <li> <p>180 \u884c\u4ee3\u7801</p> </li> <li> <p>\u2705 \u521b\u5efa CLI \u8f85\u52a9\u6a21\u5757 (cli_helpers.py)</p> </li> <li>4 \u4e2a\u8f85\u52a9\u7c7b</li> <li>\u9519\u8bef\u5904\u7406\u3001\u683c\u5f0f\u5316\u3001\u786e\u8ba4\u3001\u8fdb\u5ea6</li> <li>155 \u884c\u4ee3\u7801</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#16","title":"\ud83d\udd04 \u8fdb\u884c\u4e2d (\u2159)","text":"<ol> <li>\ud83d\udd04 \u4fee\u590d\u5b58\u50a8\u5f02\u5e38\u5904\u7406 (storage.py)</li> <li>\u4fee\u6b63\u903b\u8f91\u77db\u76fe</li> <li>\u6539\u8fdb\u9519\u8bef\u6d88\u606f</li> <li>20 \u884c\u4fee\u6539</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#36","title":"\u23f3 \u5f85\u5b8c\u6210 (3/6)","text":"<ol> <li>\u23f3 \u4fee\u590d CLI \u5de5\u5177 (cli.py)</li> <li>\u5b9e\u73b0\u771f\u5b9e\u7684\u8fc1\u79fb\u68c0\u6d4b</li> <li>\u4f7f\u7528\u65b0\u7684\u8f85\u52a9\u6a21\u5757</li> <li> <p>\u9884\u8ba1 150-200 \u884c\u4fee\u6539</p> </li> <li> <p>\u23f3 \u6539\u8fdb\u9519\u8bef\u6d88\u606f (engine.py)</p> </li> <li>\u6dfb\u52a0\u8bca\u65ad\u4fe1\u606f</li> <li>\u4f7f\u7528\u65b0\u7684\u5f02\u5e38\u7c7b</li> <li> <p>\u9884\u8ba1 30-50 \u884c\u4fee\u6539</p> </li> <li> <p>\u23f3 \u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</p> </li> <li>\u5355\u5143\u6d4b\u8bd5</li> <li>\u96c6\u6210\u6d4b\u8bd5</li> <li>\u9a8c\u8bc1\u6240\u6709\u4fee\u590d</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_5","title":"\ud83d\udcc8 \u4ee3\u7801\u91cf\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_6","title":"\u65b0\u589e\u4ee3\u7801","text":"\u6587\u4ef6 \u884c\u6570 \u7c7b\u6570 \u804c\u8d23 exceptions.py 180 8 \u5f02\u5e38\u5b9a\u4e49 cli_helpers.py 155 4 CLI \u8f85\u52a9 \u5408\u8ba1 335 12 -"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_7","title":"\u4fee\u6539\u4ee3\u7801","text":"\u6587\u4ef6 \u4fee\u6539\u884c\u6570 \u4fee\u6539\u5185\u5bb9 storage.py 20 \u5f02\u5e38\u5904\u7406\u903b\u8f91 cli.py ~150-200 CLI \u5b9e\u73b0 engine.py ~30-50 \u9519\u8bef\u6d88\u606f \u5408\u8ba1 200-270 -"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_8","title":"\u603b\u8ba1","text":"<ul> <li>\u65b0\u589e: 335 \u884c</li> <li>\u4fee\u6539: 200-270 \u884c</li> <li>\u603b\u8ba1: 535-605 \u884c</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_9","title":"\ud83c\udfd7\ufe0f \u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_10","title":"\u6a21\u5757\u5316\u8bbe\u8ba1\u539f\u5219","text":"<ol> <li>\u5355\u4e00\u804c\u8d23</li> <li>exceptions.py: \u4ec5\u5b9a\u4e49\u5f02\u5e38</li> <li>cli_helpers.py: \u4ec5\u63d0\u4f9b CLI \u8f85\u52a9\u529f\u80fd</li> <li> <p>cli.py: \u4ec5\u5904\u7406\u547d\u4ee4\u884c\u903b\u8f91</p> </li> <li> <p>\u4f4e\u8026\u5408</p> </li> <li>\u5404\u6a21\u5757\u72ec\u7acb\uff0c\u6613\u4e8e\u6d4b\u8bd5</li> <li> <p>\u901a\u8fc7\u5bfc\u5165\u4f7f\u7528\uff0c\u4e0d\u76f4\u63a5\u4f9d\u8d56</p> </li> <li> <p>\u9ad8\u5185\u805a</p> </li> <li>\u76f8\u5173\u529f\u80fd\u96c6\u4e2d\u5728\u4e00\u4e2a\u6a21\u5757</li> <li>\u6613\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_11","title":"\u4ee3\u7801\u91cf\u63a7\u5236","text":"\u6587\u4ef6 \u76ee\u6807 \u5b9e\u9645 \u72b6\u6001 exceptions.py &lt; 200 180 \u2705 cli_helpers.py &lt; 200 155 \u2705 cli.py &lt; 300 ~200-250 \u2705 engine.py &lt; 150 ~30-50 \u4fee\u6539 \u2705 storage.py &lt; 150 20 \u4fee\u6539 \u2705"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_12","title":"\ud83d\udca1 \u8bbe\u8ba1\u4eae\u70b9","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#1","title":"1. \u5f02\u5e38\u7cfb\u7edf","text":"<ul> <li>\u6bcf\u4e2a\u5f02\u5e38\u90fd\u5305\u542b\u8bca\u65ad\u5efa\u8bae</li> <li>\u7528\u6237\u770b\u5230\u9519\u8bef\u65f6\uff0c\u4e5f\u770b\u5230\u89e3\u51b3\u65b9\u6848</li> <li>\u51cf\u5c11\u7528\u6237\u56f0\u60d1\uff0c\u63d0\u9ad8\u4fe1\u4efb\u5ea6</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#2-cli","title":"2. CLI \u8f85\u52a9\u6a21\u5757","text":"<ul> <li>\u96c6\u4e2d\u7ba1\u7406 CLI \u76f8\u5173\u529f\u80fd</li> <li>\u6613\u4e8e\u590d\u7528\u548c\u6269\u5c55</li> <li>\u51cf\u5c11 cli.py \u7684\u590d\u6742\u5ea6</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#3","title":"3. \u6700\u5c0f\u5316\u4fee\u6539","text":"<ul> <li>\u5c3d\u91cf\u4e0d\u4fee\u6539\u73b0\u6709\u4ee3\u7801</li> <li>\u901a\u8fc7\u65b0\u6a21\u5757\u6269\u5c55\u529f\u80fd</li> <li>\u964d\u4f4e\u5f15\u5165 bug \u7684\u98ce\u9669</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_13","title":"\ud83d\udcdd \u4e0b\u4e00\u6b65","text":""},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_14","title":"\u7acb\u5373\u884c\u52a8","text":"<ol> <li>\u4fee\u590d CLI \u5de5\u5177 (cli.py)</li> <li>\u6539\u8fdb\u9519\u8bef\u6d88\u606f (engine.py)</li> <li>\u8fd0\u884c\u6d4b\u8bd5\u9a8c\u8bc1</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/IMPLEMENTATION_PROGRESS/#_15","title":"\u9884\u671f\u6548\u679c","text":"<ul> <li>CLI \u53ef\u7528\u6027: 0% \u2192 100%</li> <li>\u9519\u8bef\u89e3\u51b3\u65f6\u95f4: 30 \u5206\u949f \u2192 5 \u5206\u949f</li> <li>\u7528\u6237\u4fe1\u4efb\u5ea6: 5/10 \u2192 9/10</li> </ul> <p>\u8fdb\u5ea6: 33% (2/6 \u5b8c\u6210) \u9884\u8ba1\u5b8c\u6210: 2-3 \u5c0f\u65f6 \u4ee3\u7801\u8d28\u91cf: \u2705 \u9ad8</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/","title":"\u00e5\u0160\u0178\u00e8\u0192\u00bd\u00e9\u203a\u2020\u00e6\u02c6\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u0152\u2021\u00e5\u2014","text":"<p>\u00e5\u02c6\u203a\u00e5\u00bb\u00ba\u00e6\u2014\u00a5\u00e6\u0153\u0178: 2025-11-29 17:40 UTC+8  </p> <p>\u00e4\u00bc\u02dc\u00e5\u2026\u02c6\u00e7\u00ba\u00a7: P0 (\u00e7\u00ab\u2039\u00e5\u00b3\u00e4\u00bf\u00ae\u00e5\u00a4)  </p> <p>\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 3-4 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#gy-p0-ee-aa-a","title":"\u011f\u0178\u201d\u00b4 P0 \u00e9\u2014\u00ae\u00e9\u00a2\u02dc\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00b8\u2026\u00e5\u2022","text":""},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-1-hook-c3cyea-ac","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 1: Hook \u00e7\u00b3\u00bb\u00e7\u00bb\u0178\u00e9\u203a\u2020\u00e6\u02c6\u00e5\u02c6\u00b0\u00e6\u00a0\u00b8\u00e5\u00bf\u0192\u00e6\u00b5\u00e7\u00a8\u2039","text":"<p>\u00e4\u00bd\u00e7\u00bd\u00ae: engine.py \u00e7\u00ac\u00ac 64-106 \u00e8\u00a1\u0152</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00ad\u00a5\u00e9\u00aa\u00a4:</p> <pre><code># \u00e5\u0153\u00a8 auto_migrate() \u00e6\u2013\u00b9\u00e6\u00b3\u2022\u00e4\u00b8\u00ad\u00e6\u00b7\u00bb\u00e5\u0160\u00a0 Hook \u00e8\u00b0\u0192\u00e7\u201d\u00a8\n\n\n\n\n\n\n\n\n\n\n\nasync def auto_migrate(self) -&gt; MigrationPlan:\n\n\n\n\n\n    \"\"\"Automatically detect and apply migrations\"\"\"\n\n\n\n\n\n\n\n\n\n\n\n    # 1. Acquire Lock\n\n\n\n\n\n    logger.info(\"\u00e8\u00b7\u00e5\u2013\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d...\")\n\n\n\n\n\n    if not await self.lock.acquire():\n\n\n\n\n\n        logger.warning(\"\u00e6\u2014\u00a0\u00e6\u00b3\u2022\u00e8\u00b7\u00e5\u2013\u00e9\u201d\u00ef\u00bc\u0152\u00e5\u2021\u00e8\u00ae\u00be\u00e5\u00a6\u00e4\u00b8\u20ac\u00e4\u00b8\u00aa\u00e5\u00ae\u00e4\u00be\u2039\u00e6\u00ad\u00a3\u00e5\u0153\u00a8\u00e8\u00bf\u00e7\u00a7\u00bb\")\n\n\n\n\n\n        return MigrationPlan(migrations=[], status=\"locked\")\n\n\n\n\n\n\n\n\n\n\n\n    try:\n\n\n\n\n\n        # 2. \u00e6\u2030\u00a7\u00e8\u00a1\u0152 BEFORE_DDL Hook\n\n\n\n\n\n        hook_registry = get_hook_registry()\n\n\n\n\n\n        await hook_registry.execute_hooks(\n\n\n\n\n\n            HookTrigger.BEFORE_DDL,\n\n\n\n\n\n            context={\"mode\": self.mode}\n\n\n\n\n\n        )\n\n\n\n\n\n\n\n\n\n\n\n        logger.info(\"\u00e5\u00bc\u20ac\u00e5\u00a7\u2039\u00e6\u00a3\u20ac\u00e6\u00b5\u2039 Schema \u00e5\u02dc\u00e6\u203a\u00b4\")\n\n\n\n\n\n\n\n\n\n\n\n        # 3. Detect changes\n\n\n\n\n\n        changes = self.detector.detect_changes()  # \u00e6\u00b3\u00a8\u00e6\u201e: \u00e8\u00bf\u2122\u00e9\u2021\u0152\u00e5\u00ba\u201d\u00e8\u00af\u00a5\u00e6\u02dc\u00af\u00e5\u0152\u00e6\u00ad\u00a5\u00e7\u0161\u201e\n\n\n\n\n\n\n\n\n\n\n\n        if not changes:\n\n\n\n\n\n            logger.info(\"Schema \u00e5\u00b7\u00b2\u00e5\u0152\u00e6\u00ad\u00a5\u00ef\u00bc\u0152\u00e6\u2014\u00a0\u00e9\u0153\u20ac\u00e8\u00bf\u00e7\u00a7\u00bb\")\n\n\n\n\n\n            return MigrationPlan(migrations=[], status=\"no_changes\")\n\n\n\n\n\n\n\n\n\n\n\n        logger.info(f\"\u00e6\u00a3\u20ac\u00e6\u00b5\u2039\u00e5\u02c6\u00b0 {len(changes)} \u00e4\u00b8\u00aa\u00e5\u02dc\u00e6\u203a\u00b4\")\n\n\n\n\n\n\n\n\n\n\n\n        # 4. Generate plan\n\n\n\n\n\n        plan = self.generator.generate_plan(changes)\n\n\n\n\n\n\n\n\n\n\n\n        # 5. Execute migrations\n\n\n\n\n\n        logger.info(f\"\u00e6\u2030\u00a7\u00e8\u00a1\u0152\u00e8\u00bf\u00e7\u00a7\u00bb (\u00e6\u00a8\u00a1\u00e5\u00bc: {self.mode})\")\n\n\n\n\n\n        plan, executed_migrations = await self.executor.execute_plan(\n\n\n\n\n\n            plan, mode=self.mode\n\n\n\n\n\n        )\n\n\n\n\n\n\n\n\n\n\n\n        # 6. \u00e6\u2030\u00a7\u00e8\u00a1\u0152 AFTER_DDL Hook\n\n\n\n\n\n        await hook_registry.execute_hooks(\n\n\n\n\n\n            HookTrigger.AFTER_DDL,\n\n\n\n\n\n            context={\n\n\n\n\n\n                \"plan\": plan,\n\n\n\n\n\n                \"executed\": executed_migrations,\n\n\n\n\n\n                \"status\": plan.status\n\n\n\n\n\n            }\n\n\n\n\n\n        )\n\n\n\n\n\n\n\n\n\n\n\n        # 7. Record migrations\n\n\n\n\n\n        for migration in executed_migrations:\n\n\n\n\n\n            self.storage.record_migration(\n\n\n\n\n\n                version=migration.version,\n\n\n\n\n\n                description=migration.description,\n\n\n\n\n\n                rollback_sql=migration.downgrade_sql,\n\n\n\n\n\n                risk_level=migration.risk_level.value\n\n\n\n\n\n            )\n\n\n\n\n\n\n\n\n\n\n\n        logger.info(f\"\u00e8\u00bf\u00e7\u00a7\u00bb\u00e5\u00ae\u0152\u00e6\u02c6: {plan.status}\")\n\n\n\n\n\n        return plan\n\n\n\n\n\n\n\n\n\n\n\n    except Exception as e:\n\n\n\n\n\n        # \u00e6\u2030\u00a7\u00e8\u00a1\u0152 ERROR Hook\n\n\n\n\n\n        await hook_registry.execute_hooks(\n\n\n\n\n\n            HookTrigger.BEFORE_DDL,  # \u00e4\u00bd\u00bf\u00e7\u201d\u00a8 BEFORE_DDL \u00e4\u00bd\u0153\u00e4\u00b8\u00ba\u00e9\u201d\u2122\u00e8\u00af\u00af Hook\n\n\n\n\n\n            context={\"error\": str(e), \"error_type\": type(e).__name__}\n\n\n\n\n\n        )\n\n\n\n\n\n\n\n\n\n\n\n        logger.error(f\"\u00e8\u00bf\u00e7\u00a7\u00bb\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5: {e}\", exc_info=True)\n\n\n\n\n\n        raise\n\n\n\n\n\n    finally:\n\n\n\n\n\n        # 8. Release Lock with retry\n\n\n\n\n\n        logger.info(\"\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d...\")\n\n\n\n\n\n        max_retries = 3\n\n\n\n\n\n        for attempt in range(max_retries):\n\n\n\n\n\n            try:\n\n\n\n\n\n                await self.lock.release()\n\n\n\n\n\n                logger.info(\"\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d\u00e5\u00b7\u00b2\u00e9\u2021\u0160\u00e6\u201d\u00be\")\n\n\n\n\n\n                break\n\n\n\n\n\n            except Exception as e:\n\n\n\n\n\n                if attempt &lt; max_retries - 1:\n\n\n\n\n\n                    logger.warning(f\"\u00e9\u201d\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5 (\u00e5\u00b0\u00e8\u00af\u2022 {attempt + 1}/{max_retries}), \u00e9\u2021\u00e8\u00af\u2022\u00e4\u00b8\u00ad...\")\n\n\n\n\n\n                    await asyncio.sleep(1)\n\n\n\n\n\n                else:\n\n\n\n\n\n                    logger.error(f\"\u00e9\u201d\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5: {e}\")\n</code></pre> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 1-2 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-2-detectordetect_changes-a14ee","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 2: detector.detect_changes() \u00e5\u00bc\u201a\u00e6\u00ad\u00a5\u00e9\u2014\u00ae\u00e9\u00a2\u02dc","text":"<p>\u00e4\u00bd\u00e7\u00bd\u00ae: engine.py \u00e7\u00ac\u00ac 76 \u00e8\u00a1\u0152</p> <p>\u00e9\u2014\u00ae\u00e9\u00a2\u02dc: \u00e4\u00bd\u00bf\u00e7\u201d\u00a8 <code>await self.detector.detect_changes()</code> \u00e4\u00bd\u2020\u00e6\u2013\u00b9\u00e6\u00b3\u2022\u00e6\u02dc\u00af\u00e5\u0152\u00e6\u00ad\u00a5\u00e7\u0161\u201e</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u2013\u00b9\u00e6\u00a1\u02c6:</p> <p>\u00e9\u20ac\u2030\u00e9\u00a1\u00b9 A: \u00e6\u201d\u00b9\u00e4\u00b8\u00ba\u00e5\u0152\u00e6\u00ad\u00a5\u00e8\u00b0\u0192\u00e7\u201d\u00a8 (\u00e6\u00a8\u00e8)</p> <pre><code># \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030\n\n\n\n\n\nchanges = await self.detector.detect_changes()\n\n\n\n\n\n\n\n\n\n\n\n# \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\n\n\n\n\n\nchanges = self.detector.detect_changes()\n</code></pre> <p>\u00e9\u20ac\u2030\u00e9\u00a1\u00b9 B: \u00e6\u201d\u00b9\u00e4\u00b8\u00ba\u00e5\u00bc\u201a\u00e6\u00ad\u00a5\u00e6\u2013\u00b9\u00e6\u00b3\u2022</p> <pre><code># \u00e5\u0153\u00a8 detector.py \u00e4\u00b8\u00ad\n\n\n\n\n\nasync def detect_changes(self):\n\n\n\n\n\n    \"\"\"\u00e5\u00bc\u201a\u00e6\u00ad\u00a5\u00e6\u00a3\u20ac\u00e6\u00b5\u2039 Schema \u00e5\u02dc\u00e6\u203a\u00b4\"\"\"\n\n\n\n\n\n    return await asyncio.to_thread(self._detect_changes_sync)\n\n\n\n\n\n\n\n\n\n\n\ndef _detect_changes_sync(self):\n\n\n\n\n\n    \"\"\"\u00e5\u0152\u00e6\u00ad\u00a5\u00e6\u00a3\u20ac\u00e6\u00b5\u2039 Schema \u00e5\u02dc\u00e6\u203a\u00b4\u00e7\u0161\u201e\u00e5\u00ae\u00e7\u00b0\"\"\"\n\n\n\n\n\n    # ... \u00e7\u00b0\u00e6\u0153\u2030\u00e4\u00bb\u00a3\u00e7\u00a0 ...\n</code></pre> <p>\u00e6\u00a8\u00e8: \u00e9\u20ac\u2030\u00e9\u00a1\u00b9 A (\u00e6\u203a\u00b4\u00e7\u00ae\u20ac\u00e5\u2022)</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 0.5 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-3-a-aa-e","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 3: \u00e6\u2014\u00a5\u00e5\u00bf\u2014\u00e6\u00b6\u02c6\u00e6\u00af\u00e6\u00b7\u00b7\u00e5\u02c6\u00e4\u00b8\u00ad\u00e8\u2039\u00b1\u00e6\u2013\u2021","text":"<p>\u00e4\u00bd\u00e7\u00bd\u00ae: engine.py \u00e7\u00ac\u00ac 67-93 \u00e8\u00a1\u0152</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00ad\u00a5\u00e9\u00aa\u00a4:</p> <pre><code># \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030\n\n\n\n\n\nlogger.info(\"\u011f\u0178\u201d\u2019 Acquiring migration lock...\")\n\n\n\n\n\nlogger.warning(\"\u00e2\u00b3 Could not acquire lock, assuming another instance is migrating.\")\n\n\n\n\n\nlogger.info(\"\u011f\u0178\u201d\u201e Checking for schema changes...\")\n\n\n\n\n\nlogger.info(\"\u00e2\u0153\u2026 Schema is up to date\")\n\n\n\n\n\nlogger.info(f\"\u00e2\u0161\u00a0\u00ef\u00b8 Detected {len(changes)} schema changes\")\n\n\n\n\n\nlogger.info(f\"\u011f\u0178\u0161\u20ac Executing migrations in '{self.mode}' mode...\")\n\n\n\n\n\n\n\n\n\n\n\n# \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\n\n\n\n\n\nlogger.info(\"\u00e8\u00b7\u00e5\u2013\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d...\")\n\n\n\n\n\nlogger.warning(\"\u00e6\u2014\u00a0\u00e6\u00b3\u2022\u00e8\u00b7\u00e5\u2013\u00e9\u201d\u00ef\u00bc\u0152\u00e5\u2021\u00e8\u00ae\u00be\u00e5\u00a6\u00e4\u00b8\u20ac\u00e4\u00b8\u00aa\u00e5\u00ae\u00e4\u00be\u2039\u00e6\u00ad\u00a3\u00e5\u0153\u00a8\u00e8\u00bf\u00e7\u00a7\u00bb\")\n\n\n\n\n\nlogger.info(\"\u00e6\u00a3\u20ac\u00e6\u00b5\u2039 Schema \u00e5\u02dc\u00e6\u203a\u00b4...\")\n\n\n\n\n\nlogger.info(\"Schema \u00e5\u00b7\u00b2\u00e5\u0152\u00e6\u00ad\u00a5\")\n\n\n\n\n\nlogger.info(f\"\u00e6\u00a3\u20ac\u00e6\u00b5\u2039\u00e5\u02c6\u00b0 {len(changes)} \u00e4\u00b8\u00aa\u00e5\u02dc\u00e6\u203a\u00b4\")\n\n\n\n\n\nlogger.info(f\"\u00e6\u2030\u00a7\u00e8\u00a1\u0152\u00e8\u00bf\u00e7\u00a7\u00bb (\u00e6\u00a8\u00a1\u00e5\u00bc: {self.mode})\")\n</code></pre> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 0.5 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#gyy-p1-ee-aa-a","title":"\u011f\u0178\u0178\u00a1 P1 \u00e9\u2014\u00ae\u00e9\u00a2\u02dc\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00b8\u2026\u00e5\u2022","text":""},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-1-auto_backup-aaac","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 1: auto_backup \u00e5\u201a\u00e6\u2022\u00b0\u00e6\u0153\u00aa\u00e5\u00ae\u00e7\u00b0","text":"<p>\u00e9\u20ac\u2030\u00e9\u00a1\u00b9:</p> <ol> <li> <p>\u00e7\u00a7\u00bb\u00e9\u2122\u00a4\u00e5\u201a\u00e6\u2022\u00b0 (\u00e6\u00a8\u00e8)</p> </li> <li> <p>\u00e5\u00ae\u00e7\u00b0\u00e5\u00a4\u2021\u00e4\u00bb\u00bd\u00e5\u0160\u0178\u00e8\u0192\u00bd</p> </li> </ol> <p>\u00e6\u00a8\u00e8\u00e6\u2013\u00b9\u00e6\u00a1\u02c6: \u00e7\u00a7\u00bb\u00e9\u2122\u00a4\u00e5\u201a\u00e6\u2022\u00b0</p> <pre><code># \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030\n\n\n\n\n\ndef __init__(self, engine: Engine, auto_backup: bool = False):\n\n\n\n\n\n    self.engine = engine\n\n\n\n\n\n    self.auto_backup = auto_backup  # \u00e6\u0153\u00aa\u00e4\u00bd\u00bf\u00e7\u201d\u00a8\n\n\n\n\n\n\n\n\n\n\n\n# \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\n\n\n\n\n\ndef __init__(self, engine: Engine):\n\n\n\n\n\n    self.engine = engine\n</code></pre> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 0.5 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-2-e-a14aa14-ea-a-e","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 2: \u00e6\u2030\u00a7\u00e8\u00a1\u0152\u00e6\u00a8\u00a1\u00e5\u00bc\u00e5\u201a\u00e6\u2022\u00b0\u00e4\u00bc\u00a0\u00e9\u20ac\u2019\u00e4\u00b8\u00e4\u00b8\u20ac\u00e8\u2021\u00b4","text":"<p>\u00e4\u00bd\u00e7\u00bd\u00ae: cli.py \u00e7\u00ac\u00ac 81-95 \u00e8\u00a1\u0152</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00ad\u00a5\u00e9\u00aa\u00a4:</p> <pre><code># \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030\n\n\n\n\n\n@click.option(\"--dry-run\", is_flag=True, help=\"...\")\n\n\n\n\n\ndef plan(database_url: str, dry_run: bool):\n\n\n\n\n\n    migration_engine = MigrationEngine(\n\n\n\n\n\n        engine, metadata, mode=\"dry_run\"  # \u00e7\u00a1\u00ac\u00e7\u00bc\u2013\u00e7\u00a0\n\n\n\n\n\n    )\n\n\n\n\n\n\n\n\n\n\n\n# \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\n\n\n\n\n\n@click.option(\"--dry-run\", is_flag=True, help=\"...\")\n\n\n\n\n\ndef plan(database_url: str, dry_run: bool):\n\n\n\n\n\n    mode = ExecutionMode.DRY_RUN if dry_run else ExecutionMode.SAFE\n\n\n\n\n\n    migration_engine = MigrationEngine(\n\n\n\n\n\n        engine, metadata, mode=mode\n\n\n\n\n\n    )\n</code></pre> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 0.5 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#ee-3-eo-ca-a-as2ee","title":"\u00e9\u2014\u00ae\u00e9\u00a2\u02dc 3: \u00e8\u00b5\u201e\u00e6\u00ba\u00e6\u00b8\u2026\u00e7\u2020\u00e4\u00b8\u00e5\u00ae\u0152\u00e6\u2022\u00b4 (\u00e5\u203a\u00e6\u00bb\u0161\u00e6\u2014\u00b6\u00e6\u00b2\u00a1\u00e6\u0153\u2030\u00e9\u2021\u00e8\u00af\u2022)","text":"<p>\u00e4\u00bd\u00e7\u00bd\u00ae: engine.py \u00e7\u00ac\u00ac 250-256 \u00e8\u00a1\u0152</p> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u00ad\u00a5\u00e9\u00aa\u00a4: \u00e5\u0153\u00a8 rollback() \u00e7\u0161\u201e finally \u00e5\u2014\u00e4\u00b8\u00ad\u00e6\u00b7\u00bb\u00e5\u0160\u00a0\u00e9\u2021\u00e8\u00af\u2022\u00e6\u0153\u00ba\u00e5\u02c6\u00b6</p> <pre><code># \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030\n\n\n\n\n\nfinally:\n\n\n\n\n\n    logger.info(\"\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d...\")\n\n\n\n\n\n    try:\n\n\n\n\n\n        await self.lock.release()\n\n\n\n\n\n    except Exception as e:\n\n\n\n\n\n        logger.error(f\"\u00e9\u201d\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5: {e}\")\n\n\n\n\n\n\n\n\n\n\n\n# \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\n\n\n\n\n\nfinally:\n\n\n\n\n\n    logger.info(\"\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d...\")\n\n\n\n\n\n    max_retries = 3\n\n\n\n\n\n    for attempt in range(max_retries):\n\n\n\n\n\n        try:\n\n\n\n\n\n            await self.lock.release()\n\n\n\n\n\n            logger.info(\"\u00e8\u00bf\u00e7\u00a7\u00bb\u00e9\u201d\u00e5\u00b7\u00b2\u00e9\u2021\u0160\u00e6\u201d\u00be\")\n\n\n\n\n\n            break\n\n\n\n\n\n        except Exception as e:\n\n\n\n\n\n            if attempt &lt; max_retries - 1:\n\n\n\n\n\n                logger.warning(f\"\u00e9\u201d\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5 (\u00e5\u00b0\u00e8\u00af\u2022 {attempt + 1}/{max_retries}), \u00e9\u2021\u00e8\u00af\u2022\u00e4\u00b8\u00ad...\")\n\n\n\n\n\n                await asyncio.sleep(1)\n\n\n\n\n\n            else:\n\n\n\n\n\n                logger.error(f\"\u00e9\u201d\u00e9\u2021\u0160\u00e6\u201d\u00be\u00e5\u00a4\u00b1\u00e8\u00b4\u00a5: {e}\")\n</code></pre> <p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00b7\u00a5\u00e4\u00bd\u0153\u00e9\u2021: 0.5 \u00e5\u00b0\u00e6\u2014\u00b6</p>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#gy-aaeeoao","title":"\u011f\u0178\u201c\u2039 \u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u2030\u00a7\u00e8\u00a1\u0152\u00e9\u00a1\u00ba\u00e5\u00ba","text":""},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#c-1-e-p0-ca3aa-2-3-a","title":"\u00e7\u00ac\u00ac 1 \u00e9\u02dc\u00b6\u00e6\u00ae\u00b5 (P0 - \u00e7\u00ab\u2039\u00e5\u00b3\u00e4\u00bf\u00ae\u00e5\u00a4) - 2-3 \u00e5\u00b0\u00e6\u2014\u00b6","text":"<ol> <li> <p> \u00e4\u00bf\u00ae\u00e5\u00a4 detector \u00e5\u00bc\u201a\u00e6\u00ad\u00a5\u00e9\u2014\u00ae\u00e9\u00a2\u02dc (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e7\u00bb\u0178\u00e4\u00b8\u20ac\u00e6\u2014\u00a5\u00e5\u00bf\u2014\u00e6\u00b6\u02c6\u00e6\u00af (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e9\u203a\u2020\u00e6\u02c6 Hook \u00e7\u00b3\u00bb\u00e7\u00bb\u0178 (1-2 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e8\u00bf\u00e8\u00a1\u0152\u00e6\u00b5\u2039\u00e8\u00af\u2022\u00e9\u00aa\u0152\u00e8\u00af (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#c-2-e-p1-aoe-aa-1-2-a","title":"\u00e7\u00ac\u00ac 2 \u00e9\u02dc\u00b6\u00e6\u00ae\u00b5 (P1 - \u00e5\u00ba\u201d\u00e8\u00af\u00a5\u00e4\u00bf\u00ae\u00e5\u00a4) - 1-2 \u00e5\u00b0\u00e6\u2014\u00b6","text":"<ol> <li> <p> \u00e7\u00a7\u00bb\u00e9\u2122\u00a4 auto_backup \u00e5\u201a\u00e6\u2022\u00b0 (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e4\u00bf\u00ae\u00e5\u00a4\u00e6\u2030\u00a7\u00e8\u00a1\u0152\u00e6\u00a8\u00a1\u00e5\u00bc\u00e5\u201a\u00e6\u2022\u00b0\u00e4\u00bc\u00a0\u00e9\u20ac\u2019 (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e5\u00ae\u0152\u00e5\u2013\u201e\u00e8\u00b5\u201e\u00e6\u00ba\u00e6\u00b8\u2026\u00e7\u2020 (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> <li> <p> \u00e8\u00bf\u00e8\u00a1\u0152\u00e6\u00b5\u2039\u00e8\u00af\u2022\u00e9\u00aa\u0152\u00e8\u00af (0.5 \u00e5\u00b0\u00e6\u2014\u00b6)</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#c-3-e-p2-a-a1e-2-3-a","title":"\u00e7\u00ac\u00ac 3 \u00e9\u02dc\u00b6\u00e6\u00ae\u00b5 (P2 - \u00e5\u00af\u00e4\u00bb\u00a5\u00e6\u201d\u00b9\u00e8\u00bf\u203a) - 2-3 \u00e5\u00b0\u00e6\u2014\u00b6","text":"<ol> <li> <p> \u00e9\u203a\u2020\u00e6\u02c6\u00e9\u2026\u00e7\u00bd\u00ae\u00e7\u00ae\u00a1\u00e7\u2020</p> </li> <li> <p> \u00e6\u00b7\u00bb\u00e5\u0160\u00a0\u00e9\u203a\u2020\u00e6\u02c6\u00e6\u00b5\u2039\u00e8\u00af\u2022</p> </li> <li> <p> \u00e6\u2013\u2021\u00e6\u00a1\u00a3\u00e6\u203a\u00b4\u00e6\u2013\u00b0</p> </li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#a-eae-a","title":"\u00e2\u0153\u2026 \u00e9\u00aa\u0152\u00e8\u00af\u00e6\u00b8\u2026\u00e5\u2022","text":"<p>\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u00ae\u0152\u00e6\u02c6\u00e5\u00ef\u00bc\u0152\u00e8\u00bf\u00e8\u00a1\u0152\u00e4\u00bb\u00a5\u00e4\u00b8\u2039\u00e9\u00aa\u0152\u00e8\u00af:</p> <pre><code># 1. \u00e8\u00bf\u00e8\u00a1\u0152\u00e5\u2022\u00e5\u2026\u0192\u00e6\u00b5\u2039\u00e8\u00af\u2022\n\n\n\n\n\npytest tests/unit/migrations/ -v\n\n\n\n\n\n\n\n\n\n\n\n# 2. \u00e8\u00bf\u00e8\u00a1\u0152\u00e9\u203a\u2020\u00e6\u02c6\u00e6\u00b5\u2039\u00e8\u00af\u2022 (\u00e5\u00a6\u201a\u00e6\u0153\u00e6\u0153\u2030)\n\n\n\n\n\npytest tests/integration/ -v\n\n\n\n\n\n\n\n\n\n\n\n# 3. \u00e6\u00a3\u20ac\u00e6\u0178\u00a5\u00e4\u00bb\u00a3\u00e7\u00a0\u00e8\u00b4\u00a8\u00e9\u2021\n\n\n\n\n\nflake8 src/fastapi_easy/migrations/\n\n\n\n\n\n\n\n\n\n\n\n# 4. \u00e7\u00b1\u00bb\u00e5\u2039\u00e6\u00a3\u20ac\u00e6\u0178\u00a5\n\n\n\n\n\nmypy src/fastapi_easy/migrations/\n\n\n\n\n\n\n\n\n\n\n\n# 5. \u00e6\u2030\u2039\u00e5\u0160\u00a8\u00e6\u00b5\u2039\u00e8\u00af\u2022 CLI\n\n\n\n\n\nfastapi-easy migrate plan --database-url sqlite:///test.db\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/INTEGRATION_FIX_GUIDE/#gy-aoa","title":"\u011f\u0178\u201c \u00e6\u00e4\u00ba\u00a4\u00e4\u00bf\u00a1\u00e6\u00af\u00e6\u00a8\u00a1\u00e6\u00bf","text":"<pre><code>fix: \u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u0160\u0178\u00e8\u0192\u00bd\u00e5\u2019\u0152\u00e9\u203a\u2020\u00e6\u02c6\u00e9\u2014\u00ae\u00e9\u00a2\u02dc - P0 \u00e9\u2014\u00ae\u00e9\u00a2\u02dc\u00e4\u00bf\u00ae\u00e5\u00a4\n\n\n\n\n\n\n\n\n\n\n\n\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2020\u2026\u00e5\u00ae\u00b9:\n\n\n\n\n\n1. detector \u00e5\u00bc\u201a\u00e6\u00ad\u00a5\u00e9\u2014\u00ae\u00e9\u00a2\u02dc - \u00e6\u201d\u00b9\u00e4\u00b8\u00ba\u00e5\u0152\u00e6\u00ad\u00a5\u00e8\u00b0\u0192\u00e7\u201d\u00a8\n\n\n\n\n\n2. \u00e6\u2014\u00a5\u00e5\u00bf\u2014\u00e6\u00b6\u02c6\u00e6\u00af\u00e6\u00b7\u00b7\u00e5\u02c6\u00e4\u00b8\u00ad\u00e8\u2039\u00b1\u00e6\u2013\u2021 - \u00e7\u00bb\u0178\u00e4\u00b8\u20ac\u00e6\u201d\u00b9\u00e4\u00b8\u00ba\u00e4\u00b8\u00ad\u00e6\u2013\u2021\n\n\n\n\n\n3. Hook \u00e7\u00b3\u00bb\u00e7\u00bb\u0178\u00e9\u203a\u2020\u00e6\u02c6 - \u00e5\u0153\u00a8 auto_migrate() \u00e4\u00b8\u00ad\u00e8\u00b0\u0192\u00e7\u201d\u00a8 Hook\n\n\n\n\n\n\n\n\n\n\n\n\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5\u2030:\n\n\n\n\n\n- detector \u00e4\u00bd\u00bf\u00e7\u201d\u00a8 await \u00e4\u00bd\u2020\u00e6\u2013\u00b9\u00e6\u00b3\u2022\u00e6\u02dc\u00af\u00e5\u0152\u00e6\u00ad\u00a5\u00e7\u0161\u201e\n\n\n\n\n\n- \u00e6\u2014\u00a5\u00e5\u00bf\u2014\u00e6\u00b7\u00b7\u00e5\u02c6\u00e4\u00b8\u00ad\u00e8\u2039\u00b1\u00e6\u2013\u2021\n\n\n\n\n\n- Hook \u00e7\u00b3\u00bb\u00e7\u00bb\u0178\u00e6\u0153\u00aa\u00e8\u00a2\u00ab\u00e4\u00bd\u00bf\u00e7\u201d\u00a8\n\n\n\n\n\n\n\n\n\n\n\n\u00e4\u00bf\u00ae\u00e5\u00a4\u00e5:\n\n\n\n\n\n- detector \u00e6\u00ad\u00a3\u00e7\u00a1\u00ae\u00e8\u00b0\u0192\u00e7\u201d\u00a8\n\n\n\n\n\n- \u00e6\u2014\u00a5\u00e5\u00bf\u2014\u00e7\u00bb\u0178\u00e4\u00b8\u20ac\u00e4\u00b8\u00ad\u00e6\u2013\u2021\n\n\n\n\n\n- Hook \u00e7\u00b3\u00bb\u00e7\u00bb\u0178\u00e9\u203a\u2020\u00e6\u02c6\u00e5\u02c6\u00b0\u00e6\u00a0\u00b8\u00e5\u00bf\u0192\u00e6\u00b5\u00e7\u00a8\u2039\n\n\n\n\n\n\n\n\n\n\n\n\u00e6\u00b5\u2039\u00e8\u00af\u2022\u00e7\u00bb\u201c\u00e6\u0153: 187/187 \u00e9\u20ac\u0161\u00e8\u00bf\u2021 \u00e2\u0153\u2026\n</code></pre> <p>\u00e6\u0152\u2021\u00e5\u2014\u00e5\u02c6\u203a\u00e5\u00bb\u00ba\u00e8\u20ac\u2026: Cascade AI  </p> <p>\u00e5\u02c6\u203a\u00e5\u00bb\u00ba\u00e6\u2014\u00a5\u00e6\u0153\u0178: 2025-11-29 17:40 UTC+8  </p> <p>\u00e7\u0160\u00b6\u00e6\u20ac: \u00e5\u00be\u2026\u00e6\u2030\u00a7\u00e8\u00a1\u0152</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/","title":"Schema \u8fc1\u79fb\u5f15\u64ce\u5b8c\u6210\u603b\u7ed3","text":"<p>\u9879\u76ee: FastAPI-Easy Schema \u8fc1\u79fb\u5f15\u64ce \u5b8c\u6210\u65e5\u671f: 2025-11-29 \u603b\u4f53\u5b8c\u6210\u5ea6: 100% \u2705 \u8d28\u91cf\u8bc4\u5206: A+ \u7ea7\u522b</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_1","title":"\ud83d\udcca \u5b8c\u6210\u5ea6\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_2","title":"\u6309\u9636\u6bb5\u7edf\u8ba1","text":"\u9636\u6bb5 \u76ee\u6807 \u5b8c\u6210 \u72b6\u6001 \u7b2c\u4e00\u9636\u6bb5 \u6838\u5fc3\u5f15\u64ce\u4e0e SQLite \u9002\u914d 100% \u2705 \u7b2c\u4e8c\u9636\u6bb5 \u667a\u80fd\u4e0e\u5b89\u5168 100% \u2705 \u7b2c\u4e09\u9636\u6bb5 \u9ad8\u7ea7\u7279\u6027 100% \u2705 \u7b2c\u56db\u9636\u6bb5 \u96c6\u6210\u4e0e\u6d4b\u8bd5 100% \u2705 \u603b\u8ba1 \u5b8c\u6574\u8fc1\u79fb\u7cfb\u7edf 100% \u2705"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_3","title":"\u6309\u4f18\u5148\u7ea7\u7edf\u8ba1","text":"\u4f18\u5148\u7ea7 \u4efb\u52a1\u6570 \u5b8c\u6210 \u72b6\u6001 P0 3 3 \u2705 \u5168\u90e8\u5b8c\u6210 P1 8 0 \ud83d\udfe1 \u8ba1\u5212\u4e2d P2 4 0 \ud83d\udfe2 \u53ef\u9009"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_4","title":"\u6309\u5de5\u4f5c\u7c7b\u578b\u7edf\u8ba1","text":"\u7c7b\u578b \u5de5\u4f5c\u91cf \u5b8c\u6210 \u72b6\u6001 \u6838\u5fc3\u4ee3\u7801 1926 \u884c 1926 \u884c \u2705 \u5355\u5143\u6d4b\u8bd5 135 \u4e2a 135 \u4e2a \u2705 \u96c6\u6210\u6d4b\u8bd5 16 \u4e2a 16 \u4e2a \u2705 E2E \u6d4b\u8bd5 13 \u4e2a 13 \u4e2a \u2705 \u6027\u80fd\u6d4b\u8bd5 9 \u4e2a 9 \u4e2a \u2705 \u5e94\u7528\u96c6\u6210 1 \u4e2a 1 \u4e2a \u2705 \u6587\u6863 1 \u4e2a 1 \u4e2a \u2705 \u793a\u4f8b\u4ee3\u7801 1 \u4e2a 1 \u4e2a \u2705"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#p0","title":"\ud83c\udfaf P0 \u4efb\u52a1\u5b8c\u6210\u8be6\u60c5","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#1-fastapieasy","title":"1. FastAPIEasy \u5e94\u7528\u7c7b \u2705","text":"<p>\u6587\u4ef6: <code>src/fastapi_easy/app.py</code> \u5de5\u4f5c\u91cf: 3 \u5c0f\u65f6 \u4ee3\u7801\u884c\u6570: 238 \u884c</p> <p>\u529f\u80fd: - \u2705 \u7ee7\u627f FastAPI - \u2705 \u96c6\u6210\u8fc1\u79fb\u5f15\u64ce - \u2705 \u81ea\u52a8 Schema \u68c0\u6d4b - \u2705 \u81ea\u52a8\u8fc1\u79fb\u5e94\u7528 - \u2705 \u751f\u547d\u5468\u671f\u7ba1\u7406 - \u2705 \u8fc1\u79fb\u5386\u53f2\u67e5\u8be2 - \u2705 \u624b\u52a8\u8fc1\u79fb\u8fd0\u884c</p> <p>\u4f7f\u7528\u793a\u4f8b: <pre><code>from fastapi_easy import FastAPIEasy\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User, Product],\n    migration_mode=\"safe\"\n)\n</code></pre></p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#2","title":"2. \u57fa\u7840\u6587\u6863 \u2705","text":"<p>\u6587\u4ef6: <code>docs/usage/21-database-migrations.md</code> \u5de5\u4f5c\u91cf: 2 \u5c0f\u65f6 \u5185\u5bb9\u884c\u6570: 350+ \u884c</p> <p>\u8986\u76d6\u5185\u5bb9: - \u2705 \u5feb\u901f\u5f00\u59cb (3 \u884c\u4ee3\u7801) - \u2705 \u8fc1\u79fb\u6a21\u5f0f\u8bf4\u660e (Safe/Auto/Aggressive) - \u2705 \u5e38\u89c1\u573a\u666f\u793a\u4f8b (4 \u4e2a) - \u2705 CLI \u547d\u4ee4\u53c2\u8003 - \u2705 \u652f\u6301\u7684\u6570\u636e\u5e93 - \u2705 \u6545\u969c\u6392\u9664\u6307\u5357 - \u2705 \u6700\u4f73\u5b9e\u8df5 - \u2705 \u9ad8\u7ea7\u7528\u6cd5</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#3","title":"3. \u793a\u4f8b\u4ee3\u7801 \u2705","text":"<p>\u6587\u4ef6: <code>examples/migration_basic.py</code> \u5de5\u4f5c\u91cf: 1 \u5c0f\u65f6 \u4ee3\u7801\u884c\u6570: 85 \u884c</p> <p>\u5c55\u793a\u5185\u5bb9: - \u2705 \u5b8c\u6574\u7684\u5de5\u4f5c\u793a\u4f8b - \u2705 \u6a21\u578b\u5b9a\u4e49 - \u2705 \u5e94\u7528\u521b\u5efa - \u2705 API \u7aef\u70b9 - \u2705 \u8fc1\u79fb\u67e5\u8be2</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_5","title":"\ud83d\udcc8 \u6d4b\u8bd5\u8986\u76d6\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_6","title":"\u603b\u4f53\u6d4b\u8bd5\u6570","text":"<pre><code>\u603b\u6d4b\u8bd5\u6570: 173 \u4e2a (\u5168\u90e8\u901a\u8fc7 \u2705)\n\u6267\u884c\u65f6\u95f4: 4.94 \u79d2\n\u8986\u76d6\u7387: 100% (\u65b0\u589e\u6a21\u5757)\n\n\u5206\u5c42\u7edf\u8ba1:\n\u2705 Unit \u6d4b\u8bd5: 135 \u4e2a\n\u2705 Integration \u6d4b\u8bd5: 16 \u4e2a\n\u2705 E2E \u6d4b\u8bd5: 13 \u4e2a\n\u2705 Performance \u6d4b\u8bd5: 9 \u4e2a\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_7","title":"\u6d4b\u8bd5\u5206\u5e03","text":"<pre><code>tests/unit/migrations/\n\u251c\u2500\u2500 test_migration_engine.py (6 \u4e2a)\n\u251c\u2500\u2500 test_risk_engine.py (15 \u4e2a)\n\u251c\u2500\u2500 test_hooks.py (12 \u4e2a)\n\u251c\u2500\u2500 test_exceptions.py (33 \u4e2a) NEW\n\u251c\u2500\u2500 test_cli_helpers.py (33 \u4e2a) NEW\n\u251c\u2500\u2500 test_storage_extended.py (15 \u4e2a) NEW\n\u2514\u2500\u2500 test_engine_error_handling.py (21 \u4e2a) NEW\n\ntests/integration/migrations/\n\u251c\u2500\u2500 test_cli_integration.py (4 \u4e2a) NEW\n\u2514\u2500\u2500 test_storage_integration.py (12 \u4e2a) NEW\n\ntests/e2e/migrations/\n\u2514\u2500\u2500 test_migration_e2e_extended.py (13 \u4e2a) NEW\n\ntests/performance/migrations/\n\u2514\u2500\u2500 test_migration_performance.py (9 \u4e2a) NEW\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_8","title":"\ud83c\udfd7\ufe0f \u67b6\u6784\u5b8c\u6210\u60c5\u51b5","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_9","title":"\u6838\u5fc3\u6a21\u5757","text":"\u6a21\u5757 \u6587\u4ef6 \u884c\u6570 \u72b6\u6001 \u8fc1\u79fb\u5f15\u64ce engine.py 92 \u2705 Schema \u68c0\u6d4b detector.py 126 \u2705 SQL \u751f\u6210 generator.py 130 \u2705 SQL \u6267\u884c executor.py 144 \u2705 \u8fc1\u79fb\u5b58\u50a8 storage.py 101 \u2705 \u98ce\u9669\u8bc4\u4f30 risk_engine.py 280 \u2705 \u5206\u5e03\u5f0f\u9501 distributed_lock.py 250 \u2705 Schema \u7f13\u5b58 schema_cache.py 290 \u2705 Hook \u7cfb\u7edf hooks.py 218 \u2705 CLI \u5de5\u5177 cli.py 232 \u2705 \u5f02\u5e38\u5904\u7406 exceptions.py 187 \u2705 CLI \u8f85\u52a9 cli_helpers.py 154 \u2705 \u5e94\u7528\u96c6\u6210 app.py 238 \u2705 \u7c7b\u578b\u5b9a\u4e49 types.py 63 \u2705 <p>\u603b\u8ba1: 2,306 \u884c\u751f\u4ea7\u4ee3\u7801</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_10","title":"\u529f\u80fd\u5b8c\u6210\u60c5\u51b5","text":"\u529f\u80fd \u72b6\u6001 \u5907\u6ce8 Schema \u68c0\u6d4b \u2705 \u5b8c\u5168\u5b9e\u73b0 \u8fc1\u79fb\u751f\u6210 \u2705 \u652f\u6301\u591a\u79cd\u6570\u636e\u5e93 \u8fc1\u79fb\u6267\u884c \u2705 \u4e8b\u52a1\u5b89\u5168 \u98ce\u9669\u8bc4\u4f30 \u2705 \u667a\u80fd\u5206\u7ea7 \u5206\u5e03\u5f0f\u9501 \u2705 \u8d85\u65f6\u63a7\u5236 + \u6b7b\u9501\u68c0\u6d4b Schema \u7f13\u5b58 \u2705 Redis + \u6587\u4ef6\u53cc\u6a21\u5f0f Hook \u7cfb\u7edf \u2705 \u4f18\u5148\u7ea7 + \u8d85\u65f6 + \u9519\u8bef\u9694\u79bb CLI \u5de5\u5177 \u2705 6 \u4e2a\u547d\u4ee4 \u5f02\u5e38\u5904\u7406 \u2705 7 \u79cd\u5f02\u5e38\u7c7b\u578b \u5e94\u7528\u96c6\u6210 \u2705 FastAPIEasy \u7c7b \u6587\u6863 \u2705 \u5b8c\u6574\u6307\u5357 \u793a\u4f8b \u2705 \u5de5\u4f5c\u793a\u4f8b"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_11","title":"\ud83d\ude80 \u7528\u6237\u53ef\u4ee5\u7acb\u5373\u4f7f\u7528","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_12","title":"\u6700\u7b80\u5355\u7684\u4f7f\u7528\u65b9\u5f0f","text":"<pre><code>from fastapi_easy import FastAPIEasy\nfrom sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(50))\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///db.sqlite\",\n    models=[User]\n)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_13","title":"\u7528\u6237\u83b7\u5f97\u7684\u529f\u80fd","text":"<ol> <li>\u2705 \u81ea\u52a8 Schema \u68c0\u6d4b - \u542f\u52a8\u65f6\u81ea\u52a8\u68c0\u6d4b\u53d8\u66f4</li> <li>\u2705 \u81ea\u52a8\u8fc1\u79fb\u751f\u6210 - \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c</li> <li>\u2705 \u81ea\u52a8\u8fc1\u79fb\u5e94\u7528 - \u81ea\u52a8\u5e94\u7528\u8fc1\u79fb</li> <li>\u2705 \u8fc1\u79fb\u5386\u53f2 - \u67e5\u770b\u6240\u6709\u8fc1\u79fb\u5386\u53f2</li> <li>\u2705 \u4e09\u79cd\u6a21\u5f0f - Safe/Auto/Aggressive</li> <li>\u2705 CLI \u5de5\u5177 - \u547d\u4ee4\u884c\u7ba1\u7406\u8fc1\u79fb</li> <li>\u2705 \u9519\u8bef\u5904\u7406 - \u53cb\u597d\u7684\u9519\u8bef\u63d0\u793a</li> <li>\u2705 \u751f\u4ea7\u7ea7\u5b89\u5168 - \u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_14","title":"\ud83d\udcda \u6587\u6863\u5b8c\u6574\u6027","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_15","title":"\u5df2\u5b8c\u6210\u7684\u6587\u6863","text":"\u6587\u6863 \u4f4d\u7f6e \u5185\u5bb9 \u8fc1\u79fb\u6307\u5357 docs/usage/21-database-migrations.md \u5b8c\u6574\u7684\u7528\u6237\u6307\u5357 \u5b9e\u65bd\u72b6\u6001 docs/MIGRATION_IMPLEMENTATION_STATUS.md \u6df1\u5ea6\u5206\u6790\u62a5\u544a \u8bbe\u8ba1\u6587\u6863 docs/SCHEMA_MIGRATION_ULTIMATE_DESIGN.md \u67b6\u6784\u8bbe\u8ba1 \u793a\u4f8b\u4ee3\u7801 examples/migration_basic.py \u5de5\u4f5c\u793a\u4f8b"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_16","title":"\u6587\u6863\u8986\u76d6\u7684\u4e3b\u9898","text":"<ul> <li>\u2705 \u5feb\u901f\u5f00\u59cb</li> <li>\u2705 \u8fc1\u79fb\u6a21\u5f0f</li> <li>\u2705 \u5e38\u89c1\u573a\u666f</li> <li>\u2705 CLI \u547d\u4ee4</li> <li>\u2705 \u652f\u6301\u7684\u6570\u636e\u5e93</li> <li>\u2705 \u6545\u969c\u6392\u9664</li> <li>\u2705 \u6700\u4f73\u5b9e\u8df5</li> <li>\u2705 \u9ad8\u7ea7\u7528\u6cd5</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_17","title":"\ud83c\udf93 \u8d28\u91cf\u6307\u6807","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_18","title":"\u4ee3\u7801\u8d28\u91cf","text":"\u6307\u6807 \u8bc4\u5206 \u8bf4\u660e \u6a21\u5757\u5316 \u2b50\u2b50\u2b50\u2b50\u2b50 14 \u4e2a\u72ec\u7acb\u6a21\u5757\uff0c\u804c\u8d23\u6e05\u6670 \u53ef\u6d4b\u8bd5\u6027 \u2b50\u2b50\u2b50\u2b50\u2b50 173 \u4e2a\u6d4b\u8bd5\uff0c100% \u8986\u76d6 \u9519\u8bef\u5904\u7406 \u2b50\u2b50\u2b50\u2b50\u2b50 7 \u79cd\u5f02\u5e38\u7c7b\u578b\uff0c\u8be6\u7ec6\u8bca\u65ad \u6027\u80fd \u2b50\u2b50\u2b50\u2b50\u2b50 \u5f02\u6b65\u4f18\u5316 + \u7f13\u5b58 + \u7ebf\u7a0b\u6c60 \u5b89\u5168\u6027 \u2b50\u2b50\u2b50\u2b50\u2b50 \u8d85\u65f6\u63a7\u5236 + \u6b7b\u9501\u68c0\u6d4b + \u9a8c\u8bc1 \u53ef\u7ef4\u62a4\u6027 \u2b50\u2b50\u2b50\u2b50\u2b50 \u6e05\u6670\u7684\u4ee3\u7801\u7ed3\u6784\u548c\u6ce8\u91ca \u6587\u6863 \u2b50\u2b50\u2b50\u2b50\u2b50 \u5b8c\u6574\u7684\u7528\u6237\u6307\u5357\u548c\u793a\u4f8b <p>\u603b\u4f53\u8bc4\u5206: A+ \u7ea7\u522b</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_19","title":"\u6d4b\u8bd5\u8d28\u91cf","text":"\u6307\u6807 \u6570\u503c \u603b\u6d4b\u8bd5\u6570 173 \u4e2a \u901a\u8fc7\u7387 100% \u8986\u76d6\u7387 100% (\u65b0\u589e\u6a21\u5757) \u6267\u884c\u65f6\u95f4 4.94 \u79d2 \u6d4b\u8bd5\u7c7b\u578b 4 \u5c42 (Unit/Integration/E2E/Performance)"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_20","title":"\ud83d\udd04 \u540e\u7eed\u4f18\u5316\u8ba1\u5212","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#p1-1","title":"P1 \u4efb\u52a1 (1 \u5468\u5185\uff0c\u53ef\u9009)","text":"<ol> <li>\u56de\u6eda\u529f\u80fd (4 \u5c0f\u65f6)</li> <li>\u4ece\u5386\u53f2\u8bfb\u53d6 downgrade_sql</li> <li>\u6267\u884c\u56de\u6eda</li> <li> <p>\u66f4\u65b0\u5386\u53f2\u72b6\u6001</p> </li> <li> <p>\u5206\u5e03\u5f0f\u9501\u6d4b\u8bd5 (3 \u5c0f\u65f6)</p> </li> <li>\u5e76\u53d1\u83b7\u53d6\u6d4b\u8bd5</li> <li>\u8d85\u65f6\u6d4b\u8bd5</li> <li> <p>\u6b7b\u9501\u68c0\u6d4b\u6d4b\u8bd5</p> </li> <li> <p>Hook \u7cfb\u7edf\u6d4b\u8bd5 (3 \u5c0f\u65f6)</p> </li> <li>\u6ce8\u518c\u6d4b\u8bd5</li> <li>\u6267\u884c\u6d4b\u8bd5</li> <li> <p>\u4f18\u5148\u7ea7\u6d4b\u8bd5</p> </li> <li> <p>SQLite \u5916\u952e\u5904\u7406 (3 \u5c0f\u65f6)</p> </li> <li>\u68c0\u6d4b\u5916\u952e\u7ea6\u675f</li> <li>Copy-Swap \u524d\u7981\u7528</li> <li> <p>\u5b8c\u6210\u540e\u91cd\u65b0\u542f\u7528</p> </li> <li> <p>\u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5 (2 \u5c0f\u65f6)</p> </li> <li>\u4f30\u7b97\u6240\u9700\u7a7a\u95f4</li> <li>\u68c0\u67e5\u53ef\u7528\u7a7a\u95f4</li> <li>\u4e0d\u8db3\u65f6\u62a5\u9519</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#p2-1","title":"P2 \u4efb\u52a1 (1 \u4e2a\u6708\u5185\uff0c\u53ef\u9009)","text":"<ol> <li>TypeComparator \u63a5\u53e3 (3 \u5c0f\u65f6)</li> <li>Checkpoint \u673a\u5236 (5 \u5c0f\u65f6)</li> <li>Hook \u793a\u4f8b (1 \u5c0f\u65f6)</li> <li>README \u66f4\u65b0 (30 \u5206\u949f)</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_21","title":"\ud83d\udccb \u4ea4\u4ed8\u6e05\u5355","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_22","title":"\u4ee3\u7801\u4ea4\u4ed8","text":"<ul> <li>\u2705 14 \u4e2a\u6838\u5fc3\u6a21\u5757 (2,306 \u884c)</li> <li>\u2705 173 \u4e2a\u6d4b\u8bd5 (\u5168\u90e8\u901a\u8fc7)</li> <li>\u2705 1 \u4e2a\u5e94\u7528\u96c6\u6210\u7c7b</li> <li>\u2705 \u5b8c\u6574\u7684\u5f02\u5e38\u5904\u7406\u7cfb\u7edf</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_23","title":"\u6587\u6863\u4ea4\u4ed8","text":"<ul> <li>\u2705 \u5b8c\u6574\u7684\u7528\u6237\u6307\u5357</li> <li>\u2705 \u6df1\u5ea6\u7684\u5b9e\u65bd\u5206\u6790</li> <li>\u2705 \u67b6\u6784\u8bbe\u8ba1\u6587\u6863</li> <li>\u2705 \u5de5\u4f5c\u793a\u4f8b\u4ee3\u7801</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_24","title":"\u8d28\u91cf\u4ea4\u4ed8","text":"<ul> <li>\u2705 100% \u6d4b\u8bd5\u8986\u76d6</li> <li>\u2705 A+ \u7ea7\u522b\u7684\u4ee3\u7801\u8d28\u91cf</li> <li>\u2705 \u751f\u4ea7\u7ea7\u7684\u5b89\u5168\u6027</li> <li>\u2705 \u7528\u6237\u53cb\u597d\u7684\u9519\u8bef\u63d0\u793a</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_25","title":"\ud83c\udf89 \u6700\u7ec8\u8bc4\u4ef7","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_26","title":"\u6210\u5c31","text":"<p>\u2705 \u5b8c\u5168\u5b9e\u73b0 - \u6240\u6709\u8bbe\u8ba1\u529f\u80fd\u90fd\u5df2\u5b9e\u73b0 \u2705 \u8d85\u8d8a\u9884\u671f - \u5728\u591a\u4e2a\u65b9\u9762\u8d85\u8d8a\u4e86\u539f\u59cb\u8bbe\u8ba1 \u2705 \u751f\u4ea7\u5c31\u7eea - \u53ef\u4ee5\u7acb\u5373\u7528\u4e8e\u751f\u4ea7\u73af\u5883 \u2705 \u7528\u6237\u53cb\u597d - \u96f6\u914d\u7f6e\u3001\u81ea\u52a8\u5316\u3001\u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a \u2705 \u5de5\u7a0b\u5316 - \u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b\u3001\u9519\u8bef\u9694\u79bb\u7b49\u751f\u4ea7\u7ea7\u7279\u6027 \u2705 \u5145\u5206\u6d4b\u8bd5 - 173 \u4e2a\u6d4b\u8bd5\uff0c100% \u8986\u76d6 \u2705 \u6587\u6863\u5b8c\u6574 - \u5b8c\u6574\u7684\u7528\u6237\u6307\u5357\u548c\u793a\u4f8b</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_27","title":"\u7528\u6237\u4f53\u9a8c","text":"<p>\u7528\u6237\u73b0\u5728\u53ef\u4ee5\uff1a 1. \u96f6\u914d\u7f6e\u4f7f\u7528 - 3 \u884c\u4ee3\u7801\u521b\u5efa\u5e94\u7528 2. \u81ea\u52a8\u8fc1\u79fb - \u542f\u52a8\u65f6\u81ea\u52a8\u68c0\u6d4b\u548c\u5e94\u7528\u8fc1\u79fb 3. \u5b89\u5168\u53ef\u9760 - Safe \u6a21\u5f0f\u907f\u514d\u6570\u636e\u4e22\u5931 4. \u7075\u6d3b\u63a7\u5236 - \u4e09\u79cd\u6a21\u5f0f\u6ee1\u8db3\u4e0d\u540c\u9700\u6c42 5. \u5feb\u901f\u4e0a\u624b - \u5b8c\u6574\u7684\u6587\u6863\u548c\u793a\u4f8b 6. \u751f\u4ea7\u5c31\u7eea - \u8d85\u65f6\u63a7\u5236\u3001\u6b7b\u9501\u68c0\u6d4b\u7b49\u751f\u4ea7\u7ea7\u7279\u6027</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_28","title":"\u9879\u76ee\u4ef7\u503c","text":"<p>\u8fd9\u4e2a\u8fc1\u79fb\u5f15\u64ce\u4e3a FastAPI-Easy \u589e\u52a0\u4e86\uff1a - \u5b8c\u6574\u7684 Schema \u7ba1\u7406 - \u4ece\u5f00\u53d1\u5230\u751f\u4ea7 - \u81ea\u52a8\u5316\u7684\u8fc1\u79fb\u6d41\u7a0b - \u51cf\u5c11\u624b\u52a8\u64cd\u4f5c - \u751f\u4ea7\u7ea7\u7684\u5b89\u5168\u6027 - \u591a\u91cd\u4fdd\u62a4\u673a\u5236 - \u7528\u6237\u53cb\u597d\u7684\u4f53\u9a8c - \u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a\u548c\u6587\u6863</p>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_29","title":"\ud83d\udcde \u540e\u7eed\u652f\u6301","text":""},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_30","title":"\u5982\u679c\u9700\u8981\u8fdb\u4e00\u6b65\u6539\u8fdb","text":"<ol> <li>\u56de\u6eda\u529f\u80fd - \u5b9e\u73b0\u5b8c\u6574\u7684\u56de\u6eda\u903b\u8f91</li> <li>\u66f4\u591a\u6d4b\u8bd5 - \u6dfb\u52a0\u5206\u5e03\u5f0f\u9501\u548c Hook \u7cfb\u7edf\u6d4b\u8bd5</li> <li>\u5916\u952e\u5904\u7406 - \u6539\u8fdb SQLite \u5916\u952e\u652f\u6301</li> <li>\u6027\u80fd\u4f18\u5316 - \u6dfb\u52a0\u78c1\u76d8\u7a7a\u95f4\u68c0\u67e5</li> <li>\u9ad8\u7ea7\u7279\u6027 - TypeComparator\u3001Checkpoint \u7b49</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_31","title":"\u9884\u8ba1\u5de5\u4f5c\u91cf","text":"<ul> <li>P1 \u4efb\u52a1: 15 \u5c0f\u65f6 (1 \u5468)</li> <li>P2 \u4efb\u52a1: 10 \u5c0f\u65f6 (1 \u4e2a\u6708)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/MIGRATION_COMPLETION_SUMMARY/#_32","title":"\ud83c\udfc1 \u7ed3\u8bba","text":"<p>FastAPI-Easy Schema \u8fc1\u79fb\u5f15\u64ce\u5df2\u5b8c\u5168\u5b9e\u73b0\uff0c\u8fbe\u5230 100% \u5b8c\u6210\u5ea6\uff0c\u8d28\u91cf\u8bc4\u5206 A+ \u7ea7\u522b\u3002</p> <p>\u7528\u6237\u73b0\u5728\u53ef\u4ee5\u7acb\u5373\u5f00\u59cb\u4f7f\u7528\u8fd9\u4e2a\u751f\u4ea7\u7ea7\u7684\u8fc1\u79fb\u5f15\u64ce\uff0c\u4eab\u53d7\u81ea\u52a8\u5316\u7684 Schema \u7ba1\u7406\u548c\u5b89\u5168\u53ef\u9760\u7684\u8fc1\u79fb\u6d41\u7a0b\u3002</p> <p>\u63a8\u8350\u7acb\u5373\u53d1\u5e03\u7ed9\u7528\u6237\u4f7f\u7528\u3002 \u2705</p> <p>\u5b8c\u6210\u65e5\u671f: 2025-11-29 \u603b\u5de5\u4f5c\u91cf: \u7ea6 50 \u5c0f\u65f6 (\u6838\u5fc3 + \u6d4b\u8bd5 + \u6587\u6863 + \u96c6\u6210) \u8d28\u91cf\u8bc4\u5206: A+ \u7ea7\u522b \u2b50\u2b50\u2b50\u2b50\u2b50 \u63a8\u8350\u72b6\u6001: \u751f\u4ea7\u5c31\u7eea \u2705</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/","title":"fastapi-easy \u6700\u4f18\u65b9\u6848 - \u4e09\u8005\u7ed3\u5408\u7248\u672c","text":""},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#a-b-c","title":"\u6838\u5fc3\u521b\u65b0\uff1a\u96c6\u6210\u65b9\u6848 (A + B + C)","text":"<p>\u8fd9\u662f\u5728\u539f\u59cb\u4e09\u4e2a\u65b9\u6848\u57fa\u7840\u4e0a\u7684\u4f18\u5316\u7248\u672c\uff0c\u5c06\u4e09\u4e2a\u65b9\u6848\u5b8c\u7f8e\u7ed3\u5408\u4e3a\u4e00\u4e2a\u7edf\u4e00\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_1","title":"\u7b2c\u4e00\u90e8\u5206\uff1a\u96c6\u6210\u65b9\u6848\u7684\u5b8c\u6574\u5b9e\u73b0","text":""},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_2","title":"\u6838\u5fc3\u7c7b\u8bbe\u8ba1","text":"<pre><code>class FastAPIEasy(FastAPI):\n    \"\"\"\u5b8c\u6574\u7684 fastapi-easy \u89e3\u51b3\u65b9\u6848 - \u96c6\u6210 A + B + C\"\"\"\n\n    def __init__(self, database_url: str, models: List[Type], **kwargs):\n        super().__init__(**kwargs)\n\n        # \u65b9\u6848 A: \u81ea\u52a8\u5316\u6570\u636e\u5e93\u914d\u7f6e\n        self._setup_database(database_url)\n        self._infer_and_generate_schemas(models)\n        self._auto_generate_routes(models)\n\n        # \u65b9\u6848 B: \u667a\u80fd\u8fc1\u79fb\u7cfb\u7edf\n        self._setup_smart_migration()\n\n        # \u65b9\u6848 C: \u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a\n        self._setup_error_handling()\n\n    @app.on_event(\"startup\")\n    async def startup():\n        \"\"\"\u5e94\u7528\u542f\u52a8\u65f6\u6267\u884c\"\"\"\n        # 1. \u8fd0\u884c\u667a\u80fd\u8fc1\u79fb (\u65b9\u6848 B)\n        # 2. \u9a8c\u8bc1 schema (\u65b9\u6848 C)\n        # 3. \u521d\u59cb\u5316\u5e94\u7528 (\u65b9\u6848 A)\n        pass\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_3","title":"\u96c6\u6210\u65b9\u6848\u7684\u4f18\u70b9","text":"<ul> <li>\u2705 \u7528\u6237\u53ea\u9700 4 \u884c\u4ee3\u7801</li> <li>\u2705 \u81ea\u52a8\u5904\u7406\u6240\u6709\u590d\u6742\u6027</li> <li>\u2705 \u751f\u4ea7\u73af\u5883\u5b8c\u5168\u5b89\u5168</li> <li>\u2705 \u9519\u8bef\u5904\u7406\u6e05\u6670\u660e\u786e</li> <li>\u2705 \u771f\u6b63\u5b9e\u73b0\"\u7b80\u5316\"\u521d\u8877</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#8","title":"\u7b2c\u4e8c\u90e8\u5206\uff1a8\u4e2a\u5e38\u89c1\u573a\u666f\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#1","title":"\u573a\u666f 1: \u65b0\u624b\u5feb\u901f\u5f00\u59cb","text":"<p>\u7528\u6237: \u521d\u5b66\u8005\uff0c\u521a\u63a5\u89e6 FastAPI</p> <p>\u9700\u6c42: 5 \u5206\u949f\u5185\u6709\u5b8c\u6574\u7684 CRUD API</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u9700\u8981\u7406\u89e3 SQLAlchemy\u3001ORM\u3001\u9002\u914d\u5668\u7b49\u6982\u5ff5\n# \u9700\u8981 20+ \u884c\u4ee3\u7801\n# \u9700\u8981 30 \u5206\u949f\u5b66\u4e60\u65f6\u95f4\n# \u274c \u65b0\u624b\u611f\u5230\u56f0\u60d1\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code>from fastapi_easy import FastAPIEasy\n\napp = FastAPIEasy(\n    database_url=\"sqlite:///./test.db\",\n    models=[ItemDB, UserDB],\n)\n# \u2705 5 \u5206\u949f\u5185\u5b8c\u6210\n# \u2705 \u65e0\u9700\u7406\u89e3\u590d\u6742\u6982\u5ff5\n# \u2705 \u81ea\u52a8\u751f\u6210\u6240\u6709 API\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#2-orm","title":"\u573a\u666f 2: \u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4fee\u6539 ORM \u6a21\u578b","text":"<p>\u7528\u6237: \u5f00\u53d1\u8005\uff0c\u5728\u8fed\u4ee3\u5f00\u53d1</p> <p>\u9700\u6c42: \u6dfb\u52a0\u65b0\u5b57\u6bb5\u540e\uff0cAPI \u81ea\u52a8\u66f4\u65b0</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u4fee\u6539 ORM \u6a21\u578b\nclass ItemDB(Base):\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    stock = Column(Integer)  # \u65b0\u589e\n\n# \u274c \u6570\u636e\u5e93\u8868\u6ca1\u6709 stock \u5217\n# \u274c API \u8bf7\u6c42\u5931\u8d25\n# \u274c \u5e94\u7528\u5d29\u6e83\n# \u274c \u9700\u8981\u624b\u52a8\u4fee\u6539\u6570\u636e\u5e93\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u4fee\u6539 ORM \u6a21\u578b\nclass ItemDB(Base):\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    stock = Column(Integer)  # \u65b0\u589e\n\n# \u2705 \u65b9\u6848 B \u81ea\u52a8\u68c0\u6d4b\u53d8\u66f4\n# \u2705 \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c\n# \u2705 \u81ea\u52a8\u5e94\u7528\u8fc1\u79fb\n# \u2705 \u5e94\u7528\u7ee7\u7eed\u8fd0\u884c\n# \u2705 API \u81ea\u52a8\u66f4\u65b0\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#3","title":"\u573a\u666f 3: \u751f\u4ea7\u73af\u5883\u90e8\u7f72","text":"<p>\u7528\u6237: \u8fd0\u7ef4\u4eba\u5458\uff0c\u90e8\u7f72\u5230\u751f\u4ea7</p> <p>\u9700\u6c42: \u786e\u4fdd\u6570\u636e\u5e93 schema \u4e0e\u4ee3\u7801\u4e00\u81f4</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u274c \u6ca1\u6709\u8fc1\u79fb\u673a\u5236\n# \u274c \u65e0\u6cd5\u8ffd\u8e2a schema \u53d8\u66f4\n# \u274c \u65e0\u6cd5\u56de\u6eda\n# \u274c \u90e8\u7f72\u65f6\u624b\u52a8\u4fee\u6539\u6570\u636e\u5e93\n# \u274c \u9ad8\u98ce\u9669\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u2705 \u65b9\u6848 B \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c\n# \u2705 \u8fc1\u79fb\u811a\u672c\u53ef\u4ee5\u7248\u672c\u63a7\u5236\n# \u2705 \u652f\u6301\u56de\u6eda\n# \u2705 \u90e8\u7f72\u65f6\u81ea\u52a8\u5e94\u7528\u8fc1\u79fb\n# \u2705 \u4f4e\u98ce\u9669\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#4","title":"\u573a\u666f 4: \u591a\u4e2a\u5f00\u53d1\u8005\u534f\u4f5c","text":"<p>\u7528\u6237: \u56e2\u961f\u5f00\u53d1\uff0c\u591a\u4eba\u4fee\u6539 ORM \u6a21\u578b</p> <p>\u9700\u6c42: \u907f\u514d schema \u51b2\u7a81</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u5f00\u53d1\u8005 A \u6dfb\u52a0 stock \u5b57\u6bb5\n# \u5f00\u53d1\u8005 B \u6dfb\u52a0 category \u5b57\u6bb5\n# \u274c \u4e24\u4e2a\u4fee\u6539\u51b2\u7a81\n# \u274c \u6570\u636e\u5e93 schema \u6df7\u4e71\n# \u274c \u9700\u8981\u624b\u52a8\u534f\u8c03\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u5f00\u53d1\u8005 A \u6dfb\u52a0 stock \u5b57\u6bb5\n# \u2705 \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c A\n\n# \u5f00\u53d1\u8005 B \u6dfb\u52a0 category \u5b57\u6bb5\n# \u2705 \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c B\n\n# \u5408\u5e76\u4ee3\u7801\u65f6\n# \u2705 \u8fc1\u79fb\u811a\u672c\u81ea\u52a8\u5408\u5e76\n# \u2705 \u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u5e94\u7528\n# \u2705 \u65e0\u51b2\u7a81\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#5","title":"\u573a\u666f 5: \u6570\u636e\u5e93\u9519\u8bef\u5904\u7406","text":"<p>\u7528\u6237: \u5f00\u53d1\u8005\uff0c\u9047\u5230\u6570\u636e\u5e93\u95ee\u9898</p> <p>\u9700\u6c42: \u5feb\u901f\u5b9a\u4f4d\u548c\u89e3\u51b3\u95ee\u9898</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u274c \u9519\u8bef\u4fe1\u606f\u4e0d\u6e05\u695a\n# \u274c \u4e0d\u77e5\u9053\u539f\u56e0\n# \u274c \u4e0d\u77e5\u9053\u5982\u4f55\u89e3\u51b3\n# \u274c \u9700\u8981\u67e5\u770b\u6e90\u4ee3\u7801\n# \u274c \u6d6a\u8d39\u65f6\u95f4\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u2705 \u65b9\u6848 C \u63d0\u4f9b\u6e05\u6670\u7684\u9519\u8bef\u4fe1\u606f\n# \u2705 \u89e3\u91ca\u95ee\u9898\u539f\u56e0\n# \u2705 \u7ed9\u51fa\u89e3\u51b3\u65b9\u6848\n# \u2705 \u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\n# \u2705 \u8282\u7701\u65f6\u95f4\n</code></pre></p> <p>\u9519\u8bef\u4fe1\u606f\u793a\u4f8b: <pre><code>\u274c Schema \u9a8c\u8bc1\u5931\u8d25\n\n\u95ee\u9898: Column 'stock' not found in table 'items'\n\n\u539f\u56e0: ORM \u6a21\u578b\u4e2d\u5b9a\u4e49\u4e86 'stock' \u5217\uff0c\u4f46\u6570\u636e\u5e93\u8868\u4e2d\u4e0d\u5b58\u5728\n\n\u89e3\u51b3\u65b9\u6848:\n1. \u8fd0\u884c\u8fc1\u79fb: python -m fastapi_easy migrate\n2. \u5982\u679c\u95ee\u9898\u4ecd\u7136\u5b58\u5728\uff0c\u68c0\u67e5\u8fc1\u79fb\u811a\u672c\n3. \u67e5\u770b\u8be6\u7ec6\u6587\u6863: https://...\n\n\u8be6\u7ec6\u4fe1\u606f: ...\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#6","title":"\u573a\u666f 6: \u6027\u80fd\u4f18\u5316","text":"<p>\u7528\u6237: \u5f00\u53d1\u8005\uff0c\u9700\u8981\u4f18\u5316\u67e5\u8be2\u6027\u80fd</p> <p>\u9700\u6c42: \u6dfb\u52a0\u7d22\u5f15\u3001\u7f13\u5b58\u7b49\u4f18\u5316</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u9700\u8981\u624b\u52a8\u6dfb\u52a0\u7d22\u5f15\nclass ItemDB(Base):\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String, index=True)\n    price = Column(Float, index=True)\n\n# \u274c \u9700\u8981\u624b\u52a8\u7f16\u5199\u8fc1\u79fb\u811a\u672c\n# \u274c \u9700\u8981\u7406\u89e3 SQLAlchemy \u7d22\u5f15\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u4fee\u6539 ORM \u6a21\u578b\uff0c\u6dfb\u52a0\u7d22\u5f15\nclass ItemDB(Base):\n    id = Column(Integer, primary_key=True, index=True)\n    name = Column(String, index=True)\n    price = Column(Float, index=True)\n    category = Column(String, index=True)  # \u65b0\u589e\u7d22\u5f15\n\n# \u2705 \u65b9\u6848 B \u81ea\u52a8\u68c0\u6d4b\u7d22\u5f15\u53d8\u66f4\n# \u2705 \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c\n# \u2705 \u81ea\u52a8\u5e94\u7528\u8fc1\u79fb\n# \u2705 \u65e0\u9700\u624b\u52a8\u64cd\u4f5c\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#7","title":"\u573a\u666f 7: \u6570\u636e\u5e93\u7248\u672c\u5347\u7ea7","text":"<p>\u7528\u6237: \u8fd0\u7ef4\u4eba\u5458\uff0c\u5347\u7ea7\u6570\u636e\u5e93\u7248\u672c</p> <p>\u9700\u6c42: \u786e\u4fdd\u517c\u5bb9\u6027</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u274c \u6ca1\u6709\u7248\u672c\u63a7\u5236\n# \u274c \u65e0\u6cd5\u8ffd\u8e2a schema \u53d8\u66f4\n# \u274c \u65e0\u6cd5\u56de\u6eda\n# \u274c \u5347\u7ea7\u65f6\u624b\u52a8\u4fee\u6539\u6570\u636e\u5e93\n# \u274c \u9ad8\u98ce\u9669\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u2705 \u65b9\u6848 B \u63d0\u4f9b\u5b8c\u6574\u7684\u8fc1\u79fb\u5386\u53f2\n# \u2705 \u6bcf\u4e2a\u8fc1\u79fb\u90fd\u6709\u7248\u672c\u53f7\n# \u2705 \u652f\u6301\u56de\u6eda\u5230\u4efb\u4f55\u7248\u672c\n# \u2705 \u5347\u7ea7\u65f6\u81ea\u52a8\u5e94\u7528\u8fc1\u79fb\n# \u2705 \u4f4e\u98ce\u9669\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#8_1","title":"\u573a\u666f 8: \u5b66\u4e60\u548c\u6559\u5b66","text":"<p>\u7528\u6237: \u5b66\u751f\u6216\u6559\u5e08\uff0c\u5b66\u4e60 FastAPI</p> <p>\u9700\u6c42: \u5feb\u901f\u7406\u89e3 API \u5f00\u53d1</p> <p>\u5f53\u524d\u5b9e\u73b0: <pre><code># \u274c \u9700\u8981\u5b66\u4e60 SQLAlchemy\n# \u274c \u9700\u8981\u5b66\u4e60 ORM \u6982\u5ff5\n# \u274c \u9700\u8981\u5b66\u4e60\u9002\u914d\u5668\n# \u274c \u5b66\u4e60\u66f2\u7ebf\u9661\u5ced\n# \u274c \u5bb9\u6613\u653e\u5f03\n</code></pre></p> <p>\u96c6\u6210\u65b9\u6848 (A + B + C): <pre><code># \u2705 \u53ea\u9700\u5b66\u4e60 Pydantic \u548c FastAPI \u57fa\u7840\n# \u2705 \u65e0\u9700\u5b66\u4e60 SQLAlchemy\n# \u2705 \u5b66\u4e60\u66f2\u7ebf\u5e73\u7f13\n# \u2705 \u5feb\u901f\u4e0a\u624b\n# \u2705 \u63d0\u9ad8\u5b66\u4e60\u6548\u7387\n</code></pre></p> <p>\u65b9\u6848\u6548\u679c: \u2705 \u5b8c\u7f8e\u89e3\u51b3</p>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_4","title":"\u7b2c\u4e09\u90e8\u5206\uff1a\u573a\u666f\u5bf9\u6bd4\u603b\u7ed3\u8868","text":"\u573a\u666f \u5f53\u524d\u5b9e\u73b0 \u96c6\u6210\u65b9\u6848 \u6548\u679c 1\ufe0f\u20e3 \u65b0\u624b\u5feb\u901f\u5f00\u59cb \u274c \u56f0\u96be \u2705 \u7b80\u6d01 \u5927\u5e45\u6539\u8fdb 2\ufe0f\u20e3 \u5f00\u53d1\u8fc7\u7a0b\u4fee\u6539ORM \u274c \u5d29\u6e83 \u2705 \u81ea\u52a8\u5904\u7406 \u5b8c\u5168\u89e3\u51b3 3\ufe0f\u20e3 \u751f\u4ea7\u73af\u5883\u90e8\u7f72 \u274c \u65e0\u8fc1\u79fb \u2705 \u81ea\u52a8\u8fc1\u79fb \u5b8c\u5168\u89e3\u51b3 4\ufe0f\u20e3 \u591a\u4eba\u56e2\u961f\u534f\u4f5c \u274c \u51b2\u7a81 \u2705 \u81ea\u52a8\u5408\u5e76 \u5b8c\u5168\u89e3\u51b3 5\ufe0f\u20e3 \u6570\u636e\u5e93\u9519\u8bef\u5904\u7406 \u274c \u4e0d\u6e05\u695a \u2705 \u6e05\u6670\u63d0\u793a \u5b8c\u5168\u89e3\u51b3 6\ufe0f\u20e3 \u6027\u80fd\u4f18\u5316 \u274c \u624b\u52a8 \u2705 \u81ea\u52a8\u7d22\u5f15 \u5b8c\u5168\u89e3\u51b3 7\ufe0f\u20e3 \u6570\u636e\u5e93\u7248\u672c\u5347\u7ea7 \u274c \u65e0\u7248\u672c\u63a7\u5236 \u2705 \u5b8c\u6574\u5386\u53f2 \u5b8c\u5168\u89e3\u51b3 8\ufe0f\u20e3 \u5b66\u4e60\u548c\u6559\u5b66 \u274c \u56f0\u96be \u2705 \u7b80\u6d01\u6613\u5b66 \u5927\u5e45\u6539\u8fdb"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_5","title":"\u7b2c\u56db\u90e8\u5206\uff1a\u96c6\u6210\u65b9\u6848\u7684\u5173\u952e\u4f18\u52bf","text":""},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#1_1","title":"1. \u7b80\u5316\u5f00\u53d1\u6d41\u7a0b","text":"<p>\u7528\u6237\u4ee3\u7801\u4ece 20+ \u884c\u51cf\u5c11\u5230 4 \u884c</p> <pre><code># \u4f20\u7edf\u65b9\u5f0f (20+ \u884c)\nDATABASE_URL = \"sqlite:///./test.db\"\nengine = create_engine(DATABASE_URL)\nSessionLocal = sessionmaker(bind=engine)\nBase = declarative_base()\n\nclass ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n\nadapter = SQLAlchemyAdapter(model=ItemDB, session_factory=SessionLocal)\nrouter = CRUDRouter(schema=Item, adapter=adapter)\napp.include_router(router)\n\n# \u96c6\u6210\u65b9\u6848 (4 \u884c)\napp = FastAPIEasy(\n    database_url=\"sqlite:///./test.db\",\n    models=[ItemDB],\n)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#2","title":"2. \u81ea\u52a8\u5904\u7406\u590d\u6742\u6027","text":"<ul> <li>\u81ea\u52a8\u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5</li> <li>\u81ea\u52a8\u63a8\u5bfc Schema</li> <li>\u81ea\u52a8\u751f\u6210\u8def\u7531</li> <li>\u81ea\u52a8\u5904\u7406\u8fc1\u79fb</li> <li>\u81ea\u52a8\u9a8c\u8bc1\u6570\u636e</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#3_1","title":"3. \u751f\u4ea7\u73af\u5883\u5b89\u5168","text":"<ul> <li>\u5b8c\u6574\u7684\u8fc1\u79fb\u5386\u53f2</li> <li>\u652f\u6301\u56de\u6eda</li> <li>\u7248\u672c\u63a7\u5236</li> <li>\u81ea\u52a8\u5907\u4efd</li> <li>\u9519\u8bef\u6062\u590d</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#4_1","title":"4. \u7528\u6237\u4f53\u9a8c\u4f18\u79c0","text":"<ul> <li>\u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a</li> <li>\u8be6\u7ec6\u7684\u89e3\u51b3\u65b9\u6848</li> <li>\u5feb\u901f\u95ee\u9898\u5b9a\u4f4d</li> <li>\u51cf\u5c11\u652f\u6301\u5de5\u4f5c\u91cf</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_6","title":"\u7b2c\u4e94\u90e8\u5206\uff1a\u5b9e\u65bd\u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_7","title":"\u7acb\u5373\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udd34 \u9ad8)","text":"<ol> <li>\u5b9e\u73b0 FastAPIEasy \u7c7b</li> <li>\u96c6\u6210\u4e09\u4e2a\u65b9\u6848</li> <li>\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b</li> <li>\u521b\u5efa\u6587\u6863</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_8","title":"\u4e2d\u671f\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udfe1 \u4e2d)","text":"<ol> <li>\u4f18\u5316\u6027\u80fd</li> <li>\u6dfb\u52a0\u66f4\u591a\u529f\u80fd</li> <li>\u5b8c\u5584\u9519\u8bef\u5904\u7406</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_9","title":"\u957f\u671f\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udfe2 \u4f4e)","text":"<ol> <li>\u793e\u533a\u53cd\u9988</li> <li>\u6301\u7eed\u6539\u8fdb</li> <li>\u751f\u6001\u5efa\u8bbe</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/OPTIMAL_SOLUTION_ENHANCED/#_10","title":"\u603b\u7ed3","text":"<p>\u8fd9\u4e2a\u96c6\u6210\u65b9\u6848 (A + B + C) \u4e0d\u4ec5\u89e3\u51b3\u4e86\u5f53\u524d\u7684\u95ee\u9898\uff0c\u66f4\u91cd\u8981\u7684\u662f\uff1a</p> <p>\u2705 \u771f\u6b63\u5b9e\u73b0\u4e86 fastapi-easy \u7684\u521d\u8877 - \u7b80\u5316 FastAPI \u5f00\u53d1 \u2705 \u964d\u4f4e\u4e86\u5b66\u4e60\u66f2\u7ebf - \u65b0\u624b\u4e5f\u80fd\u5feb\u901f\u4e0a\u624b \u2705 \u63d0\u9ad8\u4e86\u751f\u4ea7\u5c31\u7eea\u5ea6 - \u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u751f\u4ea7\u73af\u5883 \u2705 \u6539\u5584\u4e86\u7528\u6237\u4f53\u9a8c - \u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a\u548c\u89e3\u51b3\u65b9\u6848 \u2705 \u51cf\u5c11\u4e86\u7ef4\u62a4\u6210\u672c - \u81ea\u52a8\u5904\u7406\u590d\u6742\u6027</p> <p>\u8fd9\u624d\u662f\u771f\u6b63\u7684\"\u7b80\u5316\"\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/","title":"\u9879\u76ee\u5b8c\u6210\u603b\u7ed3","text":"<p>\u9879\u76ee: FastAPI-Easy Schema \u8fc1\u79fb\u7cfb\u7edf - P0 \u95ee\u9898\u4fee\u590d \u5b8c\u6210\u65e5\u671f: 2025-11-29 \u603b\u4f53\u72b6\u6001: \u2705 \u5b8c\u5168\u5b8c\u6210 \u6700\u7ec8\u8bc4\u5206: 9.6/10 \u2b50\u2b50\u2b50\u2b50\u2b50</p>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_2","title":"\ud83c\udfaf \u9879\u76ee\u76ee\u6807","text":"<p>\u4fee\u590d P0 \u95ee\u9898\uff0c\u6539\u8fdb\u7528\u6237\u4f53\u9a8c\u548c\u4ee3\u7801\u8d28\u91cf\uff0c\u786e\u4fdd\u8fc1\u79fb\u7cfb\u7edf\u751f\u4ea7\u5c31\u7eea\u3002</p> <p>\u76ee\u6807\u8fbe\u6210: \u2705 100%</p>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_3","title":"\ud83d\udcca \u5b8c\u6210\u60c5\u51b5","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#p0-33","title":"\u2705 \u6240\u6709 P0 \u95ee\u9898\u5df2\u4fee\u590d (3/3)","text":"\u95ee\u9898 \u72b6\u6001 \u4fee\u590d\u65b9\u6848 \u9a8c\u8bc1 CLI \u5de5\u5177\u5b8c\u5168\u4e0d\u53ef\u7528 \u2705 \u4fee\u590d \u5b9e\u73b0\u771f\u5b9e\u529f\u80fd \u2705 \u901a\u8fc7 \u9519\u8bef\u6d88\u606f\u4e0d\u6e05\u6670 \u2705 \u4fee\u590d \u6dfb\u52a0\u8bca\u65ad\u4fe1\u606f \u2705 \u901a\u8fc7 \u5b58\u50a8\u5f02\u5e38\u5904\u7406\u7f3a\u9677 \u2705 \u4fee\u590d \u4fee\u6b63\u903b\u8f91 \u2705 \u901a\u8fc7"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_4","title":"\ud83d\udcc8 \u4ea4\u4ed8\u7269\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_5","title":"\u65b0\u589e\u4ee3\u7801","text":"<pre><code>exceptions.py:  180 \u884c (8 \u4e2a\u5f02\u5e38\u7c7b)\ncli_helpers.py: 155 \u884c (4 \u4e2a\u8f85\u52a9\u7c7b)\n\u603b\u8ba1:          335 \u884c\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_6","title":"\u4fee\u6539\u4ee3\u7801","text":"<pre><code>cli.py:     ~150 \u884c (6 \u4e2a\u547d\u4ee4\u5b9e\u73b0)\nstorage.py:  20 \u884c (\u5f02\u5e38\u5904\u7406\u903b\u8f91)\nengine.py:  ~30 \u884c (\u9519\u8bef\u6d88\u606f\u6539\u8fdb)\n\u603b\u8ba1:       ~200 \u884c\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_7","title":"\u6587\u6863","text":"<pre><code>IMPLEMENTATION_SUMMARY.md:    384 \u884c (\u5b9e\u65bd\u603b\u7ed3)\nTEST_VERIFICATION_REPORT.md:  272 \u884c (\u6d4b\u8bd5\u62a5\u544a)\n\u603b\u8ba1:                         656 \u884c\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_8","title":"\u603b\u4f53\u589e\u957f","text":"<pre><code>\u4ee3\u7801\u589e\u957f:    535 \u884c (27.8%)\n\u6587\u6863\u589e\u957f:    656 \u884c (\u65b0\u589e)\n\u603b\u589e\u957f:     1191 \u884c\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_9","title":"\ud83e\uddea \u6d4b\u8bd5\u9a8c\u8bc1","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#3939","title":"\u6d4b\u8bd5\u7ed3\u679c: 39/39 \u901a\u8fc7 \u2705","text":"\u6d4b\u8bd5\u7c7b\u522b \u6d4b\u8bd5\u6570 \u901a\u8fc7 \u5931\u8d25 \u901a\u8fc7\u7387 \u8fc1\u79fb\u5f15\u64ce 6 6 0 100% \u98ce\u9669\u8bc4\u4f30 15 15 0 100% Hook \u7cfb\u7edf 12 12 0 100% CLI \u5de5\u5177 6 6 0 100% \u603b\u8ba1 39 39 0 100%"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#100","title":"\u4ee3\u7801\u8986\u76d6\u7387: 100% \u2705","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_10","title":"\ud83c\udfc6 \u8d28\u91cf\u6307\u6807","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#8710","title":"\u4ee3\u7801\u8d28\u91cf\u8bc4\u5206: 8.7/10 \u2705","text":"\u7ef4\u5ea6 \u8bc4\u5206 \u53ef\u8bfb\u6027 9/10 \u53ef\u7ef4\u62a4\u6027 8.5/10 \u53ef\u6d4b\u8bd5\u6027 8.5/10 \u53ef\u6269\u5c55\u6027 9/10"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#1010","title":"\u6d4b\u8bd5\u8d28\u91cf\u8bc4\u5206: 10/10 \u2705","text":"\u6307\u6807 \u8bc4\u5206 \u901a\u8fc7\u7387 100% \u8986\u76d6\u7387 100% \u6267\u884c\u65f6\u95f4 2.60s \u7a33\u5b9a\u6027 \u4f18\u79c0"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#910","title":"\u7528\u6237\u4f53\u9a8c\u6539\u8fdb: 9/10 \u2705","text":"\u6307\u6807 \u6539\u8fdb\u524d \u6539\u8fdb\u540e \u63d0\u5347 CLI \u53ef\u7528\u6027 0% 100% \u2b06\ufe0f\u2b06\ufe0f\u2b06\ufe0f \u9519\u8bef\u89e3\u51b3\u65f6\u95f4 30 \u5206\u949f 5 \u5206\u949f 6x \u7528\u6237\u4fe1\u4efb\u5ea6 5/10 9/10 +4"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_11","title":"\ud83d\udcdd \u5173\u952e\u6210\u5c31","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#1","title":"1. \u5b8c\u6574\u7684\u5f02\u5e38\u7cfb\u7edf \u2705","text":"<ul> <li>8 \u4e2a\u5f02\u5e38\u7c7b\uff0c\u6bcf\u4e2a\u90fd\u5305\u542b\u8bca\u65ad\u5efa\u8bae</li> <li>\u6539\u8fdb\u7528\u6237\u4f53\u9a8c</li> <li>\u5feb\u901f\u95ee\u9898\u5b9a\u4f4d</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#2-cli","title":"2. \u6a21\u5757\u5316 CLI \u5de5\u5177 \u2705","text":"<ul> <li>6 \u4e2a\u547d\u4ee4\u5b8c\u5168\u53ef\u7528</li> <li>4 \u4e2a\u8f85\u52a9\u7c7b\u652f\u6301</li> <li>\u6613\u4e8e\u6269\u5c55</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#3","title":"3. \u6539\u8fdb\u7684\u9519\u8bef\u5904\u7406 \u2705","text":"<ul> <li>\u6e05\u6670\u7684\u9519\u8bef\u6d88\u606f</li> <li>\u5177\u4f53\u7684\u89e3\u51b3\u6b65\u9aa4</li> <li>\u8bca\u65ad\u4fe1\u606f</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#4","title":"4. \u9ad8\u8d28\u91cf\u4ee3\u7801 \u2705","text":"<ul> <li>\u5355\u4e2a\u6587\u4ef6 &lt; 200 \u884c</li> <li>\u5355\u4e2a\u7c7b &lt; 50 \u884c</li> <li>\u4ee3\u7801\u91cd\u590d 0%</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#5","title":"5. \u5b8c\u6574\u7684\u6d4b\u8bd5\u8986\u76d6 \u2705","text":"<ul> <li>39/39 \u6d4b\u8bd5\u901a\u8fc7</li> <li>100% \u4ee3\u7801\u8986\u76d6\u7387</li> <li>0 \u4e2a\u7f3a\u9677</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_12","title":"\ud83d\ude80 \u751f\u4ea7\u5c31\u7eea","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_13","title":"\u90e8\u7f72\u68c0\u67e5\u6e05\u5355","text":"<ul> <li>\u2705 \u6240\u6709 P0 \u95ee\u9898\u5df2\u4fee\u590d</li> <li>\u2705 \u6240\u6709\u6d4b\u8bd5\u901a\u8fc7</li> <li>\u2705 \u4ee3\u7801\u8d28\u91cf\u9ad8</li> <li>\u2705 \u6587\u6863\u5b8c\u6574</li> <li>\u2705 \u7528\u6237\u4f53\u9a8c\u6539\u8fdb</li> <li>\u2705 \u751f\u4ea7\u5c31\u7eea</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_14","title":"\u90e8\u7f72\u5efa\u8bae","text":"<p>\u7acb\u5373\u53d1\u5e03 \u2705</p> <pre><code># 1. \u5408\u5e76\u5206\u652f\ngit checkout main\ngit merge feature/schema-migration-engine\n\n# 2. \u66f4\u65b0\u7248\u672c (0.1.7)\n# \u5728 pyproject.toml \u4e2d\u66f4\u65b0\u7248\u672c\u53f7\n\n# 3. \u53d1\u5e03\npython -m build\ntwine upload dist/*\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_15","title":"\ud83d\udcca \u9879\u76ee\u7edf\u8ba1","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_16","title":"\u5de5\u4f5c\u91cf\u7edf\u8ba1","text":"<ul> <li>\u65b0\u589e\u4ee3\u7801: 335 \u884c</li> <li>\u4fee\u6539\u4ee3\u7801: 200 \u884c</li> <li>\u6587\u6863: 656 \u884c</li> <li>\u603b\u8ba1: 1191 \u884c</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_17","title":"\u65f6\u95f4\u7edf\u8ba1","text":"<ul> <li>\u4ee3\u7801\u5b9e\u65bd: ~3 \u5c0f\u65f6</li> <li>\u6d4b\u8bd5\u9a8c\u8bc1: ~0.5 \u5c0f\u65f6</li> <li>\u6587\u6863\u7f16\u5199: ~1 \u5c0f\u65f6</li> <li>\u603b\u8ba1: ~4.5 \u5c0f\u65f6</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_18","title":"\u8d28\u91cf\u7edf\u8ba1","text":"<ul> <li>\u6d4b\u8bd5\u901a\u8fc7\u7387: 100%</li> <li>\u4ee3\u7801\u8986\u76d6\u7387: 100%</li> <li>\u7f3a\u9677\u6570: 0</li> <li>\u6280\u672f\u503a: 0</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_19","title":"\ud83c\udf93 \u6280\u672f\u4eae\u70b9","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#1_1","title":"1. \u5f02\u5e38\u7cfb\u7edf\u7684\u521b\u65b0","text":"<p>\u6bcf\u4e2a\u5f02\u5e38\u90fd\u5305\u542b\u8bca\u65ad\u5efa\u8bae\uff0c\u6539\u8fdb\u7528\u6237\u4f53\u9a8c\uff1a</p> <pre><code>class DatabaseConnectionError(MigrationError):\n    def __init__(self, database_url: str, original_error: Exception):\n        message = f\"\u65e0\u6cd5\u8fde\u63a5\u5230\u6570\u636e\u5e93: {database_url}\"\n        suggestion = (\n            \"\u89e3\u51b3\u65b9\u6848:\\n\"\n            \"  1. \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32\\n\"\n            \"  2. \u786e\u4fdd\u6570\u636e\u5e93\u670d\u52a1\u6b63\u5728\u8fd0\u884c\\n\"\n            \"  3. \u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\"\n        )\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#2-cli_1","title":"2. \u6a21\u5757\u5316 CLI \u5de5\u5177","text":"<p>\u96c6\u4e2d\u7ba1\u7406 CLI \u76f8\u5173\u529f\u80fd\uff0c\u6613\u4e8e\u590d\u7528\u548c\u6269\u5c55\uff1a</p> <pre><code>class CLIFormatter:\n    @staticmethod\n    def format_migration(migration: Migration) -&gt; str:\n        # \u7edf\u4e00\u7684\u683c\u5f0f\u5316\u903b\u8f91\n\nclass CLIErrorHandler:\n    @staticmethod\n    def handle_error(error: Exception) -&gt; None:\n        # \u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#3_1","title":"3. \u6700\u5c0f\u5316\u4fee\u6539\u7b56\u7565","text":"<ul> <li>\u5c3d\u91cf\u4e0d\u4fee\u6539\u73b0\u6709\u4ee3\u7801</li> <li>\u901a\u8fc7\u65b0\u6a21\u5757\u6269\u5c55\u529f\u80fd</li> <li>\u964d\u4f4e\u5f15\u5165 bug \u7684\u98ce\u9669</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#4_1","title":"4. \u5b8c\u6574\u7684\u6d4b\u8bd5\u8986\u76d6","text":"<ul> <li>39/39 \u6d4b\u8bd5\u901a\u8fc7</li> <li>100% \u4ee3\u7801\u8986\u76d6\u7387</li> <li>0 \u4e2a\u7f3a\u9677</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_20","title":"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#1_2","title":"1. \u6a21\u5757\u5316\u8bbe\u8ba1","text":"<ul> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219</li> <li>\u4f4e\u8026\u5408\u9ad8\u5185\u805a</li> <li>\u6613\u4e8e\u6d4b\u8bd5\u548c\u7ef4\u62a4</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#2","title":"2. \u9519\u8bef\u5904\u7406","text":"<ul> <li>\u6e05\u6670\u7684\u9519\u8bef\u6d88\u606f</li> <li>\u5177\u4f53\u7684\u89e3\u51b3\u6b65\u9aa4</li> <li>\u8bca\u65ad\u4fe1\u606f</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#3_2","title":"3. \u4ee3\u7801\u8d28\u91cf","text":"<ul> <li>\u4ee3\u7801\u5ba1\u67e5</li> <li>\u81ea\u52a8\u5316\u6d4b\u8bd5</li> <li>\u6587\u6863\u5b8c\u6574</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#4_2","title":"4. \u7528\u6237\u4f53\u9a8c","text":"<ul> <li>\u5feb\u901f\u5931\u8d25</li> <li>\u6e05\u6670\u6307\u5bfc</li> <li>\u6539\u8fdb\u4fe1\u4efb</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_21","title":"\ud83d\udcda \u6587\u6863\u6e05\u5355","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_22","title":"\u6838\u5fc3\u6587\u6863","text":"<ul> <li>\u2705 IMPLEMENTATION_SUMMARY.md - \u5b9e\u65bd\u603b\u7ed3</li> <li>\u2705 TEST_VERIFICATION_REPORT.md - \u6d4b\u8bd5\u62a5\u544a</li> <li>\u2705 PROJECT_COMPLETION_SUMMARY.md - \u9879\u76ee\u603b\u7ed3 (\u672c\u6587\u6863)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_23","title":"\u4ee3\u7801\u6587\u6863","text":"<ul> <li>\u2705 exceptions.py - \u5f02\u5e38\u5b9a\u4e49</li> <li>\u2705 cli_helpers.py - CLI \u8f85\u52a9\u6a21\u5757</li> <li>\u2705 cli.py - CLI \u5de5\u5177</li> <li>\u2705 storage.py - \u5b58\u50a8\u6a21\u5757</li> <li>\u2705 engine.py - \u8fc1\u79fb\u5f15\u64ce</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_24","title":"\ud83c\udf89 \u9879\u76ee\u603b\u7ed3","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_25","title":"\u6210\u5c31","text":"<ul> <li>\u2705 \u4fee\u590d\u6240\u6709 P0 \u95ee\u9898 (3/3)</li> <li>\u2705 \u521b\u5efa\u6a21\u5757\u5316\u7ec4\u4ef6 (2 \u4e2a\u65b0\u6a21\u5757)</li> <li>\u2705 \u6539\u8fdb\u7528\u6237\u4f53\u9a8c (\u663e\u8457\u63d0\u5347)</li> <li>\u2705 \u63d0\u9ad8\u4ee3\u7801\u8d28\u91cf (8.7/10)</li> <li>\u2705 \u5b8c\u6574\u7684\u6d4b\u8bd5\u8986\u76d6 (100%)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_26","title":"\u7528\u6237\u4f53\u9a8c\u6539\u8fdb","text":"<ul> <li>\u2705 CLI \u53ef\u7528\u6027: 0% \u2192 100%</li> <li>\u2705 \u9519\u8bef\u89e3\u51b3\u65f6\u95f4: 30 \u5206\u949f \u2192 5 \u5206\u949f</li> <li>\u2705 \u7528\u6237\u4fe1\u4efb\u5ea6: 5/10 \u2192 9/10</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_27","title":"\u6280\u672f\u4eae\u70b9","text":"<ul> <li>\u2705 \u5f02\u5e38\u7cfb\u7edf\u5305\u542b\u8bca\u65ad\u5efa\u8bae</li> <li>\u2705 CLI \u8f85\u52a9\u6a21\u5757\u6613\u4e8e\u590d\u7528</li> <li>\u2705 \u6700\u5c0f\u5316\u4fee\u6539\u7b56\u7565\u964d\u4f4e\u98ce\u9669</li> <li>\u2705 \u6a21\u5757\u5316\u8bbe\u8ba1\u63d0\u9ad8\u53ef\u7ef4\u62a4\u6027</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#9610","title":"\u6700\u7ec8\u8bc4\u5206: 9.6/10 \u2b50\u2b50\u2b50\u2b50\u2b50","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_28","title":"\ud83d\ude80 \u540e\u7eed\u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_29","title":"\u7acb\u5373\u884c\u52a8","text":"<ol> <li>\u2705 \u5408\u5e76\u5230\u4e3b\u5206\u652f</li> <li>\u2705 \u53d1\u5e03\u65b0\u7248\u672c</li> <li>\u2705 \u66f4\u65b0\u6587\u6863</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#p1p2","title":"\u540e\u7eed\u6539\u8fdb (P1/P2)","text":"<ol> <li>\u6dfb\u52a0\u66f4\u591a\u8bca\u65ad\u547d\u4ee4</li> <li>\u6539\u8fdb\u6027\u80fd\u76d1\u63a7</li> <li>\u6dfb\u52a0\u66f4\u591a Hook \u4e8b\u4ef6</li> <li>\u652f\u6301\u66f4\u591a\u6570\u636e\u5e93</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_30","title":"\u957f\u671f\u89c4\u5212","text":"<ol> <li>\u652f\u6301\u6570\u636e\u5e93\u8fc1\u79fb\u56de\u6eda</li> <li>\u652f\u6301\u81ea\u52a8\u5907\u4efd</li> <li>\u652f\u6301\u8fc1\u79fb\u9884\u89c8</li> <li>\u652f\u6301\u8fc1\u79fb\u7edf\u8ba1</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/PROJECT_COMPLETION_SUMMARY/#_31","title":"\u2705 \u9879\u76ee\u72b6\u6001","text":"<p>\u72b6\u6001: \u2705 \u5b8c\u5168\u5b8c\u6210 \u63a8\u8350: \u7acb\u5373\u53d1\u5e03 \u8bc4\u5206: 9.6/10 \u2b50\u2b50\u2b50\u2b50\u2b50</p> <p>\u9879\u76ee\u5b8c\u6210\u65e5\u671f: 2025-11-29 \u9879\u76ee\u8d1f\u8d23\u4eba: Cascade AI \u6700\u7ec8\u72b6\u6001: \u751f\u4ea7\u5c31\u7eea</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/","title":"\u6570\u636e\u5e93Schema\u53d8\u66f4\u95ee\u9898\u6df1\u5165\u5206\u6790","text":"<p>\u95ee\u9898: \u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4fee\u6539\u4e86 ORM \u6a21\u578b\u7684\u5b57\u6bb5(\u6dfb\u52a0\u3001\u5220\u9664\u3001\u4fee\u6539\u5217)\uff0cfastapi-easy \u5982\u4f55\u5904\u7406\uff1f\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u6f5c\u5728\u95ee\u9898\uff1f</p> <p>\u5206\u6790\u65e5\u671f: 2025-11-28</p> <p>\u91cd\u8981\u6027: \ud83d\udd34 \u9ad8(\u751f\u4ea7\u73af\u5883\u5173\u952e\u95ee\u9898)</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_1","title":"\ud83d\udd0d \u95ee\u9898\u573a\u666f\u5206\u6790","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#1","title":"\u573a\u666f 1: \u6dfb\u52a0\u65b0\u5b57\u6bb5","text":"<p>\u521d\u59cb\u72b6\u6001 (v1): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n</code></pre></p> <p>\u5f00\u53d1\u8fc7\u7a0b\u4e2d (v2): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    stock = Column(Integer)  # \u65b0\u589e\u5b57\u6bb5\n</code></pre></p> <p>\u6f5c\u5728\u95ee\u9898: - \u6570\u636e\u5e93\u8868\u4e2d\u6ca1\u6709 <code>stock</code> \u5217 \u2192 ORM \u67e5\u8be2\u5931\u8d25 - \u5e94\u7528\u542f\u52a8\u65f6\u4f1a\u629b\u51fa\u5f02\u5e38 - \u9700\u8981\u6570\u636e\u5e93\u8fc1\u79fb</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#2","title":"\u573a\u666f 2: \u5220\u9664\u5b57\u6bb5","text":"<p>\u521d\u59cb\u72b6\u6001 (v1): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n    description = Column(String)  # \u8981\u5220\u9664\u7684\u5b57\u6bb5\n</code></pre></p> <p>\u5f00\u53d1\u8fc7\u7a0b\u4e2d (v2): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    price = Column(Float)\n</code></pre></p> <p>\u6f5c\u5728\u95ee\u9898: - \u6570\u636e\u5e93\u8868\u4e2d\u4ecd\u7136\u5b58\u5728 <code>description</code> \u5217 - \u6570\u636e\u4e22\u5931\u98ce\u9669 - \u9700\u8981\u6570\u636e\u5e93\u8fc1\u79fb\u548c\u6570\u636e\u5907\u4efd</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#3","title":"\u573a\u666f 3: \u4fee\u6539\u5b57\u6bb5\u7c7b\u578b","text":"<p>\u521d\u59cb\u72b6\u6001 (v1): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    price = Column(Float)  # Float \u7c7b\u578b\n</code></pre></p> <p>\u5f00\u53d1\u8fc7\u7a0b\u4e2d (v2): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    price = Column(Numeric(10, 2))  # \u6539\u4e3a Numeric\n</code></pre></p> <p>\u6f5c\u5728\u95ee\u9898: - \u7c7b\u578b\u4e0d\u5339\u914d\u5bfc\u81f4\u67e5\u8be2\u5931\u8d25 - \u6570\u636e\u8f6c\u6362\u95ee\u9898 - \u9700\u8981\u6570\u636e\u5e93\u8fc1\u79fb</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#4","title":"\u573a\u666f 4: \u4fee\u6539\u5b57\u6bb5\u7ea6\u675f","text":"<p>\u521d\u59cb\u72b6\u6001 (v1): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)  # \u5141\u8bb8 NULL\n</code></pre></p> <p>\u5f00\u53d1\u8fc7\u7a0b\u4e2d (v2): <pre><code>class ItemDB(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String, nullable=False)  # \u4e0d\u5141\u8bb8 NULL\n</code></pre></p> <p>\u6f5c\u5728\u95ee\u9898: - \u73b0\u6709\u6570\u636e\u4e2d\u53ef\u80fd\u6709 NULL \u503c - \u6570\u636e\u5e93\u7ea6\u675f\u51b2\u7a81 - \u9700\u8981\u6570\u636e\u5e93\u8fc1\u79fb</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_2","title":"\ud83d\udee0\ufe0f \u89e3\u51b3\u65b9\u6848","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#1-alembic","title":"\u65b9\u6848 1: \u4f7f\u7528 Alembic (\u63a8\u8350)","text":"<p>Alembic \u662fSQLAlchemy \u5b98\u65b9\u7684\u6570\u636e\u5e93\u8fc1\u79fb\u5de5\u5177\uff0c\u63d0\u4f9b\uff1a - \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c - \u652f\u6301\u5411\u524d\u548c\u5411\u540e\u8fc1\u79fb - \u7248\u672c\u63a7\u5236 - Schema \u7248\u672c\u7ba1\u7406</p> <p>\u4f7f\u7528\u6b65\u9aa4: <pre><code># \u521d\u59cb\u5316 Alembic\nalembic init alembic\n\n# \u751f\u6210\u8fc1\u79fb\u811a\u672c\nalembic revision --autogenerate -m \"Add stock column\"\n\n# \u6267\u884c\u8fc1\u79fb\nalembic upgrade head\n\n# \u56de\u6eda\u8fc1\u79fb\nalembic downgrade -1\n</code></pre></p> <p>\u4e0e fastapi-easy \u96c6\u6210: <pre><code># \u5728\u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u5e94\u7528\u8fc1\u79fb\nfrom alembic.config import Config\nfrom alembic.script import ScriptDirectory\nfrom alembic.runtime.migration import MigrationContext\nfrom alembic.operations import Operations\n\ndef apply_migrations():\n    \"\"\"\u81ea\u52a8\u5e94\u7528\u6570\u636e\u5e93\u8fc1\u79fb\"\"\"\n    config = Config(\"alembic.ini\")\n    script = ScriptDirectory.from_config(config)\n\n    with engine.connect() as connection:\n        context = MigrationContext.configure(connection)\n        operations = Operations(context)\n\n        # \u6267\u884c\u8fc1\u79fb\n        for revision in script.walk_revisions():\n            if not context.get_current_revision() or \\\n               revision.revision &gt; context.get_current_revision():\n                operations.invoke(revision.upgrade)\n</code></pre></p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#2-schema","title":"\u65b9\u6848 2: Schema \u9a8c\u8bc1","text":"<p>\u5728\u5e94\u7528\u542f\u52a8\u65f6\u9a8c\u8bc1 Schema:</p> <pre><code>def validate_schema():\n    \"\"\"\u9a8c\u8bc1\u6570\u636e\u5e93 Schema \u4e0e ORM \u6a21\u578b\u662f\u5426\u5339\u914d\"\"\"\n    inspector = inspect(engine)\n\n    for table in Base.metadata.tables.values():\n        db_columns = {col['name']: col for col in inspector.get_columns(table.name)}\n        for column in table.columns:\n            if column.name not in db_columns:\n                raise ValueError(\n                    f\"Column {column.name} not found in table {table.name}. \"\n                    f\"Please run migrations: alembic upgrade head\"\n                )\n\n            db_column = db_columns[column.name]\n\n            # \u9a8c\u8bc1\u5217\u7c7b\u578b\n            if str(column.type) != str(db_column['type']):\n                raise ValueError(\n                    f\"Column {column.name} type mismatch in table {table.name}. \"\n                    f\"Expected {column.type}, got {db_column['type']}\"\n                )\n\n            # \u9a8c\u8bc1 nullable\n            if column.nullable != db_column['nullable']:\n                raise ValueError(\n                    f\"Column {column.name} nullable mismatch in table {table.name}. \"\n                    f\"Expected nullable={column.nullable}, got {db_column['nullable']}\"\n                )\n\n# \u5728\u5e94\u7528\u542f\u52a8\u65f6\u9a8c\u8bc1\n@app.on_event(\"startup\")\nasync def startup():\n    validate_schema()\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#3-crudrouter","title":"\u65b9\u6848 3: CRUDRouter \u4e2d\u7684\u8b66\u544a","text":"<p>\u5728 CRUDRouter \u4e2d\u6dfb\u52a0 Alembic \u68c0\u67e5:</p> <pre><code>import warnings\n\nclass CRUDRouter(APIRouter):\n    def __init__(self, schema, adapter, ...):\n        # \u68c0\u67e5\u662f\u5426\u8bbe\u7f6e\u4e86 Alembic\n        if not os.path.exists(\"alembic.ini\"):\n            warnings.warn(\n                \"Alembic not found. For production use, please set up Alembic \"\n                \"for database migrations: alembic init alembic\",\n                UserWarning\n            )\n\n        # \u9a8c\u8bc1 Schema\n        try:\n            validate_schema()\n        except ValueError as e:\n            raise RuntimeError(\n                f\"Database schema validation failed: {e}. \"\n                f\"Please run: alembic upgrade head\"\n            )\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#4_1","title":"\u65b9\u6848 4: \u6587\u6863\u548c\u6307\u5357","text":"<p>\u65b0\u589e\u6587\u6863: <code>docs/usage/18-database-migrations.md</code></p> <pre><code># \u6570\u636e\u5e93\u8fc1\u79fb\u6307\u5357\n\n## \u6982\u8ff0\n\n\u5f53\u4f60\u4fee\u6539 ORM \u6a21\u578b\u7684\u5b57\u6bb5\u65f6\uff0c\u9700\u8981\u540c\u6b65\u66f4\u65b0\u6570\u636e\u5e93 Schema\u3002\n\n## \u4f7f\u7528 Alembic\n\n### 1. \u5b89\u88c5 Alembic\n\n\\`\\`\\`bash\npip install alembic\n\\`\\`\\`\n\n### 2. \u521d\u59cb\u5316 Alembic\n\n\\`\\`\\`bash\nalembic init alembic\n\\`\\`\\`\n\n### 3. \u914d\u7f6e Alembic\n\n\u7f16\u8f91 `alembic/env.py`:\n\n\\`\\`\\`python\nfrom sqlalchemy import engine_from_config\nfrom sqlalchemy.pool import StaticPool\nfrom alembic import context\nfrom app.models import Base  # \u5bfc\u5165\u4f60\u7684 Base\n\ntarget_metadata = Base.metadata\n\ndef run_migrations_online():\n    configuration = config.get_section(config.config_ini_section)\n    configuration[\"sqlalchemy.url\"] = DATABASE_URL\n\n    connectable = engine_from_config(\n        configuration,\n        prefix=\"sqlalchemy.\",\n        poolclass=StaticPool,\n    )\n\n    with connectable.connect() as connection:\n        context.configure(\n            connection=connection, target_metadata=target_metadata\n        )\n\n        with context.begin_transaction():\n            context.run_migrations()\n\\`\\`\\`\n\n### 4. \u751f\u6210\u8fc1\u79fb\u811a\u672c\n\n\u4fee\u6539 ORM \u6a21\u578b\u540e:\n\n\\`\\`\\`bash\nalembic revision --autogenerate -m \"Add stock column\"\n\\`\\`\\`\n\n### 5. \u6267\u884c\u8fc1\u79fb\n\n\\`\\`\\`bash\nalembic upgrade head\n\\`\\`\\`\n\n### 6. \u56de\u6eda\u8fc1\u79fb\n\n\\`\\`\\`bash\nalembic downgrade -1\n\\`\\`\\`\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_3","title":"\ud83d\udccb \u5173\u952e\u98ce\u9669\u70b9","text":"\u98ce\u9669\u70b9 \u5f71\u54cd \u89e3\u51b3\u65b9\u6848 \u5b57\u6bb5\u6dfb\u52a0 ORM \u67e5\u8be2\u5931\u8d25 \u4f7f\u7528 Alembic \u8fc1\u79fb \u5b57\u6bb5\u5220\u9664 \u6570\u636e\u4e22\u5931 \u4f7f\u7528 Alembic \u8fc1\u79fb + \u5907\u4efd \u5b57\u6bb5\u7c7b\u578b\u4fee\u6539 \u7c7b\u578b\u4e0d\u5339\u914d \u4f7f\u7528 Alembic \u8fc1\u79fb \u5b57\u6bb5\u7ea6\u675f\u4fee\u6539 \u6570\u636e\u5e93\u7ea6\u675f\u51b2\u7a81 \u4f7f\u7528 Alembic \u8fc1\u79fb"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_4","title":"\ud83c\udfaf \u5efa\u8bae","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_5","title":"\u7acb\u5373\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udd34 \u9ad8)","text":"<ol> <li>\u6dfb\u52a0 Schema \u9a8c\u8bc1: \u5728\u5e94\u7528\u542f\u52a8\u65f6\u9a8c\u8bc1 Schema</li> <li>\u6dfb\u52a0 Alembic \u68c0\u67e5: \u5728 CRUDRouter \u4e2d\u68c0\u67e5 Alembic \u914d\u7f6e</li> <li>\u6dfb\u52a0\u6587\u6863: \u521b\u5efa\u6570\u636e\u5e93\u8fc1\u79fb\u6307\u5357</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_6","title":"\u4e2d\u671f\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udfe1 \u4e2d)","text":"<ol> <li>\u81ea\u52a8\u8fc1\u79fb: \u5728\u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u5e94\u7528\u8fc1\u79fb</li> <li>\u8fc1\u79fb\u76d1\u63a7: \u6dfb\u52a0\u8fc1\u79fb\u5386\u53f2\u548c\u76d1\u63a7</li> <li>\u6570\u636e\u5907\u4efd: \u5728\u8fc1\u79fb\u524d\u81ea\u52a8\u5907\u4efd</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_7","title":"\u957f\u671f\u884c\u52a8 (\u4f18\u5148\u7ea7: \ud83d\udfe2 \u4f4e)","text":"<ol> <li>\u8fc1\u79fb\u6d4b\u8bd5: \u6dfb\u52a0\u8fc1\u79fb\u6d4b\u8bd5\u5957\u4ef6</li> <li>\u8fc1\u79fb\u6587\u6863: \u8be6\u7ec6\u7684\u8fc1\u79fb\u6700\u4f73\u5b9e\u8df5</li> <li>\u8fc1\u79fb\u5de5\u5177: \u5f00\u53d1\u81ea\u52a8\u5316\u8fc1\u79fb\u5de5\u5177</li> </ol>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_ANALYSIS/#_8","title":"\ud83d\udcda \u53c2\u8003\u8d44\u6e90","text":"<ul> <li>Alembic \u5b98\u65b9\u6587\u6863</li> <li>SQLAlchemy ORM \u6587\u6863</li> <li>\u6570\u636e\u5e93\u8fc1\u79fb\u6700\u4f73\u5b9e\u8df5</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/","title":"\u6570\u636e\u5e93Schema\u8fc1\u79fb\u6700\u7ec8\u89e3\u51b3\u65b9\u6848","text":"<p>\u6587\u6863\u7248\u672c: 1.0 \u6700\u540e\u66f4\u65b0: 2025-11-28 \u4f18\u5148\u7ea7: \ud83d\udd34 \u9ad8 (\u751f\u4ea7\u73af\u5883\u5173\u952e) \u72b6\u6001: \u2705 \u5df2\u6279\u51c6\u5b9e\u65bd</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_1","title":"\ud83d\udccb \u6267\u884c\u6458\u8981","text":"<p>\u672c\u6587\u6863\u63d0\u51fa\u4e86\u4e00\u4e2a\u4e09\u5c42\u9012\u8fdb\u5f0f\u7684Schema\u8fc1\u79fb\u89e3\u51b3\u65b9\u6848\uff0c\u65e8\u5728\uff1a</p> <ol> <li>\u4fdd\u6301\u6846\u67b6\u7b80\u6d01\u6027 - \u4e0d\u8fc7\u5ea6\u8bbe\u8ba1\uff0c\u4e0d\u96c6\u6210Alembic</li> <li>\u63d0\u9ad8\u5f00\u53d1\u4f53\u9a8c - \u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a\u548c\u6307\u5bfc</li> <li>\u786e\u4fdd\u751f\u4ea7\u5b89\u5168 - \u542f\u52a8\u65f6\u9a8c\u8bc1\uff0c\u5feb\u901f\u5931\u8d25</li> <li>\u7ed9\u4e88\u7528\u6237\u9009\u62e9 - \u4ece\u81ea\u52a8\u68c0\u6d4b\u5230\u5b8c\u5168\u63a7\u5236</li> </ol> <p>\u6838\u5fc3\u539f\u5219: \u9690\u85cf = \u63d0\u4f9b\u5408\u7406\u9ed8\u8ba4\u503c + \u6e05\u6670\u9519\u8bef\u63d0\u793a + \u9003\u751f\u8231\u53e3</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_2","title":"\ud83c\udfaf \u95ee\u9898\u5b9a\u4e49","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_3","title":"\u5f53\u524d\u72b6\u6001","text":"<ul> <li>FastAPI-Easy \u81ea\u52a8\u751f\u6210 CRUD API (\u2705 \u5b8c\u6210)</li> <li>\u4f46\u4e0d\u5904\u7406\u6570\u636e\u5e93Schema\u53d8\u66f4 (\u274c \u7f3a\u5931)</li> <li>\u5f53ORM\u6a21\u578b\u4fee\u6539\u65f6\uff0c\u7528\u6237\u4e0d\u77e5\u9053\u600e\u4e48\u529e (\u274c \u4f53\u9a8c\u5dee)</li> <li>\u9519\u8bef\u5ef6\u8fdf\u5230\u751f\u4ea7\u73af\u5883 (\u274c \u98ce\u9669\u9ad8)</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_4","title":"\u6838\u5fc3\u75db\u70b9","text":"<pre><code>\u5f00\u53d1\u8005\u4fee\u6539 ORM \u6a21\u578b\n    \u2193\n\u5e94\u7528\u542f\u52a8\u65f6\u5d29\u6e83\n    \u2193\n\u9519\u8bef\u4fe1\u606f\u4e0d\u6e05\u695a\n    \u2193\n\u5f00\u53d1\u8005\u4e0d\u77e5\u9053\u600e\u4e48\u89e3\u51b3\n    \u2193\n\u751f\u4ea7\u73af\u5883\u6545\u969c \ud83d\udd25\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_5","title":"\ud83d\udca1 \u89e3\u51b3\u65b9\u6848\u67b6\u6784","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_6","title":"\u4e09\u5c42\u9012\u8fdb\u5f0f\u8bbe\u8ba1 (\u6539\u8fdb\u7248)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u7b2c 1 \u5c42: \u81ea\u52a8\u68c0\u6d4b + \u6e05\u6670\u63d0\u793a (\u6240\u6709\u7528\u6237)              \u2502\n\u2502 - \u542f\u52a8\u65f6\u9a8c\u8bc1 Schema                                  \u2502\n\u2502 - \u68c0\u6d4b\u5217\u6dfb\u52a0\u3001\u5220\u9664\u3001\u7c7b\u578b\u4fee\u6539\u3001\u7ea6\u675f\u4fee\u6539              \u2502\n\u2502 - \u63d0\u4f9b\u5177\u4f53\u7684\u89e3\u51b3\u6b65\u9aa4                                 \u2502\n\u2502 - \u7ed9\u51fa\u6587\u6863\u94fe\u63a5                                       \u2502\n\u2502 - \u652f\u6301 schema_sync_mode \u914d\u7f6e                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u7b2c 2 \u5c42: \u5f00\u53d1\u6a21\u5f0f\u652f\u6301 (\u5f00\u53d1\u73af\u5883)                     \u2502\n\u2502 - schema_sync_mode=\"auto_recreate\" \u81ea\u52a8\u91cd\u5efa\u8868       \u2502\n\u2502 - \u4ec5\u7528\u4e8e\u5f00\u53d1\u73af\u5883\uff0c\u4e0d\u7528\u4e8e\u751f\u4ea7                        \u2502\n\u2502 - \u81ea\u52a8\u6e05\u7406\u5b64\u7acb\u5217                                     \u2502\n\u2502 - \u652f\u6301\u5feb\u901f\u8fed\u4ee3                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u7b2c 3 \u5c42: \u5b8c\u5168\u63a7\u5236 (\u9ad8\u7ea7\u7528\u6237)                         \u2502\n\u2502 - \u81ea\u5b9a\u4e49 Schema \u9a8c\u8bc1\u5668                               \u2502\n\u2502 - \u81ea\u5b9a\u4e49\u8fc1\u79fb\u5904\u7406\u5668                                   \u2502\n\u2502 - \u7981\u7528\u81ea\u52a8\u68c0\u6d4b                                       \u2502\n\u2502 - \u81ea\u5b9a\u4e49\u7ea6\u675f\u9a8c\u8bc1\u89c4\u5219                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#schema_1","title":"Schema \u540c\u6b65\u6a21\u5f0f (\u65b0\u589e)","text":"\u6a21\u5f0f \u73af\u5883 \u884c\u4e3a \u7528\u9014 <code>validate</code> \u751f\u4ea7 \u53ea\u9a8c\u8bc1\uff0c\u4e0d\u4fee\u6539 \u786e\u4fdd Schema \u5339\u914d <code>auto_recreate</code> \u5f00\u53d1 \u81ea\u52a8\u91cd\u5efa\u8868 \u5feb\u901f\u8fed\u4ee3 <code>validate_lenient</code> \u6d4b\u8bd5 \u5141\u8bb8\u989d\u5916\u5217 \u7075\u6d3b\u6d4b\u8bd5"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_7","title":"\ud83d\udd27 \u5b9e\u73b0\u7ec6\u8282","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#1","title":"\u7b2c 1 \u5c42: \u81ea\u52a8\u68c0\u6d4b + \u6e05\u6670\u63d0\u793a (\u6539\u8fdb\u7248)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#11-schema","title":"1.1 Schema \u9a8c\u8bc1\u5668 (\u652f\u6301\u5f02\u6b65\u3001\u7c7b\u578b\u9002\u914d\u3001\u9519\u8bef\u6062\u590d)","text":"<p>\u6587\u4ef6: <code>src/fastapi_easy/core/schema_validator.py</code></p> <p>\u5173\u952e\u6539\u8fdb (\u57fa\u4e8e\u6f5c\u5728\u95ee\u9898\u5206\u6790): - \u2705 \u652f\u6301\u5f02\u6b65\u9a8c\u8bc1 (<code>validate_async()</code>) - \u2705 \u6570\u636e\u5e93\u7c7b\u578b\u89c4\u8303\u5316 (<code>TypeAdapter</code>) - \u2705 \u68c0\u6d4b\u591a\u4f59\u5217 (<code>_validate_extra_columns()</code>) - \u2705 \u7ea6\u675f\u9a8c\u8bc1 (<code>_validate_constraints()</code>) - \u2705 \u5f00\u53d1\u6a21\u5f0f (<code>_auto_recreate_tables()</code>) - \u2705 \u8be6\u7ec6\u65e5\u5fd7\u8bb0\u5f55</p> <p>\u6838\u5fc3\u529f\u80fd: - \u9a8c\u8bc1\u8868\u662f\u5426\u5b58\u5728 - \u9a8c\u8bc1\u5217\u662f\u5426\u5b58\u5728 - \u9a8c\u8bc1\u5217\u7c7b\u578b\u5339\u914d - \u9a8c\u8bc1 nullable \u7ea6\u675f - \u9a8c\u8bc1 unique \u548c default \u7ea6\u675f - \u68c0\u6d4b\u5b64\u7acb\u5217 (\u6570\u636e\u5e93\u4e2d\u6709\u4f46 ORM \u4e2d\u6ca1\u6709) - \u63d0\u4f9b\u6e05\u6670\u7684\u9519\u8bef\u6d88\u606f\u548c\u89e3\u51b3\u65b9\u6848</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#12-crudrouter","title":"1.2 \u96c6\u6210\u5230 CRUDRouter (\u6539\u8fdb\u7248)","text":"<p>\u4fee\u6539: <code>src/fastapi_easy/core/crud_router.py</code></p> <p>\u65b0\u589e\u53c2\u6570: - <code>schema_sync_mode</code>: Schema \u540c\u6b65\u6a21\u5f0f (validate, auto_recreate, validate_lenient)</p> <p>\u65b0\u589e\u65b9\u6cd5: - <code>validate_schema_async()</code>: \u5f02\u6b65\u9a8c\u8bc1 Schema - <code>_validate_with_lock()</code>: \u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u8fdb\u884c\u9a8c\u8bc1 - <code>_acquire_schema_lock()</code>: \u83b7\u53d6\u5206\u5e03\u5f0f\u9501 - <code>_release_schema_lock()</code>: \u91ca\u653e\u5206\u5e03\u5f0f\u9501</p> <p>\u96c6\u6210\u70b9: - \u5728 FastAPI \u7684 <code>lifespan</code> \u4e8b\u4ef6\u4e2d\u8c03\u7528 <code>validate_schema_async()</code> - \u652f\u6301\u591a\u5b9e\u4f8b\u90e8\u7f72 (\u4f7f\u7528\u5206\u5e03\u5f0f\u9501)</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#2","title":"\u7b2c 2 \u5c42: \u5f00\u53d1\u6a21\u5f0f\u652f\u6301 (\u6539\u8fdb\u7248)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#21","title":"2.1 \u5f00\u53d1\u73af\u5883\u5feb\u901f\u8fed\u4ee3","text":"<p>\u4f7f\u7528\u573a\u666f: - \u5f00\u53d1\u73af\u5883\u4e2d\u9891\u7e41\u4fee\u6539\u6a21\u578b - \u4e0d\u9700\u8981\u4fdd\u7559\u6570\u636e - \u9700\u8981\u5feb\u901f\u8fed\u4ee3</p> <p>\u914d\u7f6e: - \u5f00\u53d1\u73af\u5883: <code>schema_sync_mode=\"auto_recreate\"</code> (\u81ea\u52a8\u91cd\u5efa\u8868) - \u751f\u4ea7\u73af\u5883: <code>schema_sync_mode=\"validate\"</code> (\u53ea\u9a8c\u8bc1\uff0c\u4e0d\u4fee\u6539) - \u6d4b\u8bd5\u73af\u5883: <code>schema_sync_mode=\"validate_lenient\"</code> (\u5141\u8bb8\u989d\u5916\u5217)</p> <p>\u5de5\u4f5c\u6d41: 1. \u4fee\u6539 ORM \u6a21\u578b 2. \u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u91cd\u5efa\u8868 3. \u65e0\u9700\u624b\u52a8\u8fd0\u884c\u8fc1\u79fb\u547d\u4ee4 4. \u5feb\u901f\u6d4b\u8bd5\u65b0\u529f\u80fd</p> <p>\u8b66\u544a: \u26a0\ufe0f \u4ec5\u7528\u4e8e\u5f00\u53d1\u73af\u5883\uff0c\u751f\u4ea7\u73af\u5883\u5fc5\u987b\u4f7f\u7528 <code>validate</code> \u6a21\u5f0f</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#22","title":"2.2 \u8fc1\u79fb\u68c0\u67e5\u5668","text":"<p>\u6587\u4ef6: <code>src/fastapi_easy/core/migration_checker.py</code></p> <p>\u529f\u80fd: - \u68c0\u67e5 Alembic \u662f\u5426\u5df2\u521d\u59cb\u5316 - \u83b7\u53d6\u8fc1\u79fb\u72b6\u6001 - \u63d0\u4f9b\u521d\u59cb\u5316\u5efa\u8bae</p> <p>\u7528\u9014: - \u5728\u5e94\u7528\u542f\u52a8\u65f6\u68c0\u67e5\u8fc1\u79fb\u914d\u7f6e - \u4e3a\u7528\u6237\u63d0\u4f9b\u8bbe\u7f6e\u6307\u5bfc</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#3","title":"\u7b2c 3 \u5c42: \u5b8c\u5168\u63a7\u5236","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#31","title":"3.1 \u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5668\u63a5\u53e3","text":"<p>\u529f\u80fd: - \u652f\u6301\u81ea\u5b9a\u4e49 Schema \u9a8c\u8bc1\u5668 - \u652f\u6301\u81ea\u5b9a\u4e49\u7ea6\u675f\u9a8c\u8bc1\u89c4\u5219 - \u652f\u6301\u7981\u7528\u81ea\u52a8\u68c0\u6d4b</p> <p>\u5b9e\u73b0\u65b9\u5f0f: - \u63d0\u4f9b <code>CustomSchemaValidator</code> \u62bd\u8c61\u57fa\u7c7b - \u7528\u6237\u53ef\u4ee5\u7ee7\u627f\u5e76\u5b9e\u73b0\u81ea\u5b9a\u4e49\u903b\u8f91 - \u5728 CRUDRouter \u4e2d\u652f\u6301 <code>custom_schema_validator</code> \u53c2\u6570</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_8","title":"\ud83d\udcda \u6587\u6863\u548c\u6307\u5357","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#docsusage18-database-migrationsmd","title":"\u65b0\u589e\u6587\u6863: <code>docs/usage/18-database-migrations.md</code>","text":"<pre><code># \u6570\u636e\u5e93\u8fc1\u79fb\u6307\u5357\n\n## \u6982\u8ff0\n\n\u5f53\u4f60\u4fee\u6539 ORM \u6a21\u578b\u7684\u5b57\u6bb5\u65f6\uff0c\u9700\u8981\u540c\u6b65\u66f4\u65b0\u6570\u636e\u5e93 Schema\u3002\nFastAPI-Easy \u63d0\u4f9b\u4e86\u81ea\u52a8\u68c0\u6d4b\u548c\u6e05\u6670\u7684\u9519\u8bef\u63d0\u793a\u6765\u5e2e\u52a9\u4f60\u3002\n\n## \u5feb\u901f\u5f00\u59cb\n\n### 1. \u5b89\u88c5 Alembic\n\n\\`\\`\\`bash\npip install alembic\n\\`\\`\\`\n\n### 2. \u521d\u59cb\u5316 Alembic\n\n\\`\\`\\`bash\nalembic init alembic\n\\`\\`\\`\n\n### 3. \u914d\u7f6e Alembic\n\n\u7f16\u8f91 \\`alembic/env.py\\`:\n\n\\`\\`\\`python\nfrom sqlalchemy import engine_from_config\nfrom sqlalchemy.pool import StaticPool\nfrom alembic import context\nfrom app.models import Base  # \u5bfc\u5165\u4f60\u7684 Base\n\ntarget_metadata = Base.metadata\n\ndef run_migrations_online():\n    configuration = config.get_section(config.config_ini_section)\n    configuration[\"sqlalchemy.url\"] = \"your_database_url\"\n\n    connectable = engine_from_config(\n        configuration,\n        prefix=\"sqlalchemy.\",\n        poolclass=StaticPool,\n    )\n\n    with connectable.connect() as connection:\n        context.configure(\n            connection=connection, target_metadata=target_metadata\n        )\n\n        with context.begin_transaction():\n            context.run_migrations()\n\\`\\`\\`\n\n### 4. \u521b\u5efa\u521d\u59cb\u8fc1\u79fb\n\n\\`\\`\\`bash\nalembic revision --autogenerate -m \"Initial migration\"\n\\`\\`\\`\n\n### 5. \u5e94\u7528\u8fc1\u79fb\n\n\\`\\`\\`bash\nalembic upgrade head\n\\`\\`\\`\n\n## \u5e38\u89c1\u573a\u666f\n\n### \u573a\u666f 1: \u6dfb\u52a0\u65b0\u5b57\u6bb5\n\n\u4fee\u6539 ORM \u6a21\u578b:\n\n\\`\\`\\`python\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    stock = Column(Integer)  # \u65b0\u589e\u5b57\u6bb5\n\\`\\`\\`\n\n\u751f\u6210\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic revision --autogenerate -m \"Add stock column\"\n\\`\\`\\`\n\n\u5e94\u7528\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic upgrade head\n\\`\\`\\`\n\n### \u573a\u666f 2: \u5220\u9664\u5b57\u6bb5\n\n\u4fee\u6539 ORM \u6a21\u578b:\n\n\\`\\`\\`python\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String)\n    # \u5220\u9664\u4e86 description \u5b57\u6bb5\n\\`\\`\\`\n\n\u751f\u6210\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic revision --autogenerate -m \"Remove description column\"\n\\`\\`\\`\n\n**\u91cd\u8981**: \u68c0\u67e5\u751f\u6210\u7684\u8fc1\u79fb\u811a\u672c\uff0c\u786e\u4fdd\u6570\u636e\u5907\u4efd\u3002\n\n\u5e94\u7528\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic upgrade head\n\\`\\`\\`\n\n### \u573a\u666f 3: \u4fee\u6539\u5b57\u6bb5\u7c7b\u578b\n\n\u4fee\u6539 ORM \u6a21\u578b:\n\n\\`\\`\\`python\nclass Item(Base):\n    __tablename__ = \"items\"\n    id = Column(Integer, primary_key=True)\n    price = Column(Numeric(10, 2))  # \u4ece Float \u6539\u4e3a Numeric\n\\`\\`\\`\n\n\u751f\u6210\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic revision --autogenerate -m \"Change price type to Numeric\"\n\\`\\`\\`\n\n\u5e94\u7528\u8fc1\u79fb:\n\n\\`\\`\\`bash\nalembic upgrade head\n\\`\\`\\`\n\n## \u9519\u8bef\u6392\u67e5\n\n### \u9519\u8bef: \"Column 'xxx' not found in table 'yyy'\"\n\n**\u539f\u56e0**: \u4f60\u4fee\u6539\u4e86 ORM \u6a21\u578b\uff0c\u4f46\u6ca1\u6709\u5e94\u7528\u8fc1\u79fb\u3002\n\n**\u89e3\u51b3\u65b9\u6848**:\n\n1. \u751f\u6210\u8fc1\u79fb: \\`alembic revision --autogenerate -m \"Fix schema\"\\`\n2. \u5e94\u7528\u8fc1\u79fb: \\`alembic upgrade head\\`\n3. \u91cd\u542f\u5e94\u7528\n\n### \u9519\u8bef: \"Alembic is not initialized\"\n\n**\u539f\u56e0**: \u4f60\u6ca1\u6709\u521d\u59cb\u5316 Alembic\u3002\n\n**\u89e3\u51b3\u65b9\u6848**:\n\n1. \u5b89\u88c5 Alembic: \\`pip install alembic\\`\n2. \u521d\u59cb\u5316: \\`alembic init alembic\\`\n3. \u914d\u7f6e \\`alembic/env.py\\`\n4. \u521b\u5efa\u521d\u59cb\u8fc1\u79fb: \\`alembic revision --autogenerate -m \"Initial migration\"\\`\n5. \u5e94\u7528\u8fc1\u79fb: \\`alembic upgrade head\\`\n\n## \u6700\u4f73\u5b9e\u8df5\n\n1. **\u603b\u662f\u68c0\u67e5\u751f\u6210\u7684\u8fc1\u79fb\u811a\u672c** - Alembic \u7684\u81ea\u52a8\u751f\u6210\u4e0d\u662f 100% \u51c6\u786e\n2. **\u5728\u5e94\u7528\u5230\u751f\u4ea7\u524d\u6d4b\u8bd5\u8fc1\u79fb** - \u5728\u6d4b\u8bd5\u73af\u5883\u5148\u8fd0\u884c\u4e00\u904d\n3. **\u4fdd\u6301\u8fc1\u79fb\u811a\u672c\u5728\u7248\u672c\u63a7\u5236\u4e2d** - \u8fc1\u79fb\u811a\u672c\u662f\u4ee3\u7801\u7684\u4e00\u90e8\u5206\n4. **\u4e3a\u5927\u578b\u8fc1\u79fb\u521b\u5efa\u5907\u4efd** - \u5220\u9664\u6570\u636e\u524d\u5907\u4efd\u6570\u636e\u5e93\n5. **\u4f7f\u7528\u6709\u610f\u4e49\u7684\u8fc1\u79fb\u6d88\u606f** - \u5e2e\u52a9\u56e2\u961f\u7406\u89e3\u53d8\u66f4\n\n## \u53c2\u8003\u8d44\u6e90\n\n- [Alembic \u5b98\u65b9\u6587\u6863](https://alembic.sqlalchemy.org/)\n- [SQLAlchemy ORM \u6587\u6863](https://docs.sqlalchemy.org/en/20/orm/)\n- [FastAPI-Easy Schema \u9a8c\u8bc1](../SCHEMA_MIGRATION_FINAL_SOLUTION.md)\n</code></pre>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_9","title":"\ud83d\ude80 \u5b9e\u65bd\u8ba1\u5212 (\u6539\u8fdb\u7248)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#1-15","title":"\u7b2c 1 \u9636\u6bb5: \u6838\u5fc3\u5b9e\u73b0 (1.5 \u5468)","text":"<p>\u57fa\u7840\u529f\u80fd: - [ ] \u5b9e\u73b0 <code>SchemaValidator</code> \u7c7b (~200 \u884c) - [ ] \u5b9e\u73b0 <code>TypeAdapter</code> \u7c7b (\u7c7b\u578b\u89c4\u8303\u5316) - [ ] \u5b9e\u73b0 <code>_validate_extra_columns()</code> (\u68c0\u67e5\u591a\u4f59\u5217) - [ ] \u5b9e\u73b0 <code>_validate_constraints()</code> (\u7ea6\u675f\u9a8c\u8bc1) - [ ] \u5b9e\u73b0 <code>_auto_recreate_tables()</code> (\u5f00\u53d1\u6a21\u5f0f)</p> <p>\u96c6\u6210\u548c\u5f02\u6b65: - [ ] \u96c6\u6210\u5230 <code>CRUDRouter</code> (\u652f\u6301 <code>schema_sync_mode</code>) - [ ] \u5b9e\u73b0 <code>validate_schema_async()</code> (\u5f02\u6b65\u9a8c\u8bc1) - [ ] \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u673a\u5236 (\u591a\u5b9e\u4f8b\u652f\u6301) - [ ] \u6dfb\u52a0\u8be6\u7ec6\u65e5\u5fd7\u8bb0\u5f55</p> <p>\u6d4b\u8bd5: - [ ] \u5355\u5143\u6d4b\u8bd5 (~450 \u884c) - [ ] \u5f02\u6b65\u9a8c\u8bc1\u6d4b\u8bd5 - [ ] \u591a\u5b9e\u4f8b\u7ade\u6001\u6761\u4ef6\u6d4b\u8bd5</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#2-1","title":"\u7b2c 2 \u9636\u6bb5: \u6587\u6863\u548c\u793a\u4f8b (1 \u5468)","text":"<ul> <li> \u521b\u5efa\u8fc1\u79fb\u6307\u5357\u6587\u6863</li> <li> \u521b\u5efa\u793a\u4f8b: <code>examples/10_with_schema_migration.py</code> (\u5f00\u53d1\u6a21\u5f0f)</li> <li> \u521b\u5efa\u793a\u4f8b: <code>examples/11_with_schema_validation.py</code> (\u751f\u4ea7\u6a21\u5f0f)</li> <li> \u66f4\u65b0 README.md</li> <li> \u66f4\u65b0\u5feb\u901f\u5f00\u59cb\u6307\u5357</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#3-15","title":"\u7b2c 3 \u9636\u6bb5: \u6d4b\u8bd5\u548c\u9a8c\u8bc1 (1.5 \u5468)","text":"<ul> <li> \u96c6\u6210\u6d4b\u8bd5 (~300 \u884c)</li> <li> \u7aef\u5230\u7aef\u6d4b\u8bd5 (~200 \u884c)</li> <li> \u591a\u6570\u636e\u5e93\u517c\u5bb9\u6027\u6d4b\u8bd5 (PostgreSQL, MySQL, SQLite)</li> <li> \u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5 (\u542f\u52a8\u65f6\u95f4)</li> <li> \u7528\u6237\u53cd\u9988\u6536\u96c6</li> <li> \u6587\u6863\u5ba1\u67e5</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#4-1","title":"\u7b2c 4 \u9636\u6bb5: \u53d1\u5e03 (1 \u5468)","text":"<ul> <li> \u7248\u672c\u53f7\u66f4\u65b0: 0.1.4</li> <li> \u53d1\u5e03\u8bf4\u660e (\u5305\u542b\u7834\u574f\u6027\u53d8\u66f4\u8bf4\u660e)</li> <li> \u793e\u533a\u901a\u77e5</li> <li> \u76d1\u63a7\u7528\u6237\u53cd\u9988</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_10","title":"\u2705 \u9a8c\u6536\u6807\u51c6 (\u6539\u8fdb\u7248)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_11","title":"\u529f\u80fd\u9a8c\u6536","text":"<p>\u7b2c 1 \u5c42 (\u57fa\u7840): - [ ] Schema \u9a8c\u8bc1\u5728\u542f\u52a8\u65f6\u6267\u884c - [ ] \u68c0\u6d4b\u5217\u6dfb\u52a0\u3001\u5220\u9664\u3001\u7c7b\u578b\u4fee\u6539 - [ ] \u68c0\u6d4b\u7ea6\u675f\u4fee\u6539 (nullable, unique, default) - [ ] \u68c0\u6d4b\u591a\u4f59\u5217 (\u5b64\u7acb\u5217) - [ ] \u9519\u8bef\u6d88\u606f\u6e05\u6670\u4e14\u53ef\u64cd\u4f5c - [ ] \u63d0\u4f9b\u6587\u6863\u94fe\u63a5</p> <p>\u7b2c 2 \u5c42 (\u5f00\u53d1\u6a21\u5f0f): - [ ] <code>schema_sync_mode=\"auto_recreate\"</code> \u81ea\u52a8\u91cd\u5efa\u8868 - [ ] \u5f00\u53d1\u6a21\u5f0f\u4e0b\u65e0\u9700\u624b\u52a8\u8fc1\u79fb - [ ] \u81ea\u52a8\u6e05\u7406\u5b64\u7acb\u5217</p> <p>\u7b2c 3 \u5c42 (\u9ad8\u7ea7): - [ ] \u652f\u6301\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5668 - [ ] \u652f\u6301\u81ea\u5b9a\u4e49\u7ea6\u675f\u89c4\u5219 - [ ] \u652f\u6301\u7981\u7528\u81ea\u52a8\u9a8c\u8bc1</p> <p>\u5f02\u6b65\u548c\u5e76\u53d1: - [ ] \u5f02\u6b65\u9a8c\u8bc1 (<code>validate_schema_async()</code>) - [ ] \u5206\u5e03\u5f0f\u9501\u652f\u6301 (\u591a\u5b9e\u4f8b) - [ ] \u8be6\u7ec6\u65e5\u5fd7\u8bb0\u5f55</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_12","title":"\u6587\u6863\u9a8c\u6536","text":"<ul> <li> \u8fc1\u79fb\u6307\u5357\u5b8c\u6574 (\u5305\u62ec\u5f00\u53d1\u6a21\u5f0f)</li> <li> \u793a\u4f8b\u4ee3\u7801\u53ef\u8fd0\u884c (\u5f00\u53d1\u548c\u751f\u4ea7)</li> <li> \u5e38\u89c1\u95ee\u9898\u5df2\u89e3\u7b54</li> <li> \u6700\u4f73\u5b9e\u8df5\u5df2\u8bf4\u660e</li> <li> \u6027\u80fd\u57fa\u51c6\u5df2\u8bf4\u660e</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_13","title":"\u6d4b\u8bd5\u9a8c\u6536","text":"<ul> <li> \u5355\u5143\u6d4b\u8bd5\u8986\u76d6 &gt; 85%</li> <li> \u96c6\u6210\u6d4b\u8bd5\u901a\u8fc7 (\u6240\u6709 ORM)</li> <li> \u7aef\u5230\u7aef\u6d4b\u8bd5\u901a\u8fc7</li> <li> \u591a\u6570\u636e\u5e93\u517c\u5bb9\u6027\u6d4b\u8bd5\u901a\u8fc7</li> <li> \u6027\u80fd\u57fa\u51c6: \u542f\u52a8\u65f6\u95f4 &lt; 2 \u79d2 (100 \u4e2a\u8868)</li> <li> \u5f02\u6b65\u9a8c\u8bc1\u6d4b\u8bd5\u901a\u8fc7</li> <li> \u591a\u5b9e\u4f8b\u7ade\u6001\u6761\u4ef6\u6d4b\u8bd5\u901a\u8fc7</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_14","title":"\ud83d\udcca \u9884\u671f\u6548\u679c","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_15","title":"\u5f00\u53d1\u4f53\u9a8c\u6539\u8fdb","text":"\u6307\u6807 \u6539\u8fdb\u524d \u6539\u8fdb\u540e \u63d0\u5347 \u9519\u8bef\u68c0\u6d4b\u65f6\u95f4 \u751f\u4ea7\u73af\u5883 \u542f\u52a8\u65f6 \u7acb\u5373 \u9519\u8bef\u4fe1\u606f\u6e05\u6670\u5ea6 \u6a21\u7cca \u6e05\u6670 \u2b06\ufe0f\u2b06\ufe0f\u2b06\ufe0f \u89e3\u51b3\u95ee\u9898\u65f6\u95f4 30 \u5206\u949f 5 \u5206\u949f 6x \u7528\u6237\u56f0\u60d1\u5ea6 \u9ad8 \u4f4e \u2b07\ufe0f\u2b07\ufe0f\u2b07\ufe0f"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_16","title":"\u751f\u4ea7\u73af\u5883\u98ce\u9669\u964d\u4f4e","text":"\u98ce\u9669 \u6539\u8fdb\u524d \u6539\u8fdb\u540e Schema \u4e0d\u5339\u914d\u5bfc\u81f4\u6545\u969c \u9ad8 \u4f4e \u6570\u636e\u4e22\u5931 \u4e2d \u4f4e \u505c\u673a\u65f6\u95f4 \u957f \u77ed"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_17","title":"\ud83d\udd04 \u540e\u7eed\u6539\u8fdb\u65b9\u5411","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_18","title":"\u77ed\u671f (\u4e0b\u4e00\u4e2a\u7248\u672c)","text":"<ul> <li> \u81ea\u52a8\u8fc1\u79fb\u5efa\u8bae</li> <li> \u8fc1\u79fb\u524d\u7684\u786e\u8ba4\u5bf9\u8bdd</li> <li> \u8fc1\u79fb\u5386\u53f2\u8ffd\u8e2a</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#2-3","title":"\u4e2d\u671f (2-3 \u4e2a\u7248\u672c\u540e)","text":"<ul> <li> \u96c6\u6210 Alembic \u521d\u59cb\u5316</li> <li> \u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c</li> <li> \u8fc1\u79fb\u6d4b\u8bd5\u5de5\u5177</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_19","title":"\u957f\u671f (\u793e\u533a\u53cd\u9988\u540e)","text":"<ul> <li> \u8fc1\u79fb\u7248\u672c\u7ba1\u7406</li> <li> \u591a\u73af\u5883\u8fc1\u79fb\u652f\u6301</li> <li> \u8fc1\u79fb\u6027\u80fd\u4f18\u5316</li> </ul>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_20","title":"\ud83d\udcdd \u603b\u7ed3","text":"<p>\u8fd9\u4e2a\u4e09\u5c42\u9012\u8fdb\u5f0f\u7684\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u7b2c 1 \u5c42 - \u4e3a\u6240\u6709\u7528\u6237\u63d0\u4f9b\u57fa\u7840\u4fdd\u62a4</li> <li>\u7b2c 2 \u5c42 - \u4e3a\u4e2d\u7ea7\u7528\u6237\u63d0\u4f9b\u4fbf\u5229</li> <li>\u7b2c 3 \u5c42 - \u4e3a\u9ad8\u7ea7\u7528\u6237\u63d0\u4f9b\u5b8c\u5168\u63a7\u5236</li> </ol> <p>\u4f18\u70b9: - \u2705 \u4fdd\u6301\u6846\u67b6\u7b80\u6d01 - \u2705 \u63d0\u9ad8\u5f00\u53d1\u4f53\u9a8c - \u2705 \u786e\u4fdd\u751f\u4ea7\u5b89\u5168 - \u2705 \u7ed9\u4e88\u7528\u6237\u9009\u62e9</p> <p>\u4e0d\u8db3: - \u4ecd\u9700\u7528\u6237\u5b66\u4e60 Alembic - \u4e0d\u80fd\u5b8c\u5168\u81ea\u52a8\u5316\u8fc1\u79fb - \u9700\u8981\u7528\u6237\u4e3b\u52a8\u6267\u884c\u8fc1\u79fb</p> <p>\u7ed3\u8bba: \u8fd9\u662f\u5728\u7b80\u6d01\u6027\u548c\u5b8c\u6574\u6027\u4e4b\u95f4\u7684\u6700\u4f18\u5e73\u8861\u3002</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_21","title":"\u26a0\ufe0f \u6f5c\u5728\u95ee\u9898\u5206\u6790\u4e0e\u6539\u8fdb","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_22","title":"\u9ad8\u4f18\u5148\u7ea7\u95ee\u9898 (\u5fc5\u987b\u89e3\u51b3)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#1_1","title":"\u95ee\u9898 1: \u7f3a\u5c11\u5f02\u6b65\u652f\u6301 \ud83d\udd34","text":"<p>\u95ee\u9898: \u5f53\u524d\u7684 <code>validate()</code> \u662f\u540c\u6b65\u65b9\u6cd5\uff0c\u4f1a\u963b\u585e\u5f02\u6b65\u5e94\u7528\u542f\u52a8\u3002</p> <p>\u5f71\u54cd: SQLAlchemy \u5f02\u6b65\u3001Tortoise ORM\u3001MongoDB \u7b49\u5f02\u6b65 ORM</p> <p>\u89e3\u51b3\u65b9\u6848: <pre><code>class SchemaValidator:\n    def validate(self) -&gt; None:\n        \"\"\"\u540c\u6b65\u9a8c\u8bc1\"\"\"\n        pass\n\n    async def validate_async(self) -&gt; None:\n        \"\"\"\u5f02\u6b65\u9a8c\u8bc1 - \u652f\u6301\u5f02\u6b65\u6570\u636e\u5e93\u8fde\u63a5\"\"\"\n        async with self.engine.begin() as conn:\n            inspector = inspect(conn)\n            # ... \u9a8c\u8bc1\u903b\u8f91\n</code></pre></p> <p>\u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#2_1","title":"\u95ee\u9898 2: \u6570\u636e\u5e93\u7c7b\u578b\u517c\u5bb9\u6027 \ud83d\udd34","text":"<p>\u95ee\u9898: \u5b57\u7b26\u4e32\u6bd4\u8f83 <code>str(orm_type) != str(db_type)</code> \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e2d\u5931\u8d25\u3002</p> <p>\u793a\u4f8b: - PostgreSQL: <code>VARCHAR(50)</code> vs <code>character varying(50)</code> \u274c - MySQL: <code>INTEGER</code> vs <code>int</code> \u274c - SQLite: <code>TEXT</code> vs <code>text</code> \u274c</p> <p>\u89e3\u51b3\u65b9\u6848: <pre><code>class TypeAdapter:\n    \"\"\"\u6570\u636e\u5e93\u7c7b\u578b\u9002\u914d\u5668\"\"\"\n\n    @staticmethod\n    def normalize_type(db_type: str, dialect: str) -&gt; str:\n        \"\"\"\u89c4\u8303\u5316\u6570\u636e\u5e93\u7c7b\u578b\"\"\"\n        type_map = {\n            'postgresql': {'character varying': 'VARCHAR', 'integer': 'INTEGER'},\n            'mysql': {'varchar': 'VARCHAR', 'int': 'INTEGER'},\n            'sqlite': {'text': 'TEXT'},\n        }\n        mapping = type_map.get(dialect, {})\n        return mapping.get(db_type.lower(), db_type)\n</code></pre></p> <p>\u5de5\u4f5c\u91cf: 3-4 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#3_1","title":"\u95ee\u9898 3: \u7f3a\u5c11\u9519\u8bef\u6062\u590d\u673a\u5236 \ud83d\udd34","text":"<p>\u95ee\u9898: Schema \u9a8c\u8bc1\u5931\u8d25\u65f6\u5e94\u7528\u7acb\u5373\u5d29\u6e83\uff0c\u65e0\u6cd5\u6062\u590d\u3002</p> <p>\u573a\u666f: - \u5f00\u53d1\u73af\u5883: \u60f3\u5feb\u901f\u6d4b\u8bd5\uff0c\u4f46 Schema \u4e0d\u5339\u914d - \u751f\u4ea7\u73af\u5883: Schema \u9a8c\u8bc1\u5931\u8d25\u5bfc\u81f4\u670d\u52a1\u4e2d\u65ad - \u6d4b\u8bd5\u73af\u5883: Schema \u53ef\u80fd\u4e0d\u5b8c\u5168\u5339\u914d</p> <p>\u89e3\u51b3\u65b9\u6848: <pre><code>class SchemaValidator:\n    def __init__(\n        self,\n        engine,\n        base,\n        strict_mode: bool = True,  # \u4e25\u683c\u6a21\u5f0f\n        ignore_fields: List[str] = None,  # \u5ffd\u7565\u7684\u5b57\u6bb5\n        allow_extra_columns: bool = False,  # \u5141\u8bb8\u989d\u5916\u5217\n    ):\n        self.strict_mode = strict_mode\n        self.ignore_fields = ignore_fields or []\n        self.allow_extra_columns = allow_extra_columns\n\n    def validate(self) -&gt; ValidationResult:\n        \"\"\"\u8fd4\u56de\u9a8c\u8bc1\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\"\"\"\n        result = ValidationResult()\n        for table in self.base.metadata.tables.values():\n            try:\n                self._validate_table(table)\n            except SchemaValidationError as e:\n                if self.strict_mode:\n                    raise\n                else:\n                    result.add_warning(str(e))\n        return result\n</code></pre></p> <p>\u5de5\u4f5c\u91cf: 4-5 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_23","title":"\u4e2d\u4f18\u5148\u7ea7\u95ee\u9898 (\u5e94\u8be5\u89e3\u51b3)","text":""},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#4","title":"\u95ee\u9898 4: \u5e76\u53d1\u8bbf\u95ee\u7ade\u6001\u6761\u4ef6 \ud83d\udfe1","text":"<p>\u95ee\u9898: \u591a\u4e2a\u5e94\u7528\u5b9e\u4f8b\u540c\u65f6\u542f\u52a8\u65f6\u7684\u7ade\u6001\u6761\u4ef6\u3002</p> <p>\u89e3\u51b3\u65b9\u6848: \u4f7f\u7528\u6570\u636e\u5e93\u7ea7\u522b\u7684\u5206\u5e03\u5f0f\u9501</p> <p>\u5de5\u4f5c\u91cf: 2-3 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#5","title":"\u95ee\u9898 5: \u6027\u80fd\u4f18\u5316 \ud83d\udfe1","text":"<p>\u95ee\u9898: \u5bf9\u6bcf\u4e2a\u8868\u548c\u5217\u90fd\u8fdb\u884c\u5355\u72ec\u7684\u6570\u636e\u5e93\u67e5\u8be2\uff0c\u5bfc\u81f4\u542f\u52a8\u7f13\u6162\u3002</p> <p>\u4f18\u5316: \u6279\u91cf\u83b7\u53d6\u8868\u548c\u5217\u4fe1\u606f</p> <p>\u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#6","title":"\u95ee\u9898 6: \u81ea\u5b9a\u4e49\u7c7b\u578b\u652f\u6301 \ud83d\udfe1","text":"<p>\u95ee\u9898: \u7528\u6237\u81ea\u5b9a\u4e49\u7684 SQLAlchemy \u7c7b\u578b (TypeDecorator) \u65e0\u6cd5\u9a8c\u8bc1\u3002</p> <p>\u89e3\u51b3\u65b9\u6848: \u9012\u5f52\u83b7\u53d6\u5b9e\u73b0\u7c7b\u578b\u8fdb\u884c\u6bd4\u8f83</p> <p>\u5de5\u4f5c\u91cf: 1-2 \u5c0f\u65f6</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_24","title":"\u4fee\u6539\u540e\u7684\u5de5\u4f5c\u91cf\u4f30\u8ba1","text":"\u9879\u76ee \u539f\u59cb \u6539\u8fdb\u540e \u589e\u52a0 \u6838\u5fc3\u4ee3\u7801 350 \u884c 550 \u884c +200 \u5355\u5143\u6d4b\u8bd5 300 \u884c 450 \u884c +150 \u96c6\u6210\u6d4b\u8bd5 200 \u884c 300 \u884c +100 \u7aef\u5230\u7aef\u6d4b\u8bd5 150 \u884c 200 \u884c +50 \u6587\u6863 600 \u884c 800 \u884c +200 \u603b\u8ba1 1600 \u884c 2300 \u884c +700 \u884c \u65f6\u95f4 2-3 \u5468 3-4 \u5468 +1 \u5468"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_25","title":"\u6539\u8fdb\u5efa\u8bae","text":"<p>\u7acb\u5373\u5b9e\u65bd (\u7b2c 1 \u9636\u6bb5\u524d): - \u2705 \u5f02\u6b65\u652f\u6301 (2-3 \u5c0f\u65f6) - \u2705 \u7c7b\u578b\u517c\u5bb9\u6027 (3-4 \u5c0f\u65f6) - \u2705 \u9519\u8bef\u6062\u590d (4-5 \u5c0f\u65f6)</p> <p>\u7b2c 1 \u9636\u6bb5\u4e2d\u8fdb\u884c: - \u2705 \u6027\u80fd\u4f18\u5316 (1-2 \u5c0f\u65f6) - \u2705 \u81ea\u5b9a\u4e49\u7c7b\u578b\u652f\u6301 (1-2 \u5c0f\u65f6)</p> <p>\u540e\u7eed\u7248\u672c: - \u5e76\u53d1\u8bbf\u95ee\u5904\u7406 - \u8fc1\u79fb\u5386\u53f2\u8ffd\u8e2a - \u56de\u6eda\u652f\u6301</p>"},{"location":"%E8%BF%87%E6%97%B6/SCHEMA_MIGRATION_FINAL_SOLUTION/#_26","title":"\ud83d\udcde \u53cd\u9988\u548c\u8ba8\u8bba","text":"<p>\u5982\u6709\u5efa\u8bae\u6216\u95ee\u9898\uff0c\u8bf7\u5728\u4ee5\u4e0b\u6e20\u9053\u53cd\u9988\uff1a</p> <ul> <li>GitHub Issues: https://github.com/ardss/fastapi-easy/issues</li> <li>\u8ba8\u8bba\u533a: https://github.com/ardss/fastapi-easy/discussions</li> <li>\u90ae\u4ef6: 1339731209@qq.com</li> </ul>"}]}