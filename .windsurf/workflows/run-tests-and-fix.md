---
description: 
auto_execution_mode: 3
---

# /运行测试并修复

在提交、合并或部署前自动运行测试并修复错误的工作流。

## 步骤

1. **运行所有测试检查当前状态**

   ```bash
   python -m pytest tests/ -v --tb=short
   ```

2. **分析测试结果**
   - 统计通过、失败和跳过的测试数量
   - 识别常见的失败模式
   - 按类型分类错误（导入错误、类型错误、断言错误等）

3. **对于每个失败的测试，执行以下操作：**
   a. 阅读测试文件以理解被测试的内容
   b. 阅读被测试的源文件
   c. 分析错误消息并识别根本原因
   d. 如果是简单的修复（缺少导入、拼写错误、类型错误），立即修复
   e. 如果是复杂问题，请求澄清或提出解决方案
   f. 修复后，重新运行特定测试以验证修复

4. **再次运行完整测试套件**

   ```bash
   python -m pytest tests/ -v --tb=short
   ```

5. **如果所有测试都通过：**
   - 生成修复内容的总结
   - 建议使用描述性消息提交更改
   - 如果需要，提供覆盖率报告

6. **如果测试仍然失败：**
   - 提供剩余失败的详细分析
   - 建议解决的后续步骤
   - 询问用户如何继续

## 覆盖率报告（可选）

如果你想查看代码覆盖率：

```bash
python -m pytest tests/ --cov=src/fastapi_easy --cov-report=term-missing
```

## 测试级别

你可以运行特定的测试级别：

- **仅单元测试**: `python -m pytest tests/ -m unit -v`
- **仅集成测试**: `python -m pytest tests/ -m integration -v`
- **仅端到端测试**: `python -m pytest tests/ -m e2e -v`

## 最佳实践

- 提交前始终运行测试
- 一次修复一个错误
- 每次修复后重新运行测试以确保没有回归
- 保留测试输出用于文档
- 修复错误时更新测试以防止回归
